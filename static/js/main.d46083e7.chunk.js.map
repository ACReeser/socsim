{"version":3,"sources":["events/Events.tsx","simulation/Institutions.tsx","simulation/Utils.tsx","simulation/Geography.tsx","simulation/Occupation.tsx","petri-ui/Building.tsx","simulation/Priorities.tsx","simulation/Agent.tsx","simulation/Beliefs.tsx","simulation/Bean.tsx","simulation/Time.tsx","WorldGen.tsx","simulation/Economy.tsx","World.tsx","simulation/Politics.tsx","simulation/Government.tsx","Game.tsx","simulation/Player.tsx","WorldSound.tsx","simulation/MarketTraits.tsx","simulation/City.tsx","simulation/RealEstate.tsx","widgets/Modal.tsx","widgets/NeedReadout.tsx","widgets/CardButton.tsx","right-panel/OverviewPanel.tsx","petri-ui/AnimatedUFO.tsx","widgets/particles.tsx","petri-ui/AnimatedSpotlight.tsx","petri-ui/AnimatedBean.tsx","petri-ui/AnimatedPickup.tsx","petri-ui/Mover.tsx","petri-ui/Buildings.tsx","petri-ui/Magnet.tsx","petri-ui/WorldTile.tsx","modal-content/EconomyReport.tsx","right-panel/Events.tsx","widgets/CostSmall.tsx","right-panel/BeanPanel.tsx","modal-content/FoundParty.tsx","widgets/BubbleText.tsx","widgets/SocialGraph.tsx","widgets/CapsuleLabel.tsx","right-panel/Goals.tsx","modal-content/Campaigns.tsx","widgets/TreasuryReport.tsx","modal-content/Gov.tsx","widgets/ConfirmButton.tsx","widgets/RobotArm.tsx","modal-content/Research.tsx","widgets/StopPlayFast.tsx","chrome/Subtab.tsx","right-panel/HexPanel.tsx","widgets/StringDropdown.tsx","modal-content/BeliefRow.tsx","modal-content/Brainwashing.tsx","widgets/TimelyEventToggle.tsx","right-panel/MarketPanel.tsx","modal-content/TraitsReport.tsx","modal-content/GreetingPanel.tsx","App.tsx","serviceWorker.js","index.js"],"names":["PubSub","onPublish","callbacks","args","this","forEach","c","callback","push","splice","indexOf","ChangePubSub","EventBus","buffer","sendToBuffer","event","length","pop","unshift","speechcrime","nojobslots","birth","death","marketrefresh","persuasion","Live","current","onChange","afterSetBeforePublish","newValue","publish","LiveList","onPush","child","set","get","all","i","LiveMap","onAdd","newKey","copy","Map","k","v","key","delete","EnterpriseTypes","EnterpriseTypeIcon","isEnterprise","b","undefined","enterpriseType","Charity","name","institutionKey","cash","ticksSinceLastSale","seasonalBudget","good","parentInstitution","beansHelped","inventory","law","economy","tryTransact","MathClamp","input","min","max","Math","Hex","q","r","hex_directions","hex_direction","direction","hex_neighbor","hex","dir","hex_ring","center","radius","a","results","cube","hex_add","j","accelerate_towards","mover","target","acceleration","maxSpeed","colDistance","brake","delta","x","point","y","magnitude","sqrt","velocity","accelerator_coast","lerp","t","cube_lerp","z","cube_round","rx","round","ry","rz","x_diff","abs","y_diff","z_diff","cube_to_axial","axial_to_cube","cube_linedraw","N","cube_distance","layout_flat","f0","f1","f2","f3","b0","b1","b2","b3","start_angle","origin_point","hex_to_pixel","size","origin","h","M","polarToPoint","p","cos","az","sin","transformPoint","transform","BuildingJobSlot","CityBook","_db","map","yellow","white","db","buildIndexes","keys","Array","from","ix","address","group","type","concat","add","remove","values","buildingType","GetRandom","at","BuildingIcon","UpgradedBuildingIcon","BuildingJobIcon","BuildingToGood","GoodToBuilding","JobToBuilding","Geography","book","numberOfRings","hexes","hex_spiral","hex_size","petriRadius","petriOrigin","building","addBuilding","where","removeBuilding","buildingKey","ent","slot_size","getSlotOffset","hexToTransform","hexDirectionToJobSlot","2","first","0","second","4","third","1","fourth","5","fifth","3","sixth","PetriBuilding","props","style","cityName","city","getStyle","UIBuilding","className","upgraded","UIBuildingSlots","d","jobSlot","hasJob","job_slots","PriorityNode","value","priority","DumbPriorityQueue","_values","sort","shift","PriorityQueue","index1","index2","temp","index","parentIndex","floor","swap","bubbleUp","elementPriority","leftChildIndex","rightChildIndex","leftChildPriority","rightChildPriority","indexToSwap","poppedNode","bubbleDown","ChangeState","agent","newState","state","exit","enter","AgentState","data","elapsed","deltaMS","difficulty","_act","Elapsed","Bean","activity_duration","act","intent","GoodIcon","ActivityDisplay","IdleState","priorities","GetPriorities","top","dequeue","travelState","substituteIntent","TravelState","createFromIntent","maybeParanoid","desiredGoodState","canBuy","maybeCrime","emote","maybeScarcity","destinations","isNaN","BeanPhysics","AccelerateS","MaxSpeed","CollisionDistance","Brake","location","onMove","ActToState","create","nearby","getNearestNeighbors","maybeChat","targets","filter","nn","chat","getRandomChat","ChatState","participation","believesIn","random","destination","RouteRandom","job","getRandomEntertainmentBuilding","destinationKey","Route","IntentToDestination","createFromDestination","WorkState","work","BuyState","sinceLastAttemptMS","_bought","buy","tryBuy","MaximumBuyDuration","tState","lastChatMS","Date","now","maybeAntagonised","maybeEnthused","preachBelief","persuasionStrength","maybePersuade","RelaxState","durationMS","discrete_fun","CrimeState","steal","GetPriority","bean","inventory_priority","market","getStakeListings","employerEnterpriseKey","JobToGood","quantity","wealth_priority","costOfLiving","discrete_food","bean_life","vital_thresh","food","warning","sufficient","discrete_health","medicine","discrete_stamina","shelter","queue","node","enqueue","geo","getRandomBuildingOfType","start","nearestHex","pt","pixel_to_hex","offset","CommonalityChances","PrimaryBeliefData","prog","noun","adj","icon","description","rarity","trad","ego","NarrativeBeliefData","rocket","dragon","music","noFaith","SecondaryBeliefData","Diligence","Natalism","Antinatalism","Progressivism","Libertarianism","Wanderlust","Germophobia","Parochialism","Cosmopolitanism","Capitalism","Socialism","Communism","Fraud","Naturalism","Hedonism","Gluttony","Paranoia","Depression","Optimism","Authority","Anarchism","Greed","Bloodthirst","Extroversion","Introversion","Charisma","Gossip","Antagonism","Enthusiasm","Sadism","Vandalism","Neuroticism","Dogmatism","IsBeliefDivergent","belief","utopiaMotive","utopiaCommunity","idealCon","reduce","isDivergent","con","IsIdealDivergent","BeliefsAll","Object","RandomBeliefBucket","list","str","slots","GetHedonReport","hedonHistory","flatAverage","weightedAverage","maxSource","minSource","allSum","day","daySum","sources","source","allSources","val","Season","Hour","cityKey","dob","year","season","hour","bornInPetri","discrete_sanity","lifecycle","activity_queue","speed","ethnicity","stamina","community","ideals","faith","beliefs","graceTicks","happiness","hedonFiveDayRecord","lastHappiness","ticksSinceLastRelax","fairGoodPrice","buyFood","buyMeds","fun","buyFun","buyHousing","jobQueue","onAct","amount","multiplier","econ","homeCity","mods","TraitToModifier","health","reason","mod","majorityEthnicity","MaslowHappinessScore","Deficient","getCostOfLiving","party","result","myGood","getFairGoodPrice","traits","policies","policy","fx","mag","bad","idea","canBaby","crimeReason","roll","chance","trySetJob","eventBus","trigger","message","tryGetJob","unsetJob","cost","sanityBonus","sanity","ifBelievesInMaybeEmote","strength","includes","defense","GetRandomNumber","beanKey","needy","least","targetBeanKey","GoodToThreshold","beans","newJob","mostInDemandJob","workedForEmployer","employer","getEnterprise","employAndPrice","ownerBeanKey","produceAndPrice","groceries","bought","stolen","housing","diff","alive","wasNotHungry","wasNotSick","degrade_per_tick","maybeDie","isInCrisis","meds","babyChance","ArrayBuffer","ints","Int8Array","window","crypto","getRandomValues","DataView","getFloat64","GetRandomFloat","breedBean","EmotionSanity","EmotionWorth","addEmotePickup","cause","isDire","die","pains","historicalBeans","scarce","player","abductedBeans","abundant","base","AllGoods","Economy","OrderBook","charity","unfulfilledMonthlyDemand","monthlyDemand","monthlySupply","buyer","minDemand","maxDemand","listing","getLowestPriceListing","actualDemand","price","salesTaxPercentage","receipt","transact","tax","treasury","PurchaseQualifiesForWelfare","CanPayWelfare","governmentTransact","listings","subtractFromListing","seller","existing","getBeansListings","addNewPersonalListing","getEnterpriseListings","addNewEnterpriseListing","last","GoodToJob","g","lucky","getRandomCitizen","sellerCityKey","sellerBeanKey","supply","demand","fullListings","l","numberOfSamePriceListings","lowPrice","bKey","enterpriseKey","find","sellerEnterpriseKey","cKey","listPrice","grossPrice","enterprise","BaseParty","playerKey","organizations","slogan","availablePolicies","proposedPolicy","availableCampaigns","activeCampaigns","leadership","activeHQs","platform","PlayerKnowsPrereq","prereq","seen","isArray","some","PlayerKnowsBelief","has","BeliefString","LawData","axis","prereqs","Government","lawTree","laws","Taxation","Welfare","Economics","Crime","Culture","isLaw","allowedTreasury","perBean","flatMap","triadToString","sign","qty","costs","energy","bots","hedons","tortrons","join","DefaultDifficulty","emptyHex","build","house","farm","theater","hospital","church","courthouse","park","nature","beam","upgrade","bean_brain","brainwash_ideal","brainimplant_secondary","brainwash_secondary","scan","abduct","gift","empower","vaporize","siphon","scrubHedons","resource","common","uncommon","rare","penalty","homeless_health","starving_health","death_chance","starvation","sickness","exposure","vaporization","report_card_progression","Goals","found_utopia","text","check","world","build_house_n_farm","cities","getCountOfType","reward","beam_3","Number_Starting_City_Pop","alien","scanned_bean","set_policy","brainwash","Curriculums","GradeWorld","Happiness","BooleanAverageGrader","o","Prosperity","Stability","Dogma","GradeUpToNumber","speechcrimes","date","RubricDescription","number","allowance","maximum","NormalizedScoreToGrade","array","grade","normNumber","GradeWeights","A","B","C","D","F","TechData","tech","techPoints","Player","seenBeliefs","beliefInventory","income","change","next_grade","goals","goalProgress","pastReportCards","workingReportCard","techProgress","currentlyResearchingTech","researchPoints","trait","charges","canAfford","purchase","goal","done","step","SFXToFile","SoundBuffer","file","volume","ended","audio","play","aud","Audio","process","WorldSound","lib","sfx","CommonalityBaseCost","CommonalityRandomMaxCost","GetMarketTraits","newTraits","getMarketTraitListing","PickupPhysics","World","bus","institutions","marketTraitsForSale","Spring","onChat","publishEvent","onBeanDie","e","onCitizenDie","onEmote","subscribe","institute","calculate","calculateBeliefs","Evening","simulate_every_day","simulate_every_week","simulate_every_month","simulate_every_year","hasResearched","org","age","maybeBaby","tryFindRandomJob","getTaxesAndDonations","calculateComputedState","checkGoals","checkReportCard","inflate","resetYearlyCounters","resetMonthlyDemand","collected","MaybeRebate","listener","Act","pickups","pickup","collide","magnet","pickupMagnetPoint","amt","percent","sum","yearlyInflationDollars","richest","obj","winner","yearsPartyDonations","budget","TraitIcon","Sufficient","Abundant","EmoteIcon","UFO","action","Pickup","City","url","ufos","pickupSeed","beanSeed","houses","partyHQ","environment","allOfType","getBuildings","openSlots","slot","tryFreeBean","id","shuffled","counter","shuffle","deadBean","parent","GenerateBean","split","count","circle","square","triangle","squared","pow","scannedBeans","m","prev","entries","aC","Building","occupied_slots","empty_slots","bank","workers","getWorkerBeans","share","owner","commShare","getBeanKeys","ids","s","usedSlots","revenue","distributeCash","randomBuffer","Uint32Array","randomNumber","ceil","choices","PI","GenerateBuilding","newBuilding","GenerateWorld","GenerateCity","previousCityCount","newCity","cityPopulation","hexPoint","newBean","beanBeliefCount","newBelief","StartingCash","getStartingPoint","Modal","show","hideCloseButton","onClick","closeButtonText","children","getButton","React","Component","NeedReadout","dire","need","dire_style","width","full","full_style","header","keyToName","CardButton","classes","thin","singleLine","title","disabled","subtext","TraitToCard","OverviewPanel","clearCity","avg_happy","avg_cash","toFixed","getPopulationTraitsList","AnimatedUFO","showBeam","setTimeout","setState","ufo","Particles","animations","finishedAnimationCount","parts","particleCount","createRef","active","animate","opacity","duration","easing","delay","onfinish","ref","spotlightAnimations","faceOV","beanClasses","particles","AnimatedSpotlight","lastTickMS","currentTime","tickHandle","tick","timeMS","deltaTimeMS","getSubtype","lastValid","anim","requestAnimationFrame","time","cancelAnimationFrame","msg","getFace","replace","AnimatedBean","spin","face","speech","getSpeech","delaySeedSec","paused","sitStill","selected","animationDelay","stopPropagation","getPurchase","AnimatedPickup","useState","played","setPlayed","useContext","SfxContext","useEffect","Mover","el","useRef","startPoint","unsubscribe","PickupList","setList","BeanList","activeBeanID","onBeanClick","HexPetriBuilding","findBuildingByCoordinate","setBuilding","PetriHexes","xy","hex_style","onMouseEnter","onHexClick","SocialBuildings","buildings","setBuildings","onClickBuilding","Magnet","setPoint","updatePoint","HexSizeR","height","left","WorldTile","mtn_transforms","mtnRadius","spotlightEvent","u","mtns","onMouseLeave","cx","cy","stroke","fill","renderSpotlight","median","half","EconomyReport","food_median","health_median","shelter_median","wealth_total","wealth_avg","wealth_median","wealth_dire","wealth_marker","wealthy","wealthy_percentage","wealthy_ownership","jobs","unemployed","jobless","reducer","avg","farmer","builder","doc","entertainer","EventsPanel","events","alert","tallTrigger","shouldEventJumpToBean","selectBean","href","CostSmall","rider","BeanPanel","faceOverride","_resetFace","support","innerView","scanned","beliefTable","hedonTable","display","ActivityIcon","actDurations","acts","idealPro","colSpan","bind","renderTraits","renderInner","FoundParty","onName","onSlogan","onCity","ideal","members","onBigFourChange","checked","onCommunity","currentTarget","onIdeal","onFound","BubbleNumberText","bubbleSeed","ev","positive","bubbles","string","changeEvent","bubbleClass","BubbleSeenTraitsText","sub","setBubbles","onEvent","useBubbles","SocialGraph","static","scanned_beans","CapsuleLabel","classN","label","GoalsPanel","progress","tooltip","renderReward","reportCard","renderGoal","margin","CampaignsPanel","TreasuryReport","coin","setCoin","update","GovernmentPanel","view","setView","enactLaw","revokeLaw","LawDetailList","enacted","LawFormula","canSeeName","unlocked","every","PlayerMeetsPrereqs","PrereqString","ConfirmButton","confirming","onConfirm","click","confirmText","RobotArm","xmlns","overflow","strokeWidth","tool","fontSize","ResearchPanel","tools","interval","toolI","toolI2","toolI3","toolI4","lastI","setInterval","loop","clearInterval","setResearch","total","complete","isCurrent","rootClassName","techs","renderTech","release","StopPlayFastButtons","timeScale","setTimeScale","GeoNetworkButtons","activeMain","setActiveMain","Subtabs","additionalClasses","options","HexPanel","eHex","clearHex","renderBeamButton","free","hasJobs","renderDensityWarning","changeEnterprise","fire","typ","buildingPanel","emptyPanel","EnterpriseTypePicker","toUpperCase","substring","StringDropdown","hint","hidden","titleCase","slice","getTitleForOption","getTextForOption","required","BeliefWidget","leftButton","titleView","bottomView","EditBeliefInput","frozen","toString","available","wash","divergent","SortedBeliefs","localeCompare","TraitInventoryList","live","implant","dogmatic","BrainwashingContent","beanID","isScanned","sanityCostBonus","washNarrative","washBelief","implantBelief","TimelyEventToggle","eventCount","eventClass","eventIcon","MarketPanel","buyEnergy","buyBots","buyTrait","MarketTraits","TraitsReport","GreetingPanel","starving","hungry","sated","stuffed","homeless","sleepy","awake","rested","sick","sickly","bruised","fresh","sane","stressed","disturbed","createContext","App","previousTimeMS","logicTickAccumulatorMS","simulate_beans","simulate_pickups","simulate_world","cheatMode","keyupHandler","activeModal","shiftKey","foundParty","what","fireBean","tryPurchase","newUFO","removeUFO","old","foundCharity","addCharity","enact","releaseBean","lucky_bean","washCommunity","canPurchase","loseSanity","washMotive","oldFaith","chargeBonus","useCharge","setPolicy","onDeath","startSpotlight","timescaleBeforeSpotlight","activeCityID","activeHex","activeRightPanel","document","addEventListener","removeEventListener","myUFOI","findIndex","endSpotlight","utopia","beankey","COL","tile","Provider","defaultScale","wheel","renderGeo","renderHour","n","getPanel","Morning","Midnight","Boolean","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console"],"mappings":"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","file":"static/js/main.d46083e7.chunk.js","sourcesContent":["import { Point } from \"../simulation/Geography\";\r\n\r\nexport type EventTrigger = 'speechcrime'|'birth'|'death'|'nojobslots'|'marketrefresh'|'persuasion';\r\n\r\nexport interface IEvent{\r\n    icon: string;\r\n    message: string;\r\n    beanKey?: number;\r\n    cityKey?: number;\r\n    point?: Point;\r\n    trigger: EventTrigger;\r\n}\r\n\r\nexport class PubSub<T>{\r\n    constructor(private onPublish?: (args: T) => void){}\r\n    private callbacks: Array<(args: T) => void> = [];\r\n    public publish(args: T){\r\n        if (this.onPublish)\r\n            this.onPublish(args);\r\n        this.callbacks.forEach((c) => c(args));\r\n    }\r\n    public subscribe(callback: (args: T) => void){\r\n        this.callbacks.push(callback);\r\n    }\r\n    public unsubscribe(callback: (ev: T) => void) {\r\n        this.callbacks.splice(this.callbacks.indexOf(callback), 1);\r\n    }\r\n}\r\n\r\nexport class ChangePubSub extends PubSub<{change: number}>{\r\n}\r\n\r\nexport type IEventBus = {[key in EventTrigger]: PubSub<IEvent>};\r\nexport interface IEventBuffer{\r\n    buffer: IEvent[]   \r\n}\r\nexport const EventBusBufferLength = 20; \r\nexport class EventBus implements IEventBus, IEventBuffer{\r\n    buffer: IEvent[] = [];\r\n    private sendToBuffer = (event: IEvent) => {\r\n        if (this.buffer.length > EventBusBufferLength){\r\n            this.buffer.pop();\r\n        }\r\n        this.buffer.unshift(event);\r\n    }\r\n    speechcrime = new PubSub<IEvent>(this.sendToBuffer);\r\n    nojobslots = new PubSub<IEvent>(this.sendToBuffer);\r\n    birth = new PubSub<IEvent>(this.sendToBuffer);\r\n    death = new PubSub<IEvent>(this.sendToBuffer);\r\n    marketrefresh = new PubSub<IEvent>(this.sendToBuffer);\r\n    persuasion = new PubSub<IEvent>(this.sendToBuffer);\r\n}\r\n\r\nexport class Live<T>{\r\n    public readonly onChange = new PubSub<T>();\r\n    constructor(protected current: T){}\r\n    public set(newValue: T){\r\n        this.current = newValue;\r\n        if (this.afterSetBeforePublish)\r\n            this.afterSetBeforePublish(newValue);\r\n        this.onChange.publish(newValue);\r\n    }\r\n    public get get(): T{\r\n        return this.current;\r\n    }\r\n    public afterSetBeforePublish?: (val: T) => void; \r\n}\r\nexport class LiveList<T> extends Live<Array<T>>{\r\n    public readonly onPush = new PubSub<T>();\r\n    public push(child: T): void{\r\n        this.set([...this.get, child]);\r\n        this.onPush.publish(child);\r\n    }\r\n    public remove(child: T): void{\r\n        const all = this.get;\r\n        const i = all.indexOf(child);\r\n        if (i > -1){\r\n            all.splice(i, 1);\r\n            this.set([...all]);\r\n        }\r\n    }\r\n}\r\nexport class LiveMap<K, V> extends Live<Map<K, V>>{\r\n    public readonly onAdd = new PubSub<{k: K, v: V}>();\r\n    public add(newKey: K, newValue: V){\r\n        const copy = new Map<K, V>(this.current);\r\n        copy.set(newKey, newValue);\r\n        this.set(copy);\r\n        this.onAdd.publish({k: newKey, v: newValue});\r\n    }\r\n    public remove(key: K){\r\n        const copy = new Map<K, V>(this.current);\r\n        copy.delete(key);\r\n        this.set(copy);\r\n    }\r\n    public at(key: K): V|undefined{\r\n        return this.current.get(key);\r\n    }\r\n}","import { ISeller, Economy } from \"./Economy\";\r\nimport { TraitGood, GoodToJob } from \"../World\";\r\nimport { Policy } from \"./Politics\";\r\nimport { Government } from \"./Government\";\r\n\r\nexport type EnterpriseType = 'company'|'co-op'|'commune';\r\nexport const EnterpriseTypes: EnterpriseType[] = ['company','co-op','commune'];\r\nexport const EnterpriseTypeIcon: {[e in EnterpriseType]: string} = {\r\n    'company': '', \r\n    'co-op': '', \r\n    'commune': ''\r\n};\r\n\r\nexport interface IEnterprise extends ISeller{\r\n    key: number;\r\n    cityKey: number;\r\n    enterpriseType: EnterpriseType;\r\n    ownerBeanKey?: number;\r\n}\r\n\r\nexport function isEnterprise(b: any): b is IEnterprise{\r\n    return b.key != undefined && b.enterpriseType != undefined;\r\n}\r\n\r\nexport interface IInstitution{\r\n    key: number;\r\n    playerKey: number;\r\n    name: string;\r\n\r\n    organizations: IOrganization[];\r\n}\r\n\r\nexport interface IOrganization extends ISeller{\r\n    work(law: Government, economy: Economy): void;\r\n    key: number;\r\n    institutionKey: number;\r\n    seasonalBudget: number;\r\n    parentInstitution: IInstitution|null;\r\n    cash: number;\r\n}\r\n\r\nexport class Charity implements IOrganization, ISeller{\r\n    key = 0;\r\n    name: string = '';\r\n    institutionKey = 1;\r\n    cash = 0;\r\n    ticksSinceLastSale = 0;\r\n    seasonalBudget = 0;\r\n    good: TraitGood = 'food';\r\n    parentInstitution: IInstitution|null = null;\r\n    beansHelped: number = 0;\r\n    inventory: number = 0;\r\n    \r\n    work(law: Government, economy: Economy): void{\r\n        while(this.cash > 0 && this.inventory < 10) {\r\n            const groceries = economy.tryTransact(this, this.good);\r\n            if (groceries){\r\n                //economy.addCharity(this, this.good, groceries.bought);\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n} ","\r\nexport function shuffle(array: Array<any>) {\r\n    let counter = array.length;\r\n\r\n    // While there are elements in the array\r\n    while (counter > 0) {\r\n        // Pick a random index\r\n        let index = Math.floor(Math.random() * counter);\r\n\r\n        // Decrease counter by 1\r\n        counter--;\r\n\r\n        // And swap the last element with it\r\n        let temp = array[counter];\r\n        array[counter] = array[index];\r\n        array[index] = temp;\r\n    }\r\n\r\n    return array;\r\n}\r\n\r\nexport function MathClamp(input: number, min: number, max: number): number{\r\n    return Math.max(Math.min(input, max), min)\r\n}\r\n\r\nexport function groupBy<T>(list: T[], keyGetter: (val: T) => string|number): Map<string|number, T[]> {\r\n    const map = new Map<string|number, T[]>();\r\n    list.forEach((item) => {\r\n         const key = keyGetter(item);\r\n         const collection = map.get(key);\r\n         if (!collection) {\r\n             map.set(key, [item]);\r\n         } else {\r\n             collection.push(item);\r\n         }\r\n    });\r\n    return map;\r\n}","import { LiveMap } from \"../events/Events\";\r\nimport { TraitGood, TraitJob } from \"../World\";\r\nimport { GetRandom } from \"../WorldGen\";\r\nimport { IEnterprise, isEnterprise } from \"./Institutions\";\r\nimport { BuildingJobSlot } from \"./Occupation\";\r\nimport { MathClamp } from \"./Utils\";\r\n\r\nexport interface HexPoint{\r\n    q: number;\r\n    r: number;\r\n}\r\nexport class Hex implements HexPoint{\r\n    constructor(public q: number, public r: number){}\r\n}\r\nexport const hex_directions: HexPoint[] = [\r\n    new Hex(+1, 0), new Hex(+1, -1), new Hex(0, -1), \r\n    new Hex(-1, 0), new Hex(-1, +1), new Hex(0, +1), \r\n];\r\nexport function hex_direction(direction: number): HexPoint{\r\n    return hex_directions[direction]\r\n}\r\n\r\nexport function hex_neighbor(hex: HexPoint, direction: number): HexPoint{\r\n    var dir = hex_direction(direction)\r\n    return new Hex(hex.q + dir.q, hex.r + dir.r)\r\n}\r\nexport function hex_distance(a: HexPoint, b: HexPoint): number{\r\n    return (Math.abs(a.q - b.q) \r\n          + Math.abs(a.q + a.r - b.q - b.r)\r\n          + Math.abs(a.r - b.r)) / 2\r\n}\r\nexport function hex_add(a: HexPoint, b: HexPoint): HexPoint {\r\n    return new Hex(a.q + b.q, a.r + b.r);\r\n}\r\nexport function hex_scale(a: HexPoint, k: number): HexPoint {\r\n    return new Hex(a.q * k, a.r * k);\r\n}\r\nexport function hex_ring(center: HexPoint, radius: number): HexPoint[]{\r\n    var results: HexPoint[] = [];\r\n    // this code doesn't work for radius == 0; can you see why?\r\n    var cube = hex_add(center, \r\n                        hex_scale(hex_direction(4), radius));\r\n    for (let i = 0; i < 6; i++) {\r\n        for (let j = 0; j < radius; j++) {\r\n            results.push(cube)\r\n            cube = hex_neighbor(cube, i);       \r\n        }\r\n    }\r\n    return results;\r\n}\r\nexport function hex_spiral(center: HexPoint, radius: number): HexPoint[]{\r\n    var results = [center];\r\n    for (let k = 0; k < radius; k++) {\r\n        results = results.concat(hex_ring(center, k));\r\n        //console.log(results);   \r\n    }\r\n    return results;\r\n}\r\n\r\nexport function move_towards(current: Point, target: Point, maxDistanceDelta: number)\r\n{\r\n    const a: Point = {x: target.x - current.x, y: target.y - current.y};\r\n    const magnitude = Math.sqrt(a.x * a.x + a.y * a.y);\r\n    if (magnitude <= maxDistanceDelta || magnitude == 0)\r\n    {\r\n        return target;\r\n    }\r\n    return {\r\n        x: current.x + a.x / magnitude * maxDistanceDelta,\r\n        y: current.y + a.y / magnitude * maxDistanceDelta,\r\n    };\r\n}\r\nexport interface IAccelerater {point:Point, velocity:Vector};\r\nexport function accelerate_towards(\r\n    mover: IAccelerater, \r\n    target: Point, \r\n    acceleration: number,\r\n    maxSpeed: number, \r\n    colDistance: number, \r\n    brake: Point): boolean\r\n{\r\n    const delta: Point = {\r\n        x: target.x - mover.point.x, \r\n        y: target.y - mover.point.y\r\n    };\r\n    const magnitude = Math.sqrt((delta.x * delta.x) + (delta.y * delta.y));\r\n    if (magnitude <= colDistance) return true;\r\n\r\n    delta.x /= magnitude;\r\n    delta.y /= magnitude;\r\n\r\n    mover.velocity.x += (delta.x * acceleration);\r\n    mover.velocity.y += (delta.y * acceleration);\r\n    mover.velocity.x = MathClamp(mover.velocity.x, -maxSpeed, maxSpeed);\r\n    mover.velocity.y = MathClamp(mover.velocity.y, -maxSpeed, maxSpeed);\r\n\r\n    accelerator_coast(mover, brake);\r\n    return false;\r\n}\r\nexport function accelerator_coast(\r\n    current: IAccelerater, \r\n    brake: Point): void\r\n{\r\n    current.velocity.x *= brake.x;\r\n    current.velocity.y *= brake.y;\r\n\r\n    current.point.x += current.velocity.x;\r\n    current.point.y += current.velocity.y;\r\n}\r\n\r\nexport function lerp(a: number, b: number, t: number): number{\r\n    return a + (b - a) * t\r\n}\r\n\r\nexport function vector_lerp(a: Point, b: Point, t: number): Point{\r\n    return {\r\n        x: lerp(a.x, b.x, t),\r\n        y: lerp(a.y, b.y, t)\r\n    };\r\n}\r\nfunction cube_lerp(a: CubicPoint, b: CubicPoint, t: number): CubicPoint{\r\n    return {\r\n        x: lerp(a.x, b.x, t),\r\n        y: lerp(a.y, b.y, t),\r\n        z: lerp(a.z, b.z, t)\r\n    };\r\n}\r\nfunction cube_distance(a: CubicPoint, b: CubicPoint): number{\r\n    return (Math.abs(a.x - b.x) + Math.abs(a.y - b.y) + Math.abs(a.z - b.z)) / 2\r\n}\r\nfunction cube_round(cube: CubicPoint): CubicPoint{\r\n    var rx = Math.round(cube.x);\r\n    var ry = Math.round(cube.y);\r\n    var rz = Math.round(cube.z);\r\n\r\n    var x_diff = Math.abs(rx - cube.x)\r\n    var y_diff = Math.abs(ry - cube.y)\r\n    var z_diff = Math.abs(rz - cube.z)\r\n\r\n    if (x_diff > y_diff && x_diff > z_diff)\r\n        rx = -ry-rz;\r\n    else if (y_diff > z_diff)\r\n        ry = -rx-rz;\r\n    else\r\n        rz = -rx-ry;\r\n\r\n    return {x: rx, y: ry, z: rz};\r\n}\r\nfunction round_point_to_hex(hex: HexPoint): HexPoint{\r\n    return cube_to_axial(cube_round(axial_to_cube(hex)))\r\n\r\n}\r\nfunction cube_to_axial(cube: CubicPoint){\r\n    var q = cube.x;\r\n    var r = cube.z;\r\n    return new Hex(q, r);\r\n}\r\nfunction axial_to_cube(hex: HexPoint): CubicPoint{\r\n    return {\r\n        x: hex.q,\r\n        z: hex.r,\r\n        y: -hex.q-hex.r\r\n    };\r\n}\r\nfunction cube_linedraw(a: CubicPoint, b: CubicPoint): HexPoint[]{\r\n    var N = cube_distance(a, b);\r\n    var results: HexPoint[] = [];\r\n    for (let i = 0; i <= N; i++) {\r\n        results.push(cube_to_axial(cube_round(cube_lerp(a, b, 1.0/N * i))))\r\n    }\r\n    return results;\r\n}\r\nexport function hex_linedraw(a: HexPoint, b: HexPoint): HexPoint[]{\r\n    return cube_linedraw(axial_to_cube(a), axial_to_cube(b));\r\n}\r\n\r\nclass Orientation {\r\n    // angle is in multiples of 60\r\n    constructor(public f0: number, public f1: number, public  f2: number, public f3: number,\r\n        public b0: number, public b1: number,public b2: number,public b3: number,\r\n        public start_angle: number){}\r\n};\r\nexport const layout_flat: Orientation = new Orientation(\r\n    3.0 / 2.0, \r\n    0.0, \r\n    Math.sqrt(3.0) / 2.0, \r\n    Math.sqrt(3.0),\r\n    2.0 / 3.0, \r\n    0.0, \r\n    -1.0 / 3.0, \r\n    Math.sqrt(3.0) / 3.0,\r\n    0.0\r\n);\r\nexport const origin_point: Point = {x: 0, y: 0};\r\nexport const hex_origin: HexPoint = {q: 0, r: 0};\r\nexport function hex_to_pixel(size: Point, origin: Point, h: HexPoint): Point {\r\n    const M: Orientation = layout_flat;\r\n    const x = (M.f0 * h.q + M.f1 * h.r) * size.x;\r\n    const y = (M.f2 * h.q + M.f3 * h.r) * size.y;\r\n    return {x: x + origin.x, y: y + origin.y};\r\n}\r\nexport function pixel_to_hex(size: Point, origin: Point, p: Point) {\r\n    const M = layout_flat;\r\n    const pt = {x: (p.x - origin.x) / size.x,\r\n                y: (p.y - origin.y) / size.y\r\n            };\r\n    const q = M.b0 * pt.x + M.b1 * pt.y;\r\n    const r = M.b2 * pt.x + M.b3 * pt.y;\r\n    return new Hex(q, r);\r\n}\r\n\r\n\r\nexport interface PolarPoint{\r\n    /**\r\n     * radius (in pixels)\r\n     */\r\n    r: number;\r\n    /**\r\n     * azimuth (radians)\r\n     */\r\n    az: number;\r\n}\r\n\r\nexport function polarToPoint(p: PolarPoint): Point{\r\n    return {\r\n        x: p.r * Math.cos(p.az),\r\n        y: p.r * Math.sin(p.az)\r\n    }\r\n}\r\n\r\nexport function distanceBetweenPolar(a: PolarPoint, b: PolarPoint): number{\r\n    const aCart = polarToPoint(a);\r\n    const bCart = polarToPoint(b)\r\n    return Math.sqrt(\r\n        Math.pow(aCart.x - aCart.x, 2) +\r\n        Math.pow(bCart.y - aCart.y, 2)\r\n    );\r\n}\r\n\r\nexport interface Point{\r\n    x: number; y: number;\r\n}\r\nexport interface Vector extends Point{\r\n}\r\nexport interface CubicPoint extends Point{\r\n    z: number;\r\n}\r\n\r\nexport function transformPoint(p: Point){\r\n    return {transform:`translate(${p.x}px, ${p.y}px)`};\r\n}\r\n\r\nexport interface IBuilding{\r\n    key: number;\r\n    address: HexPoint;\r\n    type: BuildingTypes;\r\n    job_slots: {[key in BuildingJobSlot]: number|null};\r\n    upgraded: boolean,\r\n    openSlots(): BuildingJobSlot[];\r\n    usedSlots(): BuildingJobSlot[];\r\n    /**\r\n     * returns true when bean is found in slot and freed\r\n     * @param beanKey \r\n     */\r\n    tryFreeBean(beanKey: number): boolean;\r\n}\r\n\r\n/**\r\n * address books allow lookups from entity \"name\" to location\r\n */\r\nexport interface AddressBookHex{\r\n    [entityKey: number]: HexPoint\r\n}\r\nexport interface AddressBookPoint{\r\n    [entityKey: number]: Point\r\n}\r\n/**\r\n * address grids allow lookups from location to entity\r\n * \r\n * note: coordinates are of form \"X,Y\"\r\n * and the map cannot distinguish between hex and cartesian points\r\n */\r\nexport interface AddressGrid<T>{\r\n    [coordinate: string]: T|undefined\r\n}\r\nexport interface AddressBuildingGrid extends AddressGrid<IBuilding>{}\r\n\r\nexport interface BuildingMap{\r\n    coordByID: AddressBookHex;\r\n    all: IBuilding[];\r\n}\r\n\r\nexport class CityBook {\r\n    /**\r\n     * given \"q,r\", return the IBuilding.key\r\n     */\r\n    public readonly map = new LiveMap<string, number>(new Map());\r\n    /**\r\n     * given IBuilding.type return the IBuilding[]\r\n     */\r\n    public readonly yellow = new LiveMap<string, number[]>(new Map());\r\n    /**\r\n     * given IBuilding.key, return \"q,r\"\r\n     */\r\n    public readonly white = new LiveMap<number, string>(new Map());\r\n    /**\r\n     * given IBuilding.key, return IBuilding\r\n     */\r\n    public readonly db: LiveMap<number, IBuilding>;\r\n\r\n    constructor(_db: Map<number, IBuilding>){\r\n        this.db = new LiveMap<number, IBuilding>(_db);\r\n        this.buildIndexes();\r\n        this.db.afterSetBeforePublish = () => this.buildIndexes();\r\n    }\r\n\r\n    private buildIndexes(){\r\n        const keys = Array.from(this.db.get.keys());\r\n        const ix = { \r\n            map: new Map<string, number>(),\r\n            yellow: new Map<string, number[]>(),\r\n            white: new Map<number, string>()\r\n        }\r\n        keys.forEach((key: number) => {\r\n            const b = this.db.get.get(key);\r\n            if (b){\r\n                const address = b.address.q+','+b.address.r;\r\n                ix.map.set(address, b.key);\r\n                ix.white.set(b.key, address);\r\n                const group = ix.yellow.get(b.type) || []\r\n                ix.yellow.set(b.type, group.concat([b.key]));\r\n            }\r\n\r\n        });\r\n        this.white.set(ix.white);\r\n        this.map.set(ix.map);\r\n        this.yellow.set(ix.yellow);\r\n    }\r\n\r\n    public addBuilding(b: IBuilding){\r\n        this.db.add(b.key, b);\r\n        this.buildIndexes();\r\n    }\r\n    public removeBuilding(b: IBuilding){\r\n        this.db.remove(b.key);\r\n        this.buildIndexes();\r\n    }\r\n\r\n    public getBuildings(): IBuilding[]{\r\n        return Array.from(this.db.get.values());\r\n    }\r\n    public findBuildingByCoordinate(h: HexPoint){\r\n        const address = h.q+','+h.r;\r\n        const key = this.map.get.get(address);\r\n        if (key != null) \r\n            return this.db.get.get(key);\r\n        return undefined;\r\n    }\r\n    public getRandomBuildingOfType(buildingType: BuildingTypes): IBuilding|undefined{\r\n        const keysOfType: number[] = this.yellow.get.get(buildingType) || [];\r\n        const r = GetRandom(keysOfType);\r\n        return this.db.at(r);\r\n    }\r\n\r\n    public getRandomEntertainmentBuilding(): IBuilding|undefined{\r\n        const keysOfType: number[] = (this.yellow.get.get('park') || []).concat(this.yellow.get.get('nature') || []);\r\n        const r = GetRandom(keysOfType);\r\n        return this.db.at(r);\r\n    }\r\n\r\n    public getCountOfType(buildingType: BuildingTypes): number{\r\n        return Array.from(this.yellow.get.get(buildingType) || []).length;\r\n    }\r\n}\r\n\r\nexport type BuildingTypes = 'farm'|'house'|'hospital'|'church'|'theater'|'courthouse'|'park'|'nature';\r\nexport type TopiaBuildingTypes = 'utopia_fields'|'utopia_pump'|'dystopia_refinery'|'dystopia_crypt';\r\n//utopian fields = free relax\r\n//utopia pump = slowly sucks up happiness/unhappiness?\r\n//dystopia refinery = slowly converts negative emotions to energy/bots\r\n//dystopia crypt = skips death notifications (limited use?)\r\nexport type MoverTypes = 'bean'|'ufo'|'pickup';\r\nexport type MatterTypes = MoverTypes|BuildingTypes;\r\n\r\nexport const BuildingIcon: {[key in BuildingTypes]: string} = {\r\n    'farm': '',\r\n    'house': '', 'hospital': '', 'church': '', 'theater': '', 'courthouse':'',\r\n    'park': '', 'nature': ''\r\n};\r\nexport const UpgradedBuildingIcon: {[key in BuildingTypes]: string} = {\r\n    'farm': '',\r\n    'house': '', 'hospital': '', 'church': '', 'theater': '', 'courthouse':'',\r\n    'park': '', 'nature': ''\r\n};\r\nexport const BuildingJobIcon: {[key in BuildingTypes]: string} = {\r\n    'farm': '',\r\n    'house': '', 'hospital': '', 'church': '', 'theater': '', 'courthouse':'',\r\n    'park': '', 'nature': ''\r\n};\r\nexport const BuildingToGood: {[key in BuildingTypes]: TraitGood} = {\r\n    'farm': 'food',\r\n    'house': 'shelter', \r\n    'hospital': 'medicine', \r\n    'church': 'fun', \r\n    'theater': 'fun', \r\n    'courthouse': 'fun',\r\n    'park': 'fun', \r\n    'nature': 'fun'\r\n};\r\nexport const GoodToBuilding: {[key in TraitGood]: BuildingTypes} = {\r\n    'food': 'farm',\r\n    'shelter': 'house',\r\n    'medicine':'hospital',\r\n    'fun': 'theater'\r\n};\r\nexport const JobToBuilding: {[key in TraitJob]: BuildingTypes} = {\r\n    'farmer': 'farm',\r\n    'builder': 'house', \r\n    'doc':'hospital', \r\n    'entertainer': 'theater',\r\n    'cleric': 'church', \r\n    'jobless': 'house', \r\n    'polit': 'house'\r\n};\r\n\r\nexport const HexSizePX = 70;\r\nexport const HexSizeR = 120; // rounded sqrt(3) * HexSizePX\r\nexport class Geography{\r\n    public book: CityBook = new CityBook(new Map());\r\n\r\n    addBuilding(building: IBuilding) {\r\n        this.book.addBuilding(building);\r\n        return null;\r\n    }\r\n    removeBuilding(where: HexPoint, building: IBuilding) {\r\n        this.book.removeBuilding(building);\r\n        return null;\r\n    }\r\n    getEnterprise(buildingKey: number): IEnterprise|undefined{\r\n        const ent = this.book.db.get.get(buildingKey);\r\n        if (isEnterprise(ent))\r\n            return ent;\r\n        return undefined;\r\n    }\r\n    public readonly numberOfRings = 5;\r\n    public hexes: HexPoint[] = hex_spiral({q:0, r:0}, this.numberOfRings);\r\n    public hex_size: Point = {x: HexSizePX, y: HexSizePX};\r\n    public readonly petriRadius = ((this.numberOfRings - 0.5) * HexSizeR) + this.numberOfRings;\r\n    public readonly petriOrigin = {x: this.petriRadius, y: this.petriRadius};\r\n}","export enum BuildingJobSlot{\r\n    first = 0,\r\n    second = 1,\r\n    third = 2,\r\n    fourth = 3,\r\n    fifth = 4,\r\n    sixth = 5\r\n}","\r\nimport React from \"react\";\r\nimport { City } from \"../simulation/City\";\r\nimport { IBuilding, BuildingIcon, hex_directions, transformPoint, hex_to_pixel, origin_point, HexPoint, BuildingJobIcon, UpgradedBuildingIcon } from \"../simulation/Geography\";\r\nimport { BuildingJobSlot } from \"../simulation/Occupation\";\r\nimport { GetRandom } from \"../WorldGen\";\r\nimport './Building.css';\r\n\r\nconst slot_size = {\r\n    x: 25,\r\n    y: 25\r\n}\r\nexport function getSlotOffset(direction: HexPoint){\r\n    return hex_to_pixel(slot_size, origin_point, direction);\r\n}\r\nexport function getRandomSlotOffset(){\r\n    return getSlotOffset(GetRandom(hex_directions));\r\n}\r\nfunction hexToTransform(direction: HexPoint){\r\n    return transformPoint(getSlotOffset(direction))\r\n}\r\nconst hexDirectionToJobSlot: {[key: number]: BuildingJobSlot} = {\r\n    2: BuildingJobSlot.first,\r\n    0: BuildingJobSlot.second,\r\n    4: BuildingJobSlot.third,\r\n    1: BuildingJobSlot.fourth,\r\n    5: BuildingJobSlot.fifth,\r\n    3: BuildingJobSlot.sixth,\r\n}\r\n\r\nexport const PetriBuilding: React.FC<{\r\n    city: City,\r\n    building: IBuilding\r\n}> = (props) => {\r\n    // const buildingHex = props.building.address;\r\n    // const p = hex_to_pixel(props.city.hex_size, props.city.petriOrigin, buildingHex);\r\n    const sty = {}; //transformPoint(p);\r\n    return <UIBuilding building={props.building} style={sty} cityName={props.city.name} getStyle={hexToTransform}></UIBuilding>;\r\n}\r\n\r\nexport const UIBuilding: React.FC<{\r\n    building: IBuilding,\r\n    cityName: string,\r\n    style: React.CSSProperties,\r\n    getStyle: (h: HexPoint) => React.CSSProperties\r\n}> = (props) => {\r\n    \r\n    return <div key={props.building.type+props.building.key} style={props.style} \r\n    className={\"building \"+props.building.type}>\r\n    {props.building.upgraded ? UpgradedBuildingIcon[props.building.type] : BuildingIcon[props.building.type]}\r\n    <UIBuildingSlots building={props.building} getStyle={props.getStyle}></UIBuildingSlots>\r\n    {props.building.type === 'courthouse' ? <span className=\"tile-label\">{props.cityName}</span> : null}\r\n    </div>\r\n}\r\nexport const UIBuildingSlots: React.FC<{\r\n    building: IBuilding,\r\n    getStyle: (h: HexPoint) => React.CSSProperties\r\n}> = (props) => {\r\n    return <>{hex_directions.map((d, i: number) => {\r\n        const jobSlot: BuildingJobSlot = hexDirectionToJobSlot[i];\r\n        const hasJob = props.building.job_slots[jobSlot] != null;\r\n        return <span key={i} className=\"slot\" style={props.getStyle(d)}>\r\n            {hasJob ? BuildingJobIcon[props.building.type] : null}\r\n        </span>\r\n    })}</>\r\n}","export class PriorityNode<T>{\r\n    constructor(public value: T, public priority: number){}\r\n}\r\nexport interface IPriorityQueue<T>{\r\n    enqueue(value: PriorityNode<T>): void;\r\n    values: PriorityNode<T>[];\r\n    dequeue(): PriorityNode<T>|undefined;\r\n}\r\nexport class DumbPriorityQueue<T> implements IPriorityQueue<T>{\r\n    \r\n    public values: PriorityNode<T>[] = [];\r\n\r\n    constructor(_values: PriorityNode<T>[]){this.values = _values;}\r\n    \r\n    enqueue(value: PriorityNode<T>): void{\r\n        this.values.push(value);\r\n        this.values = this.values.sort((a, b) => a.priority - b.priority);\r\n    }\r\n\r\n    enqueueMany(values: PriorityNode<T>[]){\r\n        this.values = values;\r\n        this.values = this.values.sort((a, b) => a.priority - b.priority);\r\n    }\r\n    \r\n    dequeue(): PriorityNode<T>|undefined{\r\n        return this.values.shift();\r\n    }\r\n}\r\n\r\nexport class PriorityQueue<T> implements IPriorityQueue<T>{\r\n    public values: PriorityNode<T>[] = [];\r\n\r\n    constructor(_values: PriorityNode<T>[]){this.values = _values;}\r\n\r\n    //helper method that swaps the values and two indexes of an array\r\n    swap(index1: number, index2: number){\r\n        let temp = this.values[index1];\r\n        this.values[index1] = this.values[index2];\r\n        this.values[index2] = temp;\r\n        return this.values;\r\n    }\r\n    //helper methods that bubbles up values from end\r\n    bubbleUp(){\r\n        //get index of inserted element\r\n        let index = this.values.length - 1\r\n        //loop while index is not 0 or element no loger needs to bubble\r\n        while(index > 0){\r\n            //get parent index via formula\r\n            let parentIndex = Math.floor((index - 1)/2);\r\n            //if values is greater than parent, swap the two\r\n            if(this.values[parentIndex].priority > this.values[index].priority){\r\n                //swap with helper method\r\n                this.swap(index, parentIndex);\r\n                //change current index to parent index\r\n                index = parentIndex;\r\n            } else{\r\n                break;\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n    // method that pushes new value onto the end and calls the bubble helper\r\n    enqueue(value: PriorityNode<T>){\r\n        this.values.push(value)\r\n        //calculate parent, if parent is greater swap\r\n        //while loop or recurse\r\n        this.bubbleUp();\r\n        return this.values\r\n    }\r\n\r\n    bubbleDown(){\r\n        let parentIndex = 0;\r\n        const length = this.values.length;\r\n        const elementPriority = this.values[0].priority;\r\n        //loop breaks if no swaps are needed\r\n        while (true){\r\n            //get indexes of child elements by following formula\r\n            const leftChildIndex = (2 * parentIndex) + 1;\r\n            const rightChildIndex = (2 * parentIndex) + 2;\r\n            let leftChildPriority = 999;\r\n            let rightChildPriority;\r\n            let indexToSwap = null;\r\n            // if left child exists, and is greater than the element, plan to swap with the left child index\r\n            if(leftChildIndex < length){\r\n                leftChildPriority = this.values[leftChildIndex].priority\r\n                if(leftChildPriority < elementPriority){\r\n                    indexToSwap = leftChildIndex;\r\n                }\r\n            }\r\n            //if right child exists\r\n            if(rightChildIndex < length){\r\n                rightChildPriority = this.values[rightChildIndex].priority;\r\n\r\n                if(\r\n                    //if right child is greater than element and there are no plans to swap\r\n                    (rightChildPriority < elementPriority && indexToSwap === null) ||\r\n                    //OR if right child is greater than left child and there ARE plans to swap\r\n                    (rightChildPriority < leftChildPriority && indexToSwap !== null))\r\n                {\r\n                    //plan to swap with the right child\r\n                    indexToSwap = rightChildIndex\r\n                }\r\n            }\r\n            //if there are no plans to swap, break out of the loop\r\n            if(indexToSwap === null){\r\n                break;\r\n            } \r\n            //swap with planned element\r\n            this.swap(parentIndex, indexToSwap);\r\n            //starting index is now index that we swapped with\r\n            parentIndex = indexToSwap;\r\n        }  \r\n    }\r\n\r\n    dequeue(): PriorityNode<T>|undefined{\r\n        //swap first and last element\r\n        this.swap(0, this.values.length - 1);\r\n        //pop max value off of values\r\n        let poppedNode = this.values.pop();\r\n        //re-adjust heap if length is greater than 1\r\n        if(this.values.length > 1){\r\n            this.bubbleDown();\r\n        }\r\n        \r\n        return poppedNode;\r\n    }\r\n}","import { Agent } from \"https\";\r\nimport { Bean, DaysUntilSleepy } from \"./Bean\";\r\nimport { getRandomSlotOffset } from \"../petri-ui/Building\";\r\nimport { TraitCommunity, TraitIdeals, TraitEthno, TraitFaith, TraitStamina, TraitHealth, TraitGood, GoodToThreshold, JobToGood, TraitSanity, GoodIcon, TraitEmote, BeanPhysics } from \"../World\";\r\nimport { GetRandom } from \"../WorldGen\";\r\nimport { accelerate_towards, BuildingTypes, Geography, GoodToBuilding, HexPoint, hex_linedraw, hex_origin, hex_ring, hex_to_pixel, IAccelerater, IBuilding, JobToBuilding, move_towards, pixel_to_hex, Point, Vector } from \"./Geography\";\r\nimport { IDate } from \"./Time\";\r\nimport { PubSub } from \"../events/Events\";\r\nimport { DumbPriorityQueue, IPriorityQueue, PriorityNode, PriorityQueue } from \"./Priorities\";\r\nimport { IDifficulty } from \"../Game\";\r\nimport { TraitBelief } from \"./Beliefs\";\r\nimport { ISeller } from \"./Economy\";\r\nimport { IterationStatement } from \"typescript\";\r\n\r\nexport type Act = 'travel'|'work'|'sleep'|'chat'|'soapbox'|'craze'|'idle'|'buy'|'crime'|'relax';\r\n\r\n/**\r\n * cruise == interruptible travel towards destination\r\n * \r\n * approach == uninterruptible travel into destination slot\r\n */\r\nexport type Travel = 'cruise'|'approach';\r\n\r\nexport interface IActListener{\r\n    onChat: (b: Bean, speech: IChatData) => void;\r\n    onEmote: (b: Bean, emote: TraitEmote) => void;\r\n}\r\n\r\nexport interface IActivityData {\r\n    act: Act;\r\n    elapsed?: number;\r\n    location?: Point, //FROM Point\r\n    destinations?: Point[]; //point to travel to??\r\n    intent?: IActivityData; //when travelling, what do you intend to do next\r\n    good?: TraitGood; //good to buy or work\r\n    timeSpent?: number; //time spent on this action\r\n    travel?: Travel;\r\n    chat?: IChatData;\r\n}\r\n\r\nexport interface IChatData{\r\n    participation: 'speaker'|'listener';\r\n    type: 'praise'|'bully'|'preach'|'gift';\r\n    preachBelief?: TraitBelief;\r\n    /**\r\n     * strength of the preacher's persuasion\r\n     */\r\n    persuasionStrength?: number;\r\n    /**\r\n     * target key of the bean who is targeted for praise or bully\r\n     */\r\n    targetBeanKey?: number;\r\n}\r\n\r\nexport interface IAgent {\r\n    state: AgentState;\r\n    onAct?: PubSub<number>;\r\n    jobQueue: PriorityQueue<AgentState>;\r\n}\r\nexport function ChangeState(agent: IAgent, newState: AgentState){\r\n    //if ((agent as any)['key'] === 0)\r\n    //console.log(`from ${agent.state.data.act} to ${newState.data.act} in ${agent.state.Elapsed}`);\r\n    agent.state.exit(agent);\r\n    agent.state = newState;\r\n    agent.state.enter(agent);\r\n}\r\nexport function Act(agent: IAgent, deltaMS: number, difficulty: IDifficulty, listener: IActListener): void{\r\n    const result = agent.state.act(agent, deltaMS, difficulty);\r\n    if (agent.onAct)\r\n        agent.onAct.publish(deltaMS);\r\n    if (result != agent.state){\r\n        ChangeState(agent, result);\r\n        if (result.data.act === 'chat' && result.data.chat?.participation === 'speaker'){\r\n            listener.onChat(agent as Bean, result.data.chat);\r\n        }\r\n    }\r\n}\r\n\r\nexport abstract class AgentState{\r\n    constructor(public data: IActivityData){}\r\n    public get Elapsed(): number {return this.data.elapsed || 0;}\r\n    enter(agent: IAgent){\r\n        this.data.elapsed = 0;\r\n    }\r\n    act(agent: IAgent, deltaMS: number, difficulty: IDifficulty): AgentState{\r\n        const newState = this._act(agent, deltaMS, difficulty);\r\n        this.data.elapsed = this.Elapsed + deltaMS;\r\n        return newState;\r\n    }\r\n    abstract _act(agent: IAgent, deltaMS: number, difficulty: IDifficulty): AgentState;\r\n    exit(agent: IAgent){\r\n        if (agent instanceof Bean){\r\n            agent.activity_duration[this.data.act] += this.Elapsed;\r\n        }\r\n    }\r\n    get display(): string {\r\n        return ActivityDisplay(this.data);\r\n    }\r\n}\r\nexport class IdleState extends AgentState{\r\n    static create(){ return new IdleState({act: 'idle'})}\r\n    _act(agent: IAgent, deltaMS: number, difficulty: IDifficulty): AgentState{\r\n        if (this.Elapsed < 200){\r\n            return this;\r\n        }\r\n        if (agent instanceof Bean && agent.city){\r\n            const priorities = GetPriorities(agent, difficulty);\r\n            let top = priorities.dequeue();\r\n            let travelState: TravelState|null = null;\r\n\r\n            //loop through possible destinations\r\n            while (top && travelState == null){\r\n                const activity = IdleState.substituteIntent(agent, top.value);\r\n                if (activity){\r\n                    travelState = TravelState.createFromIntent(agent, top.value);\r\n                    if (travelState != null)\r\n                        return travelState;\r\n                }\r\n                top = priorities.dequeue();\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n    static substituteIntent(agent: IAgent, intent: IActivityData): IActivityData|null{\r\n        if (intent.act === 'buy' && intent.good != null && agent instanceof Bean){\r\n            const desiredGoodState = agent.canBuy(intent.good);\r\n            if (desiredGoodState != 'yes' && intent.good === 'fun') //if you can't buy happiness, go somewhere to relax\r\n                intent.act = 'relax'; //relaxing is free!\r\n            else if (desiredGoodState === 'pricedout') {\r\n                if (agent.maybeCrime(intent.good)){\r\n                    intent.act = 'crime';\r\n                } else {\r\n                    const isPhysical = intent.good === 'food' || intent.good === 'medicine' || intent.good === 'shelter';\r\n                    if (isPhysical){\r\n                        agent.emote('unhappiness', 'Poverty');\r\n                    }\r\n                    return null; //don't travel to buy something that you can't afford\r\n                }\r\n            } else if (desiredGoodState === 'nosupply'){\r\n                if (intent.good){\r\n                    agent.maybeScarcity(intent.good);\r\n                }\r\n                return null; //don't travel to buy something that doesn't exist\r\n            }\r\n        }\r\n        return intent;\r\n    }\r\n    exit(agent: IAgent){\r\n        super.exit(agent);\r\n\r\n        if (agent instanceof Bean){\r\n            agent.maybeParanoid()\r\n        }\r\n    }\r\n}\r\n\r\nexport function IntentToDestination(agent: IAgent, intent: IActivityData): Point[]|null{\r\n    if (!(agent instanceof Bean))\r\n        return [];\r\n    else if (agent.city){\r\n        const city = agent.city;\r\n        switch(intent.act){\r\n            case 'buy':\r\n                if (intent.good)\r\n                    return RouteRandom(city, agent, GoodToBuilding[intent.good]);\r\n            case 'work':\r\n                return RouteRandom(city, agent, JobToBuilding[agent.job]);\r\n            case 'relax': {\r\n                const destination = city.book.getRandomEntertainmentBuilding();\r\n                if (destination){\r\n                    agent.destinationKey = destination.key;\r\n                    return Route(city, agent, destination);\r\n                } else {\r\n                    return [];\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return [];\r\n}\r\n\r\nconst WanderlustEmoteChance = 0.002;\r\nexport class TravelState extends AgentState{\r\n    static createFromIntent(agent: IAgent, intent: IActivityData): TravelState|null{\r\n        const destination = IntentToDestination(agent, intent);\r\n\r\n        if (destination)\r\n            return this.createFromDestination(destination, intent);\r\n        return null;\r\n    }\r\n    static createFromDestination(destinations: Point[], intent: IActivityData): TravelState{ \r\n        return new TravelState({act: 'travel', destinations: destinations, intent: intent});\r\n    }\r\n    _act(agent: IAgent, deltaMS: number, difficulty: IDifficulty): AgentState{\r\n        \r\n        if (agent instanceof Bean && agent.city && this.data.destinations && this.data.destinations.length){\r\n            const target = this.data.destinations[0];\r\n\r\n            if (isNaN(target.x) || isNaN(target.y)) {\r\n                //this is a sanity check\r\n                this.data.destinations.shift();\r\n                return this;\r\n            }\r\n\r\n            let collide = accelerate_towards(\r\n                agent,\r\n                target,\r\n                BeanPhysics.AccelerateS * deltaMS/1000, \r\n                BeanPhysics.MaxSpeed, \r\n                BeanPhysics.CollisionDistance,\r\n                BeanPhysics.Brake);\r\n            if (collide){\r\n                this.data.location = agent.point;\r\n                this.data.destinations.shift();\r\n            } else {\r\n            }\r\n            agent.onMove.publish(agent.point);\r\n        }\r\n\r\n        if (this.data.destinations == null || this.data.destinations.length === 0){\r\n            if (this.data.intent)\r\n                return ActToState[this.data.intent.act](this.data.intent);\r\n            else\r\n                return IdleState.create();\r\n        } else if (agent instanceof Bean && agent.city) {\r\n            const nearby = agent.city.getNearestNeighbors(agent);\r\n            if (nearby.length && agent.maybeChat()){\r\n                const targets = nearby.filter((nn) => nn.maybeChat());\r\n                if (targets.length < 1)\r\n                    return this;\r\n                const chat: IChatData = agent.getRandomChat(targets);\r\n                targets.forEach((z) => {\r\n                    ChangeState(z, ChatState.create(this.data.intent, {...chat, participation: 'listener'}));\r\n                });\r\n                return ChatState.create(this.data, chat);\r\n            } else if (agent.believesIn('Wanderlust') && Math.random() < WanderlustEmoteChance) {\r\n                agent.emote('happiness', 'Wanderlust');\r\n                return this;\r\n            } else {\r\n                return this;\r\n            }\r\n        } else {\r\n            return this;\r\n        }\r\n    }\r\n    exit(agent: IAgent){\r\n        super.exit(agent);\r\n        if (agent instanceof Bean){\r\n            agent.velocity = {x: 0, y: 0};\r\n        }\r\n    }\r\n}\r\nexport class WorkState extends AgentState{\r\n    static create(good: TraitGood){ return new WorkState({act: 'work', good: good})}\r\n    _act(agent: IAgent, deltaMS: number, difficulty: IDifficulty): AgentState{\r\n        if (this.Elapsed > 2000 && agent instanceof Bean && this.data.good && agent.city?.economy && agent.city?.law){\r\n            agent.work(agent.city.law, agent.city.economy);\r\n            return IdleState.create();\r\n        }\r\n        \r\n        return this;\r\n    }\r\n}\r\nexport class BuyState extends AgentState{\r\n    static create(good: TraitGood){ return new BuyState({act: 'buy', good: good})}\r\n    static MaximumBuyDuration = 1100;\r\n    private sinceLastAttemptMS: number = 0;\r\n    tryBuy(agent: IAgent){\r\n        if (agent instanceof Bean && this.data.good && agent.city?.economy)\r\n        {\r\n            this._bought = agent.buy[this.data.good](agent.city.economy);\r\n        }\r\n        this.sinceLastAttemptMS = 0;\r\n    }\r\n    enter(agent: IAgent){\r\n        this.tryBuy(agent);\r\n    }\r\n    private _bought: boolean = false;\r\n    _act(agent: IAgent, deltaMS: number, difficulty: IDifficulty): AgentState{\r\n        if (!this._bought){\r\n            if (this.sinceLastAttemptMS > 250)\r\n            {\r\n                this.tryBuy(agent);\r\n                // if(this.attempts >= 3 && (this.data.good == 'food' || this.data.good == 'medicine') &&\r\n                //     agent instanceof Bean &&\r\n                //     agent.getCrimeDecision(this.data.good, 'desperation')){\r\n                //     return CrimeState.create(this.data.good);\r\n                // }\r\n            }\r\n        }\r\n        if (this.Elapsed > BuyState.MaximumBuyDuration)\r\n        {\r\n            if (agent instanceof Bean && this.data.good){\r\n                agent.maybeScarcity(this.data.good);\r\n            }\r\n            return IdleState.create();\r\n        }\r\n        else\r\n            return this;\r\n    }\r\n}\r\nexport class ChatState extends AgentState{\r\n    static create(intent: IActivityData|undefined, chat: IChatData){ \r\n        return new ChatState({act: 'chat', intent: intent, chat: chat})\r\n    }\r\n    _act(agent: IAgent, deltaMS: number, difficulty: IDifficulty): AgentState{\r\n        \r\n        if (this.Elapsed > 1000 && this.data.intent){\r\n            const tState = TravelState.createFromIntent(agent, this.data.intent);\r\n            if (tState)\r\n                return tState;\r\n        }\r\n        return this;\r\n    }\r\n    exit(agent: IAgent){\r\n        super.exit(agent);\r\n        if (agent instanceof Bean && this.data.chat){\r\n            agent.lastChatMS = Date.now();\r\n            if (this.data.chat.participation === 'listener'){\r\n                switch(this.data.chat.type){\r\n                    case 'bully':\r\n                        agent.maybeAntagonised();\r\n                    case 'praise':\r\n                        agent.maybeEnthused();\r\n                    case 'preach':\r\n                        if (this.data.chat.preachBelief && this.data.chat.persuasionStrength)\r\n                            agent.maybePersuade(this.data.chat.preachBelief, this.data.chat.persuasionStrength);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nexport class RelaxState extends AgentState{\r\n    static create(intent: IActivityData|undefined, chat: IChatData){ \r\n        return new RelaxState({act: 'relax', intent: intent, chat: chat})\r\n    }\r\n    _act(agent: IAgent, deltaMS: number, difficulty: IDifficulty): AgentState{\r\n        let durationMS = 1000;\r\n        if (agent instanceof Bean && agent.believesIn('Naturalism'))\r\n            durationMS *= 3;\r\n        if (this.Elapsed > durationMS){\r\n            return IdleState.create();\r\n        }\r\n        return this;\r\n    }\r\n    exit(agent: IAgent){\r\n        super.exit(agent);\r\n        if (agent instanceof Bean){\r\n            agent.discrete_fun += 1;\r\n            agent.emote('happiness', 'Relaxation');\r\n            if (agent.believesIn('Naturalism'))\r\n                agent.emote('happiness', 'Naturalism');\r\n        }\r\n    }\r\n}\r\nexport class CrimeState extends AgentState{\r\n    static create(good: 'food'|'medicine'){ return new CrimeState({act: 'crime', good: good})}\r\n    _act(agent: IAgent, deltaMS: number, difficulty: IDifficulty): AgentState{\r\n        if (this.Elapsed > 1500 && agent instanceof Bean && agent.city?.economy && \r\n            (this.data.good === 'food' ||\r\n            this.data.good === 'medicine')){\r\n            agent.steal(this.data.good, agent.city?.economy);\r\n            return IdleState.create();\r\n        }\r\n        return this;\r\n    }\r\n}\r\n\r\nconst ActToState: {[key in Act]: (data: IActivityData) => AgentState} = {\r\n    'idle': (data) => new IdleState(data),\r\n    'work': (data) => new WorkState(data),\r\n    'chat': (data) => new ChatState(data),\r\n    'travel': (data) => new TravelState(data),\r\n    'craze': (data) => new BuyState(data),\r\n    'buy': (data) => new BuyState(data),\r\n    'sleep': (data) => new BuyState(data),\r\n    'soapbox': (data) => new BuyState(data),\r\n    'crime': (data) => new CrimeState(data),\r\n    'relax': (data) => new RelaxState(data)\r\n}\r\n\r\nexport const GetPriority = {\r\n    work: function(bean:Bean): number{\r\n        if (bean.job == 'jobless' && bean.city){\r\n            return 9;\r\n        }\r\n        else if (bean.city){\r\n            //beans with no inventory prioritize work higher\r\n            let inventory_priority = 99;\r\n            if (bean.city.economy){\r\n                const quant = bean.city.economy.market.getStakeListings(bean.key, bean.employerEnterpriseKey, JobToGood(bean.job))?.quantity || 0;\r\n                inventory_priority = quant;\r\n            }\r\n            //beans with lots of cash prioritize work higher\r\n            const wealth_priority = bean.cash / bean.city.costOfLiving / 2;\r\n            return Math.min(inventory_priority, wealth_priority);\r\n        } else {\r\n            return 0;\r\n        }\r\n    },\r\n    food: function(bean:Bean, difficulty: IDifficulty): number{\r\n        if ((bean.discrete_food <= difficulty.bean_life.vital_thresh.food.warning ))\r\n            return bean.discrete_food;\r\n        return 0.5 + (bean.discrete_food / difficulty.bean_life.vital_thresh.food.sufficient )\r\n    },\r\n    medicine:function(bean:Bean, difficulty: IDifficulty): number{\r\n        if ((bean.discrete_health <= difficulty.bean_life.vital_thresh.medicine.warning ))\r\n            return 0.25 + bean.discrete_health;\r\n        return 0.75 + (bean.discrete_health / difficulty.bean_life.vital_thresh.medicine.sufficient )\r\n    },\r\n    stamina: function(bean:Bean, difficulty: IDifficulty): number{\r\n        if ((bean.discrete_stamina <= difficulty.bean_life.vital_thresh.shelter.warning ))\r\n            return 0.50 + bean.discrete_stamina;\r\n        return 1 + (bean.discrete_stamina / difficulty.bean_life.vital_thresh.shelter.sufficient )\r\n    },\r\n    fun:function(bean:Bean, difficulty: IDifficulty): number{\r\n        return 3\r\n    }\r\n}\r\n\r\nexport function GetPriorities(bean: Bean, difficulty: IDifficulty): IPriorityQueue<IActivityData>{\r\n    const queue = new DumbPriorityQueue<IActivityData>([]);\r\n    let node = new PriorityNode<IActivityData>({act: 'work', good: JobToGood(bean.job)} as IActivityData, GetPriority.work(bean));\r\n    queue.enqueue(node);\r\n    node = new PriorityNode<IActivityData>({act: 'buy', good: 'food'} as IActivityData, GetPriority.food(bean, difficulty));\r\n    queue.enqueue(node);\r\n    node = new PriorityNode<IActivityData>({act: 'buy', good: 'shelter'} as IActivityData, GetPriority.stamina(bean, difficulty));\r\n    queue.enqueue(node);\r\n    node = new PriorityNode<IActivityData>({act: 'buy', good: 'medicine'} as IActivityData, GetPriority.medicine(bean, difficulty));\r\n    queue.enqueue(node);\r\n    node = new PriorityNode<IActivityData>({act: 'buy', good: 'fun'} as IActivityData, GetPriority.fun(bean, difficulty));\r\n    queue.enqueue(node);\r\n    return queue;\r\n}\r\n\r\nexport function ActivityIcon(data: IActivityData): string{\r\n    switch(data.act){\r\n        case 'work':\r\n            if (data.good)\r\n                return ' '+ GoodIcon[data.good];\r\n            else\r\n                return '';\r\n        case 'buy':\r\n            if (data.good == 'shelter')\r\n                return '';\r\n            if (data.good)\r\n                return ' '+ GoodIcon[data.good];\r\n            else\r\n                return '';\r\n    }\r\n    return '';\r\n}\r\nexport function ActivityDisplay(data: IActivityData): string{    \r\n    switch(data.act){\r\n        case 'chat':\r\n            return `chatting`;\r\n        case 'crime':\r\n            return `commiting crime`;\r\n        case 'relax':\r\n            return `relaxing`;\r\n        case 'travel':\r\n            return `travelling to ` + data.intent?.act || '';\r\n        case 'work':\r\n            if (data.good)\r\n                return 'working to make '+ GoodIcon[data.good];\r\n            else\r\n                return 'working';\r\n        case 'buy':\r\n            if (data.good == 'shelter')\r\n                return 'sleeping ';\r\n            if (data.good)\r\n                return 'buying '+ GoodIcon[data.good];\r\n            else\r\n                return 'buying';\r\n    }\r\n    return '';\r\n}\r\n\r\n/**\r\n * a bean is a citizen with preferences\r\n */\r\nexport interface IBean extends ISeller, IMover, IAgent{    \r\n    key: number;\r\n    cityKey: number;\r\n    name: string;\r\n    community: TraitCommunity;\r\n    ideals: TraitIdeals;\r\n    ethnicity: TraitEthno;\r\n    faith: TraitFaith;\r\n    stamina: TraitStamina;\r\n    health: TraitHealth;\r\n    discrete_food: number;\r\n    discrete_sanity: number;\r\n    discrete_stamina: number;\r\n    cash: number;\r\n    dob: IDate;\r\n    sanity: TraitSanity;\r\n    lifecycle: 'alive'|'dead'|'abducted'\r\n}\r\n\r\nexport interface IMover extends IAccelerater{\r\n    key: number;\r\n    onMove: PubSub<Point>;\r\n    destinationKey: number;\r\n}\r\n\r\n/**\r\n * fills out \"markers\" and \"destinationKey\" with random building of type\r\n * @param geo \r\n * @param mover \r\n * @param buildingType \r\n */\r\nexport function RouteRandom(geo: Geography, mover: IMover, buildingType: BuildingTypes): Point[]|null{\r\n    const destination: IBuilding|undefined = geo.book.getRandomBuildingOfType(buildingType);\r\n    if (destination === undefined) return null;\r\n    mover.destinationKey = destination.key;\r\n    return Route(geo, mover, destination);\r\n}\r\n\r\n/**\r\n * fills out \"markers\" property with points to walk to destination\r\n * @param geo \r\n * @param mover \r\n * @param buildingType \r\n */\r\nexport function Route(geo: Geography, mover: IMover, destination: IBuilding){\r\n    const start = mover.point;\r\n    const nearestHex = pixel_to_hex(geo.hex_size, geo.petriOrigin, start);\r\n    return hex_linedraw(nearestHex, destination.address).map((h) => hex_to_pixel(geo.hex_size, geo.petriOrigin, h)).map((x, i, a) => {\r\n        if (i === a.length-1){\r\n            const offset = getRandomSlotOffset();\r\n            return {\r\n                x: x.x + offset.x,\r\n                y: x.y + offset.y\r\n            }\r\n        } else {\r\n            return x;\r\n        }\r\n    });\r\n}\r\nexport function Approach(geo: Geography, mover: IMover){\r\n\r\n}","import { TraitCommunity, TraitFaith, TraitIdeals } from \"../World\";\r\n\r\nexport type BeliefCommonality = 'common'|'uncommon'|'rare';\r\nexport const CommonalityChances: {[b in BeliefCommonality]: number} = {\r\n    'common': 3,\r\n    'uncommon': 2,\r\n    'rare': 1\r\n};\r\n\r\nexport type TraitBelief = 'Diligence'| // happy from work\r\n'Natalism'| // increased % of having kids\r\n'Antinatalism'|\r\n'Naturalism'|\r\n'Hedonism'| //more entertainment\r\n'Progressivism'|\r\n'Libertarianism'|\r\n'Parochialism'|\r\n'Cosmopolitanism'|\r\n'Capitalism'|\r\n'Socialism'|\r\n'Communism'|\r\n// 'Tribalism'| \r\n// 'Globalism'| \r\n// 'Pacifism'| \r\n'Neuroticism'| // takes extra sanity damage\r\n'Dogmatism'| \r\n// 'Mysticism'| \r\n 'Paranoia'| \r\n// 'Evangelism'| \r\n// 'Fanaticism'| // doesn't like beings that don't share narrative \r\n'Authority'| //less crime, more crime reports\r\n'Anarchism'| // breaks rules easily\r\n'Sadism'| \r\n'Vandalism'|\r\n'Antagonism'|\r\n'Enthusiasm'|\r\n'Gossip'|\r\n'Extroversion'|\r\n'Charity'| // % to donate\r\n'Gluttony'|\r\n'Wanderlust'|\r\n'Germophobia'|\r\n'Bloodthirst'|\r\n'Introversion'|\r\n'Charisma'|\r\n'Depression'|\r\n'Optimism'|\r\n'Fraud'|\r\n'Greed'; // steal easier\r\n\r\n\r\n// 'friendly'| // likes all beings more\r\n// 'realistic'| // lower happiness\r\n// 'athletic'| // takes less health damage\r\n// 'open-minded'| // beliefs are easily changed\r\n\r\nexport type BeliefSubject = 'self'|'other';\r\nexport type BeliefVerb = 'are'|'arenot';\r\nexport interface IBeliefData {\r\n    noun: string,\r\n    adj: string,\r\n    icon: string,\r\n    description?: string,\r\n    rarity: BeliefCommonality,\r\n    idealPro?: Array<TraitIdeals|TraitCommunity>,\r\n    idealCon?: Array<TraitIdeals|TraitCommunity>\r\n}\r\nexport const PrimaryBeliefData: {[key in TraitIdeals|TraitCommunity]: IBeliefData} = {\r\n    prog: {\r\n        noun: 'Progressivism', adj: 'Progressive', icon: '',\r\n        description: \"Strives to help others\", rarity: 'common',\r\n    },\r\n    trad: {\r\n        noun: 'Elitism', adj: 'Elitist', icon: '',\r\n        description: \"Strives for individual power\", rarity: 'common',\r\n    },\r\n    state: {\r\n        noun: 'Collectivism', adj: 'Collectivist', icon: '',\r\n        description: \"Trusts in the social group\", rarity: 'common',\r\n    },\r\n    ego: {\r\n        noun: 'Independence', adj: 'Independent', icon: '',\r\n        description: \"Trusts only in oneself\", rarity: 'common',\r\n    },\r\n}\r\nexport const NarrativeBeliefData: {[key in TraitFaith]: IBeliefData} = {\r\n    rocket: {\r\n        noun: 'Futurism', adj: 'Futuristic', icon: '',\r\n        description: \"Loves stories of the far future\", rarity: 'common',\r\n    },\r\n    dragon: {\r\n        noun: 'Mythology', adj: 'Mythical', icon: '',\r\n        description: \"Loves stories of the legendary past\", rarity: 'common',\r\n    },\r\n    music: {\r\n        noun: 'Drama', adj: 'Dramatic', icon: '',\r\n        description: \"Loves stories of emotional bonding\", rarity: 'common',\r\n    },\r\n    noFaith: {\r\n        noun: 'Nihilism', adj: 'Nihilist', icon: '',\r\n        description: \"Hates fairy tales\", rarity: 'common',\r\n    },\r\n}\r\nexport const SecondaryBeliefData: {[key in TraitBelief]: IBeliefData} = {\r\n    // misc  traits\r\n    Diligence: {\r\n        noun: 'Diligence', adj: 'Diligence', icon: '', rarity: 'common',\r\n        description: \" to  while working\", //implemented\r\n        //idealCon: ['trad'], idealPro: ['state', 'ego']\r\n    },\r\n    Natalism: {\r\n        noun: 'Natalism', adj: 'Natalist', icon: '', rarity: 'common',\r\n        description: \"Extra  for ;Extra  after birth\" //implemented\r\n    },\r\n    Antinatalism: {\r\n        noun: 'Antinatalism', adj: 'Antinatalist', icon: '', rarity: 'uncommon',\r\n        description: \"Less  for ; after birth\" //implemented\r\n    },\r\n    Charity: {\r\n        noun: 'Charity', adj: 'Charitable', icon: '', rarity: 'uncommon',\r\n        description: \" to gift  to the penniless; and spread \", //implemented\r\n        //idealCon: ['trad'], idealPro: ['prog']\r\n    },\r\n    Progressivism: {\r\n        noun: 'Progressivism', adj: 'Progressive', icon: '', rarity: 'uncommon',\r\n        description: \" to  when paying taxes\" //implemented\r\n    },\r\n    Libertarianism: {\r\n        noun: 'Libertarianism', adj: 'Libertarian', icon: '', rarity: 'rare',\r\n        description: \" to  when paying taxes\", //implemented\r\n    },\r\n    Wanderlust: {\r\n        noun: 'Wanderlust', adj: 'Wanderer', icon: '', rarity: 'uncommon',\r\n        description: \" to  when travelling\", //implemented\r\n        //idealCon: ['trad'], idealPro: ['prog', 'state']\r\n    },\r\n    Germophobia: {\r\n        noun: 'Germophobia', adj: 'Germophobic', icon: '', rarity: 'rare',\r\n        description: \" when sick or working in hospital\", //implemented\r\n        //idealCon: ['trad'], idealPro: ['prog', 'state']\r\n    },\r\n\r\n    // work traits\r\n    Parochialism: {\r\n        noun: 'Parochialism', adj: 'Parochial', icon: '', rarity: 'common',\r\n        description: \"Extra  working ;  from dense houses\",  //first part implemented\r\n        //idealCon: ['trad'], idealPro: ['prog', 'state']\r\n    },\r\n    Cosmopolitanism: {\r\n        noun: 'Cosmopolitanism', adj: 'Cosmopolitan', icon: '', rarity: 'common',\r\n        description: \"Extra  working ;  from rural houses\",  //first part implemented\r\n        //idealCon: ['trad'], idealPro: ['prog', 'state']\r\n    },\r\n    Capitalism: {\r\n        noun: 'Capitalism', adj: 'Capitalist', icon: '', rarity: 'common',\r\n        description: \" working in co-ops and communes; Extra  when owner\", //implemented\r\n        //idealCon: ['trad'], idealPro: ['prog', 'state']\r\n    },\r\n    Socialism: {\r\n        noun: 'Socialism', adj: 'Socialist', icon: '', rarity: 'common',\r\n        description: \"Extra  working in co-ops\", //implemented\r\n        //idealCon: ['trad'], idealPro: ['prog', 'state']\r\n    },\r\n    Communism: {\r\n        noun: 'Communism', adj: 'Communist', icon: '', rarity: 'common',\r\n        description: \" working in companies\", //implemented\r\n        //idealCon: ['trad'], idealPro: ['prog', 'state']\r\n    },\r\n\r\n    Fraud: {\r\n        noun: 'Fraud', adj: 'Fraudulent', icon: '', rarity: 'uncommon',\r\n        description: \" to avoid taxes; Extra  for theft  Crime\"\r\n    },\r\n\r\n    //  traits\r\n    Naturalism: {\r\n        noun: 'Naturalism', adj: 'Naturalist', icon: '', rarity: 'uncommon',\r\n        description: \"Extra  from ;  3x longer\" //implemented\r\n    },\r\n    Hedonism: {\r\n        noun: 'Hedonism', adj: 'Hedonistic', icon: '', rarity: 'uncommon',\r\n        description: \" to emote extra ; to  when working;\", //implemented\r\n        //idealCon: ['prog'], idealPro: ['ego', 'trad']\r\n    },\r\n    Gluttony: {\r\n        noun: 'Gluttony', adj: 'Glutton', icon: '', rarity: 'common',\r\n        description: \"Extra  when stuffed; Extra  when hungry;\", //implemented\r\n        //idealCon: ['prog'], idealPro: ['ego', 'trad']\r\n    },\r\n    Paranoia: {\r\n        noun: 'Paranoia', adj: 'Paranoid', icon: '', rarity: 'uncommon',\r\n        description: \" to  at any time\",  //implemented\r\n        //idealCon: ['state'], idealPro: ['ego']\r\n    },\r\n    Depression: {\r\n        noun: 'Depression', adj: 'Depressive', icon: '', rarity: 'common',\r\n        description: \" to  when unhappy\",\r\n    },\r\n    Optimism: {\r\n        noun: 'Optimism', adj: 'Optimistic', icon: '', rarity: 'uncommon',\r\n        description: \" to  when happy\",\r\n    },\r\n\r\n    //  Crime traits\r\n    Authority: {\r\n        noun: 'Authority', adj: 'Authoritarian', icon: '', rarity: 'common',\r\n        description: \"Less  for all  Crime\", //implemented\r\n        //idealCon: ['ego'], idealPro: ['state']\r\n    },\r\n    Anarchism: {\r\n        noun: 'Anarchism', adj: 'Anarchist', icon: '', rarity: 'uncommon',\r\n        description: \"Extra  for all  Crime\", //implemented\r\n    },\r\n    Greed: {\r\n        noun: 'Greed', adj: 'Greedy', icon: '', rarity: 'common',\r\n        description: \"Extra  for theft  Crime; Extra  when rich\",\r\n        //idealCon: ['prog'], idealPro: ['trad']\r\n    },\r\n    Bloodthirst: {\r\n        noun: 'Bloodthirst', adj: 'Bloodthirsty', icon: '', rarity: 'rare',\r\n        description: \"High  to  Kill during  Crime\"\r\n    },\r\n    // Pacifism: {\r\n    //     noun: 'Pacifism', adj: 'Pacifist', icon: '', rarity: 'common',\r\n    //     description: \"will never punish others\",\r\n    //     idealCon: ['trad'], idealPro: ['prog']\r\n    // },\r\n    // Mysticism: {\r\n    //     noun: 'Mysticism', adj: 'Mystical', icon: '', rarity: 'common',\r\n    //     description: \" to  in any conversation\",\r\n    //     idealCon: ['trad'], idealPro: ['prog']\r\n    // },\r\n\r\n    //  traits\r\n    Extroversion: {\r\n        noun: 'Extroversion', adj: 'Extroverted', icon: '', rarity: 'common',\r\n        description: \"Extra  to start a \", //implemented\r\n    },\r\n    Introversion: {\r\n        noun: 'Introversion', adj: 'Introverted', icon: '', rarity: 'uncommon',\r\n        description: \"Less  to be in a \", //implemented\r\n    },\r\n    Charisma: {\r\n        noun: 'Charisma', adj: 'Charismatic', icon: '', rarity: 'uncommon',\r\n        description: \"More  to persuade in a \", //implemented\r\n    },\r\n    Gossip: {\r\n        noun: 'Gossip', adj: 'Gossipy', icon: '', rarity: 'common',\r\n        description: \" to spread  in a ;  to  after \", //implemented\r\n    },\r\n    Antagonism: {\r\n        noun: 'Antagonism', adj: 'Antagonistic', icon: '', rarity: 'common',\r\n        description: \" to spread  in a \" //implemented\r\n    },\r\n    Enthusiasm: {\r\n        noun: 'Enthusiasm', adj: 'Enthusiastic', icon: '', rarity: 'common',\r\n        description: \" to spread  in a \" //implemented\r\n    },\r\n    // Globalism: {\r\n    //     noun: 'Globalism', adj: 'Globalist', icon: '', rarity: 'common',\r\n    //     description: \" to  other hair colors in a \",\r\n    //     idealCon: ['trad'], idealPro: ['prog', 'state']\r\n    // },\r\n    // Tribalism: {\r\n    //     noun: 'Tribalism', adj: 'Tribal', icon: '', rarity: 'common',\r\n    //     description: \" to  other hair colors in a \",\r\n    //     idealCon: ['prog'], idealPro: ['state', 'ego']\r\n    // },\r\n\r\n    // narrative traits\r\n    // Evangelism: {\r\n    //     noun: 'Evangelism', adj: 'Evangelist', icon: '', rarity: 'common',\r\n    //     description: \"+50% persuasion of \",\r\n    //     idealCon: ['ego'], idealPro: ['state']\r\n    // },\r\n    // Fanaticism: {\r\n    //     noun: 'Fanaticism', adj: 'Fanatical', icon: '', rarity: 'common',\r\n    //     description: \" to  other \",\r\n    //     idealCon: ['prog'], idealPro: []\r\n    // },\r\n    // Xenophobia: {\r\n    //     noun: 'Xenophobia', adj: 'Xenophobic', icon: '', rarity: 'common',\r\n    //     description: \" to  when living with other hair colors\",\r\n    // },\r\n\r\n    // super bad traits\r\n    Sadism: {\r\n        noun: 'Sadism', adj: 'Sadistic', icon: '', rarity: 'rare',\r\n        description: \" to  Kill in a ; from  Kill\"\r\n    },\r\n    Vandalism: {\r\n        noun: 'Vandalism', adj: 'Vandal', icon: '', rarity: 'rare',\r\n        description: \" to destroy goods; from  Theft Crime\"\r\n    },\r\n\r\n    // madness traits\r\n    // Delirium: {\r\n    //     noun: 'Delirium', adj: 'Delirious', icon: '', rarity: 'rare',\r\n    //     description: \"Chooses actions at random\"\r\n    // },\r\n    // DelusionalMania: {\r\n    //     noun: 'Delusional Mania', adj: 'Delusional Maniac', icon: '', rarity: 'rare',\r\n    //     description: \" to  nearby subjects\"\r\n    // },\r\n    // Catatonia: {\r\n    //     noun: 'Catatonia', adj: 'Catatonic', icon: '', rarity: 'rare',\r\n    //     description: \"-50% walk speed. Cannot work.\"\r\n    // },\r\n\r\n    // meta-traits\r\n    Neuroticism: {\r\n        noun: 'Neuroticism', adj: 'Neurotic', icon: '', rarity: 'rare',\r\n        description: \"+100%  damage\", //implemented\r\n    },\r\n    Dogmatism: {\r\n        noun: 'Dogmatism', adj: 'Dogmatic', icon: '', rarity: 'uncommon',\r\n        description: \"Cannot change beliefs\", //implemented\r\n    },\r\n};\r\n\r\nexport function IsIdealDivergent(con: TraitCommunity|TraitIdeals, utopiaMotive: TraitIdeals, utopiaCommunity: TraitCommunity): boolean{\r\n    switch(con){\r\n        case 'trad':\r\n        case 'prog':\r\n            return con == utopiaMotive;\r\n        case 'state':\r\n        case 'ego':\r\n            return con == utopiaCommunity;\r\n    }\r\n}\r\n\r\nexport function IsBeliefDivergent(belief: TraitBelief, utopiaMotive: TraitIdeals, utopiaCommunity: TraitCommunity): boolean{\r\n    const data = SecondaryBeliefData[belief];\r\n    return data.idealCon != null && data.idealCon.reduce((isDivergent: boolean, con) => {\r\n        return isDivergent || IsIdealDivergent(con, utopiaMotive, utopiaCommunity);\r\n    }, false);\r\n}\r\n\r\nexport const BeliefsAll = Object.keys(SecondaryBeliefData).map((x) => x as TraitBelief);\r\n\r\n/**\r\n * static list of beliefs with rarity\r\n * \r\n * common traits are duplicated many times within the array\r\n * rarer traits have fewer duplications or a singular instance \r\n */\r\nexport const RandomBeliefBucket = Object.keys(SecondaryBeliefData).reduce((list, str) => {\r\n    const t = str as TraitBelief;\r\n    const slots = CommonalityChances[SecondaryBeliefData[t].rarity];\r\n    for (let i = 0; i < slots; i++) {\r\n        list.push(t);\r\n    }\r\n    return list;\r\n}, [] as TraitBelief[]);\r\n\r\nexport interface Belief{\r\n    subject: BeliefSubject;\r\n    verb: BeliefVerb;\r\n    adj: TraitBelief;\r\n}\r\n\r\nexport type HedonSourceToVal = {[source: string]: number};\r\nexport interface HedonReport {\r\n    flatAverage: number,\r\n    weightedAverage: number,\r\n    maxSource: string,\r\n    minSource: string,\r\n    all: HedonSourceToVal\r\n}\r\nexport interface HedonExtremes { max:number, min:number }\r\n\r\nexport function GetHedonReport(hedonHistory: HedonSourceToVal[]): HedonReport {\r\n    if (hedonHistory.length === 0){\r\n        return {\r\n            all: {},\r\n            flatAverage: 0,\r\n            weightedAverage: 0,\r\n            maxSource: '',\r\n            minSource: ''\r\n        }\r\n    }\r\n    const all: {[source: string]: number} = {};\r\n    let weightedAverage: number = 0;\r\n    let allSum: number = 0;\r\n    for (let i = 0; i < hedonHistory.length; i++) {\r\n        const day = hedonHistory[i];\r\n        let daySum = 0;\r\n        const sources = Object.keys(day);\r\n        for (let j = 0; j < sources.length; j++) {\r\n            const source = sources[j];\r\n            daySum += day[source];\r\n            if (!all[source]) all[source] = 0;\r\n            all[source] += day[source];\r\n        }\r\n        weightedAverage += daySum / (i + 1);\r\n        allSum += daySum;\r\n    }\r\n\r\n    const allSources = Object.keys(all);\r\n    return {\r\n        flatAverage: allSum / hedonHistory.length,\r\n        weightedAverage: weightedAverage,\r\n        maxSource: allSources.reduce((max, source) => {\r\n            if (all[source] > max.val)\r\n                return {source: source, val: all[source]};\r\n            else return max;\r\n        }, {source: '', val: 0}).source,\r\n        minSource: allSources.reduce((max, source) => {\r\n            if (all[source] < max.val)\r\n                return {source: source, val: all[source]};\r\n            else return max;\r\n        }, {source: '', val: 0}).source,\r\n        all: all\r\n    }\r\n}","import { TraitCommunity, TraitIdeals, TraitEthno, TraitFaith, TraitStamina, TraitHealth, TraitFood, TraitJob, JobToGood, IHappinessModifier, TraitToModifier, MaslowHappinessScore, GetHappiness, GoodToThreshold, TraitGood, TraitSanity, TraitEmote, EmotionSanity, EmotionWorth } from \"../World\";\r\nimport { RandomEthno, GetRandom, GetRandomNumber, GetRandomRoll } from \"../WorldGen\";\r\nimport { Economy, ISeller } from \"./Economy\";\r\nimport { Policy, Party } from \"./Politics\";\r\nimport { IEvent, PubSub } from \"../events/Events\";\r\nimport { IDate, withinLastYear } from \"./Time\";\r\nimport { Government } from \"./Government\";\r\nimport { Act, AgentState, IActivityData, IAgent, IBean, IChatData, IdleState, IMover } from \"./Agent\";\r\nimport { JobToBuilding, Point, Vector } from \"./Geography\";\r\nimport { City } from \"./City\";\r\nimport { PriorityQueue } from \"./Priorities\";\r\nimport { GetHedonReport, HedonExtremes, HedonReport, HedonSourceToVal, SecondaryBeliefData, TraitBelief } from \"./Beliefs\";\r\nimport { IPlayerData } from \"./Player\";\r\nimport { BeanDeathCause, BeanResources, IDifficulty } from \"../Game\";\r\nimport { MathClamp } from \"./Utils\";\r\n\r\nconst BabyChance = 0.008;\r\nexport const DaysUntilSleepy = 7;\r\nconst ChatCooldownMS = 4000;\r\n/**\r\n * beans with belief # < this are more likely to be persuaded\r\n * with belief # > this are less likely to be persuaded\r\n */\r\nconst PersuasionBeliefTarget = 2; \r\n\r\nconst HedonismExtraChance = 0.1;\r\nconst ParanoidUnhappyChance = 0.05;\r\nconst HedonismHateWorkChance = 0.15;\r\nconst DiligenceHappyChance = 0.25;\r\nconst ParochialHappyChance = 0.25;\r\nconst CosmopolitanHappyChance = 0.25;\r\nconst ExtrovertChatExtraChance = 0.25;\r\nconst IntrovertChatExtraChance = -.15;\r\nconst AntagonismBullyChance = 0.45;\r\nconst GossipBullyChance = 0.35;\r\nconst EnthusiasmPraiseChance = 0.45;\r\nconst GermophobiaHospitalWorkChance = 0.25;\r\nconst NatalismExtraBabyChance = 0.04;\r\nconst AntinatalismExtraBabyChance = -0.002;\r\nconst CharismaExtraPersuasionStrength = 2; //d20 based, so 10% extra strength\r\nexport const LibertarianTaxUnhappyChance = 0.1;\r\nexport const ProgressivismTaxHappyChance = 0.1;\r\n\r\nconst MaxGraceTicks = 6;\r\nexport class Bean implements IBean{\r\n    public key: number = 0;\r\n    public cityKey: number = 0;\r\n    public dob: IDate = {year: 0, season: 0, day: 1, hour: 0};\r\n    public bornInPetri: boolean = false;\r\n    public name: string = 'Human Bean';\r\n    public get sanity(): TraitSanity {\r\n        if (this.discrete_sanity >= 8)\r\n            return 'sane';\r\n        else if (this.discrete_sanity >= 5)\r\n            return 'stressed'\r\n        else if (this.discrete_sanity >= 3)\r\n            return 'disturbed'\r\n        else\r\n            return 'psychotic';\r\n    }\r\n    public discrete_sanity: number = 10;\r\n    /**\r\n     * 0-1\r\n     */\r\n    public discrete_fun: number = 0;\r\n    public lifecycle: 'alive'|'dead'|'abducted' = 'alive';\r\n    public get alive(): boolean{\r\n        return this.lifecycle === 'alive';\r\n    }\r\n    public set alive(val: boolean){\r\n        this.lifecycle = val === true ? 'alive' : 'dead';\r\n    }\r\n\r\n    public activity_queue: IActivityData[] = [];\r\n    public activity_duration: {[act in Act]: number} = {'buy': 0, 'chat': 0, 'craze': 0, 'crime': 0, 'idle': 0, 'relax': 0, 'sleep': 0, 'soapbox': 0, 'travel': 0, 'work': 0};\r\n\r\n    public speed = 60;\r\n    public point: Point = {x: 0, y: 0};\r\n    public velocity: Vector = {x: 0, y: 0};\r\n    public onMove = new PubSub<Point>();\r\n    public destinationKey = 0;\r\n\r\n    public city: City|null = null;\r\n\r\n    public ethnicity: TraitEthno = RandomEthno();\r\n\r\n    //maslow\r\n    public discrete_food: number = 1;\r\n    public get food(): TraitFood {\r\n        if (this.discrete_food >= GoodToThreshold['food'].abundant)\r\n        return 'stuffed';\r\n        else if (this.discrete_food >= GoodToThreshold['food'].sufficient)\r\n        return 'sated'\r\n        else if (this.discrete_food >= GoodToThreshold['food'].warning)\r\n        return 'hungry'\r\n        else\r\n        return 'starving';\r\n    }\r\n    public stamina: TraitStamina = 'awake';\r\n    public discrete_health: number = 2;\r\n    public get health(): TraitHealth {\r\n        if (this.discrete_health >= GoodToThreshold['medicine'].abundant)\r\n        return 'fresh';\r\n        else if (this.discrete_health >= GoodToThreshold['medicine'].sufficient)\r\n        return 'bruised'\r\n        else if (this.discrete_health >= GoodToThreshold['medicine'].warning)\r\n        return 'sickly'\r\n        else\r\n        return 'sick';\r\n    }\r\n    //values\r\n    public community: TraitCommunity = 'ego';\r\n    public ideals: TraitIdeals = 'trad';\r\n    //other\r\n    public job: TraitJob = 'jobless';\r\n    public employerEnterpriseKey?: number;\r\n    public faith: TraitFaith = 'noFaith';\r\n    public beliefs: TraitBelief[] = [];\r\n    public cash: number = 3;\r\n    /**\r\n     * # of ticks before bean can possibly die of dire conditions\r\n     */\r\n    public graceTicks = MaxGraceTicks;\r\n    /**\r\n     * current hedons on index 0, plus last len-1 days of hedon history\r\n     * \r\n     * do not modify - World.tsx simulate_world will handle it\r\n     */\r\n    public hedonHistory: HedonSourceToVal[] = [{}];\r\n    /**\r\n     * latest happiness report\r\n     */\r\n    public happiness: HedonReport = GetHedonReport(this.hedonHistory);\r\n    public hedonFiveDayRecord: HedonExtremes = {min: 0, max: 0};\r\n    /**\r\n     * -100 to 100\r\n     */\r\n    public lastHappiness: number = 0;\r\n    \r\n    public ticksSinceLastSale: number = 0;\r\n    public ticksSinceLastRelax: number = 0;\r\n    /**\r\n     * days until needs sleep\r\n     */\r\n    public discrete_stamina: number = 7;\r\n    public fairGoodPrice: number = 1;\r\n    public lastChatMS: number = Date.now();\r\n    get isInCrisis(): boolean{\r\n        return this.food === 'starving' ||\r\n        this.stamina === 'homeless' ||\r\n        this.health === 'sick';\r\n    }\r\n    believesIn(belief: TraitBelief): boolean{\r\n        return this.beliefs.indexOf(belief) !== -1;\r\n    }\r\n    loseSanity(amount: number){\r\n        const multiplier = this.believesIn('Neuroticism') ? 2 : 1;\r\n        this.discrete_sanity -= multiplier * amount;\r\n    }\r\n    getHappinessModifiers(econ: Economy, homeCity: City, law: Government): IHappinessModifier[]{\r\n        const mods: IHappinessModifier[] = [\r\n            TraitToModifier[this.food],\r\n            TraitToModifier[this.stamina],\r\n            TraitToModifier[this.health],\r\n            {\r\n                reason: 'Entertainment', mod: this.discrete_fun*.4\r\n            }\r\n        ];\r\n        if (this.ideals === 'trad' && this.ethnicity != homeCity.majorityEthnicity) {\r\n            mods.push({reason: 'Xenophobic', mod: -.1});\r\n        }\r\n        if (this.community === 'ego' && this.job != 'jobless' && this.employerEnterpriseKey &&\r\n            homeCity.book.db.get.get(this.employerEnterpriseKey)?.upgraded) {\r\n            mods.push({reason: 'Hates Building Density', mod: -.1});\r\n        }\r\n        if (this.cash < 1) {\r\n            mods.push({reason: 'Penniless', mod: MaslowHappinessScore.Deficient});\r\n        } else if (this.cash > econ.getCostOfLiving() * 3){\r\n            mods.push({reason: 'Upper Class', mod: 0.3});\r\n        } else if (this.cash > econ.getCostOfLiving() * 2){\r\n            mods.push({reason: 'Middle Class', mod: 0.15});\r\n        }\r\n        if (this.job === 'jobless') {\r\n            mods.push({reason: 'Unemployed', mod: MaslowHappinessScore.Deficient});\r\n        }\r\n\r\n        return mods;\r\n    }\r\n    getSentimentModifiers(econ: Economy, homeCity: City, law: Government, party: Party): {\r\n        party: IHappinessModifier[],\r\n        law: IHappinessModifier[]\r\n    }{\r\n        const result = {party: [] as IHappinessModifier[], law: [] as IHappinessModifier[]};\r\n\r\n        if (this.community === party.community){\r\n            result.party.push({reason: 'Same Community', mod: 0.15});\r\n        }\r\n        if (this.ideals === party.ideals){\r\n            result.party.push({reason: 'Same Ideals', mod: 0.15});\r\n        } else if (this.community != party.community){\r\n            result.party.push({reason: 'Incompatible Values', mod: -0.15});\r\n        }\r\n        return result;\r\n    }\r\n    calculateBeliefs(econ: Economy, homeCity: City, law: Government, party: Party): void{\r\n        this.hedonFiveDayRecord = {\r\n          min: Math.min(this.hedonFiveDayRecord.min, this.happiness.flatAverage),\r\n          max: Math.max(this.hedonFiveDayRecord.max, this.happiness.flatAverage)  \r\n        };\r\n        if (this.happiness.flatAverage === 0){\r\n            this.lastHappiness = 0;\r\n        } else {\r\n            this.lastHappiness = this.happiness.flatAverage >= 0 ? (\r\n                this.happiness.flatAverage / this.hedonFiveDayRecord.max) * 100 : (\r\n                this.happiness.flatAverage / this.hedonFiveDayRecord.min) * 100;\r\n        }\r\n\r\n        if (this.job === 'jobless'){\r\n            this.fairGoodPrice = 1;\r\n        } else {\r\n            const myGood = JobToGood(this.job);\r\n            this.fairGoodPrice = econ.getFairGoodPrice(myGood);\r\n        }\r\n    }\r\n    /**\r\n     * non-normalized multiplier\r\n     */\r\n    getSentimentPolicies(traits: {[x:string]:boolean}, policies: Policy[]){\r\n        let multiplier = 100;\r\n        policies.forEach((policy) => {\r\n            policy.fx.forEach((fx) => {\r\n                if (traits[fx.key])\r\n                multiplier += fx.mag * 10; //-30 to +30\r\n            });\r\n        });\r\n        return multiplier / 100;\r\n    }\r\n    _getTraitMap(){\r\n        let traits = {[this.community]: true, [this.ideals]:  true, [this.ethnicity]: true};\r\n        if (this.faith != 'noFaith')\r\n            traits[this.faith] = true;\r\n        return traits;\r\n    }\r\n    getFace(): string{\r\n        // if (!this.alive)\r\n        //     return '';\r\n        if (this.state.data.act === 'buy' && this.state.data.good === 'shelter'){\r\n            return '';\r\n        }\r\n        if (this.state.data.act === 'crime'){\r\n            return '';\r\n        }\r\n        if (this.state.data.act === 'relax'){\r\n            return '';\r\n        }\r\n        if (this.state.data.act === 'chat'){\r\n            if (this.state.data.chat?.participation === 'speaker'){\r\n                switch(this.state.data?.chat?.type){\r\n                    default: return '';\r\n                    case 'gift': return '';\r\n                    case 'praise': return '';\r\n                    case 'bully': return '';\r\n                }\r\n            }\r\n            return '';\r\n        }\r\n        if (this.food === 'starving')\r\n            return '';\r\n        if (this.health === 'sick')\r\n            return '';\r\n        if (this.stamina === 'homeless')\r\n            return '';\r\n        if (this.job === 'jobless')\r\n            return '';\r\n        if (this.lastHappiness < 0)\r\n            return '';\r\n        if (this.lastHappiness >= 50)\r\n            return '';\r\n        return '';\r\n    }\r\n    getIdea(costOfLiving: number): {bad: boolean, idea: string}|null {\r\n        if (this.food === 'hungry')\r\n            return {bad: true, idea: ''};\r\n        if (this.health === 'sickly')\r\n            return {bad: true, idea: ''};\r\n        if (this.stamina === 'homeless')\r\n            return {bad: true, idea: ''};\r\n        if (this.canBaby(costOfLiving))\r\n            return {bad: false, idea: ''};\r\n        return null;        \r\n    }\r\n    getSpeech(): string | undefined {\r\n        if (this.state.data.act === 'chat'){\r\n            if (this.state.data.chat?.participation === 'speaker' && this.state.data.chat.preachBelief){\r\n                return ''+SecondaryBeliefData[this.state.data.chat.preachBelief].icon;\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n    getCrimeDecision(\r\n        good: TraitGood,\r\n        crimeReason: 'desperation'|'greed',\r\n    ){\r\n        const roll = Math.random();\r\n        let chance = 0.05;\r\n        if (this.community === 'ego'){\r\n            chance += .1;\r\n        }\r\n        if (crimeReason === 'desperation' && this.health === 'sick' || this.food === 'starving'){\r\n            chance += .15;\r\n        }\r\n        return chance <= roll;\r\n    }\r\n    tryFindRandomJob(law: Government) {\r\n        const job: TraitJob = GetRandom(['builder', 'doc', 'farmer', 'entertainer']);\r\n        if (!this.trySetJob(job)){\r\n            \r\n            this.city?.eventBus?.nojobslots.publish({icon: '', trigger: 'nojobslots', message: `A subject cannot find a job; build or upgrade more buildings.`});\r\n        }\r\n    }\r\n    trySetJob(job: TraitJob): boolean{\r\n        if (this.city?.tryGetJob(this, job)){\r\n            this.city.unsetJob(this);\r\n            this.job = job;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    canPurchase(cost: BeanResources, sanityBonus: number) {\r\n        return (cost.sanity === undefined || this.discrete_sanity >= cost.sanity + sanityBonus);\r\n    }\r\n    public maybeParanoid() {\r\n        this.ifBelievesInMaybeEmote('Paranoia', 'unhappiness', ParanoidUnhappyChance)\r\n    }\r\n    public maybeAntagonised(){\r\n        this.emote('unhappiness', 'Antagonism');\r\n    }\r\n    public maybeEnthused(){\r\n        this.emote('happiness', 'Enthusiasm');\r\n    }\r\n    maybePersuade(belief: TraitBelief, strength: number) {\r\n        if (this.believesIn('Dogmatism'))\r\n            return;\r\n        if (!this.beliefs.includes(belief)){\r\n            let defense = 10 + GetRandomNumber(1, 6);\r\n            defense += this.beliefs.length - PersuasionBeliefTarget;\r\n            let offense = GetRandomNumber(1, 20) + strength;\r\n    \r\n            if (offense > defense){\r\n                this.beliefs = [...this.beliefs, belief]\r\n                this.city?.eventBus?.persuasion.publish({\r\n                    icon: '', \r\n                    trigger: 'persuasion', \r\n                    message: `${this.name} now believes in ${SecondaryBeliefData[belief].icon} ${SecondaryBeliefData[belief].noun}!`, \r\n                    beanKey: this.key, cityKey: this.cityKey,\r\n                    point: this.point\r\n                });\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * chats or conversations use  in descriptions\r\n     * @returns \r\n     */\r\n    public maybeChat(): boolean {\r\n        if (this.lastChatMS + ChatCooldownMS > Date.now()) \r\n            return false;\r\n        if (this.state.data.act === 'chat')\r\n            return false;\r\n        const roll = Math.random();\r\n        let chance = (this.community === 'state') ? 0.2 : 0.1;\r\n        if (this.believesIn('Extroversion')) \r\n            chance += ExtrovertChatExtraChance;\r\n        if (this.believesIn('Introversion')) \r\n            chance += IntrovertChatExtraChance;\r\n        return roll < chance;\r\n    }\r\n    public getRandomChat(nearby: Bean[]): IChatData {\r\n        const canPreach = this.beliefs.length;\r\n        if (canPreach){\r\n            if (this.believesIn('Charity') && this.cash >= 2){\r\n                //find a bean with less money than self, poorest in sight\r\n                const needy = nearby.filter(x => x.cash <= this.cash-1).reduce((least: Bean|null, bean) => {\r\n                    if (least == null || (bean.cash < least.cash))\r\n                        return bean;\r\n                    return least;\r\n                }, null);\r\n                if (needy) {\r\n                    this.cash -= 0.5;\r\n                    this.emote('happiness', 'Charity');\r\n                    needy.cash += 0.5;\r\n                    needy.emote('happiness', 'Charity');\r\n                    return {\r\n                        participation: 'speaker',\r\n                        type: 'gift',\r\n                        targetBeanKey: needy.key\r\n                    }\r\n                }\r\n            } else if(this.believesIn('Enthusiasm') && Math.random() < EnthusiasmPraiseChance){\r\n                return {\r\n                    participation: 'speaker',\r\n                    type: 'praise',\r\n                    preachBelief: 'Enthusiasm'\r\n                }\r\n            } else if(this.believesIn('Antagonism') && Math.random() < AntagonismBullyChance){\r\n                return {\r\n                    participation: 'speaker',\r\n                    type: 'bully',\r\n                    preachBelief: 'Antagonism'\r\n                }\r\n            } else if(this.believesIn('Gossip') && Math.random() < GossipBullyChance){\r\n                return {\r\n                    participation: 'speaker',\r\n                    type: 'bully',\r\n                    preachBelief: 'Gossip'\r\n                }\r\n            }\r\n            return {\r\n                participation: 'speaker',\r\n                type: 'preach',\r\n                preachBelief: GetRandom(this.beliefs),\r\n                persuasionStrength: 1 + (this.believesIn('Charisma') ? CharismaExtraPersuasionStrength : 0)\r\n            }\r\n        } else {\r\n            return {\r\n                participation: 'speaker',\r\n                type: 'praise'\r\n            }\r\n        }\r\n    }\r\n    work(law: Government, econ: Economy) {\r\n        if (this.job === 'jobless'){\r\n        } else {\r\n            switch(this.job){\r\n                case 'farmer':\r\n                    this.discrete_food = Math.min(this.discrete_food+1, GoodToThreshold.food.sufficient*2);\r\n                    this.ifBelievesInMaybeEmote('Parochialism', 'happiness', ParochialHappyChance);\r\n                    break;\r\n                case 'doc':\r\n                    this.discrete_health = Math.min(this.discrete_health+1, GoodToThreshold.medicine.sufficient*2);\r\n                    this.ifBelievesInMaybeEmote('Germophobia', 'unhappiness', GermophobiaHospitalWorkChance);\r\n                    break;\r\n                case 'builder': \r\n                    this.stamina = 'awake';\r\n                    this.discrete_stamina = 7;\r\n                    break;\r\n                case 'entertainer':\r\n                    this.ifBelievesInMaybeEmote('Cosmopolitanism', 'happiness', CosmopolitanHappyChance);\r\n                break;\r\n            }\r\n            this.ifBelievesInMaybeEmote('Diligence', 'happiness', DiligenceHappyChance);\r\n            this.ifBelievesInMaybeEmote('Hedonism', 'unhappiness', HedonismHateWorkChance);\r\n            this.ticksSinceLastSale++;\r\n            if (this.ticksSinceLastSale > 7){\r\n                const cityHasOtherWorkers = this.city ? this.city.beans.get.filter(x => x.job === this.job).length > 1 : false;\r\n                //underemployment\r\n                if (cityHasOtherWorkers && Math.random() > 0.5) {\r\n                    const newJob = econ.mostInDemandJob();\r\n                    if (newJob)\r\n                        this.trySetJob(newJob);\r\n                }\r\n            }\r\n            let workedForEmployer = false;\r\n            if (this.city && this.employerEnterpriseKey){\r\n                const employer = this.city.getEnterprise(this.employerEnterpriseKey);\r\n                if (employer){\r\n                    econ.employAndPrice(employer, JobToGood(this.job), 4, this.fairGoodPrice);\r\n                    workedForEmployer = true;\r\n                    switch(employer.enterpriseType){\r\n                        case 'company':\r\n                            this.ifBelievesInMaybeEmote('Communism', 'unhappiness', 0.1);\r\n                            if (employer.ownerBeanKey === this.key)\r\n                                this.ifBelievesInMaybeEmote('Capitalism', 'happiness', 0.1);\r\n                            break;\r\n                        case 'co-op':                            \r\n                            this.ifBelievesInMaybeEmote('Capitalism', 'unhappiness', 0.1);\r\n                                \r\n                            this.ifBelievesInMaybeEmote('Socialism', 'happiness', 0.1);\r\n                            break;\r\n                        case 'commune':                            \r\n                            this.ifBelievesInMaybeEmote('Capitalism', 'unhappiness', 0.1);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n            if (!workedForEmployer)\r\n                econ.produceAndPrice(this, JobToGood(this.job), 4, this.fairGoodPrice);\r\n        }\r\n    }\r\n    private buyFood(economy: Economy) {\r\n        const groceries = economy.tryTransact(this, 'food', 0.5, 3);\r\n        if (groceries) {\r\n            this.discrete_food += groceries.bought;\r\n            if (this.food === 'stuffed'){\r\n                this.emote('happiness', 'Stuffed');\r\n                this.ifBelievesInMaybeEmote('Gluttony', 'happiness', 1);\r\n            }\r\n        }\r\n        return groceries;\r\n    }\r\n    public buy: {[key in TraitGood]: (econ: Economy)=> boolean} = {\r\n        food: (economy: Economy) =>{\r\n            return this.buyFood(economy) != null;\r\n        },\r\n        medicine:  (economy: Economy) =>{\r\n            return this.buyMeds(economy) != null;\r\n        },\r\n        fun:  (economy: Economy) =>{\r\n            return this.buyFun(economy);\r\n        },\r\n        shelter: (economy: Economy) => {\r\n            return this.buyHousing(economy);\r\n        }\r\n    }\r\n    public steal(good: 'food'|'medicine', econ: Economy){\r\n        const stolen = econ.steal(good, 3);\r\n        if (stolen != null){\r\n            switch(good){\r\n                case 'food':\r\n                    this.discrete_food += stolen;\r\n                    break;\r\n                case 'medicine':\r\n                    this.discrete_health += stolen;\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    private buyHousing(economy: Economy): boolean {\r\n        const housing = economy.tryTransact(this, 'shelter');\r\n        if (housing) {\r\n            this.discrete_stamina = 10;\r\n            this.stamina = 'awake';\r\n        } else if (this.discrete_stamina <= 0){\r\n            this.stamina = 'homeless';\r\n        }\r\n        return housing != null;\r\n    }\r\n    private buyFun(economy: Economy): boolean {\r\n        const fun = economy.tryTransact(this, 'fun');\r\n        if (fun) {\r\n            this.discrete_fun = 1;\r\n            this.emote('happiness', 'Entertainment');\r\n            this.emote('happiness', 'Entertainment');\r\n        }\r\n        return fun != null;\r\n    }\r\n\r\n    age(economy: Economy, diff: IDifficulty): IEvent|null {\r\n        if (!this.alive) return null;\r\n\r\n        const wasNotHungry = this.food !== 'starving';\r\n        const wasNotSick = this.health !== 'sick';\r\n\r\n        this.discrete_food -= diff.bean_life.degrade_per_tick.food;\r\n        if (this.discrete_food < 0)\r\n            this.discrete_health -= 0.2;\r\n\r\n        const starve = this.maybeDie('starvation', this.food === 'starving', 0.6);\r\n        if (starve)\r\n            return null;\r\n        else if (this.food === 'starving' && wasNotHungry){\r\n            this.emote('unhappiness', 'Starving');\r\n            if (this.believesIn('Gluttony')){\r\n                this.emote('unhappiness', 'Gluttony');\r\n                this.emote('unhappiness', 'Gluttony');\r\n            }\r\n        }\r\n            \r\n        this.discrete_stamina -= diff.bean_life.degrade_per_tick.stamina;\r\n    \r\n        const exposure = this.maybeDie('exposure', this.stamina === 'homeless', 0.2);\r\n        if (exposure)\r\n            return null;\r\n\r\n        this.discrete_health -= diff.bean_life.degrade_per_tick.health;\r\n        this.discrete_health = Math.min(this.discrete_health, 3);\r\n        const sick = this.maybeDie('sickness', this.health === 'sick', 0.4);\r\n        if (sick)\r\n            return null;\r\n        else if (this.health === 'sick' && wasNotSick){\r\n            this.emote('unhappiness', 'sick');\r\n            if (this.believesIn('Germophobia')){\r\n                this.emote('unhappiness', 'Germophobia');\r\n            }\r\n        }\r\n\r\n        this.discrete_fun -= diff.bean_life.degrade_per_tick.fun;\r\n        this.discrete_fun = Math.max(0, this.discrete_fun);\r\n\r\n        if (!this.isInCrisis)\r\n            this.graceTicks = MathClamp(this.graceTicks+1, 0, MaxGraceTicks);\r\n        \r\n        return null;\r\n    }\r\n    private buyMeds(economy: Economy) {\r\n        const meds = economy.tryTransact(this, 'medicine', 0.5, 3);\r\n        if (meds){\r\n            this.discrete_health += meds.bought;\r\n            if (this.health === 'fresh')\r\n                this.emote('happiness', 'Robust');\r\n        }\r\n        return meds;\r\n    }\r\n    get babyChance(): number{\r\n        let base = BabyChance;\r\n        if (this.believesIn('Natalism'))\r\n            base += NatalismExtraBabyChance;\r\n        if (this.believesIn('Antinatalism'))\r\n            base += AntinatalismExtraBabyChance;\r\n        return base;\r\n    }\r\n    maybeBaby(economy: Economy): IEvent | null {\r\n        if (this.canBaby(economy.getCostOfLiving()) &&\r\n            GetRandomRoll(this.babyChance)) {\r\n            if (this.city)\r\n                this.city.breedBean(this);\r\n            else\r\n                throw 'bean does not have city object';\r\n            if (this.believesIn('Natalism')){\r\n                this.emote('love', 'Natalist Parent');\r\n            } else if (this.believesIn('Antinatalism')) {\r\n                this.emote('hate', 'Antinatalism');\r\n            } else {\r\n                this.emote('happiness', 'Proud Parent');\r\n            }\r\n            return {icon: '', trigger: 'birth', message: `${this.name} has a baby!`}\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n    canBaby(costOfLiving: number): boolean{\r\n        return this.alive && this.cash > costOfLiving * 3 &&\r\n            !this.isInCrisis;\r\n    }\r\n    maybeCrime(good: TraitGood): boolean {\r\n        if (good === 'shelter') return false;\r\n        if (good === 'fun') return false;\r\n        const roll = Math.random();\r\n        let chance = 0.05;\r\n        if (this.community === 'ego'){\r\n            chance += .1;\r\n        }\r\n        if (this.isInCrisis){\r\n            chance += .1;\r\n        }\r\n        if (this.believesIn('Greed')){\r\n            chance += .25;\r\n        }\r\n        if (this.believesIn('Anarchism')){\r\n            chance += .33;\r\n        }\r\n        if (this.believesIn('Authority')){\r\n            chance += -.25;\r\n        }\r\n        if (good === 'food' && this.food === 'starving'){\r\n            chance += .25;\r\n        }\r\n        else if (good === 'medicine' && this.health === 'sick'){\r\n            chance += .25;\r\n        }\r\n        return chance <= roll;\r\n    }\r\n    ifBelievesInMaybeEmote(belief: TraitBelief, emote: TraitEmote, chance: number){\r\n        if (this.believesIn(belief) && Math.random() < chance){\r\n            this.emote(emote, belief);\r\n        }\r\n    }\r\n    emote(emote: TraitEmote, source: string){\r\n        this.discrete_sanity = MathClamp(this.discrete_sanity + EmotionSanity[emote], 0, 10);\r\n        this.hedonHistory[0][source] = (this.hedonHistory[0][source] || 0) + EmotionWorth[emote];\r\n        this.city?.addEmotePickup(this.point, emote);\r\n        if (this.believesIn('Hedonism') && (emote === 'happiness' || emote === 'love') && Math.random() < HedonismExtraChance){\r\n            this.city?.addEmotePickup(this.point, emote);\r\n        }\r\n    }\r\n    canBuy(good: TraitGood): 'yes'|'nosupply'|'pricedout' {\r\n        return this.city?.economy?.canBuy(this, good) || 'nosupply';\r\n    }\r\n    maybeDie(cause: BeanDeathCause, isDire: boolean, chance = 0.5): boolean{\r\n        if (isDire && Math.random() <= chance) {\r\n            if (this.graceTicks <= 0){\r\n                this.die(cause);\r\n                return true;\r\n            }\r\n            this.graceTicks--;\r\n        }\r\n        return false;\r\n    }\r\n    die(cause: BeanDeathCause){\r\n        this.alive = false;\r\n        const pains = GetRandomNumber(2, 3);\r\n        for (let i = 0; i < pains; i++) {\r\n            this.emote('hate', 'death');\r\n        }\r\n        this.city?.beans.remove(this);\r\n        this.city?.historicalBeans.push(this);\r\n        this.city?.eventBus?.death.publish({\r\n            icon: '', trigger: 'death', message: `${this.name} died of ${cause}!`, \r\n            beanKey: this.key, cityKey: this.cityKey,\r\n            point: this.point\r\n        });\r\n    }\r\n    maybeScarcity(good: TraitGood){\r\n        let scarce = false;\r\n        if (good === 'food' && (this.food === 'starving' || this.food === 'hungry'))\r\n            scarce = true;\r\n        else if (good === 'shelter' && (this.stamina === 'homeless' || this.stamina === 'sleepy'))\r\n            scarce = true;\r\n        else if (good === 'medicine' && (this.health === 'sick' || this.health === 'sickly'))\r\n            scarce = true;\r\n        if (scarce)\r\n            this.emote('unhappiness', 'Scarcity');\r\n    }\r\n    abduct(player: IPlayerData){\r\n        this.lifecycle = 'abducted';\r\n        this.city?.unsetJob(this);\r\n        player.abductedBeans.push(this);\r\n    }\r\n\r\n    state: AgentState = IdleState.create();\r\n    jobQueue: PriorityQueue<AgentState> = new PriorityQueue<AgentState>([]);\r\n    onAct = new PubSub<number>();\r\n}","import { World } from \"../World\";\r\n\r\nexport enum Season {Spring, Summer, Fall, Winter}\r\nexport enum Hour {Midnight, Morning, Noon, Evening}\r\n\r\nexport interface IDate{\r\n    day: number;\r\n    season: Season;\r\n    year: number;\r\n    hour: Hour;\r\n}\r\n\r\nexport function Now(world: World): IDate{\r\n    return {year: world.date.year, season: world.date.season, day: world.date.day, hour: world.date.hour};\r\n}\r\n\r\nexport function withinLastYear(current: IDate, last: IDate): boolean{\r\n    return last.year > -1 && (\r\n        last.year == current.year || (\r\n            last.year == current.year - 1 &&\r\n            last.season > current.season\r\n        )\r\n    )\r\n}","import { TraitIdeals, TraitCommunity, TraitEthno, TraitFaith, World, TraitJob } from './World';\r\nimport { Bean } from './simulation/Bean';\r\nimport { Policy, BaseParty, CityPartyHQ, Party } from './simulation/Politics';\r\nimport { IBuilding, BuildingTypes, Geography, PolarPoint, polarToPoint, hex_to_pixel, HexPoint, BuildingToGood } from './simulation/Geography';\r\nimport { City } from './simulation/City';\r\nimport { BeliefsAll, RandomBeliefBucket } from './simulation/Beliefs';\r\nimport { WorldSound } from './WorldSound';\r\nimport { Building } from './simulation/RealEstate';\r\nimport { Economy } from './simulation/Economy';\r\n\r\nconst EnterpriseStartingListing = 1;\r\nconst MaxNumBeanTraitsOnGenerate = 3;\r\n\r\n/**\r\n * return better random values\r\n * @param min \r\n * @param max \r\n * @returns \r\n */\r\nexport function GetRandomNumber(min: number, max: number): number{\r\n    const randomBuffer = new Uint32Array(1);\r\n    window.crypto.getRandomValues(randomBuffer);\r\n    const randomNumber = randomBuffer[0] / (0xffffffff + 1);\r\n    min = Math.ceil(min);\r\n    max = Math.floor(max);\r\n    return Math.floor(randomNumber * (max - min + 1)) + min;\r\n}\r\n\r\n/**\r\n * \r\n * @returns float between 0 and 1\r\n */\r\nexport function GetRandomFloat(): number{\r\n    //https://stackoverflow.com/questions/34575635/cryptographically-secure-float\r\n    // A buffer with just the right size to convert to Float64\r\n    let buffer = new ArrayBuffer(8);\r\n\r\n    // View it as an Int8Array and fill it with 8 random ints\r\n    let ints = new Int8Array(buffer);\r\n    window.crypto.getRandomValues(ints);\r\n\r\n    // Set the sign (ints[7][7]) to 0 and the\r\n    // exponent (ints[7][6]-[6][5]) to just the right size \r\n    // (all ones except for the highest bit)\r\n    ints[7] = 63;\r\n    ints[6] |= 0xf0;\r\n\r\n    // Now view it as a Float64Array, and read the one float from it\r\n    return new DataView(buffer).getFloat64(0, true) - 1; \r\n}\r\n\r\n/**\r\n * given a chance (0-1) return true if random float is <= chance\r\n * @param chance \r\n * @returns \r\n */\r\nexport function GetRandomRoll(chance: number): boolean{\r\n    const randomNumber = GetRandomFloat();\r\n    //console.log(`DC ${(chance*100).toFixed(3)} rolled ${(randomNumber*100).toFixed(4)}`);\r\n    return randomNumber <= chance;\r\n}\r\n\r\n/**\r\n * convenience random function\r\n * @param length \r\n * @returns \r\n */\r\nexport function GetRandomIndex(length: number): number{\r\n    return GetRandomNumber(0, length-1)\r\n}\r\n\r\nexport function GetRandom<S>(choices: S[]):S {\r\n    const max = choices.length;\r\n    if (max == 1)\r\n        return choices[0];\r\n\r\n    const i = GetRandomIndex(choices.length);\r\n    return choices[i];\r\n}\r\nexport function RandomIdeal(): TraitIdeals{\r\n    return GetRandom(['prog', 'trad']);\r\n}\r\nexport function RandomCommunity(): TraitCommunity{\r\n    return GetRandom(['state', 'ego']);\r\n}\r\nexport function RandomEthno(): TraitEthno{\r\n    return GetRandom(['circle','square','triangle']);\r\n}\r\nexport function RandomFaith(): TraitFaith{\r\n    return GetRandom(['rocket','music','dragon', 'noFaith']);\r\n}\r\nexport function StartingCash(job: TraitJob): number{\r\n    let base = 4 + Math.floor(Math.random() * 3);\r\n    switch(job){\r\n        case 'doc': return base+2;\r\n        default: return base;\r\n    }\r\n}\r\nexport const MAX_PETRI_RADIUS = 200;\r\nexport const PI2 = Math.PI*2;\r\nexport function RandomPolar(r?: number): PolarPoint{\r\n    return {\r\n        r: r || GetRandomNumber(0, MAX_PETRI_RADIUS),\r\n        az: GetRandomNumber(0, PI2)\r\n    };\r\n}\r\nexport function GetBuildingR(type: BuildingTypes): number{\r\n    switch(type){\r\n        case 'farm':\r\n            return GetRandomNumber(200, 300);\r\n        default: \r\n            return GetRandomNumber(80, 200);\r\n    }\r\n}\r\nexport function GenerateBuilding(geo: Geography, type: BuildingTypes, hex: HexPoint, econ: Economy){\r\n    const newBuilding = new Building();\r\n    newBuilding.type = type;\r\n    newBuilding.key = geo.book.getBuildings().length;\r\n    newBuilding.address = hex;\r\n    if (geo instanceof City)\r\n        newBuilding.city = geo;\r\n    geo.addBuilding(newBuilding);\r\n    const good = BuildingToGood[type];\r\n    if (good != 'fun')\r\n        econ.employAndPrice(newBuilding, good, EnterpriseStartingListing, econ.getFairGoodPrice(good))\r\n}\r\n\r\nconst Number_Starting_Cities = 1;\r\nexport function GenerateWorld(): World{\r\n    const world = new World();\r\n \r\n    world.law.laws = [];\r\n    world.party = new BaseParty();\r\n    world.institutions.push(world.party);\r\n    for (let i = 0; i < Number_Starting_Cities; i++) {\r\n        world.cities.push(GenerateCity(world.cities.length, world.sfx, world.economy));\r\n        world.cities[i].eventBus = world.bus;\r\n        world.cities[i].environment = world.date;\r\n        world.cities[i].law = world.law;\r\n        for (let j = 0; j < world.cities[i].beans.get.length; j++) {\r\n            const bean = world.cities[i].beans.get[j];\r\n            bean.work(world.law, world.economy);\r\n            if (bean.job == 'farmer')\r\n                bean.work(world.law, world.economy);\r\n        }\r\n    }\r\n    world.economy.monthlyDemand.food = world.beans.get.length;\r\n    world.economy.monthlyDemand.shelter = world.beans.get.length;\r\n    world.economy.monthlyDemand.medicine = world.beans.get.length;\r\n\r\n    return world;\r\n}\r\n\r\nexport function GeneratePartyHQ(city: City, party: Party) {\r\n    \r\n}\r\n\r\nexport const Number_Starting_City_Pop = 0;\r\nexport function GenerateCity(previousCityCount: number, sfx: WorldSound, econ: Economy): City{\r\n    let newCity = new City(sfx, econ);\r\n    newCity.key = previousCityCount;\r\n    newCity.name = GetRandom(['New ', 'Old ', 'Fort ', 'St. ', 'Mount ', 'Grand ', '', '', '', '', '', '', '', '', '', '']);\r\n    newCity.name += GetRandom(['Spring', 'Timber', 'Over', 'West', 'East', 'North', 'South', 'Rock', 'Sand', 'Clay', 'Iron', 'Ore', 'Coal', 'Liver', 'Hawk', 'Red', 'Yellow', 'Gold', 'Blue', 'Black', 'White', 'Sunny', 'Reed', 'Ox', 'Mill', 'Fern', 'Down', 'Bel', 'Bald', 'Ash']);\r\n    newCity.name += GetRandom(['water ', ' Springs', 'ville', 'dale', 'lane', 'peak', 'coast', 'beach', 'port', 'market', 'ton', 'brook', ' Creek', 'land', 'burgh', 'bridge', 'ford', 'bury', 'chester', 'son', 'vale', ' Valley', 'hill', 'more', 'wood', ' Oaks', ' Cove', 'mouth', 'way', 'crest']);\r\n    \r\n    GenerateBuilding(newCity, 'courthouse', newCity.hexes[0], newCity.economy); \r\n    GenerateBuilding(newCity, 'nature', newCity.hexes[GetRandomNumber(15, 20)], newCity.economy); \r\n    GenerateBuilding(newCity, 'nature', newCity.hexes[GetRandomNumber(21, 25)], newCity.economy); \r\n    GenerateBuilding(newCity, 'nature', newCity.hexes[GetRandomNumber(26, 60)], newCity.economy);\r\n    // GenerateBuilding(newCity, 'house', newCity.hexes[1]); \r\n    // GenerateBuilding(newCity, 'hospital', newCity.hexes[5]);\r\n    \r\n    // GenerateBuilding(newCity, 'farm', newCity.hexes[7]);\r\n\r\n    const cityPopulation = Number_Starting_City_Pop;\r\n    while(newCity.beans.get.length < cityPopulation){\r\n        newCity.beans.push(\r\n            GenerateBean(newCity)\r\n        );\r\n    }\r\n\r\n    return newCity;\r\n}\r\nfunction getStartingPoint(city: City): HexPoint{\r\n    const house = city.book.getRandomBuildingOfType('house');\r\n    if (house){\r\n        return house.address;\r\n    } else {\r\n        return {\r\n            q: 0, r: 0\r\n        }\r\n    }\r\n}\r\nexport function GenerateBean(city: City, hexPoint?: HexPoint, job?: TraitJob): Bean{\r\n    let newBean = new Bean();\r\n    \r\n    newBean.key = ++city.beanSeed;\r\n    newBean.cityKey = city.key;\r\n    newBean.city = city;\r\n    newBean.name = GetRandom(['Joe', 'Frank', 'Jill', 'Jose',\r\n    'Johnny', 'Isabelle', 'Carmen', 'Ace', 'Carl', 'Zander', 'Jean',\r\n    'Anne', 'Leslie', 'Ben', 'Ron', \r\n    'Ellen', 'Dallas', 'Kane', 'Ash', \r\n    'Jim', 'James', 'Leonard', 'Nyota', 'Christine', 'Scotty', 'Tasha', 'Geordi', 'Beverly', 'Deanna', 'Wesley', 'Majel',\r\n    'Malcolm','River',  \r\n    'Luke', 'Han', 'Owen', 'Rey', 'Mace', 'Cody',\r\n    'Dana', 'Walter',  \r\n    'Rick', 'Holden', 'Roy', 'Pris', 'Eldon', 'Rachael',\r\n    'Rose', 'Donna', 'Jack', 'Amy', 'Rory', 'Martha', 'Clara', \r\n    'Arnold', 'Dave', 'Holly', \r\n    'Kara', 'Gaius','William', 'Lee', 'Laura', 'Saul',\r\n    'Max', 'Edison', 'Theora', 'Bryce', 'Murray', 'Ned',\r\n    'Daniel', 'Samantha', \r\n    'Logan', 'Francis', 'Jessica',\r\n    'Thomas',\r\n    'Benny', 'James', 'John Henry', 'Sarah', 'Piper', 'Nick', 'Shaun', 'Preston'\r\n    ]) + ' ';\r\n    newBean.name += GetRandom([\r\n        'Ripley', 'Bishop', 'Hicks', 'Vasquez', 'Hudson', \r\n        'Rico', 'Flores', 'Ibanez', 'Levy', 'Jenkins', 'Barlow', 'Zim', 'Rasczak',\r\n        'Kirk', 'McCoy', 'Sulu', 'Uhura', 'Chekov', 'Chapel', 'Rand','Riker', 'Crusher', 'Barret', \"O'Brien\",\r\n        'Reynolds', 'Tam', \r\n        'Scully', 'Mulder','Skinner', \r\n        'Connor', \r\n        'Rex',\r\n        'Thrace', 'Baltar', 'Smith','Adama', 'Roslin', 'Tigh', 'Song', 'Oswald', \r\n        'Deckard', 'Bryant', 'Tyrell', 'Sebastian', 'Voight', 'Kampff',\r\n        'Tyler', 'Harkness', 'Jones', 'Noble', 'Pond', 'Williams',\r\n        'Rimmer', 'Lister', \r\n        'Head', 'Carter', 'Lynch', 'McKenzie', 'Grossberg',\r\n        \"O'Neil\", 'Jackson', 'Carter',\r\n        'Whitmore',\r\n        'House', 'Mitchell', 'Eden', 'Lyons', 'Valentine', 'Garvey'\r\n         ]);\r\n    newBean.community = RandomCommunity();\r\n    newBean.ideals = RandomIdeal();\r\n    newBean.faith = RandomFaith();\r\n    const beanBeliefCount = Math.ceil(Math.random() * MaxNumBeanTraitsOnGenerate);\r\n    while (newBean.beliefs.length < beanBeliefCount) {\r\n        const newBelief = GetRandom(RandomBeliefBucket);\r\n        const hasAlready = newBean.beliefs.includes(newBelief);\r\n        if (!hasAlready)\r\n            newBean.beliefs.push(newBelief);\r\n    }\r\n    \r\n    if (job == null){\r\n        switch (city.beanSeed){\r\n            case 1:\r\n                job = 'farmer'; break;\r\n            case 2:\r\n                job = 'builder'; break;\r\n            case 3:\r\n                job = 'doc'; break;\r\n            default:\r\n                job = GetRandom(['farmer', 'builder', 'doc', 'entertainer']); break;\r\n        }\r\n    }\r\n    newBean.trySetJob(job);\r\n\r\n    newBean.cash = StartingCash(newBean.job);\r\n    newBean.discrete_food = 3;\r\n\r\n    newBean.point = hex_to_pixel(city.hex_size, city.petriOrigin, hexPoint || getStartingPoint(city));\r\n    \r\n    return newBean;\r\n}","import { TraitGood, TraitJob, GoodToJob, Trait } from \"../World\";\r\nimport { Bean, LibertarianTaxUnhappyChance, ProgressivismTaxHappyChance } from \"./Bean\";\r\nimport { IOrganization, Charity, IEnterprise } from \"./Institutions\";\r\nimport { City } from \"./City\";\r\nimport { GetRandom } from \"../WorldGen\";\r\nimport { IEvent, IEventBus, Live } from \"../events/Events\";\r\nimport { Government } from \"./Government\";\r\n\r\nexport interface IEconomicAgent{\r\n    cash: number;\r\n}\r\nexport interface ISeller extends IEconomicAgent{\r\n    ticksSinceLastSale: number;\r\n}\r\nexport interface Listing{\r\n    sellerCityKey?: number;\r\n    sellerBeanKey?: number;\r\n    sellerEnterpriseKey?: number;\r\n    price: number;\r\n    seller: ISeller;\r\n    quantity: number;\r\n}\r\nconst AllGoods: TraitGood[] = ['food', 'shelter', 'medicine', 'fun'];\r\n\r\nexport class Economy {\r\n    market = new OrderBook();\r\n    charity = new OrderBook();\r\n    unfulfilledMonthlyDemand: {[key in TraitGood]: number} = { food: 0, shelter: 0, medicine: 0, fun: 0, }\r\n    monthlyDemand: {[key in TraitGood]: number} = { food: 0, shelter: 0, medicine: 0, fun: 0, }\r\n    monthlySupply: {[key in TraitGood]: number} = { food: 0, shelter: 0, medicine: 0, fun: 0, }\r\n    law?: Government;\r\n    constructor(public eventBus: IEventBus){\r\n    }\r\n    public resetMonthlyDemand(){\r\n        this.unfulfilledMonthlyDemand = { food: 0, shelter: 0, medicine: 0, fun: 0, };\r\n        this.monthlyDemand = { food: 0, shelter: 0, medicine: 0, fun: 0, };\r\n        this.monthlySupply = { food: 0, shelter: 0, medicine: 0, fun: 0, };\r\n    }\r\n    tryTransact(\r\n        buyer: IEconomicAgent, \r\n        good: TraitGood,\r\n        minDemand: number = 1,\r\n        maxDemand: number = 1\r\n        ): {bought: number, price: number, tax: number}|null {\r\n        this.monthlyDemand[good] += maxDemand;\r\n        const listing = this.market.getLowestPriceListing(good, minDemand);\r\n        if (listing == null){\r\n            //console.log('agent could not find '+good);\r\n            this.unfulfilledMonthlyDemand[good] += maxDemand;\r\n            return null;\r\n        }\r\n        const actualDemand = Math.min(listing.quantity, maxDemand);\r\n        if ((listing.price * (1 + this.salesTaxPercentage)) <= buyer.cash * actualDemand){ \r\n            const receipt = this.market.transact(listing, good, actualDemand, buyer, this.salesTaxPercentage);\r\n            if (receipt.tax && this.law){\r\n                this.law.treasury.set(this.law.treasury.get+receipt.tax);\r\n                if (buyer instanceof Bean){\r\n                    buyer.ifBelievesInMaybeEmote('Libertarianism', 'unhappiness', LibertarianTaxUnhappyChance);\r\n                    buyer.ifBelievesInMaybeEmote('Progressivism', 'happiness', ProgressivismTaxHappyChance);\r\n                }\r\n            }\r\n            return receipt;\r\n        } else if (buyer instanceof Bean) {\r\n            if (this.law?.PurchaseQualifiesForWelfare(buyer, good) && this.law?.CanPayWelfare(listing.price)){\r\n                return this.market.governmentTransact(listing, good, actualDemand, this.law.treasury);\r\n            }\r\n            // console.log('bean couldnot afford '+good+\" @ $\"+listing?.price);\r\n            // const charityTicket = this.charity.getLowestPriceListing(good, minDemand);\r\n            // if (charityTicket && charityTicket.seller instanceof Charity) {\r\n            //     // console.log('bean got '+good+\" from charity\");\r\n            //     const actualDemand = Math.min(charityTicket.quantity, maxDemand);\r\n            //     buyer.partyLoyalty += PartyLoyaltyPerCharityUse;\r\n            //     charityTicket.seller.beansHelped++;\r\n            //     charityTicket.seller.inventory -= actualDemand;\r\n            //     return this.charity.transact(charityTicket, good, actualDemand, buyer);\r\n            // }\r\n        }\r\n        this.unfulfilledMonthlyDemand[good] += actualDemand;\r\n        return null;\r\n    }\r\n    canBuy(buyer: IEconomicAgent, good: TraitGood,\r\n        minDemand: number = 1,\r\n        maxDemand: number = 1): 'yes'|'nosupply'|'pricedout'{\r\n        const listing = this.market.getLowestPriceListing(good, minDemand);\r\n        if (listing == null){\r\n            return 'nosupply';\r\n        }\r\n        const actualDemand = Math.min(listing.quantity, maxDemand);\r\n        if (listing.price <= buyer.cash * actualDemand)\r\n            return 'yes';\r\n        if (buyer instanceof Bean && this.law?.PurchaseQualifiesForWelfare(buyer, good) && this.law?.CanPayWelfare(listing.price)){\r\n            return 'yes';\r\n        }\r\n        return 'pricedout';\r\n    }\r\n    steal(\r\n        good: TraitGood,\r\n        maxDemand: number = 1\r\n        ): number|null {\r\n        const listing = GetRandom(this.market.listings[good]);\r\n        if (listing == null){\r\n            return null;\r\n        }\r\n        const actualDemand = Math.min(listing.quantity, maxDemand);\r\n        this.market.subtractFromListing(listing, good, actualDemand);\r\n        \r\n        return actualDemand;\r\n    }\r\n    produceAndPrice(seller: Bean, good: TraitGood, quantity: number, price: number) {\r\n        this.monthlySupply[good] += quantity;\r\n        const existing = this.market.getBeansListings(seller.cityKey, seller.key, good);\r\n        if (existing){\r\n            existing.quantity += quantity;\r\n            existing.price = price;\r\n            existing.quantity = Math.min(existing.quantity, 6);\r\n        } else {\r\n            this.market.addNewPersonalListing(good, quantity, price, seller);\r\n        }\r\n        this.market.sort(good);\r\n    }\r\n    employAndPrice(seller: IEnterprise, good: TraitGood, quantity: number, price: number) {\r\n        this.monthlySupply[good] += quantity;\r\n        const existing = this.market.getEnterpriseListings(seller, good);\r\n        if (existing){\r\n            existing.quantity += quantity;\r\n            existing.price = price;\r\n            existing.quantity = Math.min(existing.quantity, 6);\r\n        } else {\r\n            this.market.addNewEnterpriseListing(good, quantity, price, seller);\r\n        }\r\n        this.market.sort(good);\r\n    }\r\n    public mostInDemandJob(): TraitJob|null{\r\n        const goods: TraitGood[] = AllGoods;\r\n        const max = goods.reduce((last, good) => {\r\n            if (this.unfulfilledMonthlyDemand[good] > last.max){\r\n                last.max = this.unfulfilledMonthlyDemand[good];\r\n                last.job = GoodToJob(good);\r\n            }\r\n            return last;\r\n        }, {max: 0, job: null as TraitJob|null})\r\n\r\n        return max.job;\r\n    }\r\n    public onBeanDie(bean: Bean){\r\n        AllGoods.forEach((g) => {\r\n            const existing = this.market.getBeansListings(bean.cityKey, bean.key, g);\r\n            if (existing){\r\n                const lucky = bean.city?.getRandomCitizen();\r\n                if (lucky) {\r\n                    existing.sellerCityKey = lucky.cityKey;\r\n                    existing.sellerBeanKey = lucky.key;\r\n                    existing.seller = lucky;\r\n                }\r\n            }\r\n        });\r\n    }\r\n    public getFairGoodPrice(good: TraitGood){\r\n        const supply = this.monthlySupply[good] || 1;\r\n        const demand = this.monthlyDemand[good];\r\n        return 0.25 + (0.75 * Math.min(demand/supply, 1));\r\n    }\r\n    public getCostOfLiving(){\r\n        return this.getFairGoodPrice('food')+this.getFairGoodPrice('shelter')+this.getFairGoodPrice('medicine');\r\n    }\r\n    get salesTaxPercentage(): number{\r\n        return this.law?.salesTaxPercentage || 0;\r\n    }\r\n}\r\n\r\nexport class OrderBook{\r\n    public readonly listings: {[key in TraitGood]: Listing[]} = {\r\n        food: [] as Listing[],\r\n        shelter: [] as Listing[],\r\n        medicine: [] as Listing[],\r\n        fun: [] as Listing[],\r\n    };\r\n    public getLowestPriceListing(good: TraitGood, demand: number): Listing|null{\r\n        const fullListings =  this.listings[good].filter((l) => {\r\n            return l.quantity >= demand;\r\n        });\r\n        if (fullListings.length > 0){\r\n            let numberOfSamePriceListings = 1;\r\n            const lowPrice = fullListings[0].price;\r\n            for (let i = 1; i < fullListings.length; i++) {\r\n                const list = fullListings[i];\r\n                if (list.price > lowPrice)\r\n                    break;\r\n                numberOfSamePriceListings++;\r\n            }\r\n            const i = Math.floor(Math.random() * numberOfSamePriceListings);\r\n            if (i >= fullListings.length)\r\n                throw \"invalid index\";\r\n            return fullListings[i];\r\n        }\r\n        return null;\r\n    }\r\n    public getStakeListings(bKey: number, enterpriseKey: number|undefined, g: TraitGood): Listing|undefined{\r\n        return this.listings[g].find((x) => x.sellerBeanKey == bKey || x.sellerEnterpriseKey == enterpriseKey);\r\n    }\r\n    public getBeansListings(cKey: number, bKey: number, g: TraitGood): Listing|undefined{\r\n        return this.listings[g].find((x) => x.sellerBeanKey == bKey && x.sellerCityKey == cKey);\r\n    }\r\n    public getEnterpriseListings(b: IEnterprise, g: TraitGood): Listing|undefined{\r\n        return this.listings[g].find((x) => x.sellerEnterpriseKey == b.key);\r\n    }\r\n    public transact(listing: Listing, good: TraitGood, demand: number, buyer: IEconomicAgent, salesTaxPercentage: number){    \r\n        this.subtractFromListing(listing, good, demand);\r\n        const listPrice = listing.price * demand;\r\n        const tax = listPrice * salesTaxPercentage;\r\n        const grossPrice = listPrice + tax;\r\n        buyer.cash -= grossPrice;\r\n        listing.seller.cash += listPrice;\r\n        listing.seller.ticksSinceLastSale = 0;\r\n        return {\r\n            bought: demand,\r\n            price: listPrice,\r\n            tax: tax\r\n        }\r\n    }\r\n    public governmentTransact(listing: Listing, good: TraitGood, demand: number, treasury: Live<number>){    \r\n        this.subtractFromListing(listing, good, demand);\r\n        const listPrice = listing.price * demand;\r\n        const grossPrice = listPrice;\r\n        treasury.set(treasury.get - grossPrice);\r\n        listing.seller.cash += listPrice;\r\n        listing.seller.ticksSinceLastSale = 0;\r\n        return {\r\n            bought: demand,\r\n            price: listPrice,\r\n            tax: 0\r\n        }\r\n    }\r\n    public subtractFromListing(listing: Listing, good: TraitGood, demand: number){     \r\n        listing.quantity -= demand;\r\n        if (listing.quantity <= 0){\r\n            this.listings[good].splice(0, 1);\r\n        }\r\n    }\r\n    public addNewPersonalListing(good: TraitGood, quantity: number, price: number, bean: Bean){\r\n        this.listings[good].push({\r\n            sellerCityKey: bean.cityKey,\r\n            sellerBeanKey: bean.key,\r\n            price: price,\r\n            seller: bean,\r\n            quantity: quantity\r\n        });\r\n    }\r\n    public addNewEnterpriseListing(good: TraitGood, quantity: number, price: number, enterprise: IEnterprise){\r\n        this.listings[good].push({\r\n            sellerEnterpriseKey: enterprise.key,\r\n            price: price,\r\n            seller: enterprise,\r\n            quantity: quantity\r\n        });\r\n    }\r\n    public sort(good: TraitGood){        \r\n        this.listings[good].sort((a, b) => a.price - b.price);\r\n    }\r\n}","import * as React from 'react';\r\nimport { Bean } from './simulation/Bean';\r\nimport { Economy } from './simulation/Economy';\r\nimport { Policy, Party, BaseParty, ICityPartyHQ } from './simulation/Politics';\r\nimport { IInstitution, IOrganization, Charity } from './simulation/Institutions';\r\nimport { IEvent, EventBus, LiveList } from './events/Events';\r\nimport { Season, IDate, Hour } from './simulation/Time';\r\nimport { Government } from './simulation/Government';\r\nimport { Player, TechData } from './simulation/Player';\r\nimport { accelerate_towards, accelerator_coast, Geography, move_towards } from './simulation/Geography';\r\nimport { City, Pickup } from './simulation/City';\r\nimport { shuffle } from './simulation/Utils';\r\nimport { Act, IActListener, IChatData } from './simulation/Agent';\r\nimport { IDifficulty, PlayerResources } from './Game';\r\nimport { type } from 'os';\r\nimport { GetHedonReport, IsBeliefDivergent, SecondaryBeliefData, TraitBelief } from './simulation/Beliefs';\r\nimport { WorldSound } from './WorldSound';\r\nimport { GetMarketTraits, MarketTraitListing } from './simulation/MarketTraits';\r\n\r\nexport interface IBeanContainer{\r\n    /**\r\n     * all beans ever, including dead ones\r\n     */\r\n    historicalBeans: LiveList<Bean>;\r\n    /**\r\n     * current non-dead beans\r\n     */\r\n    beans: LiveList<Bean>;\r\n}\r\n\r\nexport interface IWorld{\r\n    cities: City[];\r\n    law: Government;\r\n    party: Party;\r\n\r\n    institutions: IInstitution[];\r\n    bus: EventBus;\r\n    date: IDate;\r\n    alien: Player;\r\n}\r\nconst PickupPhysics = {\r\n    Brake: { x: .94, y: .94},\r\n    AccelerateS: 60,\r\n    MaxSpeed: 9,\r\n    CollisionDistance: 10\r\n}\r\nexport const BeanPhysics = {\r\n    Brake: { x: .94, y: .94},\r\n    AccelerateS: 10,\r\n    MaxSpeed: 4,\r\n    CollisionDistance: 10\r\n}\r\nconst MaxHedonHistory = 5;\r\nconst PollTaxWeeklyAmount = 0.1;\r\nexport class World implements IWorld, IBeanContainer, IActListener{\r\n    public readonly bus = new EventBus();\r\n    public readonly economy: Economy = new Economy(this.bus);\r\n    public cities: City[] = [];\r\n    public law: Government = new Government();\r\n    public institutions: IInstitution[] = [];\r\n    public marketTraitsForSale: LiveList<MarketTraitListing> = new LiveList<MarketTraitListing>([]);\r\n    public party: Party = new BaseParty();\r\n    public date: IDate = {year: 1, season: Season.Spring, day: 1, hour: 1};\r\n\r\n    public alien: Player = new Player();\r\n    public sfx = new WorldSound();\r\n\r\n    public get beans(): LiveList<Bean>{\r\n        return new LiveList(this.cities.reduce((list, c) => {\r\n            return list.concat(c.beans.get);\r\n        }, [] as Bean[]));\r\n    }\r\n    public get historicalBeans(): LiveList<Bean>{\r\n        return new LiveList(this.cities.reduce((list, c) => {\r\n            return list.concat(c.historicalBeans.get);\r\n        }, [] as Bean[]));\r\n    }\r\n    public get organizations(): IOrganization[]{\r\n        return this.institutions.reduce((list, institute) => {\r\n            return list.concat(institute.organizations);\r\n        }, [] as IOrganization[]);\r\n    }\r\n\r\n    constructor(){\r\n        this.bus.death.subscribe(this.onBeanDie);\r\n        this.economy.law = this.law;\r\n        this.marketTraitsForSale.set(GetMarketTraits());\r\n    }\r\n\r\n    /**\r\n     * update 'pushed' state\r\n     */\r\n    public calculateComputedState(){\r\n        this.cities.forEach(c => {\r\n            c.calculate(this.economy, this.law);\r\n            c.beans.get.forEach(b => b.calculateBeliefs(this.economy, c, this.law, this.party));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * simulates a season passing, setting a lot of state\r\n     */\r\n    public simulate_world(){\r\n        this.date.hour++\r\n        if (this.date.hour > Hour.Evening){\r\n            this.date.hour = 0;\r\n            this.date.day++;\r\n            this.simulate_every_day();\r\n            if (this.date.day % 7 === 0){\r\n                this.simulate_every_week();\r\n            }\r\n        }\r\n        if (this.date.day > 30){\r\n            this.date.day = 1;\r\n            this.simulate_every_month()\r\n            this.date.season++;\r\n        }\r\n        if (this.date.season > 3){\r\n            this.date.year++;\r\n            this.simulate_every_year();\r\n            this.date.season = 0;\r\n        }\r\n\r\n        this.alien.bots.amount += this.alien.bots.income;\r\n        this.alien.energy.amount += this.alien.energy.income;\r\n        if (this.alien.hasResearched('fast_resources')){\r\n            this.alien.bots.amount += this.alien.bots.income*0.5;\r\n            this.alien.energy.amount += this.alien.energy.income*0.5;\r\n        }\r\n        if (this.alien.currentlyResearchingTech){\r\n            const tech = this.alien.currentlyResearchingTech;\r\n            if(this.alien.techProgress[tech] == null){\r\n                this.alien.techProgress[tech] = {\r\n                    researchPoints: 0\r\n                }\r\n            }\r\n            const max = TechData[tech].techPoints;\r\n            const current = this.alien.techProgress[tech].researchPoints;\r\n            if (current < max)\r\n                this.alien.techProgress[tech].researchPoints += this.alien.abductedBeans.length;\r\n            if (current >= max){\r\n                if (this.alien.currentlyResearchingTech === 'neural_duplicator')\r\n                    this.alien.beliefInventory.get.forEach((x) => x.charges += 1);\r\n                this.alien.currentlyResearchingTech = undefined;\r\n\r\n            }\r\n        }\r\n\r\n        this.organizations.forEach((org) => org.work(this.law, this.economy));\r\n        \r\n        this.beans.get.forEach((b: Bean, i: number) => {\r\n            b.age(this.economy, this.alien.difficulty);\r\n            const e = b.maybeBaby(this.economy);\r\n            if (e) {\r\n                this.publishEvent(e);\r\n                this.sfx.play('squeak');\r\n            }\r\n            if (b.job === 'jobless')\r\n                b.tryFindRandomJob(this.law);\r\n            \r\n            b.happiness = GetHedonReport(b.hedonHistory);\r\n        });\r\n        this.cities.forEach((c) => c.getTaxesAndDonations(this.party, this.economy));\r\n        this.calculateComputedState();\r\n        this.alien.checkGoals(this);\r\n        this.alien.checkReportCard(this);\r\n    }\r\n    simulate_every_year(){\r\n        this.inflate();\r\n        this.resetYearlyCounters();\r\n    }\r\n    simulate_every_month(){\r\n        this.economy.resetMonthlyDemand();\r\n\r\n    }\r\n    simulate_every_week(){\r\n        this.marketTraitsForSale.set(GetMarketTraits());\r\n        this.publishEvent({message: 'New traits in the Emotion Market!', icon: '', trigger: 'marketrefresh'});\r\n        if (this.law.isLaw('poll_tax')){\r\n            let collected = 0;\r\n            this.cities.forEach((x) => {\r\n                x.beans.get.forEach((y) => {\r\n                    if (y.cash >= PollTaxWeeklyAmount){\r\n                        y.cash -= PollTaxWeeklyAmount;\r\n                        collected += PollTaxWeeklyAmount;\r\n                    }\r\n                });\r\n            });\r\n            this.law.treasury.set(this.law.treasury.get + collected);\r\n        }\r\n        this.law.MaybeRebate(this.beans.get);\r\n    }\r\n    simulate_every_day(){\r\n        this.beans.get.forEach((x) => {\r\n            if (x.hedonHistory.length >= MaxHedonHistory) {\r\n                x.hedonHistory.pop();\r\n            }\r\n            x.hedonHistory.unshift({});\r\n        });\r\n    }\r\n    simulate_beans(deltaMS: number){\r\n        this.beans.get.forEach((b) => {\r\n            Act(b, deltaMS, this.alien.difficulty, this);\r\n        });\r\n    }\r\n    simulate_pickups(deltaMS: number){\r\n        const city = this.cities[0];\r\n        const pickups = city.pickups.get;\r\n        //go backwards because we'll modify the array as we go\r\n        for(let i = pickups.length - 1; i >= 0; i--) {\r\n            const pickup = pickups[i];\r\n            let collide = false;\r\n            const magnet = city.pickupMagnetPoint.get;\r\n            if (magnet){\r\n                collide = accelerate_towards(\r\n                    pickup, \r\n                    magnet, \r\n                    PickupPhysics.AccelerateS * deltaMS/1000, \r\n                    PickupPhysics.MaxSpeed, \r\n                    PickupPhysics.CollisionDistance,\r\n                    PickupPhysics.Brake);\r\n            } else {\r\n                accelerator_coast(pickup, PickupPhysics.Brake);\r\n            }\r\n            if (collide){\r\n                const amt = EmotionWorth[pickup.type];\r\n                this.alien.hedons.amount += amt;\r\n                this.alien.hedons.change.publish({change: amt});\r\n                city.pickups.remove(pickup);\r\n                this.sfx.play(pickup.type);\r\n            } else {\r\n                pickup.onMove.publish(pickup.point);\r\n            }\r\n        }\r\n    }\r\n    onChat = (b: Bean, chat: IChatData) => {\r\n        if (this.party && chat.preachBelief){\r\n            if (IsBeliefDivergent(chat.preachBelief, this.party.ideals, this.party.community)){\r\n                this.publishEvent({\r\n                    icon: '', trigger: 'speechcrime',\r\n                    message: `Speechcrime! ${b.name} is talking about ${SecondaryBeliefData[chat.preachBelief].noun}`,\r\n                    beanKey: b.key\r\n                });\r\n                if (this.alien.speechcrimes[this.date.year] == null)\r\n                    this.alien.speechcrimes[this.date.year] = 1;\r\n                else\r\n                    this.alien.speechcrimes[this.date.year]++;\r\n            }\r\n        }\r\n    }\r\n    onBeanDie = (e: IEvent) => {\r\n        const city = this.cities.find((x) => x.key === e.cityKey);\r\n        if (city){\r\n            const bean = city.historicalBeans.get.find((x) => x.key === e.beanKey);\r\n            if (bean){\r\n                city.onCitizenDie(bean);\r\n                this.economy.onBeanDie(bean);\r\n            }\r\n        }\r\n    }\r\n    onEmote = (b: Bean, emote: TraitEmote) => {\r\n    }\r\n    publishEvent(e: IEvent){\r\n        this.bus[e.trigger].publish(e);\r\n    }\r\n    inflate() {\r\n        const allMoney = this.beans.get.reduce((sum, b) => sum+b.cash, 0) + this.organizations.reduce((sum, o) => sum + o.cash, 0);\r\n        const percent = allMoney / 100;\r\n        const yearlyInflationDollars = Math.round(percent * 1);\r\n        if (yearlyInflationDollars > 0){\r\n            const richest = this.beans.get.reduce((obj: {winner?: Bean, max: number}, b) => {\r\n                if (b.cash > obj.max){\r\n                    obj.winner = b;\r\n                    obj.max = b.cash;\r\n                }\r\n                return obj;\r\n            }, {max: 0});\r\n            if (richest.winner){\r\n                richest.winner.cash += yearlyInflationDollars;\r\n            }\r\n        }\r\n    }\r\n    resetYearlyCounters() {\r\n        this.cities.forEach((c) => {\r\n            c.yearsPartyDonations = 0;\r\n        })\r\n    }\r\n    addCharity(good: TraitGood, name: string, budget: number) {\r\n        const charity = new Charity();\r\n        charity.name = name;\r\n        charity.good = good;\r\n        charity.seasonalBudget = budget;\r\n        this.party.organizations.push(charity);\r\n    }\r\n}\r\n\r\nexport interface IEnvironment{\r\n    year: number;\r\n    season: Season;\r\n}\r\n\r\nexport interface Tile {\r\n    name?: string, \r\n    url: string, \r\n    type: string,\r\n    key: number\r\n}\r\n\r\n\r\nexport type TraitCommunity = 'state'|'ego';\r\nexport type TraitIdeals = 'prog'|'trad';\r\nexport type TraitEthno = 'circle'|'square'|'triangle';\r\nexport type TraitFaith = 'rocket'|'music'|'dragon'|'noFaith';\r\nexport type TraitFood = 'starving'|'hungry'|'sated'|'stuffed';\r\nexport type TraitStamina = 'homeless'|'sleepy'|'awake'|'rested';\r\nexport type TraitHealth = 'sick'|'sickly'|'bruised'|'fresh';\r\nexport type TraitSanity = 'psychotic'|'disturbed'|'stressed'|'sane';\r\nexport type TraitJob = 'farmer'|'builder'|'doc'|'entertainer'|'cleric'|'polit'|'jobless';\r\n\r\nexport type Trait = TraitCommunity|TraitIdeals|TraitEthno|TraitFaith|TraitFood|TraitStamina|TraitHealth|TraitSanity;\r\n\r\nexport const TraitIcon: {[key in Trait]: string} = {\r\n    'state': '', 'ego': '',\r\n    'prog': '', 'trad': '',\r\n    'circle': '', 'square': '', 'triangle': '',\r\n    'rocket': '', 'music': '', 'dragon': '',\r\n    'noFaith': '',\r\n    'starving': '', 'hungry': '', 'sated': '', 'stuffed': '',\r\n    'homeless': '', 'sleepy': '', 'awake': '', 'rested': '',\r\n    'sick': '', 'sickly': '', 'bruised': '', 'fresh': '',\r\n    'psychotic': '', 'disturbed': '', 'stressed':'', 'sane': '',\r\n}\r\nexport enum MaslowHappinessScore {Deficient= -.25, Sufficient=0, Abundant=.15}\r\n\r\nexport interface IHappinessModifier{\r\n    reason: string;\r\n    /**\r\n     * -1 to 1, where 0 is \"no effect\" and +/-1 is +/-100%\r\n     */\r\n    mod: number;\r\n}\r\n\r\nexport function GetHappiness(array: IHappinessModifier[]){\r\n    const clampedPercent = Math.min(\r\n        1,\r\n        Math.max(\r\n            -1,\r\n            array.reduce((sum, hapMod) => {\r\n                sum += hapMod.mod;\r\n                return sum\r\n            }, 0)\r\n        )\r\n    );\r\n\r\n    return (clampedPercent * 100);\r\n}\r\n\r\nexport const TraitToModifier: {[key in TraitFood|TraitStamina|TraitHealth]: IHappinessModifier} = {\r\n    'homeless': {reason: 'Homeless', mod: MaslowHappinessScore.Deficient},\r\n    'sleepy': {reason: 'Renting', mod: MaslowHappinessScore.Sufficient},\r\n    'awake': {reason: 'Homeowner', mod: MaslowHappinessScore.Sufficient},\r\n    'rested': {reason: 'Homeowner', mod: MaslowHappinessScore.Abundant},\r\n    'sick': {reason: 'Sick', mod: MaslowHappinessScore.Deficient},\r\n    'sickly': {reason: 'Sick', mod: MaslowHappinessScore.Sufficient},\r\n    'bruised': {reason: 'Bruised', mod: MaslowHappinessScore.Sufficient},\r\n    'fresh': {reason: 'Healthy', mod: MaslowHappinessScore.Abundant},\r\n    'starving': {reason: 'Hungry', mod: MaslowHappinessScore.Deficient},\r\n    'hungry': {reason: 'Hungry', mod: MaslowHappinessScore.Sufficient},\r\n    'sated': {reason: 'Sated', mod: MaslowHappinessScore.Sufficient},\r\n    'stuffed': {reason: 'Stuffed', mod: MaslowHappinessScore.Abundant},\r\n}\r\nexport interface IThreshold {warning: number, sufficient: number, abundant: number}\r\nexport const GoodToThreshold: {[key in TraitGood]: IThreshold} = {\r\n    'food': {warning: 0.5, sufficient: 1, abundant: 3},\r\n    'shelter': {warning: 0.5, sufficient: 1, abundant: 7},\r\n    'medicine': {warning: 0.5, sufficient: 1, abundant: 3},\r\n    'fun': {warning: 0.1, sufficient: 1, abundant: 3},\r\n}\r\n\r\nexport function JobToGood(job: TraitJob): TraitGood{\r\n    switch(job){\r\n        case 'builder': return 'shelter';\r\n        case 'doc': return 'medicine';\r\n        case 'entertainer': return 'fun';\r\n        default: case 'farmer': return 'food';\r\n    }\r\n}\r\nexport function GoodToJob(good: TraitGood): TraitJob{\r\n    switch(good){\r\n        case 'shelter': return 'builder';\r\n        case 'medicine': return 'doc';\r\n        case 'fun': return 'entertainer';\r\n        default: case 'food': return 'farmer';\r\n    }\r\n}\r\nexport type TraitGood = 'food'|'shelter'|'medicine'|'fun';\r\nexport const GoodIcon: {[key in TraitGood]: string} ={\r\n    'food': '',\r\n    'shelter': '', \r\n    'medicine': '', \r\n    'fun': ''\r\n};\r\n\r\nexport type TraitEmote = 'happiness'|'unhappiness'|'love'|'hate';\r\nexport const EmoteIcon: {[key in TraitEmote]: string} ={\r\n    'love': '',\r\n    'happiness': '',\r\n    'unhappiness': '',\r\n    'hate': ''\r\n};\r\nexport const EmotionWorth: {[key in TraitEmote]: number} ={\r\n    'love': 5,\r\n    'happiness': 1,\r\n    'unhappiness': -1,\r\n    'hate': -5\r\n};\r\nexport const EmotionSanity: {[key in TraitEmote]: number} ={\r\n    'love': 1,\r\n    'happiness': 0.2,\r\n    'unhappiness': 0,\r\n    'hate': -1\r\n};","import { Trait, TraitCommunity, TraitIdeals } from \"../World\";\r\nimport { IInstitution, IOrganization } from \"./Institutions\";\r\nimport { Government, LawAxis } from \"./Government\";\r\n\r\n\r\nexport interface Party extends IInstitution{\r\n    slogan: string;\r\n    community: TraitCommunity;\r\n    ideals: TraitIdeals;\r\n    \r\n    availablePolicies: Policy[]; \r\n    proposedPolicy?: Policy;\r\n    availableCampaigns: Campaign[];\r\n    activeCampaigns: Campaign[];\r\n\r\n    platform: {[key in LawAxis]: IPolicy};\r\n\r\n    leadership: number;\r\n}\r\n\r\nexport class BaseParty implements Party{\r\n    key = 1;\r\n    playerKey = 1;\r\n    organizations: IOrganization[] = [];\r\n    public name: string = \"Citizen's Party\";\r\n    public slogan: string = \"Vote for us!\";\r\n    public community: TraitCommunity = 'state';\r\n    public ideals: TraitIdeals = 'trad';\r\n    public availablePolicies: Policy[] = [];\r\n    public proposedPolicy?: Policy;\r\n    public availableCampaigns: Campaign[] = [];\r\n    public activeCampaigns: Campaign[] = [];\r\n    public leadership: number = 10;\r\n    public activeHQs: number[] = [];\r\n    public platform: {[key in LawAxis]: IPolicy} = {} as {[key in LawAxis]: IPolicy};\r\n\r\n    constructor(){\r\n    }\r\n    // differingPolicies(law: Government): IPolicy[]{\r\n    //     return Object.keys(this.platform).filter((key: string) => {\r\n    //         const ax = key as LawAxis;\r\n    //         return this.platform[ax] != law.laws[ax];\r\n    //     }).map((key) => this.platform[key as LawAxis]);\r\n    // }\r\n}\r\n\r\nexport interface ICityPartyHQ{\r\n    cityKey: number;\r\n}\r\nexport class CityPartyHQ implements ICityPartyHQ{\r\n    cityKey: number = 0;\r\n}\r\n\r\nexport interface PoliticalEffect {\r\n    key: Trait;\r\n    /**\r\n     * magnitude (-3 to +3)\r\n     */\r\n    mag: number;\r\n}\r\nexport interface Policy {\r\n    key: string; \r\n    fx: PoliticalEffect[];\r\n    axis?: LawAxis;\r\n}\r\nexport interface Campaign {\r\n    key: string; \r\n    fx: PoliticalEffect[];\r\n    cityKey?: number;\r\n\r\n    seasonalCost: number;\r\n}\r\nexport interface IPolicy{\r\n    key: string, \r\n    name: string, \r\n    community?: TraitCommunity, \r\n    ideals?: TraitIdeals, \r\n    axis: LawAxis,\r\n    hint?: string\r\n}","import { Live } from \"../events/Events\";\r\nimport { TraitCommunity, TraitGood, TraitIdeals } from \"../World\";\r\nimport { Bean } from \"./Bean\";\r\nimport { SecondaryBeliefData, TraitBelief } from \"./Beliefs\";\r\nimport { IPolicy } from \"./Politics\";\r\n\r\nexport type LawGroup = 'Taxation'|'Welfare'|'Economics'|'Crime'|'Culture';\r\nexport type LawAxis = 'wel_food'|'wel_house'|'wel_health'|'tax_basic'|'tax_second'|'econ_sub'|'cul_rel'|'cul_theo'|'crime_theo';\r\n\r\nexport type LawType = 'civil'|'criminal';\r\n\r\nexport type LawKey = 'food_aid'\r\n|'medical_aid'\r\n|'poll_tax'\r\n// |'wealth_tax'\r\n// |'food_bank'\r\n// |'univ_rations'\r\n// |'housing_subsidy'\r\n// |'state_apartments'\r\n// |'clinics'\r\n// |'grain_sub'\r\n// |'arts'\r\n// |'theocracy'\r\n// |'secularism'\r\n// |'atheism'\r\n// |'mythology'\r\n// |'futurism'\r\n// |'drama'\r\n|'sales_tax'\r\n// |'vice_tax'\r\n// |'prop_tax'\r\n|'death_tax';\r\n\r\nexport type LawPrereq = TraitBelief|TraitBelief[];\r\nexport const DollarPerBeanRebateThreshold = 1;\r\n\r\nexport function PlayerCanSeePrereqs(prereqs: LawPrereq[], seen: Map<string, boolean>){\r\n    return prereqs.length === 0 || prereqs.some((x) => PlayerKnowsPrereq(x, seen));\r\n}\r\nexport function PlayerMeetsPrereqs(prereqs: LawPrereq[], seen: Map<string, boolean>){\r\n    return prereqs.length === 0 || prereqs.every((x) => PlayerKnowsPrereq(x, seen));\r\n}\r\nexport function PlayerKnowsPrereq(prereq: LawPrereq, seen: Map<string, boolean>){\r\n    return Array.isArray(prereq) ? prereq.some((x) => PlayerKnowsBelief(x, seen)) : PlayerKnowsBelief(prereq, seen);\r\n}\r\nexport function PlayerKnowsBelief(prereq: TraitBelief, seen: Map<string, boolean>){\r\n    return seen.has(prereq);\r\n}\r\nexport function PrereqKey(prereq: LawPrereq){\r\n    return Array.isArray(prereq) ? prereq.join('/') : prereq;\r\n}\r\nexport function PrereqString(prereq: LawPrereq){\r\n    return Array.isArray(prereq) ? prereq.map(x => BeliefString(x)).join(' / ') : BeliefString(prereq);\r\n}\r\nexport function BeliefString(prereq: TraitBelief){\r\n    return SecondaryBeliefData[prereq].icon+' '+SecondaryBeliefData[prereq].noun;\r\n}\r\n\r\nexport type LawPunishment = 'fine'|'imprison'|'death';\r\n\r\nexport interface ILaw{\r\n    /**\r\n     * convenience grouping property\r\n     */\r\n    group: LawGroup;\r\n    /**\r\n     * \"slot\" for law\r\n     */\r\n    axis: LawAxis;\r\n    /**\r\n     * specific law selected\r\n     */\r\n    key: LawKey;\r\n}\r\nexport interface IGovernment{\r\n    laws: ILaw[];\r\n    lawTree: {[key in LawAxis]: ILaw};\r\n}\r\nexport interface ILawData extends ILaw{\r\n    prereqs: LawPrereq[];\r\n    name: string;\r\n    hint?: string;\r\n    description?: string;\r\n    icon?: string;\r\n}\r\nexport const LawAxisData: {[key in LawAxis]: {name: string}} = {\r\n    'wel_food': {name: 'Food Welfare'},\r\n    'wel_house': {name: 'Housing Welfare'},\r\n    'wel_health': {name: 'Healthcare'},\r\n    'tax_basic': {name: 'Taxation'},\r\n    'tax_second': {name: 'Advanced Taxation'},\r\n    'econ_sub': {name: 'Subsidies'},\r\n    'cul_rel': {name: 'Culture'},\r\n    'cul_theo': {name: 'State Narrative'},\r\n    crime_theo: {name: 'Persecution'}\r\n}\r\nexport const LawData: {[key in LawKey]: ILawData} = {\r\n    'food_aid':{\r\n        key: 'food_aid', group: 'Welfare', name: 'Food Aid', axis: 'wel_food', icon: '',\r\n        description: 'The government buys Hungry Subjects food.', prereqs: [['Gluttony','Parochialism'], ['Charity', 'Socialism']]},\r\n    'medical_aid':{\r\n        key: 'medical_aid', group: 'Welfare', name: 'Med Aid', axis: 'wel_health', icon: '',\r\n        description: 'The government buys Sick Subjects medicine.', prereqs: ['Charity', 'Cosmopolitanism']},\r\n    // 'food_bank':{\r\n    //     key: 'food_bank', group: 'Welfare', name: 'Food Bank', axis: 'wel_food',\r\n    //     description: 'Hungry Subjects are provided food purchased by the government.'\r\n    // },\r\n    // 'food_stamps':{\r\n    //     key: 'food_stamps', group: 'Welfare', name: 'Food Stamps', axis: 'wel_food',\r\n    //     description: 'Hungry Subjects are provided money by the government to purchase food.'},\r\n    // 'univ_rations':{\r\n    //     key: 'univ_rations', group: 'Welfare', name: 'Universal Rations', axis: 'wel_food',\r\n    //     description: 'All Subjects are provided small amounts of food from the government.'},\r\n    // 'outside':{\r\n    //     key: 'outside', group: 'Welfare', name: 'Sleep Outside', axis: 'wel_house',\r\n    //     description: 'Homeless Subjects must sleep in the cold.'},\r\n    // 'homeless_shelters':{\r\n    //     key: 'homeless_shelters', group: 'Welfare', name: 'Homeless Shelters', axis: 'wel_house',\r\n    //     description: 'Homeless Subjects are provided shelter purchased by the government.'},\r\n    // 'housing_subsidy':{\r\n    //     key: 'housing_subsidy', group: 'Welfare', name: 'Housing Subsidy', axis: 'wel_house',\r\n    //     description: 'Homeless Subjects are provided money by the government to purchase shelter.'},\r\n    // 'state_apartments':{\r\n    //     key: 'state_apartments', group: 'Welfare', name: 'State Apartments', axis: 'wel_house'},\r\n    // 'stay_healthy':{\r\n    //     key: 'stay_healthy', group: 'Welfare', name: 'Stay Healthy', axis: 'wel_health',\r\n    //     description: 'Sick Subjects must pay for their own medical care.'},\r\n    // 'clinics':{\r\n    //     key: 'clinics', group: 'Welfare', name: 'Charity Clinics', axis: 'wel_health',\r\n    //     description: 'Sick Subjects are provided medicine purchased by the government.'},\r\n    // 'medical_aid':{\r\n    //     key: 'medical_aid', group: 'Welfare', name: 'Medical Aid', axis: 'wel_health',\r\n    //     description: 'Sick Subjects are provided money by the government to pay for medical care.'},\r\n    // 'univ_health':{\r\n    //     key: 'univ_health', group: 'Welfare', name: 'Universal Healthcare', axis: 'wel_health',\r\n    //     description: 'All Subjects are provided medical care by the government.'},\r\n    // 'hands_off':{\r\n    //     key: 'hands_off', group: 'Economics', name: 'Laissez-faire', axis: 'econ_sub',\r\n    //     description: 'No industries receive subsidies.'},\r\n    // 'grain_sub':{\r\n    //     key: 'grain_sub', group: 'Economics', name: 'Grain Subsidy', axis: 'econ_sub',\r\n    //     description: 'Farmers are provided money.'},\r\n    // 'arts':{\r\n    //     key: 'arts', group: 'Economics', name: 'Arts Patronage', axis: 'econ_sub'},\r\n    // 'theocracy':{\r\n    //     key: 'theocracy', group: 'Crime', name: 'Illegal Narratives', axis: 'crime_theo',\r\n    //     description: \"It is illegal for subjects to speak about other universal narratives.\"},\r\n    // 'secularism':{\r\n    //     key: 'secularism', group: 'Culture', name: 'Secularism', axis: 'cul_theo',\r\n    //     description: \"The government does not endorse a particular universal narrative.\"},\r\n    // 'atheism':{\r\n    //     key: 'atheism', group: 'Culture', name: 'State Nihilism', axis: 'cul_theo'},\r\n    // 'mythology':{\r\n    //     key: 'mythology', group: 'Culture', name: 'State Mythology ', axis: 'cul_theo'},\r\n    // 'futurism':{\r\n    //     key: 'futurism', group: 'Culture', name: 'State Futurism ', axis: 'cul_theo'},\r\n    // 'drama':{\r\n    //     key: 'drama', group: 'Culture', name: 'State Drama ', axis: 'cul_theo'},\r\n    // '':{key: // , group: '', name: 'Religious Schooling', 'state', idealPro: [ 'trad', axis: 'cul_ed'},\r\n    // '':{key: // , group: '', name: 'University Grants', 'ego', axis: 'cul_ed'},\r\n    // '':{key: // , group: '', name: 'College For All', 'state', idealPro: [ 'prog', axis: 'cul_ed'},\r\n    'poll_tax':{\r\n        key: 'poll_tax', group: 'Taxation', name: 'Head Tax', axis: 'tax_basic', prereqs: [], icon: '',\r\n        description: 'Subjects must pay a flat tax.'},\r\n    'sales_tax':{\r\n        key: 'sales_tax', group: 'Taxation', name: 'Sales Tax', axis: 'tax_basic', prereqs: [], icon: '',\r\n        description: 'Subjects must pay a percentage tax for every transaction.'},\r\n    // 'wealth_tax':{\r\n    //     key: 'wealth_tax', group: 'Taxation', name: 'Wealth Tax', axis: 'tax_basic',\r\n    //     description: 'Rich subjects must pay a percentage tax on their excess cash.'},\r\n    // 'vice_tax':{\r\n    //     key: 'vice_tax', group: 'Taxation', name: 'Vice Tax', axis: 'tax_second',\r\n    //     description: 'Entertainment goods have a flat tax.'},\r\n    // 'prop_tax':{\r\n    //     key: 'prop_tax', group: 'Taxation', name: 'Property Tax', axis: 'tax_second',\r\n    //     description: 'Subjects must pay a tax on housing.'},\r\n    'death_tax':{\r\n        key: 'death_tax', group: 'Taxation', name: 'Death Tax', axis: 'tax_second', prereqs: [], icon: '',\r\n        description: 'Dead subjects pay a portion of their cash to the government.'},\r\n}\r\n\r\nexport type LawGroupToLaws = {\r\n    [key in LawGroup]: ILaw[]\r\n};\r\nconst SalesTaxPercentage = 0.05;\r\nexport class Government{\r\n    public get laws(): ILaw[] {\r\n        return Object.values(this.lawTree).flatMap(law => law ? [law] : []);\r\n    }\r\n    public set laws(val: ILaw[]) {\r\n        val.forEach((v) => {\r\n            this.lawTree[v.axis] = v;\r\n        });\r\n    }\r\n    public getLawsByGroup(): LawGroupToLaws {\r\n        return this.laws.reduce((d, x) => {\r\n            d[x.group].push(x);\r\n            return d;\r\n        }, {\r\n            Taxation: [] as ILaw[],\r\n            Welfare: [] as ILaw[],\r\n            Economics: [] as ILaw[],\r\n            Crime: [] as ILaw[],\r\n            Culture: [] as ILaw[]\r\n        });\r\n    }\r\n    public lawTree: {[key in LawAxis]: ILaw|undefined} = {} as {[key in LawAxis]: ILaw|undefined};\r\n    public treasury: Live<number> = new Live<number>(0);\r\n\r\n    isLaw(l: LawKey): boolean{\r\n        return this.lawTree[LawData[l].axis]?.key === l;\r\n    }\r\n\r\n    enact(l: LawKey): void {\r\n        const data = LawData[l];\r\n        this.lawTree[data.axis] = data;\r\n    }\r\n\r\n    revoke(l: LawKey): void {\r\n        const data = LawData[l];\r\n        this.lawTree[data.axis] = undefined;\r\n    }\r\n\r\n    get salesTaxPercentage(): number{\r\n        return this.isLaw('sales_tax') ? SalesTaxPercentage : 0;\r\n    }\r\n    \r\n    PurchaseQualifiesForWelfare(bean: Bean, good: TraitGood): boolean{\r\n        switch(good){\r\n            case 'food':\r\n                return (bean.food === 'starving' || bean.food === 'hungry') && this.isLaw('food_aid');\r\n            case 'medicine':\r\n                return (bean.health === 'sick' || bean.health === 'sickly') && this.isLaw('medical_aid');\r\n        }\r\n        return false;\r\n    }\r\n    CanPayWelfare(price: number): boolean{\r\n        return this.treasury.get >= price;\r\n    }\r\n    MaybeRebate(beans: Bean[]){\r\n        const allowedTreasury = beans.length * DollarPerBeanRebateThreshold;\r\n        if (this.treasury.get > allowedTreasury){\r\n            const overage = this.treasury.get - allowedTreasury;\r\n            const perBean = overage / beans.length;\r\n            this.treasury.set(allowedTreasury);\r\n            beans.forEach((b) => b.cash += perBean);\r\n        }\r\n    }\r\n}","import { BeliefCommonality } from \"./simulation/Beliefs\";\r\nimport { BuildingTypes } from \"./simulation/Geography\";\r\nimport { RubricKeys } from \"./simulation/Player\";\r\nimport { IThreshold, TraitGood } from \"./World\";\r\n\r\nexport type PlayerEmptyHexAction = 'build';\r\nexport type PlayerHexAction = 'beam'|'upgrade';\r\nexport type PlayerBeanAction = 'scan'|'abduct'|'vaporize'|'siphon'|'empower'|'gift';\r\nexport type PlayerBeanBrainAction = 'brainwash_ideal'|'brainimplant_secondary'|'brainwash_secondary';\r\nexport type PlayerMarketAction = 'energy'|'bots';\r\nexport type PlayerGovernmentAction = '';\r\nexport type PlayerAction = PlayerHexAction|PlayerBeanAction;\r\n\r\nexport interface PlayerResources{\r\n    energy?: number;\r\n    bots?: number;\r\n    hedons?: number;\r\n    tortrons?: number;\r\n}\r\nexport interface BeanResources{\r\n    sanity?: number;\r\n}\r\nexport type BeanDeathCause = 'vaporization'|'exposure'|'starvation'|'sickness';\r\nexport function triadToString(cost: PlayerResources, sign: '+'|''|'-', qty: number = 1){\r\n    const costs = [];\r\n    if (cost.energy){\r\n        costs.push(sign+(cost.energy*qty)+' Energy');\r\n    }\r\n    if (cost.bots){\r\n        costs.push(sign+(cost.bots*qty)+' Bots');\r\n    }\r\n    if (cost.hedons){\r\n        costs.push(sign+(cost.hedons*qty)+' Hedons');\r\n    }\r\n    if (cost.tortrons){\r\n        costs.push(sign+(cost.tortrons*qty)+' Antihedons');\r\n    }\r\n    return costs.join(' ');\r\n}\r\nexport interface SecondaryResources{\r\n    research?: number;\r\n    leadership?: number;\r\n}\r\nexport interface IDifficulty{\r\n    cost: {\r\n        emptyHex: {[key in PlayerEmptyHexAction]: {[key in BuildingTypes]: PlayerResources}},\r\n        hex: {[key in PlayerHexAction]: PlayerResources} \r\n        bean: {[key in PlayerBeanAction]: PlayerResources},\r\n        bean_brain: {[key in PlayerBeanBrainAction]: BeanResources}\r\n        market: {\r\n            scrubHedons: PlayerResources,\r\n            resource: {[key in PlayerMarketAction]: PlayerResources},\r\n            beliefs: {[key in BeliefCommonality]: PlayerResources}\r\n        }\r\n    },\r\n    bean_life: {\r\n        vital_thresh: {[key in TraitGood]: IThreshold},\r\n        degrade_per_tick: {\r\n            food: number,\r\n            health: number,\r\n            stamina: number,\r\n            fun: number\r\n        },\r\n        penalty: {\r\n            homeless_health: number,\r\n            starving_health: number\r\n        },\r\n        death_chance: {\r\n            [cause in BeanDeathCause]: number\r\n        }\r\n    },\r\n    report_card_progression: RubricKeys[]\r\n}\r\nexport const DefaultDifficulty: IDifficulty = {\r\n    cost: {\r\n        emptyHex: {\r\n            build: {\r\n                house: {\r\n                    energy: 1,\r\n                    bots: 3\r\n                },\r\n                farm: {\r\n                    energy: 1,\r\n                    bots: 3\r\n                },\r\n                theater: {\r\n                    energy: 1,\r\n                    bots: 4\r\n                },\r\n                hospital: {\r\n                    energy: 1,\r\n                    bots: 4\r\n                },\r\n                church: {\r\n                    energy: 1,\r\n                    bots: 4\r\n                },\r\n                courthouse: {\r\n                    energy: 999,\r\n                    bots: 999\r\n                },\r\n                park: {\r\n                    energy: 1,\r\n                    bots: 4\r\n                },\r\n                nature: {\r\n                    energy: 1,\r\n                    bots: 4\r\n                }\r\n            }\r\n        },\r\n        hex: {\r\n            beam: {\r\n                energy: 3\r\n            },\r\n            upgrade: {\r\n                energy: 1,\r\n                bots: 4,\r\n            }\r\n        },\r\n        bean_brain: {\r\n            brainwash_ideal: { sanity: 4},\r\n            brainimplant_secondary: { sanity: 1},\r\n            brainwash_secondary: {sanity: 2},\r\n        },\r\n        bean: {\r\n            scan: {\r\n                energy: 1\r\n            },\r\n            abduct: {\r\n                bots: 3\r\n            },\r\n            gift: {},\r\n            empower: {},\r\n            vaporize: {\r\n                energy: 2,\r\n                bots: 4\r\n            },\r\n            siphon: {},\r\n        },\r\n        market: {\r\n            scrubHedons: {\r\n                energy: 5\r\n            },\r\n            resource: {\r\n                bots: {\r\n                    hedons: 6\r\n                },\r\n                energy: {\r\n                    hedons: 5\r\n                }\r\n            },\r\n            beliefs: {\r\n                common: {},\r\n                uncommon: {},\r\n                rare: {}\r\n            },\r\n        }\r\n    },\r\n    bean_life: {\r\n        vital_thresh: {\r\n            'food': {warning: 0.6, sufficient: 1, abundant: 3},\r\n            'shelter': {warning: 0.6, sufficient: 1, abundant: 7},\r\n            'medicine': {warning: 0.6, sufficient: 1, abundant: 3},\r\n            'fun': {warning: 0.1, sufficient: 1, abundant: 3},\r\n        },\r\n        degrade_per_tick: {\r\n            food: 1/12,\r\n            health: 1/20,\r\n            stamina: 1,\r\n            fun: 1/12\r\n        },\r\n        penalty: {\r\n            homeless_health: 1/20,\r\n            starving_health: 1/24\r\n        },\r\n        death_chance: {\r\n            starvation: 1/8,\r\n            sickness: 1/8,\r\n            exposure: 1/8,\r\n            vaporization: 1\r\n        }\r\n    },\r\n    report_card_progression: []\r\n};","import { ChangePubSub, LiveList, LiveMap } from \"../events/Events\";\r\nimport { DefaultDifficulty, IDifficulty, PlayerResources } from \"../Game\";\r\nimport { World } from \"../World\";\r\nimport { Number_Starting_City_Pop } from \"../WorldGen\";\r\nimport { IBean } from \"./Agent\";\r\nimport { TraitBelief } from \"./Beliefs\";\r\nimport { IDate } from \"./Time\";\r\n\r\n\r\nexport interface IPlayerData{\r\n    scanned_bean: {[beanKey: number]: boolean};\r\n    abductedBeans: IBean[];\r\n    energy: IResource;\r\n    bots: IResource;\r\n    workingReportCard: IReportCard;\r\n    techProgress: TechProgress;\r\n    currentlyResearchingTech: Tech|undefined;\r\n}\r\n\r\nexport interface IResource{\r\n    amount: number;\r\n    income: number;\r\n    change: ChangePubSub;\r\n}\r\n\r\nexport type GoalKey = 'found_utopia'|'build_house_n_farm'|'beam_3'|'scan'|'set_policy'|'brainwash'|'c+_grade';\r\nexport interface IGoal{\r\n    key: GoalKey;\r\n    text: string;\r\n    tooltip?: string;\r\n    reward?: PlayerResources,\r\n    check: (world: World) => boolean\r\n}\r\nexport interface IGoalProgress {\r\n    done: boolean,\r\n    step: number\r\n}\r\nexport interface IProgressable{\r\n    goalProgress: {[key: string]: IGoalProgress},\r\n    goals: Array<GoalKey>\r\n}\r\nexport const Goals: {[key in GoalKey]: IGoal} = {\r\n    found_utopia: {\r\n        key: 'found_utopia', text: 'Found your Utopia',\r\n       check: (world) => world.party.name != 'Goodplace'\r\n    },\r\n    build_house_n_farm: {\r\n        key: 'build_house_n_farm', text: 'Build a house and farm',\r\n        check: (world) => {\r\n            return world.cities[0].book.getCountOfType('house') > 0 &&\r\n            world.cities[0].book.getCountOfType('house') > 0;\r\n        },\r\n        reward: {\r\n            energy: 3, bots: 3\r\n        }\r\n    }, \r\n    beam_3: {\r\n        key: 'beam_3', text: 'Beam in 3 new beings', \r\n        check: (world) => {\r\n            return world.beans.get.filter(b => !b.bornInPetri).length >= (3 + Number_Starting_City_Pop)\r\n        }\r\n    }, \r\n    scan: {\r\n        key: 'scan', text: 'Scan a Subject',\r\n        check: (world) => Object.keys(world.alien.scanned_bean).length > 0\r\n    }, \r\n    set_policy: {\r\n        key: 'set_policy', text: 'Set a Gov Policy',\r\n        check: (world) => false\r\n    }, \r\n    brainwash: {\r\n        key: 'brainwash', text: 'Brainwash a Subject',\r\n        check: (world) => false\r\n    }, \r\n    'c+_grade': {\r\n        key: 'c+_grade', text: 'Receive a C+ Grade',\r\n        check: (world) => false\r\n    } \r\n};\r\n\r\nexport type Grade = 'F'|'D'|'C'|'B'|'A';\r\nexport type RubricKeys = 'Happiness'|'Prosperity'|'Stability'|'Dogma';\r\nexport type IReportCard = {[key in RubricKeys]: Grade}\r\nexport type GradingFunc = (world: World) => IReportCard;\r\nexport interface ICurriculum {\r\n    GradeWorld: GradingFunc,\r\n    RubricDescription: {[key in RubricKeys]: string} \r\n}\r\nexport const Curriculums: {[difficulty: string]: ICurriculum} = {\r\n    Default: {\r\n        GradeWorld: (world: World) => {return{\r\n            Happiness: BooleanAverageGrader(world.beans.get, (o) => o.lastHappiness >- .2),\r\n            Prosperity: BooleanAverageGrader(world.beans.get, (o) => o.food !== 'hungry'),\r\n            Stability: BooleanAverageGrader(world.beans.get, (o) => o.sanity === 'sane'),\r\n            Dogma: GradeUpToNumber((world.alien.speechcrimes[world.date.year] || 0), 10, 10),\r\n        }},\r\n        RubricDescription: {\r\n            Happiness: 'Subjects are at least 20% happy',\r\n            Prosperity: 'Subjects are not hungry',\r\n            Stability: 'Subjects are all sane',\r\n            Dogma: 'Up to 10 Speechcrimes'\r\n        }\r\n    }\r\n}\r\n/**\r\n * \r\n * @param number number of bad events\r\n * @param allowance number of allowed events\r\n * @param maximum range of \"overflow\" events\r\n */\r\nfunction GradeUpToNumber(number: number, allowance: number, maximum: number): Grade{\r\n    const normalized = 1 - Math.min(1, Math.max(0, number - allowance) / maximum);\r\n    return NormalizedScoreToGrade(normalized);\r\n}\r\nfunction BooleanAverageGrader<T>(array: T[], grade: (o: T) => boolean): Grade{\r\n    if (array.length < 1) return 'F';\r\n    return NormalizedScoreToGrade(array.filter(grade).length / array.length);\r\n}\r\nfunction NormalizedScoreToGrade(normNumber: number): Grade{\r\n    if (normNumber < .58) return 'F';\r\n    if (normNumber < .68) return 'D';\r\n    if (normNumber < .78) return 'C';\r\n    if (normNumber < .88) return 'B';\r\n    return 'A';\r\n}\r\nconst GradeWeights: {[key in Grade]: number} ={\r\n    A: 5,\r\n    B: 4,\r\n    C: 3,\r\n    D: 2,\r\n    F: 1\r\n}\r\nexport function GetAverage(reportCard: IReportCard): Grade{\r\n    return NormalizedScoreToGrade((GradeWeights[reportCard.Happiness] + \r\n        GradeWeights[reportCard.Prosperity] + \r\n        GradeWeights[reportCard.Stability] +\r\n        GradeWeights[reportCard.Dogma] \r\n    ) / 20);\r\n}\r\n\r\nexport type Tech = 'sanity_bonus'|'fast_resources'|'trauma_nanobots'|'neural_duplicator';\r\nexport interface ITechInfo{\r\n    tech: Tech,\r\n    /**\r\n     * number of tech points required to complete research\r\n     */\r\n    techPoints: number,\r\n    name: string,\r\n    description: string\r\n}\r\nexport const TechData: {[key in Tech]: ITechInfo} = {\r\n    'sanity_bonus': {\r\n        tech: 'sanity_bonus',\r\n        name: 'Surgical Psychops',\r\n        techPoints: 30,\r\n        description: 'Brainwashing causes -1  Sanity damage'\r\n    },\r\n    'fast_resources': {\r\n        tech: 'fast_resources',\r\n        name: '0 Dimensional Supersiphons',\r\n        techPoints: 30,\r\n        description: 'Faster  and  accumulation'\r\n    },\r\n    'trauma_nanobots': {\r\n        tech: 'trauma_nanobots',\r\n        name: 'Trauma Nanobots',\r\n        techPoints: 30,\r\n        description: 'Spend  to stop Subject from dying'\r\n    },\r\n    'neural_duplicator': {\r\n        tech: 'neural_duplicator',\r\n        name: 'Level 2 Neural Duplication',\r\n        techPoints: 30,\r\n        description: 'Copy  Traits 1 additional time'\r\n    }\r\n}\r\nexport interface IPlayerTechProgress{\r\n    /**\r\n     * number of research points\r\n     */\r\n    researchPoints: number\r\n}\r\nexport type TechProgress = {[key: string]: IPlayerTechProgress};\r\nexport interface BeliefInventory{\r\n    trait: TraitBelief,\r\n    charges: number\r\n}\r\n\r\nexport class Player implements IPlayerData, IProgressable{\r\n    public scanned_bean: {[beanKey: number]: boolean} = {};\r\n    public seenBeliefs = new LiveMap<string, boolean>(new Map<string, boolean>());\r\n    public beliefInventory = new LiveList<BeliefInventory>([]);\r\n    public speechcrimes: {[year: number]: number} = {};\r\n    public abductedBeans: IBean[] = [];\r\n    public energy = { amount: 16, income: 2/30, change: new ChangePubSub()};\r\n    public bots = { amount: 10, income: 2/30, change: new ChangePubSub()};\r\n    public hedons = { amount: 0, income: 0, change: new ChangePubSub()};\r\n    public tortrons = { amount: 0, income: 0, change: new ChangePubSub()};\r\n    public next_grade: IDate = { year: 1, season: 3, day: 1, hour: 0 };\r\n    public difficulty: IDifficulty = DefaultDifficulty;\r\n    public goals: GoalKey[] = ['found_utopia', 'build_house_n_farm',  'beam_3', 'scan', 'brainwash', 'set_policy', 'c+_grade'];\r\n    public goalProgress: {[key: string]: IGoalProgress} = {};\r\n    public pastReportCards: IReportCard[] = [];\r\n    public workingReportCard: IReportCard = {\r\n        Happiness: 'D',\r\n        Prosperity: 'D',\r\n        Stability: 'D',\r\n        Dogma: 'D',\r\n    };\r\n    public techProgress: TechProgress = {};\r\n    public currentlyResearchingTech: Tech|undefined;\r\n\r\n    public canAfford(cost: PlayerResources, qty: number = 1): boolean{\r\n        return (cost.bots === undefined || this.bots.amount >= cost.bots * qty) &&\r\n        (cost.energy === undefined || this.energy.amount >= cost.energy * qty) && \r\n        (cost.hedons === undefined || this.hedons.amount >= cost.hedons * qty);\r\n    }\r\n\r\n    public hasResearched(tech: Tech){\r\n        return this.techProgress[tech] != null && this.techProgress[tech].researchPoints >= TechData[tech].techPoints;\r\n    }\r\n\r\n    public useCharge(t: TraitBelief){\r\n        const all = this.beliefInventory.get;\r\n        const existing = all.find(x => x.trait === t);\r\n        if (existing){\r\n            existing.charges -= 1;\r\n            this.beliefInventory.set([...all.filter(x => x.charges > 0)]);\r\n        }\r\n    }\r\n\r\n    public purchase(cost: PlayerResources, qty: number = 1){\r\n        if (cost.bots){\r\n            this.bots.amount -= cost.bots * qty;\r\n            this.bots.change.publish({change: -cost.bots * qty});\r\n        }\r\n        if (cost.energy){\r\n            this.energy.amount -= cost.energy * qty;\r\n            this.energy.change.publish({change: -cost.energy * qty});\r\n        }\r\n        if (cost.hedons){\r\n            this.hedons.amount -= cost.hedons * qty;\r\n            this.hedons.change.publish({change: -cost.hedons * qty});\r\n        }\r\n    }\r\n\r\n    public tryPurchase(cost: PlayerResources, qty: number = 1): boolean{\r\n        if (this.canAfford(cost, qty)){\r\n            this.purchase(cost, qty);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public reward(reward: PlayerResources){\r\n        if (reward.bots){\r\n            this.bots.amount += reward.bots;\r\n            this.bots.change.publish({change: reward.bots});\r\n        }\r\n        if (reward.energy){\r\n            this.energy.amount += reward.energy;\r\n            this.energy.change.publish({change: reward.energy});\r\n        }\r\n        if (reward.hedons){\r\n            this.hedons.amount += reward.hedons;\r\n            this.hedons.change.publish({change: reward.hedons});\r\n        }\r\n\r\n    }\r\n\r\n    public checkGoals(world: World){\r\n        for (let i = 0; i < this.goals.length; i++) {\r\n            const goal = this.goals[i];\r\n            if (this.goalProgress[goal] == null){\r\n                this.goalProgress[goal] = {done: false, step: 0};\r\n            }\r\n            if (!this.goalProgress[goal].done) {\r\n                const done = Goals[goal].check(world);\r\n                const reward = Goals[goal].reward;\r\n                this.goalProgress[goal].done = done;\r\n                if (done && reward != null){\r\n                    this.reward(reward);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    public checkReportCard(world: World) {\r\n        this.workingReportCard = Curriculums.Default.GradeWorld(world);\r\n    }\r\n}","export type SFXFile = 'drop.mp3'|'ding_soft.mp3'|'ding_bad.wav'|'death_bell.wav'|'scan.mp3'|'squish_pop.mp3'|'squish_suck.mp3'|'baby_squeak.wav'|'mhmm.mp3';\r\nexport type SFX = 'drop'|'happiness'|'unhappiness'|'love'|'hate'|'death'|'scan'|'wash_in'|'wash_out'|'squeak'|'mhmm';\r\n\r\nconst SFXToFile: {[sfx in SFX]: SFXFile} = {\r\n    drop: \"drop.mp3\",\r\n    love: \"ding_soft.mp3\",\r\n    happiness: \"ding_soft.mp3\",\r\n    unhappiness: \"ding_bad.wav\",\r\n    hate: \"ding_bad.wav\",\r\n    death: \"death_bell.wav\",\r\n    scan: 'scan.mp3',\r\n    wash_in: 'squish_pop.mp3',\r\n    wash_out: 'squish_suck.mp3',\r\n    squeak: 'baby_squeak.wav',\r\n    mhmm: 'mhmm.mp3',\r\n};\r\n\r\ntype SFXMap = {[sfx in SFX]: SoundBuffer};\r\n\r\nclass SoundBuffer{\r\n    constructor(private file: SFXFile, private volume: number = 1){}\r\n\r\n    private buffer: HTMLAudioElement[] = [];\r\n    play(){\r\n        if (this.buffer.length > 0 && this.buffer[0].ended){\r\n            const audio = this.buffer.shift();\r\n            audio?.play();\r\n            if (audio)\r\n                this.buffer.push(audio);\r\n        } else {\r\n            const aud = new Audio(process.env.PUBLIC_URL+'/'+this.file);\r\n            aud.volume = this.volume;\r\n            aud.play();\r\n            this.buffer.push(aud);\r\n        }\r\n    }\r\n}\r\nexport class WorldSound{\r\n    private lib: SFXMap = {\r\n        'drop': new SoundBuffer(SFXToFile['drop'], 0.2),\r\n        'love': new SoundBuffer(SFXToFile['happiness']),\r\n        'happiness': new SoundBuffer(SFXToFile['happiness']),\r\n        'unhappiness': new SoundBuffer(SFXToFile['unhappiness']),\r\n        'hate': new SoundBuffer(SFXToFile['unhappiness']),\r\n        'death': new SoundBuffer(SFXToFile['death']),\r\n        'scan': new SoundBuffer(SFXToFile['scan'], 0.3),\r\n        'wash_in': new SoundBuffer(SFXToFile['wash_in']),\r\n        'wash_out': new SoundBuffer(SFXToFile['wash_out']),\r\n        'squeak': new SoundBuffer(SFXToFile['squeak'], 0.3),\r\n        'mhmm': new SoundBuffer(SFXToFile['mhmm'], 0.5),\r\n    }\r\n\r\n    public play(sfx: SFX){\r\n        this.lib[sfx].play();\r\n    }\r\n}","import { PlayerResources } from \"../Game\";\r\nimport { GetRandom, GetRandomNumber } from \"../WorldGen\";\r\nimport { BeliefCommonality, RandomBeliefBucket, SecondaryBeliefData, TraitBelief } from \"./Beliefs\";\r\n\r\nexport interface MarketTraitListing {\r\n    cost: PlayerResources;\r\n    trait: TraitBelief;\r\n}\r\nexport const CommonalityBaseCost: {[b in BeliefCommonality]: number} = {\r\n    'common': 3,\r\n    'uncommon': 5,\r\n    'rare': 7\r\n};\r\nexport const CommonalityRandomMaxCost: {[b in BeliefCommonality]: number} = {\r\n    'common': 3,\r\n    'uncommon': 5,\r\n    'rare': 7\r\n};\r\n\r\nexport function GetMarketTraits(): MarketTraitListing[]{\r\n    const newTraits: MarketTraitListing[] = [];\r\n    for (let i = 0; i < 3; i++) {\r\n        const b = GetRandom(RandomBeliefBucket);\r\n        newTraits.push(getMarketTraitListing(b));\r\n    }\r\n    return newTraits;\r\n}\r\n\r\nfunction getMarketTraitListing(b: TraitBelief): MarketTraitListing{\r\n    const rare = SecondaryBeliefData[b].rarity;\r\n    return {\r\n        trait: b,\r\n        cost: {\r\n            hedons: CommonalityBaseCost[rare] + GetRandomNumber(0, CommonalityRandomMaxCost[rare])\r\n        }\r\n    }\r\n}","import { IBeanContainer, Tile, Trait, TraitEthno, TraitJob, TraitEmote } from \"../World\";\r\nimport { Bean } from \"./Bean\";\r\nimport { Economy } from \"./Economy\";\r\nimport { Government } from \"./Government\";\r\nimport { GenerateBean, GetRandom, GetRandomNumber } from \"../WorldGen\";\r\nimport { ICityPartyHQ, Party } from \"./Politics\";\r\nimport { Geography, HexPoint, IBuilding, JobToBuilding, Point, Vector } from \"./Geography\";\r\nimport { IDate } from \"./Time\";\r\nimport { shuffle } from \"./Utils\";\r\nimport { BuildingJobSlot } from \"./Occupation\";\r\nimport { IEventBus, Live, LiveList, PubSub } from \"../events/Events\";\r\nimport { WorldSound } from \"../WorldSound\";\r\nimport { isEnterprise } from \"./Institutions\";\r\nimport { SecondaryBeliefData, TraitBelief } from \"./Beliefs\";\r\n\r\n\r\nexport function reportIdeals(beans: Bean[]): {avg: number, winner: Trait}{\r\n    return _report(beans, 'ego' as Trait, (b) => b.ideals);\r\n}\r\nexport function reportCommunity(beans: Bean[]): {avg: number, winner: Trait}{\r\n    return _report(beans, 'state' as Trait, (b) => b.community);\r\n}\r\nexport function reportEthno(beans: Bean[]): {avg: number, winner: Trait}{\r\n    return _report(beans, 'circle' as Trait, (b) => b.ethnicity);\r\n}\r\nexport function _report(beans: Bean[], defWin: Trait, beanPropGet: (bean: Bean) => Trait): {avg: number, winner: Trait}{\r\n    const result = { avg: 0, winner: defWin };\r\n    const all = beans.reduce((stash: any, bean) => {\r\n        const value = beanPropGet(bean);\r\n        if (stash[value] == null) { stash[value] = 1;}\r\n        else { stash[value]++}\r\n        return stash;\r\n    }, {});\r\n    Object.keys(all).forEach((trait) => {\r\n        if (all[trait] > result.avg) {\r\n            result.avg = all[trait];\r\n            result.winner = trait as Trait;\r\n        }\r\n    });\r\n    result.avg /= beans.length;\r\n    return result;\r\n}\r\n\r\nexport class UFO{\r\n    constructor(public key: number, public point: HexPoint, public action: string){}\r\n}\r\nexport class Pickup{\r\n    constructor(public key: number, public point: Point, public type: TraitEmote){}\r\n    public velocity: Vector = {x: 0, y: 0};\r\n    public onMove = new PubSub<Point>();\r\n}\r\n\r\n\r\nexport class City extends Geography implements Tile, IBeanContainer {\r\n    public name: string = '';\r\n    public url: string = '';\r\n    public type: string = '';\r\n    public key: number = 0;\r\n    public beans = new LiveList<Bean>([]);\r\n    public historicalBeans = new LiveList<Bean>([]);\r\n    public readonly pickups = new LiveList<Pickup>([]);\r\n    public ufos: UFO[] = [];\r\n    public pickupSeed = 0;\r\n    public beanSeed = 0;\r\n    public houses: any[] = [];\r\n    public partyHQ?: ICityPartyHQ;\r\n    public yearsPartyDonations: number = 0;\r\n\r\n    /// computed properties\r\n    public majorityEthnicity: TraitEthno = 'circle';\r\n    public costOfLiving: number = 1;\r\n\r\n    constructor(private sfx: WorldSound, public readonly economy: Economy){\r\n        super();\r\n    }\r\n\r\n    public law?: Government;\r\n    public environment?: IDate;\r\n    public eventBus?: IEventBus;\r\n    public pickupMagnetPoint = new Live<Point|undefined>(undefined);\r\n\r\n    tryGetJob(bean: Bean, job: TraitJob): boolean{\r\n        if(job === 'jobless') return false;\r\n        const allOfType = this.book.getBuildings().filter((x) => x.type === JobToBuilding[job]);\r\n        \r\n        for (let i = 0; i < allOfType.length; i++) {\r\n            const building = allOfType[i];\r\n            const slots = building.openSlots();\r\n            if (slots.length > 0){\r\n                const slot = slots.shift() as BuildingJobSlot;\r\n                building.job_slots[slot] = bean.key;\r\n                bean.employerEnterpriseKey = building.key;\r\n                if (isEnterprise(building) && building.ownerBeanKey == null){\r\n                    building.ownerBeanKey = bean.key;\r\n                }\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n    unsetJob(bean: Bean){\r\n        if (bean.job === 'jobless') return;\r\n        const all = this.book.getBuildings();\r\n        for (let i = 0; i < all.length; i++) {\r\n            const building = all[i];\r\n            if (building.tryFreeBean(bean.key)){\r\n                bean.employerEnterpriseKey = undefined;\r\n                bean.job = 'jobless';\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    addEmotePickup(p: Point, emote: TraitEmote){\r\n        const point = {...p};\r\n        point.x += GetRandomNumber(-10, 10);\r\n        point.y += GetRandomNumber(-10, 10);\r\n        const id = ++this.pickupSeed;\r\n        this.pickups.push(new Pickup(id, point, emote));\r\n    }\r\n\r\n    getRandomCitizen(): Bean|null{\r\n        const shuffled = shuffle(this.beans.get);\r\n        if (shuffled.length > 0) {\r\n            return shuffled[0];\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n    onCitizenDie(deadBean: Bean){\r\n        if (deadBean.cash > 0){\r\n            if (this.law && this.law.isLaw('death_tax')){\r\n                this.law.treasury.set(this.law.treasury.get + deadBean.cash);\r\n                deadBean.cash = 0;\r\n            } else {\r\n                //inheritance\r\n                const lucky = this.getRandomCitizen();\r\n                if (lucky) {\r\n                    lucky.cash = lucky.cash + deadBean.cash;\r\n                    deadBean.cash = 0;\r\n                }\r\n            }\r\n        }\r\n        this.unsetJob(deadBean);\r\n    }\r\n    breedBean(parent: Bean) {\r\n        const job: TraitJob = Math.random() <= .5 ? parent.job : GetRandom(['doc', 'farmer', 'builder', 'jobless']);\r\n        const bean = GenerateBean(this, undefined, job);\r\n        bean.ethnicity = parent.ethnicity;\r\n        bean.name = bean.name.split(' ')[0] + ' ' + parent.name.split(' ')[1];\r\n        bean.cash = parent.cash / 2;\r\n        parent.cash /= 2;\r\n        bean.bornInPetri = true;\r\n        if (this.environment)\r\n            bean.dob = {year: this.environment?.year, season: this.environment?.season, day: this.environment?.day, hour: this.environment?.hour};\r\n        this.beans.push(bean);\r\n    }\r\n    getTaxesAndDonations(party: Party, economy: Economy){\r\n    }\r\n    calculate(economy: Economy, law: Government) {\r\n        this.costOfLiving = economy.getCostOfLiving();\r\n        const c = this.beans.get.reduce((count: {circle: number, square: number, triangle: number}, bean) => {\r\n            switch(bean.ethnicity){\r\n                case 'circle': count.circle++;break;\r\n                case 'square': count.square++;break;\r\n                case 'triangle': count.triangle++;break;\r\n            }\r\n            return count;\r\n        }, {circle: 0, square: 0, triangle: 0});\r\n        if (c.circle > c.square && c.circle > c.triangle){\r\n            this.majorityEthnicity = 'circle';\r\n        } else if (c.square > c.circle && c.square > c.triangle){\r\n            this.majorityEthnicity = 'square';\r\n        } else {\r\n            this.majorityEthnicity = 'triangle';\r\n        }\r\n    }\r\n    getNearestNeighbors(source: Bean): Bean[] {\r\n        return this.beans.get.filter((b) => {\r\n            if (b.key == source.key) return false;\r\n\r\n            const p = b.point;\r\n            const q = source.point;\r\n            const squared = Math.pow(p.x - q.x, 2)+Math.pow(p.y - q.y, 2);\r\n\r\n            return squared < 1600 && squared > 600;\r\n        });\r\n    }\r\n    getPopulationTraitsList(scannedBeans: {[beanKey: number]: boolean}, beans = this.beans.get): {icon: string, noun: string, count: number}[]{\r\n        return Array.from(\r\n            beans.reduce((m, b) => {\r\n                if (scannedBeans[b.key]){\r\n                    b.beliefs.forEach((t) => {\r\n                        const prev = m.get(t) || 0;\r\n                        m.set(t, prev+1);\r\n                    });\r\n                } else {\r\n                    m.set('Unknown', (m.get('Unknown') || 0) + 1);\r\n                }\r\n                return m;\r\n            }, new Map<TraitBelief|'Unknown', number>()).entries()\r\n        ).sort(([aT, aC], [bT, bC]) => bC - aC).map(([t, c]) => {\r\n            return t === 'Unknown' ? {\r\n                icon: '',\r\n                noun: 'Unknown',\r\n                count: c\r\n            } : {\r\n                icon: SecondaryBeliefData[t].icon,\r\n                noun: SecondaryBeliefData[t].noun,\r\n                count: c\r\n            }\r\n        });\r\n    }\r\n}","import { Bean } from \"./Bean\";\r\nimport { City } from \"./City\";\r\nimport { BuildingTypes, HexPoint, IBuilding, Point } from \"./Geography\";\r\nimport { EnterpriseType, IEnterprise } from \"./Institutions\";\r\nimport { BuildingJobSlot } from \"./Occupation\";\r\n\r\nexport class Building implements IBuilding, IEnterprise{\r\n    public city?: City;\r\n    public key: number = 0;\r\n    public cityKey: number = 0;\r\n    public address: HexPoint = {q: 0, r: 0};\r\n    public type: BuildingTypes = 'farm';\r\n    public occupied_slots: Point[] = [];\r\n    public empty_slots: Point[] = [];\r\n    public upgraded: boolean = false;\r\n    public job_slots: {[key in BuildingJobSlot]: number|null} = {\r\n        0: null,\r\n        1: null,\r\n        2: null,\r\n        3: null,\r\n        4: null,\r\n        5: null,\r\n    }\r\n    public enterpriseType: EnterpriseType = 'company';\r\n    public ownerBeanKey?: number | undefined;\r\n    public ticksSinceLastSale: number = 0;\r\n    public bank: number = 0;\r\n    get cash(): number{\r\n        return this.bank;\r\n    }\r\n    set cash(revenue: number){\r\n        this.bank += revenue;\r\n        this.distributeCash();\r\n    }\r\n    distributeCash(){\r\n        const workers = this.getWorkerBeans();\r\n        switch(this.enterpriseType){\r\n            case 'company':\r\n                if (workers.length < 1) {\r\n                    //noop;\r\n                } else if (workers.length === 1){\r\n                    workers[0].cash += this.bank;\r\n                    this.bank = 0;\r\n                }\r\n                else {\r\n                    const share = this.bank / (workers.length + 0.5);\r\n                    this.bank = 0;\r\n                    let owner = workers.find(x => x.key === this.ownerBeanKey);\r\n                    if (owner == null){\r\n                        owner = workers[0];\r\n                        this.ownerBeanKey = owner.key;\r\n                    }\r\n                    workers.forEach(x => {\r\n                        if (x === owner){\r\n                            x.cash += share * 1.5;\r\n                        } else {\r\n                            x.cash += share;\r\n                        }\r\n                    });\r\n                }\r\n                break;\r\n            case 'co-op':\r\n                const share = this.bank / workers.length;\r\n                this.bank = 0;\r\n                workers.forEach(x => {\r\n                    x.cash += share;\r\n                });\r\n                break;\r\n            case 'commune':\r\n                const commShare = this.bank / workers.length;\r\n                this.bank = 0;\r\n                workers.forEach(x => {\r\n                    x.cash += commShare;\r\n                });\r\n                break;\r\n        }\r\n    }\r\n    getWorkerBeans(): Bean[]{\r\n        const beans: Bean[] = [];\r\n        for(const bKey in this.getBeanKeys()){\r\n            const bean = this.city?.beans.get.find((y) => y.key === +bKey);\r\n            if (bean){\r\n                beans.push(bean);\r\n            }\r\n        }\r\n        return beans;\r\n    }\r\n    getBeanKeys(): number[]{\r\n        const ids: number[] = [];\r\n        const keys = Object.keys(this.job_slots);\r\n        for(const key in keys){\r\n            const slot = +key as BuildingJobSlot;\r\n            const val = this.job_slots[slot];\r\n            if (val != null){\r\n                ids.push(val);\r\n            }\r\n        }\r\n        return ids;\r\n    }\r\n    openSlots(): BuildingJobSlot[]{\r\n        return Object.keys(this.job_slots).filter((s, i) => {\r\n            return this.job_slots[+s as BuildingJobSlot] === null && (i < 3 || this.upgraded);\r\n        }).map((x) => +x);\r\n    }\r\n    usedSlots(): BuildingJobSlot[]{\r\n        return Object.keys(this.job_slots).filter((s) => {\r\n            return this.job_slots[+s as BuildingJobSlot] != null;\r\n        }).map((x) => +x);\r\n    }\r\n    tryFreeBean(beanKey: number): boolean{\r\n        const usedSlots = this.usedSlots();\r\n        for (let i = 0; i < usedSlots.length; i++) {\r\n            const slot = usedSlots[i];\r\n            const beanInSlot = this.job_slots[slot];\r\n            if (beanInSlot === beanKey){\r\n                this.job_slots[slot] = null;\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}","import React from \"react\";\r\n\r\nexport interface modalPs{\r\n    show: boolean;\r\n    onClick: () => void;\r\n    closeButtonText?: string;\r\n    hideCloseButton?: boolean\r\n}\r\nexport class Modal extends React.Component<modalPs> {\r\n    constructor(props: modalPs) {\r\n        super(props);\r\n        this.state = {\r\n            show: false\r\n        }\r\n    }\r\n    getButton(){\r\n        if (this.props.hideCloseButton)\r\n            return null;\r\n        else\r\n            return <button type=\"button\" className=\"done\" onClick={() => this.props.onClick()} >{this.props.closeButtonText || 'Done'}</button>\r\n    }\r\n    render() {\r\n        if (!this.props.show) {\r\n            return null;\r\n        }\r\n        return (\r\n        <div className=\"modal\">\r\n            {this.props.children}\r\n            {this.getButton()}\r\n        </div>\r\n        )\r\n    }\r\n}","import React from \"react\";\r\nimport { Bean } from \"../simulation/Bean\";\r\nimport { Trait } from \"../World\";\r\nimport { keyToName } from \"../App\";\r\n\r\nexport class NeedReadout extends React.Component<{\r\n    beans: Bean[], \r\n    need: (b: Bean) => Trait, \r\n    dire: Trait, \r\n    abundant: Trait,\r\n    className?: string}> {\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.state = {\r\n        }\r\n    }\r\n    header(){\r\n        if (this.props.children){\r\n            return <b>{this.props.children}</b>;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n    render(){\r\n        const dire = this.props.beans.filter(b => this.props.need(b) == this.props.dire).length;\r\n        const dire_style = {\r\n            width: Math.floor((dire / this.props.beans.length)*100)+'%'\r\n        }\r\n        const full = this.props.beans.filter(b => this.props.need(b) == this.props.abundant).length;\r\n        const full_style = {\r\n            width: Math.floor((full / this.props.beans.length)*100)+'%'\r\n        }\r\n        return (                \r\n        <div className={this.props.className}>\r\n            {this.header()}\r\n            {/* <span>{keyToName[this.props.report.winner]}</span> */}\r\n            <div className=\"bar\">\r\n                <div className=\"bar-inner dire\" style={dire_style}>\r\n                    {(dire > 0 ? `${dire} ${keyToName[this.props.dire]}`: '')}\r\n                </div>\r\n                <div className=\"bar-inner abundant\" style={full_style}>\r\n                    {full > 0 ? full : ''}\r\n                </div>\r\n            </div>\r\n        </div>\r\n        )\r\n    }\r\n}","import { ReactComponent } from \"*.svg\";\r\nimport React from \"react\";\r\nimport { keyToName } from \"../App\";\r\nimport { Bean } from \"../simulation/Bean\";\r\nimport { NarrativeBeliefData, PrimaryBeliefData } from \"../simulation/Beliefs\";\r\nimport { Trait, TraitIcon } from \"../World\";\r\n\r\nexport class CardButton extends React.Component<{\r\n    icon: string,\r\n    name: string,\r\n    onClick?: () => void,\r\n    title?: string,\r\n    subtext?: string,\r\n    thin?: boolean,\r\n    singleLine?: boolean,\r\n    disabled?: boolean\r\n}>{\r\n    render(){\r\n        let classes = \"card button\";\r\n        if (this.props.thin) classes += ' thin';\r\n        if (this.props.singleLine) classes += ' single';\r\n        return <button className={classes} title={this.props.title} onClick={() => {\r\n            if (this.props.onClick) this.props.onClick()\r\n        }} type=\"button\" disabled={this.props.disabled}>\r\n            {this.props.icon} {this.props.name}\r\n            {\r\n                (this.props.subtext != null) ? <small>{this.props.subtext}</small> : null\r\n            }\r\n        </button>\r\n    }\r\n}\r\n\r\nexport function TraitToCard(bean: Bean, trait: Trait, onClick?: () => void){\r\n    switch(trait){\r\n        case 'trad':\r\n        case 'prog':\r\n        case 'ego':\r\n        case 'state':\r\n            return <CardButton icon={TraitIcon[trait]} title={PrimaryBeliefData[trait].description} name=\"\" subtext={keyToName[trait]} thin={true} singleLine={true} onClick={onClick}></CardButton>\r\n        case 'fresh':\r\n        case 'sick':\r\n        case 'hungry':\r\n        case 'starving':\r\n        case 'stuffed':\r\n        case 'homeless':\r\n        case 'rested':\r\n        case 'circle':\r\n        case 'square':\r\n        case 'triangle':\r\n        case 'sane':\r\n        case 'disturbed':\r\n        case 'stressed':\r\n            return <CardButton icon={TraitIcon[trait]} title={keyToName[trait]} name=\"\" subtext={keyToName[trait]} thin={true} singleLine={true} onClick={onClick}></CardButton>\r\n        case 'noFaith':\r\n        case 'rocket':\r\n        case 'dragon':\r\n        case 'music':\r\n            return <CardButton icon={TraitIcon[trait]} title={NarrativeBeliefData[trait].description} name=\"\" subtext={keyToName[trait]} thin={true} singleLine={true} onClick={onClick}></CardButton>\r\n        default:\r\n            return null;\r\n    }\r\n} ","import React from \"react\";\r\nimport { Trait } from \"../World\";\r\nimport { keyToName } from \"../App\";\r\nimport { Bean } from \"../simulation/Bean\";\r\nimport { NeedReadout } from \"../widgets/NeedReadout\";\r\nimport { reportIdeals, reportCommunity, reportEthno, City } from \"../simulation/City\";\r\nimport { Party } from \"../simulation/Politics\";\r\nimport { PrimaryBeliefData, SecondaryBeliefData, TraitBelief } from \"../simulation/Beliefs\";\r\nimport { LiveList } from \"../events/Events\";\r\nimport { CardButton } from \"../widgets/CardButton\";\r\nimport { Player } from \"../simulation/Player\";\r\n\r\ninterface OverviewPanelP {\r\n    city?: City,\r\n    beans: LiveList<Bean>,\r\n    utopia: Party,\r\n    alien: Player,\r\n    clearCity: () => void;\r\n}\r\n\r\nexport class OverviewPanel extends React.Component<OverviewPanelP> {\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.state = {\r\n        }\r\n    }\r\n    render() {\r\n        let header = <div>\r\n            Human Emotion Farm\r\n            <div>\r\n                <small>Part of the  Galactic Xenosensation Federation</small>\r\n            </div>\r\n        </div>;\r\n        if (this.props.city) {\r\n            header = <div>\r\n                <div>\r\n                    <b>{this.props.city.name}</b>\r\n                    <button type=\"button\" className=\"pull-r\" onClick={() => this.props.clearCity()} ></button>\r\n                </div>\r\n            </div>;\r\n        }\r\n        const avg_happy = this.props.beans.get.reduce((sum, x) => sum + x.lastHappiness, 0) / (this.props.beans.get.length || 1);\r\n        const avg_cash = this.props.beans.get.reduce((sum, x) => sum + x.cash, 0) / (this.props.beans.get.length || 1);\r\n        return (\r\n            <div>\r\n                {header}\r\n                {/* <div className=\"header\"><b>Demographics</b></div> */}\r\n                <div className=\"header\"><b> Subjects</b></div>\r\n                <div>\r\n                    <b>Population</b>&nbsp;\r\n                    <span>{this.props.beans.get.length}</span>\r\n                </div>\r\n                {/* <AxisReadout report={reportEthno(this.props.beans.get)}>Ethnicity</AxisReadout> */}\r\n                <NeedReadout beans={this.props.beans.get} need={(b) => b.food} dire=\"starving\" abundant=\"stuffed\">Food Security</NeedReadout>\r\n                <NeedReadout beans={this.props.beans.get} need={(b) => b.stamina} dire=\"homeless\" abundant=\"rested\">Housing</NeedReadout>\r\n                <NeedReadout beans={this.props.beans.get} need={(b) => b.health} dire=\"sick\" abundant=\"fresh\">Healthcare</NeedReadout>\r\n                <b>Avg. Money</b> ${avg_cash.toFixed(2)} &nbsp;\r\n                <b>Avg. Happiness</b> {Math.round(avg_happy)}%\r\n                {\r\n                    this.props.city ? <>\r\n                        <div className=\"header\"><b> Traits</b></div>\r\n                        <div className=\"max-w-300\">\r\n                            { \r\n                                this.props.city.getPopulationTraitsList(this.props.alien.scanned_bean).map((v) => \r\n                                    <span key={v.noun} className=\"overview-belief\">\r\n                                        {v.icon}&nbsp;{v.noun}&nbsp;x{v.count}\r\n                                    </span>)\r\n                            }\r\n                        </div>\r\n                    </> : null\r\n                }\r\n                {\r\n                    this.props.city?.beans.get?.length || 0 > 7 ? <div className=\"card-parent\">\r\n                        <CardButton icon=\"\" name=\"Scan All\" disabled={true} subtext=\"-Energy +Info\" onClick={() => {}}></CardButton>\r\n                    </div> : null\r\n                }\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport class AxisReadout extends React.Component<{ report: { avg: number, winner: Trait } }> {\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.state = {\r\n        }\r\n    }\r\n    render() {\r\n        let maj = 'Leaning';\r\n        if (this.props.report.avg >= .51)\r\n            maj = 'Major'\r\n        if (this.props.report.avg >= .8)\r\n            maj = 'Extreme'\r\n        const percent = Math.floor(this.props.report.avg * 100);\r\n        const style = {\r\n            width: percent + '%'\r\n        }\r\n        return (\r\n            <div>\r\n                <b>\r\n                    {this.props.children}\r\n                </b>&nbsp;&nbsp;\r\n                <span>{maj} {keyToName[this.props.report.winner]}</span>\r\n                <div className=\"bar\">\r\n                    <div className=\"bar-inner\" style={style}>\r\n                        {percent}%\r\n                </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}","import React from \"react\";\r\nimport { City, UFO } from \"../simulation/City\";\r\nimport { hex_to_pixel, origin_point, transformPoint } from \"../simulation/Geography\";\r\n\r\n\r\nexport class AnimatedUFO extends React.Component<{\r\n    ufo: UFO,\r\n    city: City\r\n}, {\r\n    showBeam: boolean\r\n}>{\r\n    constructor(props: any){\r\n        super(props);\r\n        this.state = {\r\n            showBeam: false\r\n        };\r\n        setTimeout(() => {\r\n            this.setState({showBeam: true});\r\n            setTimeout(() => {\r\n                this.setState({showBeam: false})\r\n            }, 1800);\r\n        }, 1800);\r\n    }\r\n    render(){\r\n        let style = {\r\n          ...transformPoint(hex_to_pixel(this.props.city.hex_size, this.props.city.petriOrigin, this.props.ufo.point))\r\n        };\r\n        return <span style={style} className=\"ufo\">\r\n            \r\n            {this.state.showBeam ? <span className=\"beam\"></span> : null}\r\n            \r\n        </span>\r\n    }\r\n}","import React, { RefObject } from \"react\";\r\n\r\nexport class Particles extends React.Component<{\r\n    particleCount: number,\r\n    className?: string,\r\n    delay: number\r\n}, {\r\n    active: boolean,\r\n    parts: RefObject<HTMLDivElement>[]\r\n}> {\r\n    private animations: Array<Animation|null> = [];\r\n    private finishedAnimationCount: number = 0;\r\n    constructor(props: any){\r\n        super(props);\r\n        let parts: RefObject<HTMLDivElement>[] = []\r\n        for (let i = 0; i < this.props.particleCount; i++) {\r\n            parts.push(React.createRef());\r\n        }\r\n        this.state = {\r\n            active: true,\r\n            parts: parts\r\n        }\r\n    }\r\n    componentDidMount(){\r\n        this.animations = this.state.parts.map((p) => {\r\n            if (p.current){\r\n                const x = Math.floor(Math.random() * 400) - 200;\r\n                const y = Math.floor(Math.random() * 400) - 400;\r\n                return p.current.animate([\r\n                    {\r\n                      transform: `translate(0px, 0px)`,\r\n                      opacity: 1\r\n                    },\r\n                    {\r\n                      transform: `translate(${x}px, ${y}px)`,\r\n                      opacity: 0\r\n                    }    \r\n                ], {\r\n                    duration: 1500 + Math.random() * 1000,\r\n                    easing: 'ease-in-out',\r\n                    delay: this.props.delay + (Math.random() * 100)\r\n                });\r\n            }\r\n            return null;\r\n        });\r\n        this.animations.forEach((x) => {\r\n            if (x)\r\n            x.onfinish = () => {\r\n                this.finishedAnimationCount++;\r\n                if (this.finishedAnimationCount >= this.props.particleCount){\r\n\r\n                    this.setState({active: false, parts: []});\r\n                }\r\n            }\r\n        })\r\n    }\r\n    render(){\r\n        return <div className={(this.props.className || '') + \" particle-parent\"}>\r\n            {\r\n                this.state.active ? this.state.parts.map((x, i) => {\r\n                    return <div key={i} className=\"particle\" ref={x}></div>;\r\n                }) : null\r\n            }\r\n        </div>\r\n    }\r\n}\r\n\r\nexport class DelayedParticles extends React.Component<{\r\n    particleCount: number,\r\n    className?: string,\r\n    delay: number\r\n}, {\r\n    active: boolean\r\n}> {\r\n    constructor(props: any){\r\n        super(props);\r\n        this.state = {\r\n            active: false\r\n        };\r\n    }\r\n    componentDidMount(){\r\n        window.setTimeout(() => {\r\n            this.setState({active: true});\r\n        }, this.props.delay);\r\n    }\r\n    render(){\r\n        if (this.state.active){\r\n            return <Particles delay={0} className={this.props.className} particleCount={this.props.particleCount}></Particles>\r\n        } else {\r\n            return this.props.children;\r\n        }\r\n    }\r\n}","import React from \"react\";\r\nimport { EventTrigger, IEvent } from \"../events/Events\";\r\nimport { BeanDeathCause } from \"../Game\";\r\nimport { Bean } from \"../simulation/Bean\";\r\nimport { transformPoint } from \"../simulation/Geography\";\r\nimport { Particles } from \"../widgets/particles\";\r\nimport './spotlight.css';\r\n\r\ninterface SpotlightState{\r\n  name: string;\r\n  beanClasses: string;\r\n  faceOV?: string,\r\n  particles: {className:string,delay:number}[]\r\n}\r\ninterface SpotlightAnimationState extends SpotlightState{\r\n  start: number;\r\n}\r\nconst spotlightAnimations: {[key:string]:SpotlightAnimationState[]} = {\r\n  'death-exposure': [\r\n    {\r\n      start: 0,\r\n      name: 'death-exposure', faceOV: '',\r\n      beanClasses: 'drop-tool turn-blue',      \r\n      particles: []\r\n    },\r\n    {\r\n      start: 2000,\r\n      name: 'death-exposure',faceOV: '',\r\n      beanClasses: 'drop-tool turn-blue',      \r\n      particles: [] \r\n    }\r\n  ],\r\n  'death-vaporization': [\r\n    {\r\n      start: 0,\r\n      name: 'death-vaporization',\r\n      beanClasses: '',\r\n      \r\n      particles: []\r\n    },\r\n    {\r\n      start: 1000,\r\n      name: 'death-vaporization',\r\n      beanClasses: 'drop-tool',\r\n      particles: []\r\n    },\r\n    {\r\n      start: 2000,\r\n      name: 'death-vaporization', \r\n      beanClasses: 'drop-tool', faceOV: ' ',\r\n      particles: [\r\n        {className: 'head', delay: 0}\r\n      ]\r\n    },\r\n    {\r\n      start: 3000,\r\n      name: 'death-vaporization', \r\n      beanClasses: 'drop-tool hide-body', faceOV: ' ',\r\n      particles: [\r\n        {className: 'head', delay: 0},\r\n        {className: 'body', delay: 0}\r\n      ]\r\n    }\r\n  ],\r\n  'death-sickness': [\r\n    {\r\n      start: 0,\r\n      name: 'death-sickness', faceOV: '',\r\n      beanClasses: '',      \r\n      particles: []\r\n    },\r\n    {\r\n      start: 1000,\r\n      name: 'death-sickness', \r\n      beanClasses: 'drop-tool', faceOV: '',\r\n      particles: [\r\n        {className: 'head', delay: 0}\r\n      ]\r\n    },\r\n    {\r\n      start: 1400,\r\n      name: 'death-sickness', \r\n      beanClasses: 'drop-tool', faceOV: '',\r\n      particles: [\r\n        {className: 'head', delay: 0},\r\n        {className: 'head', delay: 0}\r\n      ]\r\n    },\r\n    {\r\n      start: 2000,\r\n      name: 'death-sickness', \r\n      beanClasses: 'drop-tool', faceOV: '',\r\n      particles: [\r\n        {className: 'head', delay: 0}\r\n      ]\r\n    },\r\n  ],\r\n  'death-starvation': [\r\n    {\r\n      start: 0,\r\n      name: 'death-starvation', faceOV: '',\r\n      beanClasses: '',      \r\n      particles: []\r\n    },\r\n    {\r\n      start: 500,\r\n      name: 'death-starvation', faceOV: '',\r\n      beanClasses: 'body-shrink',      \r\n      particles: []\r\n    },\r\n    {\r\n      start: 1000,\r\n      name: 'death-starvation', faceOV: '',\r\n      beanClasses: 'body-shrink drop-tool',      \r\n      particles: []\r\n    },\r\n    {\r\n      start: 3000,\r\n      name: 'death-starvation', faceOV: '',\r\n      beanClasses: 'body-shrink drop-tool',      \r\n      particles: []\r\n    }\r\n  ]\r\n}\r\nexport class AnimatedSpotlight extends React.Component<{\r\n    event: IEvent,\r\n    bean: Bean,\r\n}, SpotlightState>{\r\n    constructor(props: any){\r\n        super(props);\r\n        const name = `${this.props.event.trigger}-${this.getSubtype(this.props.event.message)}`;\r\n        this.state = spotlightAnimations[name][0];\r\n    }\r\n    private lastTickMS: DOMHighResTimeStamp = 0;\r\n    private currentTime: number = 0;\r\n    private tickHandle: number = 0;\r\n    componentDidMount(){\r\n      window.requestAnimationFrame((time: DOMHighResTimeStamp) => {\r\n        this.lastTickMS = time; //initialize tick time\r\n        this.tickHandle = window.requestAnimationFrame(this.tick);\r\n      });\r\n    }\r\n    componentWillUnmount(){\r\n      window.cancelAnimationFrame(this.tickHandle);\r\n    }\r\n    tick = (timeMS: DOMHighResTimeStamp) => {\r\n      // Compute the delta-time against the previous time\r\n      const deltaTimeMS = (timeMS - this.lastTickMS);\r\n    \r\n      // Update the previous time\r\n      this.lastTickMS = timeMS;\r\n      if (deltaTimeMS > 0){\r\n        this.currentTime += deltaTimeMS;\r\n        const name = `${this.props.event.trigger}-${this.getSubtype(this.props.event.message)}`;\r\n        this.setState(spotlightAnimations[name].reduce((lastValid: SpotlightAnimationState, anim: SpotlightAnimationState) => {\r\n          if (this.currentTime >= anim.start)\r\n            return anim;\r\n          else\r\n            return lastValid;\r\n        }, spotlightAnimations[name][0]));\r\n\r\n      }\r\n      this.tickHandle = window.requestAnimationFrame(this.tick);\r\n    }\r\n    getSubtype(msg: string): BeanDeathCause|undefined{\r\n        return msg.includes('vaporiz') ? 'vaporization' : msg.includes('exposure') ? 'exposure' : msg.includes('sickness') ? 'sickness' : 'starvation';\r\n    }\r\n    render(){\r\n        let t: React.CSSProperties|undefined;\r\n        if (this.props.event.point)\r\n          t = transformPoint(this.props.event?.point);\r\n\r\n        const classes = [this.props.bean.job, this.props.bean.ethnicity, this.state.name, this.state.beanClasses].join(' ');\r\n        return <div className=\"spotlight\" style={t}>\r\n        <div className=\"bean-parent\">\r\n          <span className={classes+\" bean\"}>\r\n            <span className=\"bean-face\">\r\n            {this.state.faceOV || this.props.bean.getFace()}\r\n            </span>\r\n          </span>\r\n          {\r\n              this.state.particles.map((x, i) => <Particles key={i}\r\n                className={this.state.name+' '+x.className} delay={x.delay} particleCount={30}\r\n              ></Particles>)\r\n          }\r\n        </div>\r\n        <div className=\"label\">\r\n          {this.props.event.message.replace('A subject', this.props.bean.name)}\r\n        </div>\r\n        {\r\n          (\r\n            this.props.event.trigger === 'death' ? \r\n            <div className=\"card-parent\">\r\n              <button className=\"card button\" disabled>\r\n                Prevent Death<br/>-4 \r\n              </button>\r\n            </div> : null\r\n          )\r\n        }\r\n      </div>\r\n    }\r\n}","import { Bean } from \"../simulation/Bean\";\r\nimport React from \"react\";\r\nimport { origin_point, Point, transformPoint } from \"../simulation/Geography\";\r\nimport { GoodIcon } from \"../World\";\r\n\r\ninterface AnimatedBeanP {\r\n  bean: Bean;\r\n  selected?: boolean;\r\n  sitStill?: boolean;\r\n  onClick: () => void;\r\n  static?: boolean;\r\n}\r\n\r\ninterface AnimatedBeanS{\r\n  paused: boolean,\r\n  spin: boolean;\r\n  face: string;\r\n  good?: string;\r\n  speech?: string;\r\n}\r\n\r\nfunction BeanIsBuying(bean: Bean){\r\n  return bean.state.data.act == 'buy' && bean.state.data.good != 'shelter';\r\n}\r\n\r\nexport class AnimatedBean extends React.Component<AnimatedBeanP, AnimatedBeanS> {\r\n    constructor(props: AnimatedBeanP) {\r\n      super(props);\r\n      this.delaySeedSec = (Math.random() * 60) + this.props.bean.key;\r\n      this.state = {\r\n        paused: false,\r\n        spin: false,\r\n        face: props.bean.getFace(),\r\n      };\r\n      props.bean.onAct.subscribe(this.animate);\r\n    }\r\n    animate = (deltaMS: number) => {\r\n      this.setState({\r\n        spin: this.props.bean.state.data.act == 'work',\r\n        face: this.props.bean.getFace(),\r\n        good: BeanIsBuying(this.props.bean) ? GoodIcon[this.props.bean.state.data.good || 'food'] : undefined,\r\n        speech: this.props.bean.getSpeech()\r\n      })\r\n    }\r\n    delaySeedSec: number;\r\n    getPurchase(){\r\n      if (this.state.good){\r\n        return <span className=\"purchase\">\r\n          <span className=\"money\"></span>\r\n          <span className=\"purchase-good\">{this.state.good}</span>\r\n        </span>\r\n      }\r\n    }\r\n    getSpeech(){\r\n      if (this.state.speech){\r\n        return <span className=\"speech\">\r\n          <span className=\"\">{this.state.speech}</span>\r\n        </span>\r\n      }\r\n    }\r\n    render() {\r\n      let classes = this.props.bean.job + ' ' + this.props.bean.ethnicity;\r\n      classes += this.state.paused || !this.props.bean.alive ? ' paused' : '';\r\n      if (this.props.sitStill){\r\n\r\n      } else {\r\n        classes += ' bean-walker';\r\n        if (this.state.spin)\r\n          classes += ' spin';\r\n        if (this.props.selected)\r\n          classes += ' selected';\r\n        if (this.props.bean.state.data.act != 'travel')\r\n          classes += ' paused';\r\n      }\r\n\r\n      let style = {\r\n        animationDelay: '-'+this.delaySeedSec+'s'\r\n      };\r\n      style.animationDelay = '';\r\n      let title = '';\r\n      return (\r\n        <span className={classes+\" bean interactable\"}\r\n          style={style} title={title}\r\n          onClick={(e) => {e.stopPropagation(); this.props.onClick(); }}\r\n        >\r\n          {this.state.face} {this.getPurchase()} {this.getSpeech()}\r\n        </span>\r\n      )\r\n    }\r\n  }","import React, { useEffect, useRef, useState } from \"react\";\r\nimport { SfxContext } from \"../App\";\r\nimport { UFO, City, Pickup } from \"../simulation/City\";\r\nimport { transformPoint, hex_to_pixel } from \"../simulation/Geography\";\r\nimport { EmoteIcon } from \"../World\";\r\n\r\nexport const AnimatedPickup: React.FC<{\r\n    pickup: Pickup,\r\n    //city: City\r\n}> = (props) => {\r\n    const [played, setPlayed] = useState(false);\r\n    const sfx = React.useContext(SfxContext);\r\n    useEffect(() => {\r\n        if (!played && sfx){\r\n            sfx.play('drop');\r\n            setPlayed(true);\r\n        }\r\n    })\r\n    return <span className=\"pickup bob\">\r\n        {EmoteIcon[props.pickup.type]}\r\n    </span>\r\n}","import React, { useEffect, useRef, useState } from \"react\";\r\nimport { LiveList, PubSub } from \"../events/Events\";\r\nimport { Bean } from \"../simulation/Bean\";\r\nimport { Pickup } from \"../simulation/City\";\r\nimport { Point } from \"../simulation/Geography\";\r\nimport { AnimatedBean } from \"./AnimatedBean\";\r\nimport { AnimatedPickup } from \"./AnimatedPickup\";\r\n\r\nexport const Mover: React.FC<{\r\n    onMove: PubSub<Point>,\r\n    startPoint: Point\r\n}> = (props) => {\r\n    const el = useRef<HTMLDivElement|null>(null);\r\n    const onMove = (p: Point) => {\r\n        if (el.current && p)\r\n            el.current.style.transform = `translate(${p.x}px, ${p.y}px)`;\r\n    }\r\n    useEffect(() => {\r\n        props.onMove.subscribe(onMove);\r\n        onMove(props.startPoint);\r\n        return () => props.onMove.unsubscribe(onMove)\r\n    }, []);\r\n    return <div ref={el}>\r\n        {props.children}\r\n    </div>\r\n}\r\n\r\nexport const PickupList: React.FC<{\r\n    pickups: LiveList<Pickup>\r\n}> = (props) => {\r\n    const [list, setList] = useState(props.pickups.get);\r\n    const onChange = (l: Pickup[]) => {\r\n        setList(l);\r\n    }\r\n    useEffect(() => {\r\n        props.pickups.onChange.subscribe(onChange)\r\n        return () => props.pickups.onChange.unsubscribe(onChange)\r\n    }, []);\r\n    return <>\r\n        {\r\n            list.map((p: Pickup) => {\r\n                return <Mover onMove={p.onMove} key={p.key} startPoint={p.point}>\r\n                    <AnimatedPickup pickup={p}></AnimatedPickup>\r\n                </Mover>\r\n            })\r\n        }\r\n    </>;\r\n}\r\n\r\nexport const BeanList: React.FC<{\r\n    beans: LiveList<Bean>,\r\n    activeBeanID: number|null;\r\n    onBeanClick: (b: Bean) => void;\r\n}> = (props) => {\r\n    const [list, setList] = useState(props.beans.get);\r\n    const onChange = (l: Bean[]) => {\r\n        setList(l);\r\n    }\r\n    useEffect(() => {\r\n        props.beans.onChange.subscribe(onChange)\r\n        return () => props.beans.onChange.unsubscribe(onChange)\r\n    }, []);\r\n    return <>\r\n        {\r\n            list.map((bean: Bean) => {\r\n                return <Mover onMove={bean.onMove} key={bean.key} startPoint={bean.point}>\r\n                    <AnimatedBean bean={bean} selected={bean.key === props.activeBeanID} onClick={() => props.onBeanClick(bean)}></AnimatedBean>\r\n                </Mover>\r\n            })\r\n        }\r\n    </>;\r\n}","import React, { useEffect, useState } from \"react\";\r\nimport { LiveMap } from \"../events/Events\";\r\nimport { City } from \"../simulation/City\";\r\nimport { CityBook, HexPoint, hex_to_pixel, IBuilding, transformPoint } from \"../simulation/Geography\";\r\nimport { PetriBuilding, UIBuilding } from \"./Building\";\r\nimport { hex_style } from \"./WorldTile\";\r\n\r\n\r\nexport const PetriBuildings: React.FC<{\r\n    city: City\r\n}> = (props) => {\r\n    const [buildings, setBuildings] = useState<IBuilding[]>(props.city.book.getBuildings());\r\n    const getBuildings = () => {\r\n        setBuildings(props.city.book.getBuildings())\r\n    }\r\n    useEffect(() => {\r\n        props.city.book.db.onChange.subscribe(getBuildings);\r\n        return () => props.city.book.db.onChange.unsubscribe(getBuildings);\r\n    });\r\n    return <>\r\n        {\r\n            buildings.map((x) => <PetriBuilding city={props.city} key={x.key} building={x}></PetriBuilding>)\r\n        }\r\n    </>\r\n}\r\nexport const HexPetriBuilding: React.FC<{\r\n    city: City,\r\n    hex: HexPoint\r\n}> = (props) => {\r\n    const [building, setBuilding] = useState<IBuilding|undefined>(props.city.book.findBuildingByCoordinate(props.hex));\r\n    const getBuildings= () => {\r\n        setBuilding(props.city.book.findBuildingByCoordinate(props.hex))\r\n    }\r\n    useEffect(() => {\r\n        props.city.book.db.onChange.subscribe(getBuildings);\r\n        return () => props.city.book.db.onChange.unsubscribe(getBuildings);\r\n    });\r\n    if (building)\r\n        return <PetriBuilding city={props.city} key={building.key} building={building}></PetriBuilding>\r\n    else \r\n        return null;\r\n}\r\n\r\nexport const PetriHexes: React.FC<{\r\n    city: City,\r\n    hexes: HexPoint[],\r\n    onHexClick: (hex: HexPoint) => void\r\n}> = (props) => {\r\n    return <>{props.hexes.map((hex, i) => {\r\n      const xy = hex_to_pixel(props.city.hex_size, props.city.petriOrigin, hex);\r\n      return <div className=\"hex\" \r\n        key={i} \r\n        style={{...hex_style, ...transformPoint(xy)}} \r\n        onMouseEnter={(e) => { props.city.pickupMagnetPoint.set(xy); }}\r\n        onClick={(e) => { props.onHexClick(hex); e.stopPropagation(); return false; }}>\r\n          <HexPetriBuilding city={props.city} hex={hex}></HexPetriBuilding>\r\n      </div>\r\n    })}</>\r\n  }\r\nexport const SocialBuildings: React.FC<{\r\n    city: City,\r\n    onClickBuilding: (b: IBuilding) => void;\r\n}> = (props) => {\r\n    const [buildings, setBuildings] = useState<IBuilding[]>(props.city.book.getBuildings());\r\n    const getBuildings = () => {\r\n        setBuildings(props.city.book.getBuildings())\r\n    }\r\n    useEffect(() => {\r\n        props.city.book.db.onChange.subscribe(getBuildings);\r\n        return () => props.city.book.db.onChange.unsubscribe(getBuildings);\r\n    });\r\n    return <>\r\n        {\r\n            buildings.map((x) => <div key={x.key} className=\"building-node\" onClick={() => props.onClickBuilding(x)}>\r\n                <UIBuilding cityName={props.city.name} building={x} style={{}} getStyle={() => {return{}}}></UIBuilding>\r\n            </div> )\r\n        }\r\n    </>\r\n}","import React, { useEffect, useRef, useState } from \"react\";\r\nimport { Live } from \"../events/Events\";\r\nimport { HexPoint, Point } from \"../simulation/Geography\";\r\n\r\n\r\nexport const Magnet: React.FC<{\r\n    pickupMagnetPoint: Live<Point|undefined>\r\n}> = (props) => {\r\n    const el = useRef<HTMLDivElement|null>(null);\r\n    const [point, setPoint] = useState(props.pickupMagnetPoint.get);\r\n    const updatePoint = (p: Point|undefined) => {\r\n        setPoint(p);\r\n        if (el.current && p)\r\n            el.current.style.transform = `translate(${p.x}px, ${p.y}px)`;\r\n    }\r\n    useEffect(() => {\r\n        props.pickupMagnetPoint.onChange.subscribe(updatePoint);\r\n        updatePoint(props.pickupMagnetPoint.get);\r\n        return () => props.pickupMagnetPoint.onChange.unsubscribe(updatePoint)\r\n    });\r\n\r\n    if (point){\r\n        return <div className=\"magnet\" ref={el}></div>\r\n    } else {\r\n        return null;\r\n    }\r\n}","import { Tile } from \"../World\";\r\nimport { Bean } from \"../simulation/Bean\";\r\nimport { AnimatedBean } from \"./AnimatedBean\";\r\nimport React from \"react\";\r\nimport { IBuilding, BuildingIcon, BuildingTypes, hex_to_pixel, MatterTypes, PolarPoint, polarToPoint, transformPoint, HexPoint, Point, HexSizeR } from \"../simulation/Geography\";\r\nimport { PetriBuilding } from \"./Building\";\r\nimport { PI2 } from \"../WorldGen\";\r\nimport { City, Pickup, UFO } from \"../simulation/City\";\r\nimport { AnimatedUFO } from \"./AnimatedUFO\";\r\nimport { IEvent } from \"../events/Events\";\r\nimport { AnimatedSpotlight } from \"./AnimatedSpotlight\";\r\nimport { BeanList, PickupList } from \"./Mover\";\r\nimport { HexPetriBuilding, PetriBuildings, PetriHexes } from \"./Buildings\";\r\nimport { Magnet } from \"./Magnet\";\r\n\r\nexport const hex_style = {\r\n  width: HexSizeR + 'px', \r\n  height: HexSizeR + 'px', \r\n  top: (-HexSizeR/2)+'px',\r\n  left: (-HexSizeR/2)+'px'\r\n}\r\n\r\ninterface WorldTilePs {\r\n  tile: Tile;\r\n  city: City;\r\n  activeBeanID: number | null;\r\n  costOfLiving: number;\r\n  spotlightEvent: IEvent | undefined;\r\n  onClick: () => void;\r\n  onBeanClick: (b: Bean) => void;\r\n  onHexClick: (hex: HexPoint) => void;\r\n}\r\nexport class WorldTile extends React.Component<WorldTilePs> {\r\n  constructor(props: WorldTilePs) {\r\n    super(props);\r\n    this.state = {\r\n    }\r\n    const mtnRadius = props.city.petriRadius - 20;\r\n    for (let i = 0; i < 360 / 5; i++) {\r\n      const az = i * 5 * Math.PI / 180;\r\n      const pt = polarToPoint({ r: mtnRadius, az: az });\r\n      pt.x += props.city.petriRadius; pt.y += props.city.petriRadius;\r\n      this.mtn_transforms.push(transformPoint(pt));\r\n    }\r\n  }\r\n  mtn_transforms: { transform: string }[] = [];\r\n  renderSpotlight(): JSX.Element | null {\r\n    if (this.props.spotlightEvent) {\r\n      const bean = this.props.city.historicalBeans.get.find((x) => x.key === this.props.spotlightEvent?.beanKey);\r\n      if (this.props.spotlightEvent.point && bean) {\r\n        return <AnimatedSpotlight event={this.props.spotlightEvent} bean={bean}></AnimatedSpotlight>\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  renderHexes(){\r\n    return this.props.city.hexes.map((hex, i) => {\r\n      const xy = hex_to_pixel(this.props.city.hex_size, this.props.city.petriOrigin, hex);\r\n      return <div className=\"hex\" key={i} style={{...hex_style, ...transformPoint(xy)}} \r\n        onMouseEnter={(e) => { this.props.city.pickupMagnetPoint.set(xy); }}\r\n        onClick={(e) => { this.props.onHexClick(hex); e.stopPropagation(); return false; }}>\r\n          <HexPetriBuilding city={this.props.city} hex={hex}></HexPetriBuilding>\r\n      </div>\r\n    });\r\n  }\r\n  render() {\r\n    const deaths = this.props.city.historicalBeans.get.filter((x) => !x.alive).map((b: Bean, i) => {\r\n      return (\r\n        <span key={i} className=\"dead\" style={{ left: (i * 10) + 'px' }}></span>\r\n      )\r\n    });\r\n    const ufos = this.props.city.ufos.map((u: UFO, i: number) => {\r\n      return <AnimatedUFO ufo={u} key={u.key} city={this.props.city}></AnimatedUFO>\r\n    });\r\n    const mtns = this.mtn_transforms.map((x, i) => {\r\n      return <span key={i} style={x} className=\"mtn\"></span>\r\n    });\r\n    const style = {\r\n      height: (this.props.city.petriRadius * 2) + 'px',\r\n      width: (this.props.city.petriRadius * 2) + 'px',\r\n    }\r\n    return (\r\n      <div className=\"tile\" onClick={() => this.props.onClick()} onMouseLeave={() => {this.props.city.pickupMagnetPoint.set(undefined);}} style={style}>\r\n        <svg style={{ width: '100%', height: '100%' }} className=\"petri-base\">\r\n          <circle cx=\"50%\" cy=\"50%\" r=\"50%\" stroke=\"grey\" fill=\"rgba(255, 255, 255, 1)\" />\r\n        </svg>\r\n        <PetriHexes city={this.props.city} hexes={this.props.city.hexes} onHexClick={this.props.onHexClick}></PetriHexes>\r\n        {mtns}\r\n        {/* {deaths} */}\r\n        {/* <PetriBuildings city={this.props.city}></PetriBuildings> */}\r\n        <PickupList pickups={this.props.city.pickups}></PickupList>\r\n        <BeanList beans={this.props.city.beans} activeBeanID={this.props.activeBeanID} onBeanClick={(b: Bean) => this.props.onBeanClick(b)}></BeanList>\r\n        {ufos}\r\n        <Magnet pickupMagnetPoint={this.props.city.pickupMagnetPoint}></Magnet>\r\n        <svg style={{ width: '100%', height: '100%' }} className=\"petri-lid\">\r\n          <circle cx=\"50%\" cy=\"50%\" r=\"50%\" stroke=\"grey\" fill=\"rgba(255, 255, 255, 0.2)\" />\r\n        </svg>\r\n        {this.renderSpotlight()}\r\n      </div>\r\n    )\r\n  }\r\n}","import { Bean } from \"../simulation/Bean\";\r\nimport React from \"react\";\r\nimport { World, TraitJob } from \"../World\";\r\nimport { NeedReadout } from \"../widgets/NeedReadout\";\r\nimport { Listing } from \"../simulation/Economy\";\r\n\r\nfunction median(values: Array<number>){\r\n  if(values.length ===0) return 0;\r\n\r\n  values.sort(function(a,b){\r\n    return a-b;\r\n  });\r\n\r\n  var half = Math.floor(values.length / 2);\r\n\r\n  if (values.length % 2)\r\n    return values[half];\r\n\r\n  return (values[half - 1] + values[half]) / 2.0;\r\n}\r\n\r\nexport class EconomyReport extends React.Component<{world: World}, {paused: boolean}> {\r\n    constructor(props: {world: World}) {\r\n      super(props);\r\n      this.state = {\r\n        paused: false\r\n      }\r\n    }\r\n    render() {\r\n      const beans = this.props.world.beans.get;\r\n      const food_median = median(beans.map(x => x.discrete_food));\r\n      const health_median = median(beans.map(x => x.discrete_health)).toFixed(1);\r\n      const shelter_median = median(beans.map(x => x.discrete_stamina)).toFixed(1);\r\n      const wealth_total = beans.reduce((sum, y) => sum + y.cash, 0);\r\n      const wealth_avg = wealth_total / (beans.length || 1);\r\n      const wealth_median = median(beans.map(x => x.cash));\r\n      const wealth_dire = beans.filter(x => x.cash < 1).length;\r\n      const wealth_marker = Math.max(wealth_avg, wealth_median);\r\n      const wealthy = beans.filter(x => x.cash > wealth_marker);\r\n      const wealthy_percentage = (wealthy.length / (beans.length || 1)) * 100;\r\n      const wealthy_ownership = (wealthy.reduce((s, x) => s+x.cash, 0) / wealth_total)*100;\r\n      const jobs = beans.reduce((obj, b) => {\r\n        obj[b.job] = (obj[b.job] || 0)+1;\r\n        return obj;\r\n      }, {} as {[key in TraitJob]: number});\r\n      const unemployed = (((jobs.jobless || 0) / beans.length)*100).toFixed(1);\r\n      function reducer(obj:  {supply: number, price: number, avg: number, count: number}, l: Listing){\r\n        obj.supply += l.quantity;\r\n        obj.price += l.price;\r\n        obj.count++;\r\n        obj.avg = obj.price / obj.count;\r\n        return obj;\r\n      }\r\n      const food = this.props.world.economy.market.listings['food'].reduce(reducer, {supply: 0, price: 0, avg: 0, count: 0});\r\n      const meds = this.props.world.economy.market.listings['medicine'].reduce(reducer, {supply: 0, price: 0, avg: 0, count: 0});\r\n      const houses = this.props.world.economy.market.listings['shelter'].reduce(reducer, {supply: 0, price: 0, avg: 0, count: 0});\r\n      return (\r\n        <div>\r\n          <div className=\"pad-4p\">\r\n            <h2>State of the Utopia</h2>\r\n          </div>\r\n          {/* <div className=\"pad-4p\">\r\n            <h3>Subject's Health</h3>\r\n          </div> */}\r\n          <div className=\"col-2\">\r\n            <div>\r\n              <strong> Food Security</strong>\r\n              <NeedReadout beans={this.props.world.beans.get} need={(b) => b.food} dire=\"hungry\" abundant=\"stuffed\" className=\"big\"></NeedReadout>\r\n              <table className=\"width-100p\">\r\n                <tbody>\r\n                  <tr>\r\n                    <td>Median {food_median.toFixed(1)} </td>\r\n                    <td className=\"text-center\">\r\n                      Supply: {food.supply}  @ ${food.avg.toFixed(2)}\r\n                    </td>\r\n                    <td className=\"text-right\">\r\n                      Deficit: {this.props.world.economy.unfulfilledMonthlyDemand.food} \r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n            <div>\r\n              <strong> Healthcare</strong>\r\n              <NeedReadout beans={this.props.world.beans.get} need={(b) => b.health} dire=\"sick\" abundant=\"fresh\" className=\"big\"></NeedReadout>\r\n              <table className=\"width-100p\">\r\n                <tbody>\r\n                  <tr>\r\n                    <td>Median {health_median} </td>\r\n                    <td className=\"text-center\">\r\n                      Supply: {meds.supply}  @ ${meds.avg.toFixed(2)}\r\n                    </td>\r\n                    <td className=\"text-right\">\r\n                      Deficit: {this.props.world.economy.unfulfilledMonthlyDemand.medicine} \r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n          <div className=\"col-2\">\r\n            <div>\r\n              <strong> Housing</strong> <br/>\r\n              <NeedReadout beans={this.props.world.beans.get} need={(b) => b.stamina} dire=\"homeless\" abundant=\"rested\" className=\"big\"></NeedReadout>\r\n              <table className=\"width-100p\">\r\n                <tbody>\r\n                  <tr>\r\n                    <td>Median {shelter_median} </td>\r\n                    <td className=\"text-center\">\r\n                      Supply: {houses.supply}  @ ${houses.avg.toFixed(2)}\r\n                    </td>\r\n                    <td className=\"text-right\">\r\n                      Deficit: {this.props.world.economy.unfulfilledMonthlyDemand.shelter} \r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n          {/* <div className=\"pad-4p\">\r\n            <h3>Economic Health</h3>\r\n          </div> */}\r\n          <div className=\"col-2\">\r\n            <div>\r\n              <strong> Wealth</strong> <br/>\r\n              {wealth_dire} penniless citizens &nbsp; &nbsp; Cost of Living: ${this.props.world.economy.getCostOfLiving().toFixed(2)} <br/>\r\n              <table className=\"width-100p\">\r\n                <tbody>\r\n                  <tr>\r\n                    <td>Total ${wealth_total.toFixed(2)}</td>\r\n                    <td className=\"text-center\">\r\n                      Median: ${wealth_median.toFixed(2)} \r\n                    </td>\r\n                    <td className=\"text-right\">\r\n                      Avg: ${wealth_avg.toFixed(2)}\r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </table>\r\n              Top {wealthy_percentage.toFixed(1)}% of subjects own {wealthy_ownership.toFixed(1)}% of the wealth\r\n            </div>\r\n            <span>\r\n              <strong>Unemployment</strong> {unemployed}% ({jobs.jobless})<br/>\r\n              <ul className=\"boxes\">\r\n                <li>{jobs.farmer || 0} farmers</li>\r\n                <li>{jobs.builder || 0} builders</li>\r\n                <li>{jobs.doc || 0} doctors</li>\r\n                <li>{jobs.entertainer || 0} entertainers</li>\r\n              </ul>\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n  }","import React from \"react\";\r\nimport { IEvent } from \"../events/Events\";\r\n\r\nexport interface EventsPanelPS\r\n{\r\n    events: IEvent[],\r\n    selectBean: (beanKey?: number) => void\r\n}\r\nfunction shouldEventJumpToBean(e: IEvent): boolean{\r\n    return e.beanKey != null && (\r\n        e.trigger === 'speechcrime' ||\r\n        e.trigger === 'birth');\r\n}\r\n\r\nexport class EventsPanel extends React.Component<EventsPanelPS> {\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.state = {\r\n        }\r\n    }\r\n    render(){\r\n        let events = this.props.events.map((e, i) => {\r\n            const alert = e.icon === '';\r\n            const tallTrigger = e.trigger === 'nojobslots' || e.trigger === 'persuasion';\r\n            return <div key={i} className={alert||tallTrigger ? 'tall': ''}>\r\n                <span className={alert ? 'police-siren': ''}>{e.icon}</span>&nbsp;\r\n                {\r\n                    shouldEventJumpToBean(e) ? <a onClick={() => this.props.selectBean(e.beanKey)} href=\"javascript:void(0)\">{e.message}</a> : <span>{e.message}</span>\r\n                }\r\n            </div>\r\n        });\r\n        if (this.props.events.length === 0){\r\n            events = [<div key={0}>\r\n                <small>No events yet</small>\r\n            </div>]\r\n        }\r\n        return (                \r\n        <div className=\"events-panel\">\r\n            <div>\r\n                <b>Events</b>\r\n            </div>\r\n            {events}\r\n        </div>\r\n        )\r\n    }\r\n}","import React from \"react\";\r\nimport { PlayerResources, triadToString } from \"../Game\";\r\n\r\nexport class CostSmall extends React.Component<{\r\n    cost: PlayerResources,\r\n    rider?: string,\r\n    qty?: number\r\n}>{\r\n\r\n    render(){\r\n        return <small>\r\n            {triadToString(this.props.cost, '-', this.props.qty)} {this.props.rider}\r\n        </small>\r\n    }\r\n}","import React from \"react\";\r\nimport { EmoteIcon, IHappinessModifier, TraitIcon } from \"../World\";\r\nimport { keyToName } from \"../App\";\r\nimport { Bean } from \"../simulation/Bean\";\r\nimport { NeedReadout } from \"../widgets/NeedReadout\";\r\nimport { reportIdeals, reportCommunity, reportEthno, City } from \"../simulation/City\";\r\nimport { Economy } from \"../simulation/Economy\";\r\nimport { Party } from \"../simulation/Politics\";\r\nimport { IEvent, EventBus } from \"../events/Events\";\r\nimport { withinLastYear } from \"../simulation/Time\";\r\nimport { Government } from \"../simulation/Government\";\r\nimport { Player } from \"../simulation/Player\";\r\nimport { CardButton, TraitToCard } from \"../widgets/CardButton\";\r\n\r\nimport './BeanPanel.css';\r\nimport { Act, ActivityIcon, GetPriorities } from \"../simulation/Agent\";\r\nimport { IsBeliefDivergent, SecondaryBeliefData, TraitBelief } from \"../simulation/Beliefs\";\r\nimport { CostSmall } from \"../widgets/CostSmall\";\r\n\r\ninterface BeanPanelP{\r\n    city: City,\r\n    bean: Bean,\r\n    economy: Economy,\r\n    law: Government,\r\n    party: Party,\r\n    alien: Player,\r\n    clearCity: () => void;\r\n    bus: EventBus\r\n    scan: (bean: Bean) => boolean;\r\n    vaporize: (bean: Bean) => void;\r\n    abduct: (bean: Bean) => void;\r\n    brainwash: () => void;\r\n    gift: () => void;\r\n}\r\n\r\ninterface BeanPanelS{\r\n    faceOverride?: string;\r\n    innerView: 'priorities'|'feelings'|'beliefs';\r\n}\r\n\r\nexport class BeanPanel extends React.Component<BeanPanelP, BeanPanelS> {\r\n    constructor(props: BeanPanelP) {\r\n        super(props);\r\n        this.state = {\r\n            innerView: 'beliefs'\r\n        }\r\n    }\r\n    scan = () => {\r\n        if (this.props.scan(this.props.bean)){\r\n            this.setState({faceOverride: ''});\r\n            this._resetFace();\r\n        }\r\n    }\r\n    vaporize = () => {\r\n        this.props.vaporize(this.props.bean);\r\n        this.setState({faceOverride: ''});\r\n        this._resetFace();\r\n    }\r\n    support = () => {\r\n        this.setState({faceOverride: ''});\r\n        this._resetFace();\r\n    }\r\n    abduct = () => {\r\n        this.props.abduct(this.props.bean);\r\n        this.setState({faceOverride: ''});\r\n        this._resetFace();\r\n    }\r\n    _resetFace(){\r\n        setTimeout(() => {\r\n            this.setState({faceOverride: undefined})\r\n        }, 5000);\r\n    }\r\n    happyTable(mods: IHappinessModifier[]){\r\n        return mods.filter((y) => y.mod != 0).map((x, i) => {\r\n            return <tr key={i}>\r\n                <td className=\"small text-right\">{x.reason}</td>\r\n                <td className=\"small\">{Math.round(x.mod * 100)}%</td>\r\n            </tr>\r\n        });\r\n    }\r\n    hedonTable(){\r\n        return Object.keys(this.props.bean.happiness.all).map((x, i) => {\r\n            return <tr key={i}>\r\n                <td className=\"small text-right\">{this.props.bean.happiness.all[x]} {this.props.bean.happiness.all[x] >= 0 ? EmoteIcon['happiness'] : EmoteIcon['unhappiness']} from </td>\r\n                <td className=\"small\">{x}</td>\r\n            </tr>\r\n        });\r\n    }\r\n    renderInner(){\r\n        if (!this.scanned){\r\n            return <div className=\"width-100p text-center\">\r\n                <small>\r\n                    Subject needs a Scan to reveal their thoughts\r\n                </small>\r\n            </div>\r\n        }\r\n        switch(this.state.innerView){\r\n            case 'beliefs':\r\n                return this.scanned ? this.beliefTable(this.props.bean.beliefs) : null\r\n            case 'feelings':\r\n                return <table className=\"width-100p\"><tbody>\r\n                    {this.scanned ? this.hedonTable() : null}\r\n                    </tbody>\r\n                </table>\r\n            case 'priorities':\r\n                return <table className=\"width-100p\">\r\n                    <tbody>\r\n                        <tr>\r\n                            <td>\r\n                                Currently {this.props.bean.state.display}\r\n                            </td>\r\n                        </tr>\r\n                        {\r\n                            GetPriorities(this.props.bean, this.props.alien.difficulty).values.map((x) => {\r\n                                return <tr key={`p-${x.value.act}-${x.value.good}`}>\r\n                                    <td>\r\n                                    {x.priority.toFixed(1)} {ActivityIcon(x.value)}\r\n                                    </td>\r\n                                </tr>\r\n                            })\r\n                        }\r\n                        {\r\n                            this.actDurations().filter((x) => this.props.bean.activity_duration[x] > 0).map((x) => {\r\n                                const act = x as Act;\r\n                                return <tr key={act}>\r\n                                    <td>{x}</td>\r\n                                    <td>\r\n                                        {\r\n                                            (this.props.bean.activity_duration[act] / 1000).toFixed(1)\r\n                                        }s\r\n                                    </td>\r\n                                </tr>\r\n                                \r\n                            })\r\n                        }\r\n                    </tbody>\r\n                </table>\r\n        }\r\n    }\r\n    actDurations(){\r\n        const acts = Object.keys(this.props.bean.activity_duration).map((x) => x as Act);\r\n        acts.sort((a, b) => this.props.bean.activity_duration[b] - this.props.bean.activity_duration[a]);\r\n        return acts;\r\n    }\r\n    beliefTable(beliefs: TraitBelief[]): React.ReactNode {\r\n        return beliefs.map((b, i) => {\r\n            const classes = 'belief-name shadow text-left '+SecondaryBeliefData[b].rarity;\r\n            return <table className=\"width-100p\" key={b+i}><tbody><tr>\r\n            <th className={classes}>\r\n                {SecondaryBeliefData[b].icon} {SecondaryBeliefData[b].adj}\r\n            </th>\r\n            <td className=\"text-right\">\r\n                {(SecondaryBeliefData[b].idealPro || []).map(y => <span key={y}>+{TraitIcon[y]}</span>)}\r\n                {(SecondaryBeliefData[b].idealCon || []).map(y => <span key={y}>-{TraitIcon[y]}</span>)}\r\n            </td>\r\n        </tr><tr><td className=\"small text-center\" colSpan={2}>{\r\n            SecondaryBeliefData[b].description ? SecondaryBeliefData[b].description?.split(';').map((x, i) => <div key={i}>{x}</div>) : null\r\n        }</td></tr></tbody></table>});\r\n    }\r\n    get scanned(){\r\n        return this.props.alien.scanned_bean[this.props.bean.key];\r\n    }\r\n    renderTraits(){\r\n        if (this.scanned){\r\n            const brainwash = this.props.brainwash.bind(this);\r\n            return <div>\r\n                <div className=\"card-parent\">\r\n                    {TraitToCard(this.props.bean, this.props.bean.ethnicity, undefined)}\r\n                    {TraitToCard(this.props.bean, this.props.bean.faith, brainwash)}\r\n                </div>\r\n                <div className=\"card-parent\">\r\n                    {\r\n                        this.props.bean.beliefs.map((b) => <CardButton key={b} icon={SecondaryBeliefData[b].icon} title={SecondaryBeliefData[b].adj} name='' thin={true} singleLine={true} onClick={() => {}}></CardButton>)\r\n                    }\r\n                </div>\r\n                <div className=\"card-parent\">\r\n                    {TraitToCard(this.props.bean, this.props.bean.food, undefined)}\r\n                    {TraitToCard(this.props.bean, this.props.bean.stamina, undefined)}\r\n                    {TraitToCard(this.props.bean, this.props.bean.health, undefined)}\r\n                </div>\r\n            </div>\r\n        } else {\r\n            return <div className=\"card-parent\">\r\n                <CardButton icon=\"\" name=\"Scan\" subtext=\"-Energy +Info\" onClick={this.scan} disabled={!this.props.alien.canAfford(this.props.alien.difficulty.cost.bean.scan)}></CardButton>\r\n            </div>\r\n        }\r\n    }\r\n    render(){\r\n        const classes = this.props.bean.job + ' ' + this.props.bean.ethnicity;\r\n        return (                \r\n        <div className=\"vertical bean-panel\">\r\n            <div className=\"bean-panel-header\">\r\n                <div>\r\n                    <b>{this.props.bean.name}&nbsp;\r\n                    <small>\r\n                        of {this.props.city.name}\r\n                    </small>\r\n                    </b>\r\n                    <button type=\"button\" className=\"pull-r\" onClick={() => this.props.clearCity()} ></button>\r\n                </div>\r\n                <div className=\"bean-view\">                \r\n                    <span className={classes+\" bean\"}>\r\n                        {\r\n                            this.state.faceOverride === undefined ? this.props.bean.getFace() : this.state.faceOverride\r\n                        }\r\n                    </span>\r\n                </div>\r\n                <div className=\"horizontal\">\r\n                    <span className=\"text-center\">\r\n                         ${this.props.bean.cash.toFixed(2)}\r\n                    </span>\r\n                    <span className=\"text-center\">\r\n                         {Math.round(this.props.bean.lastHappiness)}%\r\n                    </span>\r\n                    <span className=\"text-center\">\r\n                        {Math.round(this.props.bean.happiness.flatAverage)} {EmoteIcon['happiness']} /day\r\n                    </span>\r\n                </div>\r\n                {this.renderTraits()}\r\n            </div>\r\n            <div className=\"grow-1 pad-4 bean-panel-content\">\r\n                <div className=\"cylinder blue-orange horizontal\">\r\n                    <button type=\"button\" className={this.state.innerView=='beliefs'?'active':''} onClick={()=>this.setState({innerView:'beliefs'})}>\r\n                         Traits\r\n                    </button>\r\n                    <button type=\"button\" className={this.state.innerView=='feelings'?'active':''} onClick={()=>this.setState({innerView:'feelings'})}>\r\n                         Feelings\r\n                    </button>\r\n                    <button type=\"button\" className={this.state.innerView=='priorities'?'active':''} onClick={()=>this.setState({innerView:'priorities'})}>\r\n                         Priorities\r\n                    </button>\r\n                </div>\r\n                {this.renderInner()}\r\n            </div>\r\n            <div className=\"bean-action-card-parent\">\r\n                <div className=\"card-parent\">\r\n                    <button type=\"button\" className=\"button card\" onClick={() => this.props.brainwash()}\r\n                        title=\"Rewrite one of this being's traits\"\r\n                    > Brainwash\r\n                        <small>-Sanity +-Trait</small>\r\n                    </button>\r\n                </div>\r\n                <div className=\"card-parent\">\r\n                    <button type=\"button\" className=\"button card\"  onClick={() => this.props.brainwash()}  disabled={true}\r\n                        title=\"Give this being food or meds or cash\">\r\n                         Gift\r\n                        <small>-Energy +Things</small>\r\n                    </button>\r\n                </div>\r\n                <div className=\"card-parent\">\r\n                    <button type=\"button\" className=\"button card\" onClick={this.scan} disabled={true}\r\n                        title=\"Steal a bit of this being's mind\">\r\n                         Braindrain\r\n                        <small>-Energy -Sanity</small>\r\n                    </button>\r\n                    <button type=\"button\" className=\"button card\" onClick={this.vaporize}\r\n                        disabled={!this.props.alien.canAfford(this.props.alien.difficulty.cost.bean.vaporize)}\r\n                        title=\"Delete this being from the experiment\"\r\n                    >\r\n                         Vaporize\r\n                        <CostSmall cost={this.props.alien.difficulty.cost.bean.vaporize}></CostSmall>\r\n                    </button>\r\n                </div>\r\n                <div className=\"card-parent\">\r\n                    <button type=\"button\" className=\"button card\"\r\n                        disabled={!this.props.alien.canAfford(this.props.alien.difficulty.cost.bean.abduct)}\r\n                        onClick={() => this.abduct()}\r\n                        title=\"Remove this being for study\"\r\n                    >\r\n                         Abduct for Research\r\n                        <CostSmall cost={this.props.alien.difficulty.cost.bean.abduct} rider=\"+Tech\"></CostSmall>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        )\r\n    }\r\n}","import React, { ChangeEvent } from \"react\";\r\nimport { TraitCommunity, TraitIdeals } from \"../World\";\r\nimport { City } from \"../simulation/City\";\r\n\r\nexport interface FoundPartyPS\r\n{\r\n    cities: City[],\r\n    onFound: (state: FoundPartyS) => void\r\n}\r\nexport interface FoundPartyS\r\n{\r\n    community: TraitCommunity|null\r\n    ideal: TraitIdeals|null,\r\n    name: string,\r\n    slogan: string,\r\n    members: string,\r\n    goal: string,\r\n    cityKey: number\r\n}\r\n\r\nexport class FoundParty extends React.Component<FoundPartyPS, FoundPartyS> {\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.state = {\r\n            community: null,\r\n            ideal: null,\r\n            name: \"Goodplace\",\r\n            slogan: \"Perfection is achievable.\",\r\n            members: \"Citizens\",\r\n            goal: \"Legislation\",\r\n            cityKey: 0\r\n        }\r\n    }\r\n    onCommunity(val: TraitCommunity){\r\n        this.setState({community: val}, () => {\r\n            this.onBigFourChange();\r\n        });\r\n    }\r\n    onIdeal(val: TraitIdeals){\r\n        this.setState({ideal: val}, () => {\r\n            this.onBigFourChange();\r\n        });\r\n    }\r\n    onBigFourChange(){\r\n        if (this.state.community === 'ego' && this.state.ideal === 'trad'){\r\n            this.setState({\r\n                name: 'Arcadia',\r\n                slogan: \"A man belongs on the farm.\",\r\n                members: \"Farmers\", goal: \"Tariffs\"});\r\n        } else if (this.state.community === 'ego' && this.state.ideal === 'prog') {\r\n            this.setState({\r\n                name: \"Libertaria\",\r\n                slogan: \"Freedom for every being!\",\r\n                members: \"Builders\", goal: \"Right to Strike\"});\r\n        } else if (this.state.community === 'state' && this.state.ideal === 'trad') {\r\n            this.setState({\r\n                name: \"Ultimate Kingdom\",\r\n                slogan: \"Honor to King and family.\",\r\n                members: \"Homeowners\", goal: \"Repeal Property Tax\"});\r\n        } else if (this.state.community === 'state' && this.state.ideal === 'prog') {\r\n            this.setState({\r\n                name: \"Equus\",\r\n                slogan: \"True equality is peace.\",\r\n                members: \"Penniless\", goal: \"Food Welfare\"});\r\n        }\r\n    }\r\n    onName = (e: ChangeEvent<HTMLInputElement>) => {\r\n        this.setState({name: e.target.value});\r\n    }\r\n    onSlogan = (e: ChangeEvent<HTMLInputElement>) => {\r\n        this.setState({slogan: e.target.value});\r\n    }\r\n    onCity = (key: any) => {\r\n        this.setState({cityKey: +key});\r\n    }\r\n    render(){\r\n        return <div>\r\n          <div className=\"pad-4p\">\r\n            <h2>Found your Utopia</h2>\r\n          </div>    \r\n          <div className=\"col-2\">\r\n            <div>\r\n              Perfect societies rely on the\r\n              <div>\r\n                <label>\r\n                  <input type=\"radio\" name=\"community\" value=\"state\" checked={this.state.community === 'state'} onChange={(e) => this.onCommunity(e.currentTarget.value as TraitCommunity)} /> <b>Collective</b>  {/*  */}\r\n                </label>\r\n                &nbsp;&nbsp;or&nbsp;&nbsp;\r\n                <label>\r\n                  <input type=\"radio\" name=\"community\" value=\"ego\" checked={this.state.community === 'ego'} onChange={(e) => this.onCommunity(e.currentTarget.value as TraitCommunity)}/> <b>Independent</b>  {/**/}\r\n                </label>\r\n              </div>\r\n              &nbsp;\r\n              to guarantee well-being.\r\n            </div>\r\n            <div>\r\n              Perfect beings devote themselves to\r\n              <div>\r\n                <label>\r\n                  <input type=\"radio\" name=\"ideal\" value=\"trad\" checked={this.state.ideal === 'trad'} onChange={(e) => this.onIdeal(e.currentTarget.value as TraitIdeals)}/> <b>Elitist</b> {/* */} \r\n                </label>\r\n                &nbsp;&nbsp;or&nbsp;&nbsp;\r\n                <label>\r\n                  <input type=\"radio\" name=\"ideal\" value=\"prog\" checked={this.state.ideal === 'prog'} onChange={(e) => this.onIdeal(e.currentTarget.value as TraitIdeals)} /> <b>Progressive</b> {/*  */} \r\n                </label>\r\n              </div>\r\n              &nbsp;\r\n              social values.\r\n            </div>\r\n          </div>\r\n          <hr />\r\n          <div className=\"col-2\">\r\n            <div>\r\n              My Utopia is named <input type=\"text\" value={this.state.name} onChange={this.onName} />\r\n            </div>\r\n            <div>\r\n              My Utopia's mantra is <input type=\"text\" value={this.state.slogan} onChange={this.onSlogan}  />\r\n            </div>\r\n          </div>\r\n          <hr/>\r\n          <button type=\"button\" disabled={this.state.community == null || this.state.ideal == null} className=\"important btn-found-party\" onClick={() => this.props.onFound(this.state)}>Found the {this.state.name} Utopia</button>\r\n        </div>\r\n    }\r\n}","import React, { useEffect, useState } from \"react\";\r\nimport { ChangePubSub, PubSub } from \"../events/Events\";\r\n\r\ninterface Bubble {string: string, id: number, className?: string};\r\n\r\nfunction useBubbles<T>(sub: PubSub<T>, transform: (input: T) => {string: string, className: string}){\r\n    const [bubbles, setBubbles] = useState<Bubble[]>([]);\r\n    let bubbleSeed = 0;\r\n    const onEvent = (event: T) => {\r\n        const id = ++bubbleSeed;\r\n        setBubbles(bubbles.concat([{\r\n            id: id,\r\n            ...transform(event)\r\n        }]));\r\n        setTimeout(() => {\r\n            setBubbles(\r\n                bubbles.filter((b) => b.id != id)\r\n            )\r\n        }, 1500)\r\n    }\r\n    useEffect(() => {\r\n        sub.subscribe(onEvent);\r\n        return () => sub.unsubscribe(onEvent);\r\n    });\r\n    return bubbles;\r\n}\r\n\r\nexport class BubbleNumberText extends React.Component<{\r\n    bubbleClass?: string,\r\n    icon?: string,\r\n    changeEvent?: ChangePubSub\r\n}, {\r\n    bubbles: Array<Bubble>\r\n}> {\r\n\r\n    constructor(props: any){\r\n        super(props);\r\n        this.state = {\r\n            bubbles: []\r\n        };\r\n    }\r\n    componentDidMount(){\r\n        if (this.props.changeEvent){\r\n            this.props.changeEvent.subscribe(this.onChange)\r\n        }\r\n    }\r\n    bubbleSeed = 0;\r\n    onChange = (ev: {change: number}) => {\r\n        const id = ++this.bubbleSeed;\r\n        const positive = ev.change > 0;\r\n        this.setState({\r\n            bubbles: this.state.bubbles.concat([{\r\n                string: (positive ? '+': '') + ev.change,\r\n                id: id,\r\n                className: positive ? 'pos' : 'neg'\r\n            }])\r\n        });\r\n        setTimeout(() => {\r\n            this.setState({\r\n                bubbles: this.state.bubbles.filter((b) => b.id != id)\r\n            })\r\n        }, 1500)\r\n    }\r\n\r\n    componentWillUnmount(){\r\n        if (this.props.changeEvent){\r\n            this.props.changeEvent.unsubscribe(this.onChange);\r\n        }\r\n    }\r\n\r\n    render(){\r\n        const bubbles = this.state.bubbles.map((b) => <span key={b.id} className={[b.className, this.props.bubbleClass, \"bubbler\"].join(' ')}>\r\n            {this.props.icon} {b.string}\r\n        </span>)\r\n        return <span className=\"bubble-parent\">\r\n            {this.props.children}\r\n            {bubbles}\r\n        </span>\r\n    }\r\n}\r\n\r\nexport const BubbleSeenTraitsText: React.FC<{\r\n    bubbleClass?: string,\r\n    icon?: string,\r\n    changeEvent: PubSub<{k: string, v: boolean}>\r\n}> = (props) => {\r\n    const bubbles = useBubbles(props.changeEvent, (input: {k: string, v: boolean}) => {\r\n        return {\r\n            string: `Discovered ${input.k}!`,\r\n            className: 'seen-belief'\r\n        }\r\n    })\r\n    return <span className=\"bubble-parent\">\r\n        {props.children}\r\n        {bubbles.map((b) => <span key={b.id} className={[b.className, props.bubbleClass, \"bubbler\"].join(' ')}>\r\n            {props.icon} {b.string}\r\n        </span>)}\r\n    </span>\r\n}","import React from \"react\";\r\nimport { Bean } from \"../simulation/Bean\";\r\nimport { AnimatedBean } from \"../petri-ui/AnimatedBean\";\r\nimport \"./SocialGraph.css\";\r\nimport { IBuilding, origin_point } from \"../simulation/Geography\";\r\nimport { LiveList } from \"../events/Events\";\r\nimport { SocialBuildings } from \"../petri-ui/Buildings\";\r\nimport { City } from \"../simulation/City\";\r\nimport { Building } from \"../simulation/RealEstate\";\r\n\r\ninterface SocialGraphP{\r\n    city: City,\r\n    beans: LiveList<Bean>;\r\n    scanned_beans: {[beanKey: number]: boolean},\r\n    costOfLiving: number;\r\n    onClick: (b: Bean) => void;\r\n    onClickBuilding: (b: IBuilding) => void;\r\n}\r\ninterface SocialGraphS{\r\n    \r\n}\r\nexport class SocialGraph extends React.Component<SocialGraphP, SocialGraphS>{\r\n    constructor(props: SocialGraphP){\r\n        super(props);\r\n        this.state = {\r\n\r\n        };\r\n    }\r\n    render(){\r\n        return <div className=\"social-graph\">\r\n            <div className=\"social-graph-row\">\r\n            {\r\n                this.props.beans.get.map((b) => \r\n                <div key={b.key} className=\"bean-node\" onClick={() => this.props.onClick(b)}>\r\n                    <AnimatedBean bean={b} static={true} sitStill={true} \r\n                        onClick={() => {this.props.onClick(b);}}>\r\n                    </AnimatedBean>\r\n                    {\r\n                        this.props.scanned_beans[b.key] ? null : <span className=\"social-graph-unscanned prohibited-emoji\"></span>\r\n                    }\r\n                </div>)\r\n            }\r\n            </div>\r\n            <div className=\"social-graph-row\">\r\n            {\r\n                <SocialBuildings city={this.props.city} onClickBuilding={this.props.onClickBuilding}></SocialBuildings>\r\n            }\r\n            </div>\r\n        </div>\r\n    }\r\n}","import React from \"react\";\r\n\r\nexport class CapsuleLabel extends React.Component<{\r\n    icon?: string,\r\n    label?: string\r\n}, {\r\n}> {\r\n\r\n    constructor(props: any){\r\n        super(props);\r\n        this.state = {\r\n        };\r\n    }\r\n\r\n    render(){\r\n        const classN = 'capsule-label '+this.props.label||'';\r\n        return <span className={classN}>\r\n            <span className=\"capsule-icon\">\r\n                {this.props.icon}\r\n            </span>\r\n            <span className=\"capsule-text\">\r\n                {this.props.label}:\r\n            </span>\r\n            <span className=\"capsule-value\">\r\n                {this.props.children}\r\n            </span>\r\n        </span>\r\n    }\r\n}","import React from \"react\";\r\nimport { DefaultDifficulty, triadToString } from \"../Game\";\r\nimport { Curriculums, GetAverage, Goals, IGoal, IPlayerData, IProgressable } from \"../simulation/Player\";\r\n\r\nexport interface GoalPanelPS\r\n{\r\n  player: IPlayerData;\r\n  progress: IProgressable;\r\n}\r\n\r\nexport class GoalsPanel extends React.Component<GoalPanelPS> {\r\n  renderReward(g: IGoal){\r\n    return <div>\r\n      <small>\r\n       {triadToString(g.reward || {}, '+')}\r\n      </small>\r\n    </div>\r\n  }\r\n  renderGoal(g: IGoal){\r\n    const done = this.props.progress.goalProgress[g.key] != null && this.props.progress.goalProgress[g.key].done;\r\n    return <li>\r\n      {done ? '': ''}\r\n      {g.text}\r\n      {g.tooltip != null ? <small title={g.tooltip}></small> : null}\r\n      {done || g.reward == null ? null : this.renderReward(g)}\r\n    </li>\r\n  }\r\n    render(){\r\n        return (<div className=\"goals\">\r\n        <div><b>Goals</b></div>\r\n        <ul>\r\n          {this.props.progress.goals.map((key) => {\r\n            return this.renderGoal(Goals[key]);\r\n          })}\r\n        </ul>\r\n        <div><b>Report Card</b></div>\r\n        <p className=\"horizontal\">\r\n          <span>\r\n            Last Grade: <b>D</b>\r\n          </span>\r\n          <span>\r\n            Next Grade in: <b>2 mo.</b>\r\n          </span>\r\n        </p>\r\n        <p>\r\n        </p>\r\n        <table style={{margin: 'auto'}}>\r\n          <tbody>\r\n            <tr>\r\n              <th> Happiness\r\n              </th>\r\n              <td>\r\n                {this.props.player.workingReportCard.Happiness}\r\n              </td>\r\n              <td>\r\n                <small title=\"Are your subjects happy?\"></small>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td className=\"text-left\" colSpan={3}>\r\n                <small>\r\n              {Curriculums.Default.RubricDescription.Happiness}\r\n                </small>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <th> Prosperity</th>\r\n              <td>\r\n                {this.props.player.workingReportCard.Prosperity}\r\n              </td>\r\n              <td>\r\n                <small title=\"Are your subjects fed and healthy?\"></small>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td className=\"text-left\" colSpan={3}>\r\n              <small>{Curriculums.Default.RubricDescription.Prosperity}</small>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <th> Stability\r\n              </th>\r\n              <td>\r\n                {this.props.player.workingReportCard.Stability}\r\n              </td>\r\n              <td>\r\n                <small title=\"Are your subjects sane and civil?\"></small>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td className=\"text-left\" colSpan={3}>\r\n              <small>{Curriculums.Default.RubricDescription.Stability}</small>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <th> Dogma\r\n              </th>\r\n              <td>\r\n                {this.props.player.workingReportCard.Dogma}\r\n              </td>\r\n              <td>\r\n                <small title=\"Do your society's rules match your utopian ideals?\"></small>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td className=\"text-left\" colSpan={3}>\r\n              <small>{Curriculums.Default.RubricDescription.Dogma}</small>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td colSpan={3}>\r\n                <hr />\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <th>\r\n                Avg. Grade\r\n              </th>\r\n              <td>\r\n                {GetAverage(this.props.player.workingReportCard)}\r\n              </td>\r\n              <td></td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>)\r\n    }\r\n}","import React from \"react\";\r\n\r\nexport class CampaignsPanel extends React.Component<{\r\n\r\n}>{\r\n    render(){\r\n        return <div className=\"pad-4p\">\r\n        <div className=\"subheader\">\r\n            <h3>Propaganda</h3>\r\n            <button type=\"button\" className=\"callout\" onClick={() => void(0)} > Buy Propaganda</button>\r\n        </div>\r\n        <span>\r\n          Propaganda changes beans' feelings on a wide variety of topics.\r\n        </span>\r\n        <div className=\"card-parent\">\r\n          <button type=\"button\" className=\"card button\">\r\n            <span className=\"h\">\r\n               Broadcast Campaign\r\n            </span>\r\n            <small>Approval+ Cash-</small>\r\n            <span className=\"p\">\r\n              Small chance to increase Approval among all beans\r\n            </span>\r\n          </button>\r\n          <button type=\"button\" className=\"card button\">\r\n            <span className=\"h\">\r\n               Canvassing\r\n            </span>\r\n            <small>Approval+ Labor-</small>\r\n            <span className=\"p\">\r\n              Chance to increase Approval on a few random beans\r\n            </span>\r\n          </button>\r\n          <button type=\"button\" className=\"card button\">\r\n            <span className=\"h\">\r\n               Print Campaign\r\n            </span>\r\n            <small>Approval+ Cash-</small>\r\n            <span className=\"p\">\r\n              Chance to increase Approval on wealthy beans\r\n            </span>\r\n          </button>\r\n        </div>\r\n        <div className=\"subheader\">\r\n            <h3>Appearances</h3>\r\n            <button type=\"button\" className=\"callout\" onClick={() => void(0)} > Schedule Appearance</button>\r\n        </div>\r\n        <span>\r\n          Appearances have limited reach, but have powerful effects.\r\n        </span>\r\n        <div className=\"card-parent\">\r\n          <button type=\"button\" className=\"card button\">\r\n            <span className=\"h\">\r\n             Debating\r\n            </span>\r\n            <small>\r\n              Labor-\r\n            </small>\r\n            <span className=\"p\">\r\n              Chance to gain or lose Influence\r\n            </span>\r\n          </button>\r\n          <button type=\"button\" className=\"card button\">\r\n            <span className=\"h\">\r\n             Photo Op\r\n            </span>\r\n            <small>\r\n              Labor-\r\n            </small>\r\n            <span className=\"p\">\r\n              Increases Approval within one Social Group\r\n            </span>\r\n          </button>\r\n          <button type=\"button\" className=\"card button\">\r\n            <span className=\"h\">\r\n               Speechmaking\r\n            </span>\r\n            <small>\r\n              Labor-\r\n            </small>\r\n            <span className=\"p\">\r\n              Increases chance of Donations in a single City\r\n            </span>\r\n          </button>\r\n          <button type=\"button\" className=\"card button\">\r\n            <span className=\"h\">\r\n             Town Hall\r\n            </span>\r\n            <small>\r\n              Labor-\r\n            </small>\r\n            <span className=\"p\">\r\n              Suppresses negative Approval in a single city                     \r\n            </span>\r\n          </button>\r\n        </div>\r\n        {/* <CharityPanel world={this.state.world} onFoundCharity={this.foundCharity}></CharityPanel>\r\n        <div>\r\n          <b>Campaign Finances</b> <br/>\r\n          <b>Expenses</b> ${seasonalCost} <b>Surplus</b> ${this.state.world.party.seasonalIncome - seasonalCost}\r\n        </div> */}\r\n      </div>\r\n    }\r\n}","import React, { useEffect, useState } from \"react\";\r\nimport { Live } from \"../events/Events\";\r\nimport { LawGroup, LawKey, LawData } from \"../simulation/Government\";\r\nimport { BeliefInventory } from \"../simulation/Player\";\r\n\r\n\r\nexport const TreasuryReport: React.FC<{\r\n    treasury: Live<number>\r\n}> = (props) => {\r\n    const [coin, setCoin] = useState(props.treasury.get);\r\n    const update = () => {\r\n        setCoin(props.treasury.get);\r\n    }\r\n    useEffect(() => {\r\n        props.treasury.onChange.subscribe(update);\r\n        return props.treasury.onChange.unsubscribe(update);\r\n    })\r\n    return <div className=\"pad-4p\">\r\n        <div>\r\n            <strong> Treasury: {coin.toFixed(2)}</strong>\r\n        </div>\r\n    </div>\r\n}","import React, { useState } from \"react\";\r\nimport { SecondaryBeliefData } from \"../simulation/Beliefs\";\r\nimport { LawData, LawGroup, LawKey, PlayerCanSeePrereqs, PlayerKnowsPrereq, PlayerMeetsPrereqs, PrereqKey, PrereqString } from \"../simulation/Government\";\r\nimport { BeliefInventory } from \"../simulation/Player\";\r\nimport { TreasuryReport } from \"../widgets/TreasuryReport\";\r\nimport { World } from \"../World\";\r\n\r\nexport const GovernmentPanel: React.FC<{\r\n    world: World,\r\n    enactLaw: (l: LawKey) => void\r\n    revokeLaw: (l: LawKey) => void\r\n}> = (props) => {\r\n    const [view, setView] = useState<LawGroup|'funds'>('Welfare');\r\n    return <div>\r\n        <div className=\"col-2\">\r\n            <h2 className=\"marg-b-0\">Utopia Government</h2>\r\n            <div>\r\n                <div className=\"horizontal blue-orange cylinder f-size-125em marg-t-20\">\r\n                    <button type=\"button\" onClick={() => setView('Welfare')} className={view === 'Welfare' ? 'active' : ''}>\r\n                         Welfare\r\n                    </button>\r\n                    <button type=\"button\" onClick={() => setView('Crime')} className={view === 'Crime' ? 'active' : ''}>\r\n                         Crime\r\n                    </button>\r\n                    <button type=\"button\" onClick={() => setView('Taxation')} className={view === 'Taxation' ? 'active' : ''}>\r\n                         Taxes\r\n                    </button>\r\n                    <button type=\"button\" onClick={() => setView('funds')} className={view === 'funds' ? 'active' : ''}>\r\n                         Funds\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        {\r\n            view === 'funds' ? <div className=\"col-2\">\r\n                <div>\r\n                    <TreasuryReport treasury={props.world.law.treasury}></TreasuryReport>\r\n                </div>\r\n                <div>\r\n                </div>\r\n            </div> : <LawDetailList \r\n                group={view} seenBeliefs={props.world.alien.seenBeliefs.get} beliefs={props.world.alien.beliefInventory.get}\r\n                isLaw={(l) => props.world.law.isLaw(l)}\r\n                enactLaw={(l: LawKey) => props.enactLaw(l)}\r\n                revokeLaw={(l: LawKey) => props.revokeLaw(l)}\r\n            ></LawDetailList>\r\n        }\r\n    </div>\r\n}\r\n\r\n\r\nexport const LawDetailList: React.FC<{\r\n    group: LawGroup,\r\n    seenBeliefs: Map<string, boolean>,\r\n    beliefs: BeliefInventory[],\r\n    isLaw(l: LawKey): boolean,\r\n    enactLaw: (l: LawKey) => void\r\n    revokeLaw: (l: LawKey) => void\r\n}> = (props) => {\r\n    const laws = Object.values(LawData).filter(x => x.group === props.group);\r\n    return <div className=\"pad-4p\">\r\n        <strong>{props.group} Laws</strong>\r\n        <div className=\"horizontal scroll\">\r\n        {\r\n            laws.map((x) => <LawFormula seenBeliefs={props.seenBeliefs} id={x.key} beliefs={props.beliefs} key={x.key} enacted={props.isLaw(x.key)}\r\n                enactLaw={(l) => props.enactLaw(l)} revokeLaw={(l) => props.revokeLaw(l)}>\r\n            </LawFormula>)\r\n        }\r\n        </div>\r\n    </div>\r\n}\r\n\r\n\r\nexport const LawFormula: React.FC<{\r\n    id: LawKey,\r\n    seenBeliefs: Map<string, boolean>,\r\n    beliefs: BeliefInventory[],\r\n    enacted: boolean,\r\n    enactLaw: (l: LawKey) => void\r\n    revokeLaw: (l: LawKey) => void\r\n}> = (props) => {\r\n    const law = LawData[props.id];\r\n    const canSeeName = PlayerCanSeePrereqs(law.prereqs, props.seenBeliefs);\r\n    const unlocked = PlayerMeetsPrereqs(law.prereqs, props.seenBeliefs);\r\n    return <div className=\"vertical law-formula\">\r\n        <div className=\"horizontal\">\r\n            <div className=\"circular\">\r\n                {canSeeName ? law.icon : ''}\r\n            </div>\r\n            <div>\r\n                <strong>\r\n                    {canSeeName ? law.name : 'Unknown'}\r\n                </strong>\r\n                <div>\r\n                    {\r\n                        canSeeName ? <small> {law.description} </small> : null\r\n                    }\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div className=\"vertical\">\r\n            {\r\n                law.prereqs.map((x) => {\r\n                    const has = PlayerKnowsPrereq(x, props.seenBeliefs);\r\n                    const key = PrereqKey(x);\r\n                    return !has ? <span className=\"law-formula-ingredient unknown\" key={key}>\r\n                         Unknown\r\n                    </span> : <span className=\"law-formula-ingredient\" key={key}>\r\n                        {PrereqString(x)}\r\n                    </span>\r\n                })\r\n            }\r\n        </div>\r\n        {\r\n            props.enacted ? <button className=\"callout\"  onClick={() => props.revokeLaw(props.id)}>\r\n                &nbsp;Revoke Active Law\r\n            </button> : <button className=\"callout\" disabled={!unlocked} onClick={() => props.enactLaw(props.id)}>\r\n                {\r\n                    unlocked ? '' : <span className=\"grey\"></span>\r\n                }\r\n                &nbsp;Enact\r\n            </button>\r\n        }\r\n        {props.children}\r\n    </div>;\r\n}","import React from \"react\";\r\n\r\nexport class ConfirmButton extends React.Component<{\r\n    confirmText: string,\r\n    onConfirm: () => void,\r\n    disabled?: boolean,\r\n    className?: string\r\n}, {\r\n    confirming: boolean\r\n}> {\r\n    constructor(props:any){\r\n        super(props);\r\n        this.state = {\r\n            confirming: false\r\n        }\r\n    }\r\n    click(){\r\n        if (this.state.confirming){\r\n            this.props.onConfirm();\r\n            this.setState({confirming: false});\r\n        } else {\r\n            this.setState({confirming: true});\r\n        }\r\n    }\r\n    render(){\r\n        return <button className={this.props.className} onClick={() => this.click()} disabled={this.props.disabled}>\r\n            { this.state.confirming ? this.props.confirmText : this.props.children}\r\n        </button>\r\n    }\r\n}","import React from \"react\";\r\n\r\nexport class RobotArm extends React.Component<{\r\n    tool: string,\r\n    classN: string\r\n}, {\r\n\r\n}> {\r\n    render(){\r\n        const style = {};\r\n        return <svg width=\"100\" height=\"300\" xmlns=\"http://www.w3.org/2000/svg\" style={style} className={this.props.classN+\" robot-arm\"}>\r\n        <g>\r\n         <title>robotarm</title>\r\n         <rect fill=\"transparent\" id=\"canvas_background\" height=\"302\" width=\"102\" y=\"-1\" x=\"-1\"/>\r\n         <g display=\"none\" overflow=\"visible\" y=\"0\" x=\"0\" height=\"100%\" width=\"100%\" id=\"canvasGrid\">\r\n          <rect fill=\"url(#gridpattern)\" strokeWidth=\"0\" y=\"0\" x=\"0\" height=\"100%\" width=\"100%\"/>\r\n         </g>\r\n        </g>\r\n        <g>\r\n         <title>Layer 1</title>\r\n         <rect id=\"svg_2\" height=\"200\" width=\"48\" y=\"91.63545\" x=\"25\" strokeWidth=\"1.5\" stroke=\"#000\" fill=\"#BBBBBB\"/>\r\n         <ellipse ry=\"48\" rx=\"48\" id=\"svg_1\" cy=\"50\" cx=\"50\" strokeWidth=\"1.5\" stroke=\"#000\" fill=\"#999999\"/>\r\n         <ellipse ry=\"20\" rx=\"20\" id=\"svg_3\" cy=\"50\" cx=\"50\" strokeWidth=\"1.5\" stroke=\"#000\" fill=\"#444444\"/>\r\n         <ellipse ry=\"48\" rx=\"48\" id=\"svg_4\" cy=\"250\" cx=\"50\" strokeWidth=\"1.5\" stroke=\"#000\" fill=\"#999999\"/>\r\n        <ellipse ry=\"20\" rx=\"20\" id=\"svg_5\" cy=\"250\" cx=\"50\" strokeWidth=\"1.5\" stroke=\"#000\" fill=\"#444444\">{this.props.tool}</ellipse>\r\n            \r\n        </g><text y=\"250\" x=\"-20\" fontSize=\"4em\">{this.props.tool}</text>\r\n       </svg>\r\n    }\r\n}","import React from \"react\";\r\nimport { IPlayerData, ITechInfo, Tech, TechData } from \"../simulation/Player\";\r\nimport { ConfirmButton } from \"../widgets/ConfirmButton\";\r\nimport { RobotArm } from \"../widgets/RobotArm\";\r\nimport './research.css';\r\n\r\nexport class ResearchPanel extends React.Component<{\r\n  player: IPlayerData,\r\n  setResearch: (t: Tech) => void,\r\n  release: () => void\r\n}, {\r\n  toolI: number, toolI2: number, toolI3: number, toolI4: number\r\n}>{\r\n  tools = [\r\n  '',\r\n  '',\r\n  '',\r\n  '',\r\n  '',\r\n  '',\r\n  '',\r\n  '',\r\n  '',\r\n  ];\r\n  constructor(props:any){\r\n    super(props);\r\n    this.state = {\r\n      toolI: 0,\r\n      toolI2: 2,\r\n      toolI3: 4,\r\n      toolI4: 1,\r\n    };\r\n  }\r\n  interval?: number;\r\n  loop(lastI: number){\r\n    let i = lastI + 1;\r\n    if (i === this.tools.length)\r\n      i = 0;\r\n    return i;\r\n  }\r\n  componentDidMount(){\r\n    this.interval = window.setInterval(() => {\r\n      this.setState({\r\n        toolI: this.loop(this.state.toolI),\r\n        toolI2: this.loop(this.state.toolI2),\r\n        toolI3: this.loop(this.state.toolI3),\r\n        toolI4: this.loop(this.state.toolI4),\r\n      });\r\n    }, 1000);\r\n  }\r\n  componentWillUnmount(){\r\n    if (this.interval != null)\r\n      window.clearInterval(this.interval);\r\n  }\r\n  setResearch(tech: Tech){\r\n    this.props.setResearch(tech);\r\n  }\r\n  renderTech(tech: ITechInfo){\r\n    const unstarted = this.props.player.techProgress[tech.tech] == null;\r\n    const progress = unstarted ? 0 : this.props.player.techProgress[tech.tech].researchPoints;\r\n    const total = tech.techPoints;\r\n    const style = {width: (Math.min(progress/total*100, 100))+'%'};\r\n    const complete = progress >= total;\r\n    const isCurrent = this.props.player.currentlyResearchingTech === tech.tech;\r\n    const state: ''|''|'' = complete ? '' : isCurrent ? '' : '';\r\n    const rootClassName = isCurrent ? 'active': 'inactive';\r\n    return <div className={\"card-parent \"+rootClassName} key={tech.tech}>\r\n      <button className=\"card button\" onClick={() => this.setResearch(tech.tech)}>\r\n        <strong>{tech.name}</strong>\r\n        <strong className=\"pull-r f-size-125em\">{state}</strong>\r\n        <div>\r\n          {tech.description}\r\n        </div>      \r\n        <div className=\"bar f-size-12 h-12\">\r\n            <div className=\"bar-inner text-center\" style={style}>\r\n            </div>\r\n            {progress}/{total} tech\r\n        </div>\r\n      </button>\r\n    </div>\r\n  }\r\n  render(){\r\n      const techs = Object.values(TechData);\r\n      return <div>\r\n          <div className=\"col-2\">\r\n            <div>\r\n              <h2>Research  Lab</h2>\r\n              <div className=\"vertical\">\r\n                {\r\n                  techs.map((t) => this.renderTech(t))\r\n                }\r\n              </div>\r\n            </div>\r\n          <div className=\"vertical\">\r\n            <div>\r\n              <div className=\"robot\">\r\n                \r\n                <RobotArm classN=\"far-left\" tool={this.tools[this.state.toolI]}></RobotArm>\r\n                <RobotArm classN=\"left\" tool={this.tools[this.state.toolI2]}></RobotArm>\r\n                <RobotArm classN=\"near-right\" tool={this.tools[this.state.toolI3]}></RobotArm>\r\n                <RobotArm classN=\"far-right\" tool={this.tools[this.state.toolI4]}></RobotArm>\r\n              </div>\r\n            </div>\r\n            <div className=\"h-42em\">\r\n              {\r\n                this.props.player.abductedBeans.map((b) => {\r\n                  return <span key={b.key} className=\"victim bean triangle shake\"></span>\r\n                })\r\n              }\r\n            </div>\r\n\r\n            <div className=\"text-center\">\r\n              Currently probing {this.props.player.abductedBeans.length} beings for {this.props.player.abductedBeans.length} tech a day\r\n              <p>\r\n                <small>1 tech per research subject per day</small>\r\n              </p>\r\n            </div>\r\n            {\r\n              this.props.player.abductedBeans.length > 0 ? <div className=\"text-right\">\r\n                <ConfirmButton className=\"callout\" onConfirm={() => {this.props.release()}} confirmText=\"-1 Research Subject?\">\r\n                 Release Research Subject\r\n                </ConfirmButton>\r\n              </div> : null\r\n            }\r\n          </div>\r\n        </div>\r\n        <div>\r\n\r\n        </div>\r\n      </div>\r\n  }\r\n}","import React from \"react\";\r\nimport \"./StopPlayFast.css\"\r\n\r\nexport class StopPlayFastButtons extends React.Component<{\r\n    timeScale: number,\r\n    setTimeScale: (s: number) => void\r\n}>{\r\n    render(){\r\n        return <div className=\"s-p-f button-group cylinder blue-orange\">\r\n            \r\n            <button type=\"button\" className={this.props.timeScale == 0 ? 'active': ''} onClick={() => this.props.setTimeScale(0)}></button>\r\n            <button type=\"button\" className={this.props.timeScale == 1 ? 'active': ''} onClick={() => this.props.setTimeScale(1)}></button>\r\n            <button type=\"button\" className={this.props.timeScale == 2 ? 'active': ''} onClick={() => this.props.setTimeScale(2)}></button>\r\n        </div>\r\n    }\r\n}\r\n\r\n\r\nexport const GeoNetworkButtons: React.FC<{\r\n    activeMain: 'geo' | 'network';\r\n    setActiveMain: (v: 'geo' | 'network') => void\r\n}> = (props) => {\r\n    \r\n    return <div className=\"s-p-f button-group cylinder blue-orange\">\r\n        \r\n        <button type=\"button\" className={props.activeMain == 'geo' ? 'active': ''} onClick={() => props.setActiveMain('geo')}></button>\r\n        <button type=\"button\" className={props.activeMain == 'network' ? 'active': ''} onClick={() => props.setActiveMain('network')}></button>\r\n    </div>\r\n    \r\n}","import React from 'react';\r\n\r\nexport const Subtabs: React.FC<{\r\n    additionalClasses?: string,\r\n    active: string,\r\n    options: {icon: string, value: string, text: string, onClick: () => void}[]    \r\n}> = (props) => {\r\n\r\n    return <div className={'horizontal blue-orange cylinder f-size-125em marg-t-20'+(props.additionalClasses||'')}>\r\n        {\r\n            props.options.map((x) => <button type=\"button\" key={x.value} onClick={() => x.onClick()}  className={props.active === x.value ? 'active': ''}>\r\n                {x.icon} {x.text}\r\n            </button>)\r\n        }\r\n    </div>\r\n}","import React from \"react\";\r\nimport { keyToName } from \"../App\";\r\nimport { Subtabs } from \"../chrome/Subtab\";\r\nimport { IDifficulty } from \"../Game\";\r\nimport { City } from \"../simulation/City\";\r\nimport { BuildingIcon, BuildingJobIcon, BuildingTypes, HexPoint, IBuilding } from \"../simulation/Geography\";\r\nimport { EnterpriseType, EnterpriseTypeIcon, EnterpriseTypes, isEnterprise } from \"../simulation/Institutions\";\r\nimport { CostSmall } from \"../widgets/CostSmall\";\r\n\r\nexport class HexPanel extends React.Component<{\r\n    city: City,\r\n    hex: HexPoint,\r\n    difficulty: IDifficulty,\r\n    clearHex: () => void,\r\n    build: (where: HexPoint, what: BuildingTypes) => void,\r\n    beam: (where: HexPoint) => void,\r\n    upgrade: (what: IBuilding) => void,\r\n    fire: (beanKey: number) => void,\r\n    changeEnterprise: (what: IBuilding) => void,\r\n}, {\r\n\r\n}> {\r\n    emptyPanel(){\r\n        const eHex = this.props.difficulty.cost.emptyHex;\r\n        return <div>\r\n            <div>\r\n                <strong>Empty Lot</strong> in <strong>{this.props.city.name}</strong>\r\n                <button type=\"button\" className=\"pull-r\" onClick={() => this.props.clearHex()} ></button>\r\n            </div>\r\n            {/* <div>\r\n                {this.props.hex.q}x\r\n                {this.props.hex.r}\r\n            </div> */}\r\n            <h3>Build:</h3>\r\n            <div className=\"card-parent\">\r\n                <button className=\"card button\" type=\"button\" onClick={() => this.props.build(this.props.hex, 'house')}>\r\n                    {BuildingIcon['house']} House\r\n                    <CostSmall cost={eHex.build.house}></CostSmall>\r\n                </button>\r\n            </div>\r\n            <div className=\"card-parent\">\r\n                <button className=\"card button\" type=\"button\" onClick={() => this.props.build(this.props.hex, 'farm')}>\r\n                    {BuildingIcon['farm']} Farm\r\n                    <CostSmall cost={eHex.build.farm}></CostSmall>\r\n                </button>\r\n                <button className=\"card button\" type=\"button\" onClick={() => this.props.build(this.props.hex, 'hospital')}>\r\n                    {BuildingIcon['hospital']} Hospital\r\n                    <CostSmall cost={eHex.build.hospital}></CostSmall>\r\n                </button>\r\n            </div>\r\n            <div className=\"card-parent\">\r\n                <button className=\"card button\" type=\"button\" onClick={() => this.props.build(this.props.hex, 'theater')}>\r\n                    {BuildingIcon['theater']} Theater\r\n                    <CostSmall cost={eHex.build.theater}></CostSmall>\r\n                </button>\r\n                <button className=\"card button\" type=\"button\" onClick={() => this.props.build(this.props.hex, 'park')}>\r\n                    {BuildingIcon['park']} Park\r\n                    <CostSmall cost={eHex.build.park}></CostSmall>\r\n                </button>\r\n            </div>\r\n            <h3>Beings:</h3>\r\n            {this.renderBeamButton()}\r\n        </div>\r\n\r\n    }\r\n    renderBeamButton(){\r\n        return <div className=\"card-parent\">\r\n        <button className=\"card button\" type=\"button\" onClick={() => this.props.beam(this.props.hex)}>\r\n             Beam In New Subject\r\n            <CostSmall cost={this.props.difficulty.cost.hex.beam} rider=\"+Subject\"></CostSmall>\r\n        </button>\r\n    </div>\r\n    }\r\n    buildingPanel(b: IBuilding){\r\n        const slots = b.usedSlots();\r\n        const free = b.openSlots();\r\n        const hasJobs = b.type != 'park' && b.type != 'nature';\r\n        return <div>\r\n            <strong>{b.upgraded && hasJobs ? 'Dense ': 'Small '}{keyToName[b.type]}</strong> in <strong>{this.props.city.name}</strong>\r\n            <button type=\"button\" className=\"pull-r\" onClick={() => this.props.clearHex()}></button>\r\n        {\r\n            b.upgraded && hasJobs ? <div>\r\n                {this.renderDensityWarning(b.type)}\r\n            </div> : null\r\n        }\r\n        {\r\n            <EnterpriseTypePicker building={b} changeEnterprise={this.props.changeEnterprise}></EnterpriseTypePicker>\r\n        }\r\n        {\r\n            (slots.length === 0) ? null : <div>\r\n                <strong>Workers:</strong>\r\n                {\r\n                    slots.map((x) => {\r\n                        return {\r\n                            key: x,\r\n                            bean: this.props.city.beans.get.find((y) => y.key === b.job_slots[x])\r\n                        }\r\n                    }).map((x) => <div key={x.key}>\r\n                        {BuildingJobIcon[b.type]} {x.bean?.name} {isEnterprise(b) && b.enterpriseType === 'company' && x.bean?.key === b.ownerBeanKey ? '' : ''}\r\n                        <button title=\"Fire\" className=\"callout marg-0\" onClick={() => x.bean ? this.props.fire(x.bean.key) : null}>\r\n                            \r\n                        </button>\r\n                    </div>)\r\n                }\r\n            </div>\r\n        }\r\n        {\r\n            !hasJobs ? null : <div>\r\n                This {keyToName[b.type]} can support {free.length} more jobs.\r\n                {\r\n                    b.upgraded ? null : <span><br/>Upgrade it to add 3 more job slots.</span>\r\n                }\r\n            </div>\r\n        }\r\n        {\r\n            b.upgraded || !hasJobs ? null : <div><div className=\"card-parent\">\r\n                    <button className=\"card button\" type=\"button\" onClick={() => this.props.upgrade(b)}>\r\n                         Upgrade\r\n                        <CostSmall cost={this.props.difficulty.cost.hex.upgrade}></CostSmall>\r\n                    </button>\r\n                </div>\r\n                {this.renderDensityWarning(b.type)}\r\n            </div>\r\n        }\r\n        {this.renderBeamButton()}\r\n        </div>\r\n    }\r\n    renderDensityWarning(typ: BuildingTypes){\r\n        if (typ === 'house')\r\n        return <>\r\n            <div className=\"text-center\">\r\n            <small>\r\n             Parochial subjects may emit <br/>when living in dense buildings\r\n            </small>\r\n        </div> \r\n        <div className=\"text-center\">\r\n            <small>\r\n             Cosmopolitan subjects may emit <br/>when living in small buildings\r\n            </small>\r\n        </div>\r\n        </>;\r\n        else return <div>\r\n\r\n        </div>\r\n    }\r\n    renderJobs(){\r\n\r\n    }\r\n    render(){\r\n        const building: IBuilding|undefined = this.props.city.book.findBuildingByCoordinate(this.props.hex);\r\n        if (building){\r\n            return this.buildingPanel(building)\r\n        } else {\r\n            return this.emptyPanel();\r\n        }\r\n    }\r\n}\r\n\r\nexport const EnterpriseTypePicker: React.FC<{\r\n    building: IBuilding,\r\n    changeEnterprise: (what: IBuilding) => void,\r\n}> = (props) => {\r\n    const b = props.building;\r\n    if (isEnterprise(b)){\r\n        const options = EnterpriseTypes.map((x) => {\r\n            return {\r\n                icon: EnterpriseTypeIcon[x],\r\n                text: x[0].toUpperCase()+x.substring(1),\r\n                value: x,\r\n                onClick: () => {\r\n                    b.enterpriseType = x;\r\n                    props.changeEnterprise(b);\r\n                }\r\n            }\r\n        })\r\n        return <Subtabs active={b.enterpriseType} options={options}></Subtabs>\r\n    } else {\r\n        return null\r\n    }\r\n}","import React, { ChangeEvent } from \"react\";\r\n\r\nexport interface StringDropdownPS{\r\n    options: Array<string>,\r\n    onChange: (key: any) => void,\r\n    hint?: string,\r\n    value?: any,\r\n    titleCase?: boolean\r\n}\r\ninterface StringDropdownS{\r\n    key: any;\r\n}\r\n\r\nexport class StringDropdown extends React.Component<StringDropdownPS, StringDropdownS> {\r\n    constructor(props: any) {\r\n        super(props);\r\n        this.state = {\r\n            key: props.value || null\r\n        }\r\n    }\r\n    onChange = (e: ChangeEvent<HTMLSelectElement>) => {\r\n        this.props.onChange(e.target.value);\r\n        this.setState({key: e.target.value})\r\n    }\r\n    hint(){\r\n        if (this.props.hint){\r\n            return <option value=\"\" disabled selected hidden>{this.props.hint}</option>\r\n        } \r\n        return undefined;\r\n    }\r\n    protected getTextForOption(data: string): string{\r\n        if (this.props.titleCase){\r\n            data = data[0].toUpperCase()+data.slice(1);\r\n        }\r\n        return data;\r\n    }\r\n    options(){\r\n        return this.props.options.map((str) => {\r\n            return <option value={str} key={str} title={this.getTitleForOption(str)}>\r\n                {this.getTextForOption(str)}\r\n            </option>\r\n        })\r\n    }\r\n    render(){\r\n        return <select onChange={this.onChange} value={this.state.key} required={this.props.hint != null}>\r\n            {this.hint()}\r\n            {this.options()}\r\n        </select>\r\n    }\r\n    protected getTitleForOption(data: string): string|undefined{\r\n        return undefined;\r\n    }\r\n}\r\n","import React, { ReactElement } from \"react\";\r\nimport { BeliefsAll, IBeliefData, SecondaryBeliefData, TraitBelief } from \"../simulation/Beliefs\";\r\nimport { ConfirmButton } from \"../widgets/ConfirmButton\";\r\nimport { StringDropdown } from \"../widgets/StringDropdown\";\r\nimport { TraitIcon } from \"../World\";\r\nimport './beliefs.css';\r\n\r\n\r\n\r\nexport const BeliefWidget: React.FC<{\r\n    data: IBeliefData,\r\n    cost?: number,\r\n    leftButton?: ReactElement,\r\n    titleView: ReactElement,\r\n    bottomView: ReactElement\r\n}> = (props) => {\r\n    return <div className=\"belief\">\r\n        <div className=\"horizontal badger\">\r\n            <div className=\"vertical\">\r\n                <div className=\"circular\">\r\n                    {props.data.icon}\r\n                </div>\r\n                {\r\n                    props.leftButton\r\n                }\r\n            </div>\r\n            <div className=\"vertical\">\r\n                <div className=\"text-center\">\r\n                    {\r\n                        props.titleView\r\n                    }\r\n                    {\r\n                        props.cost ? \r\n                        <span className=\"pull-r\">{props.cost}</span>\r\n                        : null\r\n                    }\r\n                </div>\r\n                {\r\n                props.data.description ? props.data.description.split(';').map((x, i) => \r\n                    <small className=\"marg-b-6\" key={i}> {x}\r\n                    </small>\r\n                    ) : null\r\n                }\r\n                <div className=\"grow-1 text-center\">\r\n                    {\r\n                       props.bottomView\r\n                    }\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport class EditBeliefInput extends React.Component<{\r\n    data: IBeliefData,\r\n    frozen?: boolean,\r\n    divergent?: boolean,\r\n    available: number,\r\n    cost: number,\r\n    wash: () => void\r\n}, {\r\n\r\n}>{\r\n\r\n    render(){\r\n        return <div className=\"belief\"><div className=\"horizontal badger\">\r\n            <div className=\"vertical\">\r\n                <div className=\"circular\">\r\n                    {this.props.data.icon}\r\n                </div>\r\n                {\r\n                    this.props.frozen ? null : <ConfirmButton className=\"callout pad-4 marg-0\"\r\n                        confirmText={'-'+this.props.cost.toString()+'?'} disabled={this.props.available < this.props.cost} onConfirm={this.props.wash}>\r\n                     <small>Wash</small>\r\n                    </ConfirmButton>\r\n                }\r\n            </div>\r\n            <div className=\"vertical\">\r\n                <div className=\"text-center\">\r\n                    <strong title={this.props.data.description} className={this.props.divergent ? 'divergent marg-r-6': 'marg-r-6'}>\r\n                        {this.props.data.noun}\r\n                    </strong>\r\n                    <span className=\"pull-r\">{this.props.cost}</span>\r\n                </div>\r\n                <small className=\"marg-b-6\">{this.props.data.description}</small>\r\n                <div className=\"grow-1 text-center\">\r\n                    {/* {\r\n                        RenderIdealBadges(this.props.data.idealPro || [], 'pos')\r\n                    }\r\n                    {\r\n                        RenderIdealBadges(this.props.data.idealCon || [], 'neg')\r\n                    }  */}\r\n                </div>\r\n            </div>\r\n        </div></div>\r\n    }\r\n}\r\n\r\nconst SortedBeliefs = BeliefsAll.slice().sort((a, b) => a.localeCompare(b));\r\nexport class AddBeliefInput extends React.Component<{\r\n    available: number,\r\n    cost: number,\r\n    add: (b: TraitBelief) => void\r\n}, {\r\n    belief: TraitBelief,\r\n}>{\r\n    constructor(props: any){\r\n        super(props);\r\n        this.state = {\r\n            belief: 'Neuroticism'\r\n        }\r\n    }\r\n    render(){\r\n        const data = SecondaryBeliefData[this.state.belief]\r\n        return <div className=\"belief\"><div className=\"horizontal badger add\">\r\n            <div className=\"vertical\">\r\n                <div className=\"circular\">\r\n                    {data.icon}\r\n                </div>\r\n                <ConfirmButton className=\"callout grow-0 pad-4 marg-0\" disabled={this.props.available < this.props.cost} \r\n                    confirmText={'-'+this.props.cost.toString()+'?'} onConfirm={() => this.props.add(this.state.belief)}>\r\n                     <small>Implant</small>\r\n                </ConfirmButton>\r\n            </div>\r\n            <div className=\"vertical\">\r\n                <div className=\"text-center\">                    \r\n                    <StringDropdown titleCase={true}\r\n                    options={SortedBeliefs} \r\n                    value={this.state.belief}\r\n                    onChange={(a: string) => {\r\n                        console.log(a);\r\n                        this.setState({belief: a as TraitBelief})\r\n                    }}\r\n                    ></StringDropdown>\r\n                    <span className=\"pull-r\">{this.props.cost}</span>\r\n                </div>\r\n                <small className=\"marg-b-6\">{data.description}</small>\r\n                <div className=\"grow-1 text-center\">\r\n                    {\r\n                        (data.idealPro || []).map((x) => <span className=\"pos badge align-mid\" key={x}>+{TraitIcon[x]}</span>)\r\n                    }\r\n                    {\r\n                        (data.idealCon || []).map((x) => <span className=\"neg badge align-mid\" key={x}>-{TraitIcon[x]}</span>)\r\n                    }\r\n                </div>\r\n            </div>\r\n        </div></div>\r\n    }\r\n}","import React, { useEffect, useState } from \"react\";\r\nimport { BeliefSubject, BeliefVerb, TraitBelief, SecondaryBeliefData, Belief, PrimaryBeliefData, NarrativeBeliefData, IsBeliefDivergent } from \"../simulation/Beliefs\";\r\nimport './modals.css';\r\nimport { EmoteIcon, TraitCommunity, TraitFaith, TraitIdeals, World } from \"../World\";\r\nimport { AddBeliefInput, BeliefWidget, EditBeliefInput } from \"./BeliefRow\";\r\nimport { Bean } from \"../simulation/Bean\";\r\nimport { LiveList } from \"../events/Events\";\r\nimport { BeliefInventory } from \"../simulation/Player\";\r\nimport { ConfirmButton } from \"../widgets/ConfirmButton\";\r\n\r\nexport const TraitInventoryList: React.FC<{\r\n    dogmatic: boolean,\r\n    live: LiveList<BeliefInventory>,\r\n    implant: (t: TraitBelief) => void\r\n}> = (props) => {\r\n    const [list, setList] = useState(props.live.get);\r\n    const onChange = (b: BeliefInventory[]) => {\r\n        setList(b);\r\n    };\r\n    useEffect(() => {\r\n        props.live.onChange.subscribe(onChange);\r\n        return () => props.live.onChange.unsubscribe(onChange)\r\n    });\r\n\r\n    return <>\r\n        {list.map((x) => <BeliefWidget \r\n        key={x.trait} data={SecondaryBeliefData[x.trait]} titleView={<strong>{SecondaryBeliefData[x.trait].noun}</strong>}\r\n        leftButton={\r\n            <ConfirmButton onConfirm={() => props.implant(x.trait)} className=\"callout marg-0\" confirmText=\"-1 ?\" disabled={x.charges < 1 || props.dogmatic}>\r\n                Implant\r\n            </ConfirmButton>\r\n        }\r\n        bottomView={<span>{x.charges} </span>}>\r\n        </BeliefWidget>)}\r\n    </>\r\n};\r\n\r\nexport class BrainwashingContent extends React.Component<{\r\n    world: World,\r\n    beanID: number|null,\r\n    washCommunity: (bean: Bean, c: TraitCommunity) => void,\r\n    washMotive: (bean: Bean, m: TraitIdeals) => void,\r\n    washNarrative: (bean: Bean, n: TraitFaith) => void,\r\n    washBelief: (bean: Bean, b: TraitBelief) => void,\r\n    implantBelief: (bean: Bean, b: TraitBelief) => void\r\n}, {\r\n}>{\r\n    constructor(props: any){\r\n        super(props);\r\n    }\r\n    render(){\r\n        const bean = this.props.world.beans.get.find(x => x.key == this.props.beanID);\r\n        const isScanned =  this.props.beanID && this.props.world.alien.scanned_bean[this.props.beanID];\r\n        const sanityCostBonus = this.props.world.alien.hasResearched('sanity_bonus') ? -1 : 0;\r\n        if (bean == null) return <div></div>;\r\n        const dogmatic = bean.believesIn('Dogmatism');\r\n        return <div>\r\n            <div className=\"horizontal fancy-header\">\r\n                <div>\r\n                    BRAIN\r\n                </div>\r\n                <div className=\"emoji-3\">\r\n                \r\n                </div>\r\n                <div>\r\n                    WASH\r\n                </div>\r\n            </div>\r\n            <div>\r\n                <p className=\"pad-4p\">\r\n                    <strong>{bean.name}</strong> has {bean.discrete_sanity.toFixed(0)} sanity . \r\n                    {\r\n                        bean.sanity === 'stressed' || bean.sanity === 'disturbed' ?\r\n                            <small className=\"pull-r\">(Low sanity  causes {EmoteIcon['unhappiness']}; Negative sanity  causes extremely negative traits)</small>\r\n                        : null\r\n                    }\r\n                </p>\r\n                {\r\n                    dogmatic ? <div className=\"text-center\">\r\n                         Dogmatic subjects cannot change their minds\r\n                    </div> : null\r\n                }\r\n                { isScanned ? <div className=\"horizontal scroll\">\r\n                    {/* <EditBeliefInput\r\n                        available={bean.discrete_sanity} frozen={dogmatic}\r\n                        wash={() => this.props.washCommunity(bean, bean.community)} \r\n                        cost={this.props.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity || 0}\r\n                        data={PrimaryBeliefData[bean.community]}\r\n                    ></EditBeliefInput>\r\n                    <EditBeliefInput\r\n                        available={bean.discrete_sanity}  frozen={dogmatic}\r\n                        wash={() => this.props.washMotive(bean, bean.ideals)} \r\n                        cost={this.props.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity || 0}\r\n                        data={PrimaryBeliefData[bean.ideals]}\r\n                    ></EditBeliefInput> */}\r\n                    <EditBeliefInput\r\n                        available={bean.discrete_sanity} frozen={dogmatic}\r\n                        wash={() => this.props.washNarrative(bean, bean.faith)} \r\n                        cost={this.props.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity || 0}\r\n                        data={NarrativeBeliefData[bean.faith]}\r\n                    ></EditBeliefInput>\r\n                    {\r\n                        bean.beliefs.map((b) => <EditBeliefInput key={b}\r\n                        available={bean.discrete_sanity} frozen={dogmatic && b != 'Dogmatism'}\r\n                        divergent={IsBeliefDivergent(b, this.props.world.party.ideals, this.props.world.party.community)}\r\n                        wash={() => this.props.washBelief(bean, b)} \r\n                            cost={(this.props.world.alien.difficulty.cost.bean_brain.brainwash_secondary.sanity || 0) + sanityCostBonus}\r\n                            data={SecondaryBeliefData[b]}\r\n                        >\r\n                        </EditBeliefInput>)\r\n                    }\r\n                    {/* {\r\n                        dogmatic ? null : <AddBeliefInput\r\n                            available={bean.discrete_sanity}\r\n                            add={(b) => this.props.implantBelief(bean, b)} \r\n                            cost={this.props.world.alien.difficulty.cost.bean_brain.brainimplant_secondary.sanity || 0}\r\n                        ></AddBeliefInput>\r\n                    } */}\r\n                </div> : <div className=\"text-center\"> Scan this subject to reveal its Traits! </div>}\r\n                <h3 className=\"pad-4p\">\r\n                     Trait Inventory\r\n                </h3>\r\n                <div className=\"horizontal scroll\">\r\n                    <TraitInventoryList \r\n                        live={this.props.world.alien.beliefInventory} \r\n                        dogmatic={dogmatic} \r\n                        implant={(t: TraitBelief) => this.props.implantBelief(bean, t)}></TraitInventoryList>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    }\r\n}","import React from \"react\";\r\nimport { IEvent, PubSub } from \"../events/Events\";\r\n\r\nexport class TimelyEventToggle extends React.Component<{\r\n    event: PubSub<IEvent>,\r\n    eventIcon: string,\r\n    eventClass: string\r\n}, {\r\n eventCount: number,\r\n}>{\r\n    constructor(props: any){\r\n        super(props);\r\n        this.props.event.subscribe(this.onEvent);\r\n        this.state = {\r\n            eventCount: 0\r\n        };\r\n    }\r\n    onEvent = (e: IEvent) => {\r\n        this.setState({eventCount: this.state.eventCount+1});\r\n        window.setTimeout(() => {\r\n            this.setState({\r\n                eventCount: this.state.eventCount-1\r\n            });\r\n        }, 3000);\r\n    }\r\n    render(){\r\n        return <span>\r\n            {this.state.eventCount < 1 ? this.props.children : <span className={this.props.eventClass}>{this.props.eventIcon}</span>}\r\n        </span>\r\n    }\r\n}","import React, { useEffect, useState } from \"react\";\r\nimport { LiveList } from \"../events/Events\";\r\nimport { IDifficulty } from \"../Game\";\r\nimport { SecondaryBeliefData, TraitBelief } from \"../simulation/Beliefs\";\r\nimport { MarketTraitListing } from \"../simulation/MarketTraits\";\r\nimport { BeliefInventory, Player } from \"../simulation/Player\";\r\nimport { CostSmall } from \"../widgets/CostSmall\";\r\nimport { EmoteIcon } from \"../World\";\r\n\r\n export class MarketPanel extends React.Component<{\r\n     player: Player,\r\n     market: LiveList<MarketTraitListing>,\r\n     buyEnergy: (amount: number) => void,\r\n     buyBots: (amount: number) => void,\r\n     scrubHedons: () => void,\r\n     buyTrait: (l: MarketTraitListing) => void\r\n }>{\r\n     render(){\r\n        return <div>\r\n            <div className=\"text-center\">\r\n                <strong> Galactic  Emotion  Market</strong>\r\n            </div>\r\n            <p>\r\n                <small>\r\n                    The premier exchange for , ,  and {EmoteIcon['happiness']}!\r\n                </small>\r\n            </p>\r\n            <div className=\"card-parent\">\r\n                <button className=\"card button\" onClick={() => this.props.buyEnergy(1)}\r\n                    disabled={!this.props.player.canAfford(this.props.player.difficulty.cost.market.resource.energy)}>\r\n                    +1  Energy\r\n                    <CostSmall cost={this.props.player.difficulty.cost.market.resource.energy} qty={1} ></CostSmall>\r\n                </button>\r\n                <button className=\"card button\" onClick={() => this.props.buyEnergy(5)}\r\n                    disabled={!this.props.player.canAfford(this.props.player.difficulty.cost.market.resource.energy, 5)}>\r\n                    +5  Energy\r\n                    <CostSmall cost={this.props.player.difficulty.cost.market.resource.energy} qty={5} ></CostSmall>\r\n                </button>\r\n            </div>\r\n            <div className=\"card-parent\">\r\n                <button className=\"card button\" onClick={() => this.props.buyBots(1)}\r\n                    disabled={!this.props.player.canAfford(this.props.player.difficulty.cost.market.resource.bots)}>\r\n                    +1  Bot\r\n                    <CostSmall cost={this.props.player.difficulty.cost.market.resource.bots} qty={1} ></CostSmall>\r\n                </button>\r\n                <button className=\"card button\" onClick={() => this.props.buyBots(5)}\r\n                    disabled={!this.props.player.canAfford(this.props.player.difficulty.cost.market.resource.bots, 5)}>\r\n                    +5  Bots\r\n                    <CostSmall cost={this.props.player.difficulty.cost.market.resource.bots} qty={5} ></CostSmall>\r\n                </button>\r\n            </div>\r\n            <div className=\"card-parent\">\r\n                <button className=\"card button\" onClick={() => this.props.scrubHedons()}\r\n                    disabled={this.props.player.hedons.amount >= 0 || !this.props.player.canAfford(this.props.player.difficulty.cost.market.scrubHedons)}>\r\n                    Remove  Negative Hedons\r\n                    <CostSmall cost={this.props.player.difficulty.cost.market.scrubHedons} qty={1} ></CostSmall>\r\n                </button>\r\n                {/* <button className=\"card button\" onClick={() => this.props.buyBots(5)}\r\n                    disabled={!this.props.player.canAfford(this.props.player.difficulty.cost.market.resource.bots, 5)}>\r\n                    +5  Bots\r\n                    <CostSmall cost={this.props.player.difficulty.cost.market.resource.bots} qty={5} ></CostSmall>\r\n                </button> */}\r\n            </div>\r\n            <div>\r\n                \r\n                <small>\r\n                    <i>Current  Traits for sale:</i>\r\n                </small>\r\n            </div>\r\n            <div className=\"short-scroll\">\r\n                {\r\n                    <MarketTraits hedons={this.props.player.hedons.amount} live={this.props.market} buy={this.props.buyTrait}></MarketTraits>\r\n                }\r\n            </div>\r\n        </div>\r\n     }\r\n }\r\n\r\n \r\nexport const MarketTraits: React.FC<{\r\n    live: LiveList<MarketTraitListing>,\r\n    hedons: number,\r\n    buy: (l: MarketTraitListing) => void\r\n}> = (props) => {\r\n    const [list, setList] = useState(props.live.get);\r\n    const onChange = (b: MarketTraitListing[]) => {\r\n        setList(b);\r\n    };\r\n    useEffect(() => {\r\n        props.live.onChange.subscribe(onChange);\r\n        return () => props.live.onChange.unsubscribe(onChange)\r\n    });\r\n    return <>\r\n    {\r\n    list.map((l, i) => {\r\n        const t = SecondaryBeliefData[l.trait];\r\n        const className = 'belief-name '+t.rarity;\r\n        return <div className=\"card-parent\" key={i}>\r\n            <button className=\"card button\" onClick={() => props.buy(l)} disabled={props.hedons < (l.cost.hedons || 0)}>\r\n                <span className={className}>\r\n                    {t.icon} {t.noun}\r\n                </span>\r\n                <CostSmall cost={l.cost}></CostSmall>\r\n            </button>\r\n        </div>\r\n    })\r\n    }\r\n    </>\r\n}","import { Bean } from \"../simulation/Bean\";\r\nimport React, { ReactElement } from \"react\";\r\nimport { World, TraitJob } from \"../World\";\r\nimport { BeliefsAll, IBeliefData, SecondaryBeliefData, TraitBelief } from \"../simulation/Beliefs\";\r\nimport { BeliefWidget } from \"./BeliefRow\";\r\nimport { LiveList, LiveMap } from \"../events/Events\";\r\nimport { BeliefInventory } from \"../simulation/Player\";\r\n\r\ninterface TraitsP {\r\n  seenBeliefs: LiveMap<string, boolean>,\r\n  beliefInventory: LiveList<BeliefInventory>,\r\n}\r\nexport class TraitsReport extends React.Component<TraitsP, {\r\n  hoveredTrait?: TraitBelief\r\n}> {\r\n    constructor(props: TraitsP) {\r\n      super(props);\r\n      this.state = {\r\n      }\r\n    }\r\n    render() {\r\n      const beliefs: IBeliefData[] = [];\r\n      this.props.seenBeliefs.get.forEach((val, key) => {\r\n        if (SecondaryBeliefData[key as TraitBelief] != null){\r\n          beliefs.push(SecondaryBeliefData[key as TraitBelief]);\r\n        }\r\n      });\r\n      beliefs.sort((a, b) => a.noun.localeCompare(b.noun));\r\n      return (\r\n        <div className=\"vertical\">\r\n          <div className=\"pad-4p\">\r\n            <h2>Subject  Traits</h2>\r\n          </div>\r\n          <div className=\"col-2-30-60\">\r\n            <div>\r\n              <div className=\"scroll\">\r\n                <div className=\"scoll-sticky-h\">\r\n                  <strong>Trait Inventory</strong>\r\n                </div>\r\n                {\r\n                  this.props.beliefInventory.get.length < 1 ? <div>\r\n                    No Traits! <br/>\r\n                     Brainwash your subjects  <br/>\r\n                    or buy from the  Market\r\n                    </div> : this.props.beliefInventory.get.map((x) => <div key={x.trait}>\r\n                          <div>\r\n                            <strong>\r\n                              {SecondaryBeliefData[x.trait].icon} {SecondaryBeliefData[x.trait].noun}\r\n                            </strong>\r\n                          </div>\r\n                          <div>\r\n                            This can be implanted {x.charges} more times\r\n                          </div>\r\n                        </div>)\r\n                }\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <div className=\"modal-scroll-v\">\r\n                <div className=\"sticky-t-0\">\r\n                  <strong>Discovered {beliefs.length} of {BeliefsAll.length} Traits</strong>\r\n                </div>\r\n                {\r\n                  beliefs.length < 1 ? <div>\r\n                    No Traits! <br/>\r\n                     Scan some of your subjects.\r\n                  </div> : beliefs.map((x) => <BeliefWidget key={x.noun} data={x} cost={0}\r\n                  titleView={<strong>{x.noun}</strong>}\r\n                  bottomView={<span></span>}\r\n                ></BeliefWidget>)\r\n                }\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n  }","import React from 'react';\r\nimport { EmoteIcon } from '../World';\r\n\r\nexport const GreetingPanel: React.FC = (props) => {\r\n    return <div>\r\n        <div className=\"col-2\">\r\n            <div>\r\n                <h3>Welcome to the</h3>\r\n                <h2> Alien  Utopia  Laboratory</h2>\r\n                <div>\r\n                    Thank you for joining the <select><option>Human</option></select> Cultivation Division of the <strong> Galactic Xenosensation Federation!</strong> Your interdimensional petri dish is ready for farming.\r\n                </div>\r\n                <p>\r\n                    As a <select><option>Human Emotion Farmer</option></select>, you are required to execute the following duties:\r\n                </p>\r\n                <ul>\r\n                    <li>\r\n                        Construct <strong> Buildings</strong> for your <select><option>Human</option></select> subjects.\r\n                    </li>\r\n                    <li>\r\n                        <strong> Beam In</strong> <select><option>Human</option></select> subjects for cultivation.\r\n                    </li>\r\n                    <li>\r\n                        Harvest your subject's positive <strong>{EmoteIcon['happiness']} Hedons</strong>.\r\n                    </li>\r\n                    <li>\r\n                        Sell the Hedons on the <br/><strong> Galactic  Emotion  Market</strong>.\r\n                    </li>\r\n                </ul>\r\n                <div>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                <p>\r\n                    The GXF's records indicate <select><option>Humans</option></select> are a<br/><u>mentally malleable</u> and <u>physically fragile</u> species. Try the following cultivation methods:\r\n                </p>\r\n                <ul>\r\n                    <li>\r\n                        <strong> Scan</strong> your subject's primitive minds for information on what pleases them.\r\n                    </li>\r\n                    <li>\r\n                        <strong> Brainwash</strong> subjects to change their <strong>&nbsp;Traits</strong>. Try to add Traits that emit more <strong>{EmoteIcon['happiness']}&nbsp;Hedons</strong>.\r\n                    </li>\r\n                    <li>\r\n                        Avoid letting your subjects die or endure pain; this makes <strong>{EmoteIcon['unhappiness']}&nbsp;Antihedons</strong> which are less profitable.\r\n                    </li>\r\n                    <li>\r\n                        Use your knowledge of Traits to modify the farm's <strong>&nbsp;Government</strong> to maximize Hedon generation.\r\n                    </li>\r\n                    <li>\r\n                        Use the GXF's <strong> Research Lab</strong> to upgrade your farm, when stocked with <strong> Abducted</strong> subjects.\r\n                    </li>\r\n                </ul>\r\n                <h3>\r\n                     Galactic Xenosensation Federation <br/>\r\n                    <div className=\"text-right\">\r\n                        <small>\r\n                        {/* <i>THE market leader in corporeal sensations.</i> */}\r\n                        <i>1 trillion sensations. 100% organic. 100% gourmet.</i>\r\n                        </small>\r\n                    </div>\r\n                </h3>\r\n            </div>\r\n        </div>\r\n    </div>\r\n}","import React from 'react';\r\nimport './App.css';\r\nimport './chrome/chrome.css';\r\nimport { World, TraitGood, Trait, TraitCommunity, TraitIdeals, TraitFaith } from './World';\r\nimport { GenerateWorld, GeneratePartyHQ, GenerateBuilding, GenerateBean, GetRandom } from './WorldGen';\r\nimport { Modal } from './widgets/Modal';\r\nimport { OverviewPanel } from './right-panel/OverviewPanel';\r\nimport { Bean } from './simulation/Bean';\r\nimport { WorldTile } from './petri-ui/WorldTile';\r\nimport { EconomyReport } from './modal-content/EconomyReport';\r\nimport { CharityPanel } from './modal-content/CharityPanel';\r\nimport { PoliticalEffect, Policy, CityPartyHQ, IPolicy } from './simulation/Politics';\r\nimport { EventsPanel } from './right-panel/Events';\r\nimport { BeanPanel } from './right-panel/BeanPanel';\r\nimport { FoundParty, FoundPartyS } from './modal-content/FoundParty';\r\nimport { PartyOverview } from './modal-content/PartyOverview';\r\nimport { BubbleNumberText, BubbleSeenTraitsText } from './widgets/BubbleText';\r\nimport { Season, Now, Hour } from './simulation/Time';\r\nimport { SocialGraph } from './widgets/SocialGraph';\r\nimport { CapsuleLabel } from './widgets/CapsuleLabel';\r\n\r\n\r\nimport { TransformWrapper, TransformComponent } from \"react-zoom-pan-pinch\";\r\nimport { GoalsPanel } from './right-panel/Goals';\r\nimport { CampaignsPanel } from './modal-content/Campaigns';\r\nimport { GovernmentPanel } from './modal-content/Gov';\r\nimport { ResearchPanel } from './modal-content/Research';\r\nimport { GeoNetworkButtons, StopPlayFastButtons } from './widgets/StopPlayFast';\r\nimport { BuildingTypes, HexPoint, IBuilding, Point, transformPoint } from './simulation/Geography';\r\nimport { HexPanel } from './right-panel/HexPanel';\r\nimport { City, UFO } from './simulation/City';\r\nimport { BrainwashingContent } from './modal-content/Brainwashing';\r\nimport { SecondaryBeliefData, TraitBelief } from './simulation/Beliefs';\r\nimport { TimelyEventToggle } from './widgets/TimelyEventToggle';\r\nimport { LawAxis, LawKey } from './simulation/Government';\r\nimport { Tech } from './simulation/Player';\r\nimport { IEvent } from './events/Events';\r\nimport { WorldSound } from './WorldSound';\r\nimport { MarketPanel } from './right-panel/MarketPanel';\r\nimport { TraitsReport } from './modal-content/TraitsReport';\r\nimport { GreetingPanel } from './modal-content/GreetingPanel';\r\nimport { MarketTraitListing } from './simulation/MarketTraits';\r\n\r\nexport const keyToName: { [key in Trait | BuildingTypes]: string } = {\r\n  state: 'Collectivist', ego: 'Independent',\r\n  trad: 'Elitist', prog: 'Progressive',\r\n  circle: 'Brunette', square: 'Blonde', triangle: 'Redhead',\r\n  rocket: 'Futuristic', dragon: 'Mythical', music: 'Dramatic', noFaith: 'Nihilistic',\r\n  starving: 'Starving', hungry: 'Hungry', sated: 'Sated', stuffed: 'Stuffed',\r\n  homeless: 'Homeless', sleepy: 'Sleepy', awake: 'Awake', rested: 'Rested',\r\n  sick: 'Sick', sickly: 'Sickly', bruised: 'Bruised', fresh: 'Robust',\r\n  sane: 'Sane', stressed: 'Confused', disturbed: 'Disturbed', 'psychotic': 'Psychotic',\r\n  house: 'House', hospital: 'Hospital', farm: 'Farm', theater: 'Theater', church: 'Church', courthouse: 'Courthouse', park: 'Park', nature: 'Elysian Scenery'\r\n};\r\n\r\nexport type ModalView = 'greeting' | 'economy' | 'campaign' | 'party_creation' | 'gov' | 'polisci' | 'brainwash' | 'traits';\r\ninterface AppPs {\r\n}\r\ninterface AppState {\r\n  world: World,\r\n  activeCityID: number | null;\r\n  activeBeanID: number | null;\r\n  activeHex: HexPoint | null;\r\n  activeModal: ModalView | null;\r\n  activeMain: 'geo' | 'network';\r\n  activeRightPanel: 'events' | 'overview' | 'goals' | 'market';\r\n  timeScale: number;\r\n  spotlightEvent: IEvent | undefined;\r\n  cursor?: Point;\r\n}\r\nexport const SfxContext = React.createContext<WorldSound|undefined>(undefined);\r\n\r\nconst LogicTickMS = 2000;\r\nconst SpotlightDurationTimeMS = 5000;\r\nconst ChargePerWash = 3;\r\nconst ChargePerMarket = 3;\r\nclass App extends React.Component<AppPs, AppState>{\r\n  constructor(props: AppPs) {\r\n    super(props);\r\n    this.state = {\r\n      world: GenerateWorld(),\r\n      activeCityID: null,\r\n      activeBeanID: null,\r\n      activeHex: null,\r\n      activeMain: 'geo',\r\n      activeModal: 'greeting',\r\n      activeRightPanel: 'overview',\r\n      timeScale: 0,\r\n      spotlightEvent: undefined\r\n    };\r\n    this.state.world.calculateComputedState();\r\n    this.state.world.bus.death.subscribe(this.onDeath);\r\n    this.state.world.bus.persuasion.subscribe(() => this.state.world.sfx.play('mhmm'));\r\n  }\r\n  private previousTimeMS: DOMHighResTimeStamp = 0;\r\n  private logicTickAccumulatorMS: number = 0;\r\n  componentDidMount() {\r\n    document.addEventListener(\"keyup\", this.keyupHandler, false);\r\n    window.requestAnimationFrame((time: DOMHighResTimeStamp) => {\r\n      this.previousTimeMS = time;\r\n      window.requestAnimationFrame(this.tick);\r\n    });\r\n  }\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"keyup\", this.keyupHandler);\r\n  }\r\n  tick = (timeMS: DOMHighResTimeStamp) => {\r\n    // Compute the delta-time against the previous time\r\n    const deltaTimeMS = (timeMS - this.previousTimeMS) * this.state.timeScale;\r\n\r\n    // Update the previous time\r\n    this.previousTimeMS = timeMS;\r\n    if (deltaTimeMS > 0) {\r\n      this.logicTickAccumulatorMS += deltaTimeMS;\r\n      this.state.world.simulate_beans(deltaTimeMS);\r\n      this.state.world.simulate_pickups(deltaTimeMS);\r\n\r\n      if (this.logicTickAccumulatorMS > LogicTickMS) {\r\n        this.state.world.simulate_world();\r\n        this.setState({ world: this.state.world });\r\n        this.logicTickAccumulatorMS = 0;\r\n      }\r\n    }\r\n    window.requestAnimationFrame(this.tick);\r\n  }\r\n  cheatMode: boolean = false;\r\n  keyupHandler = (event: KeyboardEvent) => {\r\n    if (event.key === ' ') {\r\n      if (this.state.timeScale > 0) {\r\n        this.setState({ timeScale: 0 });\r\n      } else {\r\n        this.setState({ timeScale: 1 });\r\n      }\r\n    } else if (event.key === 'Escape') {\r\n      this.setState({activeModal: null});\r\n    } else if (this.cheatMode && event.key === 'B') {\r\n      this.state.world.alien.energy.amount += (this.state.world.alien.difficulty.cost.hex.beam.energy || 0);\r\n      this.beam(this.state.world.cities[0], { q: 0, r: 0 });\r\n    } else if (this.cheatMode && event.key === 'Q') {\r\n      if (this.state.world.cities[0].book.getBuildings().filter(x => x.type === 'farm').length < 1){\r\n        this.state.world.alien.energy.amount += this.state.world.alien.difficulty.cost.emptyHex.build.farm.energy || 0;\r\n        this.state.world.alien.bots.amount += this.state.world.alien.difficulty.cost.emptyHex.build.farm.bots || 0;\r\n        this.build(this.state.world.cities[0], { q: 1, r: 1 }, 'farm');\r\n        this.state.world.alien.energy.amount += this.state.world.alien.difficulty.cost.emptyHex.build.house.energy || 0;\r\n        this.state.world.alien.bots.amount += this.state.world.alien.difficulty.cost.emptyHex.build.house.bots || 0;\r\n        this.build(this.state.world.cities[0], { q: 1, r: 0 }, 'house');\r\n        this.state.world.alien.energy.amount += this.state.world.alien.difficulty.cost.emptyHex.build.hospital.energy || 0;\r\n        this.state.world.alien.bots.amount += this.state.world.alien.difficulty.cost.emptyHex.build.hospital.bots || 0;\r\n        this.build(this.state.world.cities[0], { q: 0, r: 1 }, 'hospital');\r\n      }\r\n      this.state.world.alien.energy.amount += (this.state.world.alien.difficulty.cost.hex.beam.energy || 0) * 4;\r\n      this.beam(this.state.world.cities[0], { q: 0, r: 0 });\r\n      this.beam(this.state.world.cities[0], { q: 1, r: 0 });\r\n      this.beam(this.state.world.cities[0], { q: 0, r: 1 });\r\n      this.beam(this.state.world.cities[0], { q: 1, r: 1 });\r\n      this.setState({activeModal: null});\r\n    } else if (this.cheatMode && event.key === 'S') {\r\n      this.state.world.beans.get.forEach((b) => {\r\n        if (this.state.world.alien.difficulty.cost.bean.scan.energy){\r\n          if (this.state.world.alien.energy.amount < this.state.world.alien.difficulty.cost.bean.scan.energy)\r\n            this.state.world.alien.energy.amount += this.state.world.alien.difficulty.cost.bean.scan.energy;\r\n        }\r\n        this.scan(b);\r\n      });\r\n    }\r\n    this.cheatMode = event.shiftKey && event.key === 'C';\r\n  }\r\n  foundParty = (state: FoundPartyS) => {\r\n    this.state.world.party.name = state.name;\r\n    this.state.world.party.slogan = state.slogan;\r\n    this.state.world.cities[0].name = state.name;\r\n    if (state.community)\r\n      this.state.world.party.community = state.community;\r\n    if (state.ideal)\r\n      this.state.world.party.ideals = state.ideal;\r\n    const city = this.state.world.cities.find((x) => x.key == state.cityKey);\r\n    if (city) {\r\n      GeneratePartyHQ(city, this.state.world.party);\r\n    }\r\n    this.state.world.calculateComputedState();\r\n    this.setState({\r\n      world: this.state.world,\r\n      activeModal: null\r\n    });\r\n  }\r\n  get difficulty() {\r\n    return this.state.world.alien.difficulty;\r\n  }\r\n  build = (city: City, where: HexPoint, what: BuildingTypes) => {\r\n    const cost = this.difficulty.cost.emptyHex.build[what];\r\n    if (this.state.world.alien.canAfford(cost)) {\r\n      this.state.world.alien.purchase(cost);\r\n      GenerateBuilding(city, what, where, city.economy);\r\n    }\r\n\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  changeEnterprise = (city: City, what: IBuilding) => {\r\n    \r\n    this.setState({ world: this.state.world });\r\n  }\r\n  fireBean = (city: City, beanKey: number) => {\r\n    const b = city.beans.get.find(x => x.key === beanKey);\r\n    if (b){\r\n      city.unsetJob(b);\r\n      this.setState({ world: this.state.world });\r\n    }\r\n  }\r\n  upgrade = (city: City, what: IBuilding) => {\r\n    const cost = this.difficulty.cost.hex.upgrade;\r\n    if (this.state.world.alien.tryPurchase(cost)) {\r\n      what.upgraded = true;\r\n    }\r\n\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  beam = (city: City, where: HexPoint) => {\r\n    const cost = this.difficulty.cost.hex.beam;\r\n    if (this.state.world.alien.canAfford(cost)) {\r\n      this.state.world.alien.purchase(cost);\r\n      const newUFO = new UFO(city.ufos.length, where, 'beam-in');\r\n      city.ufos.push(newUFO);\r\n      window.setTimeout(() => {\r\n        city.beans.push(GenerateBean(city, where));\r\n        this.setState({ world: this.state.world });\r\n      }, 3000);\r\n\r\n      this.setState({ world: this.state.world }, () => {\r\n        this.removeUFO(city, newUFO.key);\r\n      });\r\n    }\r\n  }\r\n  buyBots = (amount: number) => {\r\n    const cost = this.difficulty.cost.market.resource.bots;\r\n    if (this.state.world.alien.tryPurchase(cost, amount)) {\r\n      this.state.world.alien.bots.amount += amount;\r\n      this.state.world.alien.bots.change.publish({change:amount});\r\n    }\r\n\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  buyEnergy = (amount: number) => {\r\n    const cost = this.difficulty.cost.market.resource.bots;\r\n    if (this.state.world.alien.tryPurchase(cost, amount)) {\r\n      this.state.world.alien.energy.amount += amount;\r\n      this.state.world.alien.energy.change.publish({change:amount});\r\n    }\r\n\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  scrubHedons = () => {\r\n    const cost = this.difficulty.cost.market.scrubHedons;\r\n    if (this.state.world.alien.tryPurchase(cost)) {\r\n      const old = this.state.world.alien.hedons.amount;\r\n      this.state.world.alien.hedons.amount = 0;\r\n      this.state.world.alien.hedons.change.publish({change: -old});\r\n    }\r\n\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  buyTrait = (l: MarketTraitListing) => {\r\n    if (this.state.world.alien.tryPurchase(l.cost)) {\r\n      \r\n      const existing = this.state.world.alien.beliefInventory.get.find((x) => x.trait === l.trait);\r\n      if (existing) {\r\n        existing.charges += ChargePerMarket;\r\n        this.state.world.alien.beliefInventory.set([...this.state.world.alien.beliefInventory.get]);\r\n      } else\r\n        this.state.world.alien.beliefInventory.push({trait: l.trait, charges: ChargePerMarket});\r\n    }\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  removeUFO(city: City, key: number) {\r\n    window.setTimeout(() => {\r\n      const myUFOI = city.ufos.findIndex((x) => x.key === key);\r\n      if (myUFOI > -1)\r\n        city.ufos.splice(myUFOI, 1);\r\n    }, 7000);\r\n  }\r\n  foundCharity = (good: TraitGood, name: string, budget: number) => {\r\n    this.state.world.addCharity(good, name, budget);\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  vaporize = (bean: Bean) => {\r\n    if (this.state.world.alien.tryPurchase(this.state.world.alien.difficulty.cost.bean.vaporize)) {\r\n      if (bean.city) {\r\n        bean.die('vaporization');\r\n      }\r\n      this.setState({ world: this.state.world });\r\n    }\r\n  }\r\n  abduct = (bean: Bean) => {\r\n    if (this.state.world.alien.tryPurchase(this.state.world.alien.difficulty.cost.bean.abduct)) {\r\n      bean.abduct(this.state.world.alien);\r\n      bean.city?.beans.remove(bean);\r\n      this.setState({ world: this.state.world });\r\n    }\r\n  }\r\n  enactLaw = (law: LawKey) => {\r\n    this.state.world.law.enact(law);\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  revokeLaw = (law: LawKey) => {\r\n    this.state.world.law.enact(law);\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  releaseBean = () => {\r\n    if (this.state.world.alien.abductedBeans.length > 0) {\r\n      const lucky_bean = this.state.world.alien.abductedBeans.shift();\r\n      if (lucky_bean instanceof Bean) {\r\n        lucky_bean.lifecycle = 'alive';\r\n        lucky_bean.city?.beans.push(lucky_bean);\r\n      } else {\r\n        window.alert(\"releasing data beans is unimplemented\");\r\n      }\r\n    }\r\n  }\r\n  setResearch = (t: Tech) => {\r\n    this.state.world.alien.currentlyResearchingTech = t;\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  scan = (bean: Bean) => {\r\n    if (this.state.world.alien.tryPurchase(this.state.world.alien.difficulty.cost.bean.scan)) {\r\n      this.state.world.alien.scanned_bean[bean.key] = true;\r\n      bean.beliefs.forEach((b) => {\r\n        if (!this.state.world.alien.seenBeliefs.get.has(b)){\r\n          this.state.world.alien.seenBeliefs.add(b, true);\r\n        }\r\n      });\r\n      this.state.world.sfx.play('scan');\r\n      this.setState({ world: this.state.world });\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n  washCommunity = (bean: Bean, a: TraitCommunity) => {\r\n    if (bean.canPurchase(this.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal, 0)) {\r\n      bean.loseSanity(this.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity || 0);\r\n      if (bean.community === 'ego')\r\n        bean.community = 'state';\r\n      else bean.community = 'ego';\r\n      this.setState({ world: this.state.world });\r\n      return true;\r\n    }\r\n  }\r\n  washMotive = (bean: Bean, a: TraitIdeals) => {\r\n    if (bean.canPurchase(this.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal, 0)) {\r\n      bean.loseSanity(this.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity || 0);\r\n      if (bean.ideals === 'prog')\r\n        bean.ideals = 'trad';\r\n      else bean.ideals = 'prog';\r\n      this.setState({ world: this.state.world });\r\n      return true;\r\n    }\r\n  }\r\n  washNarrative = (bean: Bean, a: TraitFaith) => {\r\n    if (bean.canPurchase(this.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal, 0)) {\r\n      bean.loseSanity(this.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity || 0);\r\n      const oldFaith = bean.faith;\r\n      while (bean.faith === oldFaith)\r\n        bean.faith = GetRandom(['rocket', 'dragon', 'music', 'noFaith']);\r\n      this.setState({ world: this.state.world });\r\n      return true;\r\n    }\r\n  }\r\n  washBelief = (bean: Bean, a: TraitBelief) => {\r\n    const sanityCostBonus = this.state.world.alien.hasResearched('sanity_bonus') ? -1 : 0;\r\n    if (bean.canPurchase(this.state.world.alien.difficulty.cost.bean_brain.brainwash_secondary, sanityCostBonus)) {\r\n      bean.loseSanity(this.state.world.alien.difficulty.cost.bean_brain.brainwash_secondary.sanity || 0);\r\n      bean.beliefs.splice(\r\n        bean.beliefs.indexOf(a), 1\r\n      );\r\n      const existing = this.state.world.alien.beliefInventory.get.find((x) => x.trait === a);\r\n      const chargeBonus = this.state.world.alien.hasResearched('neural_duplicator') ? 1 : 0;\r\n      if (existing) {\r\n        existing.charges += ChargePerWash + chargeBonus;\r\n        this.state.world.alien.beliefInventory.set([...this.state.world.alien.beliefInventory.get]);\r\n      } else\r\n        this.state.world.alien.beliefInventory.push({trait: a, charges: ChargePerWash + chargeBonus});\r\n      this.state.world.sfx.play('wash_out');\r\n      this.setState({ world: this.state.world });\r\n      return true;\r\n    }\r\n  }\r\n  implantBelief = (bean: Bean, a: TraitBelief) => {\r\n    const sanityCostBonus = this.state.world.alien.hasResearched('sanity_bonus') ? -1 : 0;\r\n    if (bean.canPurchase(this.state.world.alien.difficulty.cost.bean_brain.brainimplant_secondary, sanityCostBonus) && \r\n      this.state.world.alien.beliefInventory.get.filter(x => x.trait == a && x.charges > 0)) {\r\n      bean.beliefs.push(a);\r\n      this.state.world.alien.useCharge(a);\r\n      this.state.world.sfx.play('wash_in');\r\n      bean.loseSanity(this.state.world.alien.difficulty.cost.bean_brain.brainimplant_secondary.sanity || 0);\r\n      this.setState({ world: this.state.world });\r\n      return true;\r\n    }\r\n  }\r\n  setPolicy = (axis: LawAxis, policy: IPolicy) => {\r\n    this.state.world.party.platform[axis] = policy;\r\n    this.state.world.calculateComputedState();\r\n    this.setState({ world: this.state.world });\r\n  }\r\n  onDeath = (event: IEvent) => {\r\n    this.state.world.sfx.play('death');\r\n    this.startSpotlight(event);\r\n  }\r\n  private timescaleBeforeSpotlight: number = 1;\r\n  startSpotlight(event: IEvent) {\r\n    this.timescaleBeforeSpotlight = this.state.timeScale;\r\n    this.setState({\r\n      spotlightEvent: event,\r\n      timeScale: 0\r\n    }, () => {\r\n      setTimeout(() => this.endSpotlight(), SpotlightDurationTimeMS);\r\n    });\r\n  }\r\n  endSpotlight() {\r\n    this.setState({\r\n      timeScale: this.timescaleBeforeSpotlight,\r\n      spotlightEvent: undefined\r\n    });\r\n  }\r\n  getPanel() {\r\n    switch (this.state.activeRightPanel) {\r\n      case 'overview':\r\n        if (this.state.activeCityID == null) {\r\n          return <OverviewPanel beans={this.state.world.beans} utopia={this.state.world.party} clearCity={() => this.setState({ activeCityID: null })} alien={this.state.world.alien}></OverviewPanel>\r\n        } else {\r\n          const city = this.state.world.cities.find((x) => x.key == this.state.activeCityID);\r\n          if (city) {\r\n\r\n            if (this.state.activeHex != null) {\r\n              return <HexPanel city={city} hex={this.state.activeHex} difficulty={this.state.world.alien.difficulty}\r\n                clearHex={() => this.setState({ activeHex: null })}\r\n                beam={(where) => this.beam(city, where)}\r\n                upgrade={(what) => this.upgrade(city, what)}\r\n                build={(where, what) => { this.build(city, where, what) }}\r\n                changeEnterprise={(what) => this.changeEnterprise(city, what)}\r\n                fire={(beanKey) => this.fireBean(city, beanKey)}\r\n                ></HexPanel>\r\n            }\r\n            else if (this.state.activeBeanID != null) {\r\n              const bean = city.beans.get.find((y) => y.key == this.state.activeBeanID);\r\n              if (bean)\r\n                return <BeanPanel bean={bean} city={city} alien={this.state.world.alien}\r\n                  economy={this.state.world.economy} party={this.state.world.party} bus={this.state.world.bus} law={this.state.world.law}\r\n                  scan={this.scan} vaporize={this.vaporize}\r\n                  brainwash={() => this.setState({ activeModal: 'brainwash' })}\r\n                  abduct={this.abduct}\r\n                  gift={() => this.setState({ activeModal: 'brainwash' })}\r\n                  clearCity={() => this.setState({ activeCityID: null, activeBeanID: null })}></BeanPanel>\r\n            }\r\n\r\n            return <OverviewPanel beans={city?.beans} utopia={this.state.world.party} city={city} clearCity={() => this.setState({ activeCityID: null })} alien={this.state.world.alien}></OverviewPanel>\r\n          }\r\n          else\r\n            return <div>\r\n            </div>\r\n        }\r\n      case 'goals':\r\n        return <GoalsPanel player={this.state.world.alien} progress={this.state.world.alien}></GoalsPanel>\r\n      case 'events':\r\n        return <EventsPanel events={this.state.world.bus.buffer} selectBean={(beankey?: number) => {\r\n          if (beankey)\r\n            this.setState({ activeCityID: this.state.world.cities[0].key, activeBeanID: beankey, activeHex: null, activeRightPanel: 'overview' })\r\n        }}></EventsPanel>\r\n      case 'market': \r\n        return <MarketPanel buyEnergy={this.buyEnergy} buyBots={this.buyBots} scrubHedons={this.scrubHedons} buyTrait={this.buyTrait}\r\n         player={this.state.world.alien} market={this.state.world.marketTraitsForSale}></MarketPanel>\r\n    }\r\n  }\r\n  renderGeo() {\r\n    const COL = this.state.world.economy.getCostOfLiving();\r\n    return this.state.world.cities.map((t) => {\r\n      return (\r\n        <WorldTile tile={t} city={t} costOfLiving={COL} key={t.key} spotlightEvent={this.state.spotlightEvent} activeBeanID={this.state.activeBeanID}\r\n          onClick={() => this.setState({ activeCityID: t.key, activeRightPanel: 'overview', activeHex: null, activeBeanID: null })}\r\n          onBeanClick={(b) => this.setState({ activeCityID: t.key, activeRightPanel: 'overview', activeHex: null, activeBeanID: b.key })}\r\n          onHexClick={(hex) => { this.setState({ activeCityID: t.key, activeHex: hex, activeBeanID: null, activeRightPanel: 'overview' }) }}\r\n        ></WorldTile>\r\n      )\r\n    });\r\n  }\r\n  render() {\r\n    const season = Season[this.state.world.date.season];\r\n    return (\r\n      <div className=\"canvas\"><SfxContext.Provider value={this.state.world.sfx}>\r\n        {\r\n          this.state.activeMain === 'network' ? <div className=\"canvas\">\r\n            {/* <div className=\"horizontal max-w-500 m-t-2em\">\r\n              <button type=\"button\">\r\n                 Influence\r\n              </button>\r\n              <button type=\"button\">\r\n                 Party Preference\r\n              </button>\r\n              <button type=\"button\">\r\n                 Demographics\r\n              </button>\r\n            </div> */}\r\n            <SocialGraph costOfLiving={this.state.world.economy.getCostOfLiving()} scanned_beans={this.state.world.alien.scanned_bean}\r\n              beans={this.state.world.beans} city={this.state.world.cities[0]}\r\n              onClickBuilding={(b) => this.setState({ activeCityID: this.state.world.cities[0].key, activeHex: b.address, activeBeanID: null, activeRightPanel: 'overview' })}\r\n              onClick={(b) => this.setState({ activeCityID: b.cityKey, activeRightPanel: 'overview', activeBeanID: b.key, activeHex: null })} ></SocialGraph>\r\n          </div> : <TransformWrapper\r\n            defaultScale={1}\r\n            wheel={{ step: 48 }}>\r\n            <TransformComponent>\r\n              <div className=\"world\">\r\n                {this.renderGeo()}\r\n              </div>\r\n            </TransformComponent>\r\n          </TransformWrapper>\r\n        }\r\n        <div className=\"overlay\">\r\n          <Modal show={this.state.activeModal == 'greeting'} onClick={() => this.setState({ activeModal: null })}>\r\n            <GreetingPanel></GreetingPanel>\r\n          </Modal>\r\n          <Modal show={this.state.activeModal == 'party_creation'} onClick={() => this.setState({ activeModal: null })} hideCloseButton={true}>\r\n            <FoundParty cities={this.state.world.cities} onFound={this.foundParty}></FoundParty>\r\n          </Modal>\r\n          <Modal show={this.state.activeModal == 'gov'} onClick={() => this.setState({ activeModal: null })}>\r\n            <GovernmentPanel world={this.state.world} enactLaw={this.enactLaw} revokeLaw={this.revokeLaw}></GovernmentPanel>\r\n          </Modal>\r\n          <Modal show={this.state.activeModal == 'polisci'} onClick={() => this.setState({ activeModal: null })}>\r\n            <ResearchPanel release={this.releaseBean} setResearch={this.setResearch} player={this.state.world.alien}></ResearchPanel>\r\n          </Modal>\r\n          <Modal show={this.state.activeModal == 'campaign'} onClick={() => this.setState({ activeModal: null })}>\r\n            <CampaignsPanel></CampaignsPanel>\r\n          </Modal>\r\n          <Modal show={this.state.activeModal == 'economy'} onClick={() => this.setState({ activeModal: null })}>\r\n            {(this.state.activeModal == 'economy' ? <EconomyReport world={this.state.world}></EconomyReport> : '')}\r\n          </Modal>\r\n          <Modal show={this.state.activeModal == 'traits'} onClick={() => this.setState({ activeModal: null })}>\r\n            <TraitsReport seenBeliefs={this.state.world.alien.seenBeliefs} beliefInventory={this.state.world.alien.beliefInventory}\r\n            ></TraitsReport>\r\n          </Modal>\r\n          <Modal show={this.state.activeModal == 'brainwash'} onClick={() => this.setState({ activeModal: null })}>\r\n            {(this.state.activeModal == 'brainwash' ? <BrainwashingContent\r\n              world={this.state.world} beanID={this.state.activeBeanID}\r\n              washCommunity={this.washCommunity}\r\n              washMotive={this.washMotive}\r\n              washNarrative={this.washNarrative}\r\n              washBelief={this.washBelief}\r\n              implantBelief={this.implantBelief}>\r\n            </BrainwashingContent> : '')}\r\n          </Modal>\r\n          <div className=\"left\">\r\n            <div className=\"top\">\r\n              <span> Alien  Utopia  Lab</span>\r\n              <span>&nbsp;Year {this.state.world.date.year},&nbsp;{season} {this.state.world.date.day} {this.renderHour()}</span>\r\n              <StopPlayFastButtons timeScale={this.state.timeScale} setTimeScale={(n: number) => { this.setState({ timeScale: n }) }}></StopPlayFastButtons>\r\n              <GeoNetworkButtons setActiveMain={(v) => this.setState({ activeMain: v })} activeMain={this.state.activeMain} ></GeoNetworkButtons>\r\n              <span></span>\r\n            </div>\r\n            <div className=\"bottom\">\r\n              <BubbleNumberText changeEvent={this.state.world.alien.energy.change} icon=\"\">\r\n                <CapsuleLabel icon=\"\" label=\"Energy\">\r\n                  {this.state.world.alien.energy.amount.toFixed(1)}\r\n                </CapsuleLabel>\r\n              </BubbleNumberText>\r\n              <BubbleNumberText changeEvent={this.state.world.alien.bots.change} icon=\"\">\r\n                <CapsuleLabel icon=\"\" label=\"Bots\">\r\n                  {this.state.world.alien.bots.amount.toFixed(1)}\r\n                </CapsuleLabel>\r\n              </BubbleNumberText>\r\n              <BubbleNumberText changeEvent={this.state.world.alien.hedons.change} icon=\"\">\r\n                <CapsuleLabel icon=\"\" label=\"Hedons\">\r\n                  {this.state.world.alien.hedons.amount.toFixed(0)}\r\n                </CapsuleLabel>\r\n              </BubbleNumberText>\r\n              {/* <BubbleText changeEvent={this.state.world.alien.tortrons.change} icon=\"\">\r\n                <CapsuleLabel icon=\"\" label=\"Tortrons\">\r\n                  {this.state.world.alien.tortrons.amount.toFixed(0)}\r\n                </CapsuleLabel>\r\n              </BubbleText> */}\r\n              <span>\r\n                <button type=\"button\" className=\"callout\" onClick={() => this.setState({ activeModal: 'economy' })}> State of the Utopia</button>\r\n                <button type=\"button\" className=\"callout\" onClick={() => this.setState({ activeModal: 'gov' })}> Gov</button>\r\n                <button type=\"button\" className=\"callout\" onClick={() => this.setState({ activeModal: 'polisci' })}> Research</button>\r\n                \r\n                <BubbleSeenTraitsText changeEvent={this.state.world.alien.seenBeliefs.onAdd} icon=\"\">\r\n                  <button type=\"button\" className=\"callout\" onClick={() => this.setState({ activeModal: 'traits' })}> Traits</button>\r\n                </BubbleSeenTraitsText>\r\n                {/* <button type=\"button\" onClick={() => this.setState({activeModal:'campaign'})}>Campaigns</button> */}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div className=\"right\">\r\n            <div className=\"full-width-tabs\">\r\n              <button onClick={() => this.setState({ activeRightPanel: 'overview' })}> Info</button>\r\n              <button onClick={() => this.setState({ activeRightPanel: 'market' })}> Market</button>\r\n              <button onClick={() => this.setState({ activeRightPanel: 'events' })}>\r\n                <TimelyEventToggle event={this.state.world.bus.speechcrime} eventIcon=\"\" eventClass=\"police-siren\"></TimelyEventToggle> Events\r\n              </button>\r\n              <button onClick={() => this.setState({ activeRightPanel: 'goals' })}> Goals</button>\r\n            </div>\r\n            <div className=\"right-panel\">\r\n              {this.getPanel()}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        </SfxContext.Provider></div>\r\n    )\r\n  }\r\n  renderHour(): string {\r\n    switch (this.state.world.date.hour) {\r\n      default: return '';\r\n      case Hour.Evening: return '';\r\n      case Hour.Morning: return '';\r\n      case Hour.Midnight: return '';\r\n    }\r\n  }\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}