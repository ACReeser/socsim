(this.webpackJsonpsocsim=this.webpackJsonpsocsim||[]).push([[0],[,,,,,,,,,,,,,,,,function(e,t,a){e.exports=a(32)},,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(15),s=a.n(r),o=(a(21),a(8)),l=a(1),c=a(2),u=a(4),h=a(3),d=(a(22),a(23),a(9)),m=function(){function e(t){Object(l.a)(this,e),this.onPublish=t,this.callbacks=[]}return Object(c.a)(e,[{key:"publish",value:function(e){this.onPublish&&this.onPublish(e),this.callbacks.forEach((function(t){return t(e)}))}},{key:"subscribe",value:function(e){this.callbacks.push(e)}},{key:"unsubscribe",value:function(e){this.callbacks.splice(this.callbacks.indexOf(e),1)}}]),e}(),p=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return a}(m),f=function e(){var t=this;Object(l.a)(this,e),this.buffer=[],this.sendToBuffer=function(e){t.buffer.length>20&&t.buffer.pop(),t.buffer.unshift(e)},this.speechcrime=new m(this.sendToBuffer),this.nojobslots=new m(this.sendToBuffer),this.birth=new m(this.sendToBuffer),this.death=new m(this.sendToBuffer),this.marketrefresh=new m(this.sendToBuffer)},y=function(){function e(t){Object(l.a)(this,e),this.current=t,this.onChange=new m}return Object(c.a)(e,[{key:"set",value:function(e){this.current=e,this.onChange.publish(e)}},{key:"get",get:function(){return this.current}}]),e}(),b=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).onPush=new m,e}return Object(c.a)(a,[{key:"push",value:function(e){this.set([].concat(Object(o.a)(this.get),[e])),this.onPush.publish(e)}},{key:"remove",value:function(e){var t=this.get,a=t.indexOf(e);a>-1&&(t.splice(a,1),this.set(Object(o.a)(t)))}}]),a}(y),v=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).onAdd=new m,e}return Object(c.a)(a,[{key:"add",value:function(e,t){var a=new Map(this.current);a.set(e,t),this.set(a),this.onAdd.publish({k:e,v:t})}},{key:"remove",value:function(e){var t=new Map(this.current);t.delete(e),this.set(t)}},{key:"at",value:function(e){return this.current.get(e)}}]),a}(y),g=a(7),E=a(11),k=a(6),w=["company","cooperative","commune"],j={company:"\ud83c\udfa9",cooperative:"\ud83e\udd1d",commune:"\u2692\ufe0f"};function C(e){return void 0!=e.key&&void 0!=e.enterpriseType}var x=function(){function e(){Object(l.a)(this,e),this.key=0,this.name="",this.institutionKey=1,this.cash=0,this.ticksSinceLastSale=0,this.seasonalBudget=0,this.good="food",this.parentInstitution=null,this.beansHelped=0,this.inventory=0}return Object(c.a)(e,[{key:"work",value:function(e,t){for(;this.cash>0&&this.inventory<10;){if(!t.tryTransact(this,this.good))break}}}]),e}();function S(e,t,a){return Math.max(Math.min(e,a),t)}var N=function e(t,a){Object(l.a)(this,e),this.q=t,this.r=a},O=[new N(1,0),new N(1,-1),new N(0,-1),new N(-1,0),new N(-1,1),new N(0,1)];function _(e){return O[e]}function M(e,t){var a=_(t);return new N(e.q+a.q,e.r+a.r)}function B(e,t){for(var a,n,i=[],r=function(e,t){return new N(e.q+t.q,e.r+t.r)}(e,(a=_(4),n=t,new N(a.q*n,a.r*n))),s=0;s<6;s++)for(var o=0;o<t;o++)i.push(r),r=M(r,s);return i}function P(e,t,a,n,i,r){var s={x:t.x-e.point.x,y:t.y-e.point.y},o=Math.sqrt(s.x*s.x+s.y*s.y);return o<=i||(s.x/=o,s.y/=o,e.velocity.x+=s.x*a,e.velocity.y+=s.y*a,e.velocity.x=S(e.velocity.x,-n,n),e.velocity.y=S(e.velocity.y,-n,n),T(e,r),!1)}function T(e,t){e.velocity.x*=t.x,e.velocity.y*=t.y,e.point.x+=e.velocity.x,e.point.y+=e.velocity.y}function D(e,t,a){return e+(t-e)*a}function I(e,t,a){return{x:D(e.x,t.x,a),y:D(e.y,t.y,a),z:D(e.z,t.z,a)}}function A(e){var t=Math.round(e.x),a=Math.round(e.y),n=Math.round(e.z),i=Math.abs(t-e.x),r=Math.abs(a-e.y),s=Math.abs(n-e.z);return i>r&&i>s?t=-a-n:r>s?a=-t-n:n=-t-a,{x:t,y:a,z:n}}function F(e){var t=e.x,a=e.z;return new N(t,a)}function H(e){return{x:e.q,z:e.r,y:-e.q-e.r}}function L(e,t){for(var a=function(e,t){return(Math.abs(e.x-t.x)+Math.abs(e.y-t.y)+Math.abs(e.z-t.z))/2}(e,t),n=[],i=0;i<=a;i++)n.push(F(A(I(e,t,1/a*i))));return n}var R=new function e(t,a,n,i,r,s,o,c,u){Object(l.a)(this,e),this.f0=t,this.f1=a,this.f2=n,this.f3=i,this.b0=r,this.b1=s,this.b2=o,this.b3=c,this.start_angle=u}(1.5,0,Math.sqrt(3)/2,Math.sqrt(3),2/3,0,-1/3,Math.sqrt(3)/3,0),q={x:0,y:0};function z(e,t,a){var n=R,i=(n.f0*a.q+n.f1*a.r)*e.x,r=(n.f2*a.q+n.f3*a.r)*e.y;return{x:i+t.x,y:r+t.y}}function G(e){return{x:e.r*Math.cos(e.az),y:e.r*Math.sin(e.az)}}function K(e){return{transform:"translate(".concat(e.x,"px, ").concat(e.y,"px)")}}var W,U=function(){function e(t){Object(l.a)(this,e),this.map=new v(new Map),this.yellow=new v(new Map),this.white=new v(new Map),this.db=void 0,this.db=new v(t),this.buildIndexes()}return Object(c.a)(e,[{key:"buildIndexes",value:function(){var e=this,t=Array.from(this.db.get.keys()),a={map:new Map,yellow:new Map,white:new Map};t.forEach((function(t){var n=e.db.get.get(t);if(n){var i=n.address.q+","+n.address.r;a.map.set(i,n.key),a.white.set(n.key,i);var r=a.yellow.get(n.type)||[];a.yellow.set(n.type,r.concat([n.key]))}})),this.white.set(a.white),this.map.set(a.map),this.yellow.set(a.yellow)}},{key:"addBuilding",value:function(e){this.db.add(e.key,e),this.buildIndexes()}},{key:"removeBuilding",value:function(e){this.db.remove(e.key),this.buildIndexes()}},{key:"getBuildings",value:function(){return Array.from(this.db.get.values())}},{key:"findBuildingByCoordinate",value:function(e){var t=e.q+","+e.r,a=this.map.get.get(t);if(a)return this.db.get.get(a)}},{key:"getRandomBuildingOfType",value:function(e){var t=Ft(this.yellow.get.get(e)||[]);return this.db.at(t)}},{key:"getRandomEntertainmentBuilding",value:function(){var e=Ft((this.yellow.get.get("park")||[]).concat(this.yellow.get.get("nature")||[]));return this.db.at(e)}},{key:"getCountOfType",value:function(e){return Array.from(this.yellow.get.get(e)||[]).length}}]),e}(),V={farm:"\ud83d\udc04",house:"\ud83c\udfe1",hospital:"\ud83c\udfe5",church:"\u26ea",theater:"\ud83c\udfaa",courthouse:"\ud83c\udfeb",park:"\u26f2\ufe0f",nature:"\ud83c\udfde\ufe0f"},J={farm:"\ud83d\ude9c",house:"\ud83c\udfd8\ufe0f",hospital:"\ud83c\udfd9\ufe0f",church:"\u26ea",theater:"\ud83c\udfdf\ufe0f",courthouse:"\ud83c\udfeb",park:"\ud83c\udfa1",nature:"\ud83c\udfde\ufe0f"},$={farm:"\ud83c\udf3e",house:"\ud83d\udcea",hospital:"\ud83d\udecf\ufe0f",church:"\u26ea",theater:"\ud83e\ude91",courthouse:"\ud83c\udfeb",park:"\ud83d\udc90",nature:"\u2668\ufe0f"},Q={farm:"food",house:"shelter",hospital:"medicine",church:"fun",theater:"fun",courthouse:"fun",park:"fun",nature:"fun"},X={food:"farm",shelter:"house",medicine:"hospital",fun:"theater"},Y={farmer:"farm",builder:"house",doc:"hospital",entertainer:"theater",cleric:"church",jobless:"house",polit:"house"},Z=function(){function e(){Object(l.a)(this,e),this.book=new U(new Map),this.numberOfRings=5,this.hexes=function(e,t){for(var a=[e],n=0;n<t;n++)a=a.concat(B(e,n));return a}({q:0,r:0},this.numberOfRings),this.hex_size={x:70,y:70},this.petriRadius=550,this.petriOrigin={x:this.petriRadius,y:this.petriRadius}}return Object(c.a)(e,[{key:"addBuilding",value:function(e){return this.book.addBuilding(e),null}},{key:"removeBuilding",value:function(e,t){return this.book.removeBuilding(t),null}},{key:"getEnterprise",value:function(e){var t=this.book.db.get.get(e);if(C(t))return t}}]),e}();!function(e){e[e.first=0]="first",e[e.second=1]="second",e[e.third=2]="third",e[e.fourth=3]="fourth",e[e.fifth=4]="fifth",e[e.sixth=5]="sixth"}(W||(W={}));a(24);var ee={x:25,y:25};function te(e){return z(ee,q,e)}var ae={2:W.first,0:W.second,4:W.third,1:W.fourth,5:W.fifth,3:W.sixth},ne=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"slots",value:function(){var e=this;return O.map((function(t,a){var n=ae[a],r=null!=e.props.building.job_slots[n];return i.a.createElement("span",{key:a,className:"slot",style:K(te(t))},r?$[e.props.building.type]:null)}))}},{key:"render",value:function(){var e=this.props.building.address,t=K(z(this.props.city.hex_size,this.props.city.petriOrigin,e));return i.a.createElement("div",{key:this.props.building.type+this.props.building.key,style:t,className:"building "+this.props.building.type},this.props.building.upgraded?J[this.props.building.type]:V[this.props.building.type],this.slots(),"courthouse"===this.props.building.type?i.a.createElement("span",{className:"tile-label"},this.props.city.name):null)}}]),a}(i.a.Component),ie=function e(t,a){Object(l.a)(this,e),this.value=t,this.priority=a},re=function(){function e(t){Object(l.a)(this,e),this.values=[],this.values=t}return Object(c.a)(e,[{key:"enqueue",value:function(e){this.values.push(e),this.values=this.values.sort((function(e,t){return e.priority-t.priority}))}},{key:"enqueueMany",value:function(e){this.values=e,this.values=this.values.sort((function(e,t){return e.priority-t.priority}))}},{key:"dequeue",value:function(){return this.values.shift()}}]),e}(),se=function(){function e(t){Object(l.a)(this,e),this.values=[],this.values=t}return Object(c.a)(e,[{key:"swap",value:function(e,t){var a=this.values[e];return this.values[e]=this.values[t],this.values[t]=a,this.values}},{key:"bubbleUp",value:function(){for(var e=this.values.length-1;e>0;){var t=Math.floor((e-1)/2);if(!(this.values[t].priority>this.values[e].priority))break;this.swap(e,t),e=t}return 0}},{key:"enqueue",value:function(e){return this.values.push(e),this.bubbleUp(),this.values}},{key:"bubbleDown",value:function(){for(var e=0,t=this.values.length,a=this.values[0].priority;;){var n=2*e+1,i=2*e+2,r=999,s=void 0,o=null;if(n<t&&(r=this.values[n].priority)<a&&(o=n),i<t&&((s=this.values[i].priority)<a&&null===o||s<r&&null!==o)&&(o=i),null===o)break;this.swap(e,o),e=o}}},{key:"dequeue",value:function(){this.swap(0,this.values.length-1);var e=this.values.pop();return this.values.length>1&&this.bubbleDown(),e}}]),e}();function oe(e,t){e.state.exit(e),e.state=t,e.state.enter(e)}var le=function(){function e(t){Object(l.a)(this,e),this.data=t}return Object(c.a)(e,[{key:"enter",value:function(e){this.data.elapsed=0}},{key:"act",value:function(e,t,a){var n=this._act(e,t,a);return this.data.elapsed=this.Elapsed+t,n}},{key:"exit",value:function(e){e instanceof Ie&&(e.activity_duration[this.data.act]+=this.Elapsed)}},{key:"Elapsed",get:function(){return this.data.elapsed||0}},{key:"display",get:function(){return function(e){var t;switch(e.act){case"chat":return"chatting";case"crime":return"commiting crime";case"relax":return"relaxing";case"travel":return"travelling to "+(null===(t=e.intent)||void 0===t?void 0:t.act)||!1;case"work":return e.good?"working to make "+Nt[e.good]:"working";case"buy":return"shelter"==e.good?"sleeping \ud83d\ude34":e.good?"buying "+Nt[e.good]:"buying"}return""}(this.data)}}]),e}(),ce=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"_act",value:function(e,t,n){if(this.Elapsed<200)return this;if(e instanceof Ie&&e.city)for(var i=we(e,n),r=i.dequeue(),s=null;r&&null==s;){if(a.substituteIntent(e,r.value)&&null!=(s=ue.createFromIntent(e,r.value)))return s;r=i.dequeue()}return this}},{key:"exit",value:function(e){Object(E.a)(Object(k.a)(a.prototype),"exit",this).call(this,e),e instanceof Ie&&e.maybeParanoid()}}],[{key:"create",value:function(){return new a({act:"idle"})}},{key:"substituteIntent",value:function(e,t){if("buy"===t.act&&null!=t.good&&e instanceof Ie){var a=e.canBuy(t.good);if("yes"!=a&&"fun"===t.good)t.act="relax";else if("pricedout"===a){if(!e.maybeCrime(t.good))return("food"===t.good||"medicine"===t.good||"shelter"===t.good)&&e.emote("unhappiness","Poverty"),null;t.act="crime"}else if("nosupply"===a)return t.good&&e.maybeScarcity(t.good),null}return t}}]),a}(le);var ue=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"_act",value:function(e,t,a){var n=this;if(e instanceof Ie&&e.city&&this.data.destinations&&this.data.destinations.length){var i=this.data.destinations[0];if(isNaN(i.x)||isNaN(i.y))return this.data.destinations.shift(),this;P(e,i,Et.AccelerateS*t/1e3,Et.MaxSpeed,Et.CollisionDistance,Et.Brake)&&(this.data.location=e.point,this.data.destinations.shift()),e.onMove.publish(e.point)}if(null==this.data.destinations||0===this.data.destinations.length)return this.data.intent?ye[this.data.intent.act](this.data.intent):ce.create();if(e instanceof Ie&&e.city){var r=e.city.getNearestNeighbors(e);if(r.length&&e.maybeChat()){var s=r.filter((function(e){return e.maybeChat()}));if(s.length<1)return this;var o=e.getRandomChat(s);return s.forEach((function(e){oe(e,me.create(n.data.intent,Object(g.a)(Object(g.a)({},o),{},{participation:"listener"})))})),me.create(this.data,o)}return e.believesIn("Wanderlust")&&Math.random()<.002?(e.emote("happiness","Wanderlust"),this):this}return this}},{key:"exit",value:function(e){Object(E.a)(Object(k.a)(a.prototype),"exit",this).call(this,e),e instanceof Ie&&(e.velocity={x:0,y:0})}}],[{key:"createFromIntent",value:function(e,t){var a=function(e,t){if(!(e instanceof Ie))return[];if(e.city){var a=e.city;switch(t.act){case"buy":if(t.good)return je(a,e,X[t.good]);case"work":return je(a,e,Y[e.job]);case"relax":var n=a.book.getRandomEntertainmentBuilding();return n?(e.destinationKey=n.key,Ce(a,e,n)):[]}}return[]}(e,t);return a?this.createFromDestination(a,t):null}},{key:"createFromDestination",value:function(e,t){return new a({act:"travel",destinations:e,intent:t})}}]),a}(le),he=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"_act",value:function(e,t,a){var n,i;return this.Elapsed>2e3&&e instanceof Ie&&this.data.good&&(null===(n=e.city)||void 0===n?void 0:n.economy)&&(null===(i=e.city)||void 0===i?void 0:i.law)?(e.work(e.city.law,e.city.economy),ce.create()):this}}],[{key:"create",value:function(e){return new a({act:"work",good:e})}}]),a}(le),de=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).sinceLastAttemptMS=0,e._bought=!1,e}return Object(c.a)(a,[{key:"tryBuy",value:function(e){var t;e instanceof Ie&&this.data.good&&(null===(t=e.city)||void 0===t?void 0:t.economy)&&(this._bought=e.buy[this.data.good](e.city.economy)),this.sinceLastAttemptMS=0}},{key:"enter",value:function(e){this.tryBuy(e)}},{key:"_act",value:function(e,t,n){return this._bought||this.sinceLastAttemptMS>250&&this.tryBuy(e),this.Elapsed>a.MaximumBuyDuration?(e instanceof Ie&&this.data.good&&e.maybeScarcity(this.data.good),ce.create()):this}}],[{key:"create",value:function(e){return new a({act:"buy",good:e})}}]),a}(le);de.MaximumBuyDuration=1100;var me=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"_act",value:function(e,t,a){if(this.Elapsed>1e3&&this.data.intent){var n=ue.createFromIntent(e,this.data.intent);if(n)return n}return this}},{key:"exit",value:function(e){Object(E.a)(Object(k.a)(a.prototype),"exit",this).call(this,e),e instanceof Ie&&this.data.chat&&(e.lastChatMS=Date.now(),"listener"===this.data.chat.participation&&("bully"===this.data.chat.type?e.maybeAntagonised():"praise"===this.data.chat.type&&e.maybeEnthused()))}}],[{key:"create",value:function(e,t){return new a({act:"chat",intent:e,chat:t})}}]),a}(le),pe=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"_act",value:function(e,t,a){var n=1e3;return e instanceof Ie&&e.believesIn("Naturalism")&&(n*=3),this.Elapsed>n?ce.create():this}},{key:"exit",value:function(e){Object(E.a)(Object(k.a)(a.prototype),"exit",this).call(this,e),e instanceof Ie&&(e.discrete_fun+=1,e.emote("happiness","Relaxation"),e.believesIn("Naturalism")&&e.emote("happiness","Naturalism"))}}],[{key:"create",value:function(e,t){return new a({act:"relax",intent:e,chat:t})}}]),a}(le),fe=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"_act",value:function(e,t,a){var n,i;return this.Elapsed>1500&&e instanceof Ie&&(null===(n=e.city)||void 0===n?void 0:n.economy)&&("food"===this.data.good||"medicine"===this.data.good)?(e.steal(this.data.good,null===(i=e.city)||void 0===i?void 0:i.economy),ce.create()):this}}],[{key:"create",value:function(e){return new a({act:"crime",good:e})}}]),a}(le),ye={idle:function(e){return new ce(e)},work:function(e){return new he(e)},chat:function(e){return new me(e)},travel:function(e){return new ue(e)},craze:function(e){return new de(e)},buy:function(e){return new de(e)},sleep:function(e){return new de(e)},soapbox:function(e){return new de(e)},crime:function(e){return new fe(e)},relax:function(e){return new pe(e)}},be=function(e){if("jobless"==e.job&&e.city)return 9;if(e.city){var t,a=99;if(e.city.economy)a=(null===(t=e.city.economy.market.getStakeListings(e.key,e.employerEnterpriseKey,St(e.job)))||void 0===t?void 0:t.quantity)||0;var n=e.cash/e.city.costOfLiving/2;return Math.min(a,n)}return 0},ve=function(e,t){return e.discrete_food<=t.bean_life.vital_thresh.food.warning?e.discrete_food:.5+e.discrete_food/t.bean_life.vital_thresh.food.sufficient},ge=function(e,t){return e.discrete_health<=t.bean_life.vital_thresh.medicine.warning?.25+e.discrete_health:.75+e.discrete_health/t.bean_life.vital_thresh.medicine.sufficient},Ee=function(e,t){return e.discrete_stamina<=t.bean_life.vital_thresh.shelter.warning?.5+e.discrete_stamina:1+e.discrete_stamina/t.bean_life.vital_thresh.shelter.sufficient},ke=function(e,t){return 3};function we(e,t){var a=new re([]),n=new ie({act:"work",good:St(e.job)},be(e));return a.enqueue(n),n=new ie({act:"buy",good:"food"},ve(e,t)),a.enqueue(n),n=new ie({act:"buy",good:"shelter"},Ee(e,t)),a.enqueue(n),n=new ie({act:"buy",good:"medicine"},ge(e,t)),a.enqueue(n),n=new ie({act:"buy",good:"fun"},ke(e,t)),a.enqueue(n),a}function je(e,t,a){var n=e.book.getRandomBuildingOfType(a);return void 0===n?null:(t.destinationKey=n.key,Ce(e,t,n))}function Ce(e,t,a){var n,i,r=t.point,s=function(e,t,a){var n=R,i=(a.x-t.x)/e.x,r=(a.y-t.y)/e.y,s=n.b0*i+n.b1*r,o=n.b2*i+n.b3*r;return new N(s,o)}(e.hex_size,e.petriOrigin,r);return(n=s,i=a.address,L(H(n),H(i))).map((function(t){return z(e.hex_size,e.petriOrigin,t)})).map((function(e,t,a){if(t===a.length-1){var n=te(Ft(O));return{x:e.x+n.x,y:e.y+n.y}}return e}))}var xe={common:3,uncommon:2,rare:1},Se={prog:{noun:"Progressivism",adj:"Progressive",icon:"\u2696\ufe0f",description:"Strives to help others",rarity:"common"},trad:{noun:"Elitism",adj:"Elitist",icon:"\ud83d\udc51",description:"Strives for individual power",rarity:"common"},state:{noun:"Collectivism",adj:"Collectivist",icon:"\ud83d\udd4a\ufe0f",description:"Trusts in the social group",rarity:"common"},ego:{noun:"Independence",adj:"Independent",icon:"\ud83e\udd85",description:"Trusts only in oneself",rarity:"common"}},Ne={rocket:{noun:"Futurism",adj:"Futuristic",icon:"\ud83d\ude80",description:"Loves stories of the far future",rarity:"common"},dragon:{noun:"Mythology",adj:"Mythical",icon:"\ud83d\udc32",description:"Loves stories of the legendary past",rarity:"common"},music:{noun:"Drama",adj:"Dramatic",icon:"\ud83c\udfb5",description:"Loves stories of emotional bonding",rarity:"common"},noFaith:{noun:"Nihilism",adj:"Nihilist",icon:"\u26ab\ufe0f",description:"Hates fairy tales",rarity:"common"}},Oe={Diligence:{noun:"Diligence",adj:"Diligence",icon:"\ud83d\udcaa",rarity:"common",description:"\ud83c\udfb2 to \ud83d\udc4d while working"},Natalism:{noun:"Natalism",adj:"Natalist",icon:"\ud83d\udc76",rarity:"common",description:"Extra \ud83c\udfb2 for \ud83d\udc76"},Charity:{noun:"Charity",adj:"Charitable",icon:"\ud83d\ude07",rarity:"uncommon",description:"\ud83c\udfb2 to gift \ud83d\udcb0 to the penniless; and spread \ud83d\udc4d"},Progressivism:{noun:"Progressivism",adj:"Progressive",icon:"\u2696\ufe0f",rarity:"uncommon",description:"\ud83c\udfb2 to \ud83d\udc4d when paying taxes"},Libertarianism:{noun:"Libertarianism",adj:"Libertarian",icon:"\ud83d\udd2b",rarity:"rare",description:"\ud83c\udfb2 to \ud83d\udca2 when paying taxes"},Wanderlust:{noun:"Wanderlust",adj:"Wanderer",icon:"\ud83d\udd2d",rarity:"uncommon",description:"\ud83c\udfb2 to \ud83d\udc4d when travelling"},Germophobia:{noun:"Germophobia",adj:"Germophobic",icon:"\ud83e\udd27",rarity:"rare",description:"\ud83d\udca2 when sick or working in hospital"},Parochialism:{noun:"Parochialism",adj:"Parochial",icon:"\ud83d\udc2e",rarity:"common",description:"Extra \ud83d\udc4d working \ud83c\udf3e; \ud83d\udca2 from dense houses"},Cosmopolitanism:{noun:"Cosmopolitanism",adj:"Cosmopolitan",icon:"\ud83c\udf78",rarity:"common",description:"Extra \ud83d\udc4d working \ud83c\udfbb; \ud83d\udca2 from rural houses"},Capitalism:{noun:"Capitalism",adj:"Capitalist",icon:"\ud83c\udfa9",rarity:"common",description:"\ud83d\udca2 working in co-ops and communes; Extra \ud83d\udc4d when owner"},Socialism:{noun:"Socialism",adj:"Socialist",icon:"\ud83e\udd1d",rarity:"common",description:"Extra \ud83d\udc4d working in co-ops"},Communism:{noun:"Communism",adj:"Communist",icon:"\u2692\ufe0f",rarity:"common",description:"\ud83d\udca2 working in companies"},Naturalism:{noun:"Naturalism",adj:"Naturalist",icon:"\ud83d\udef6",rarity:"uncommon",description:"Extra \ud83d\udc4d from \ud83d\ude0e; \ud83d\ude0e 3x longer"},Hedonism:{noun:"Hedonism",adj:"Hedonistic",icon:"\ud83d\udc8b",rarity:"uncommon",description:"\ud83c\udfb2 to emote extra \ud83d\udc4d;\ud83c\udfb2 to \ud83d\udca2 when working;"},Gluttony:{noun:"Gluttony",adj:"Glutton",icon:"\ud83c\udf83",rarity:"common",description:"Extra \ud83d\udc4d when stuffed; Extra \ud83d\udca2 when hungry;"},Paranoia:{noun:"Paranoia",adj:"Paranoid",icon:"\ud83d\udc7d",rarity:"uncommon",description:"\ud83c\udfb2 to \ud83d\udca2 at any time"},Authority:{noun:"Authority",adj:"Authoritarian",icon:"\ud83d\udc62",rarity:"common",description:"Less \ud83c\udfb2 for all \ud83d\ude08 Crime"},Anarchism:{noun:"Anarchism",adj:"Anarchist",icon:"\ud83d\udd95",rarity:"uncommon",description:"Extra \ud83c\udfb2 for all \ud83d\ude08 Crime"},Greed:{noun:"Greed",adj:"Greedy",icon:"\ud83e\udd11",rarity:"common",description:"Extra \ud83c\udfb2 for theft \ud83d\ude08 Crime; Extra \ud83d\udc4d when rich"},Extroversion:{noun:"Extroversion",adj:"Extrovert",icon:"\ud83e\udd29",rarity:"common",description:"Extra \ud83c\udfb2 to start a \ud83d\udde3\ufe0f"},Gossip:{noun:"Gossip",adj:"Gossipy",icon:"\ud83d\udcde",rarity:"common",description:"\ud83c\udfb2 to spread \ud83d\udca2 in a \ud83d\udde3\ufe0f"},Antagonism:{noun:"Antagonism",adj:"Antagonistic",icon:"\ud83e\udd2c",rarity:"common",description:"\ud83c\udfb2 to spread \ud83d\udca2 in a \ud83d\udde3\ufe0f"},Enthusiasm:{noun:"Enthusiasm",adj:"Enthusiastic",icon:"\ud83e\udd73",rarity:"common",description:"\ud83c\udfb2 to spread \ud83d\udc4d in a \ud83d\udde3\ufe0f"},Neuroticism:{noun:"Neuroticism",adj:"Neurotic",icon:"\ud83d\ude31",rarity:"rare",description:"+100% \ud83e\udde0 damage",idealCon:["state"],idealPro:["ego"]},Dogmatism:{noun:"Dogmatism",adj:"Dogmatic",icon:"\ud83d\udc36",rarity:"uncommon",description:"Cannot change beliefs",idealCon:["ego"],idealPro:["state"]}};function _e(e,t,a){var n=Oe[e];return null!=n.idealCon&&n.idealCon.reduce((function(e,n){return e||function(e,t,a){switch(e){case"trad":case"prog":return e==t;case"state":case"ego":return e==a}}(n,t,a)}),!1)}var Me=Object.keys(Oe).map((function(e){return e})),Be=Object.keys(Oe).reduce((function(e,t){for(var a=t,n=xe[Oe[a].rarity],i=0;i<n;i++)e.push(a);return e}),[]);function Pe(e){if(0===e.length)return{all:{},flatAverage:0,weightedAverage:0,maxSource:"",minSource:""};for(var t={},a=0,n=0,i=0;i<e.length;i++){for(var r=e[i],s=0,o=Object.keys(r),l=0;l<o.length;l++){var c=o[l];s+=r[c],t[c]||(t[c]=0),t[c]+=r[c]}a+=s/(i+1),n+=s}var u=Object.keys(t);return{flatAverage:n/e.length,weightedAverage:a,maxSource:u.reduce((function(e,a){return t[a]>e.val?{source:a,val:t[a]}:e}),{source:"",val:0}).source,minSource:u.reduce((function(e,a){return t[a]<e.val?{source:a,val:t[a]}:e}),{source:"",val:0}).source,all:t}}var Te,De,Ie=function(){function e(){var t=this;Object(l.a)(this,e),this.key=0,this.cityKey=0,this.dob={year:0,season:0,day:1,hour:0},this.bornInPetri=!1,this.name="Human Bean",this.discrete_sanity=10,this.discrete_fun=0,this.lifecycle="alive",this.activity_queue=[],this.activity_duration={buy:0,chat:0,craze:0,crime:0,idle:0,relax:0,sleep:0,soapbox:0,travel:0,work:0},this.speed=60,this.point={x:0,y:0},this.velocity={x:0,y:0},this.onMove=new m,this.destinationKey=0,this.city=null,this.ethnicity=Ft(["circle","square","triangle"]),this.discrete_food=1,this.stamina="awake",this.discrete_health=2,this.community="ego",this.ideals="trad",this.job="jobless",this.employerEnterpriseKey=void 0,this.faith="noFaith",this.beliefs=[],this.cash=3,this.hedonHistory=[{}],this.happiness=Pe(this.hedonHistory),this.lastHappiness=0,this.lastSentiment=0,this.lastPartySentiment=0,this.ticksSinceLastSale=0,this.ticksSinceLastRelax=0,this.discrete_stamina=7,this.fairGoodPrice=1,this.lastChatMS=Date.now(),this.buy={food:function(e){return null!=t.buyFood(e)},medicine:function(e){return null!=t.buyMeds(e)},fun:function(e){return t.buyFun(e)},shelter:function(e){return t.buyHousing(e)}},this.state=ce.create(),this.jobQueue=new se([]),this.onAct=new m}return Object(c.a)(e,[{key:"believesIn",value:function(e){return-1!==this.beliefs.indexOf(e)}},{key:"loseSanity",value:function(e){var t=this.believesIn("Neuroticism")?2:1;this.discrete_sanity-=t*e}},{key:"getHappinessModifiers",value:function(e,t,a){var n,i=[Ct[this.food],Ct[this.stamina],Ct[this.health],{reason:"Entertainment",mod:.4*this.discrete_fun}];return"trad"===this.ideals&&this.ethnicity!=t.majorityEthnicity&&i.push({reason:"Xenophobic",mod:-.1}),"ego"===this.community&&"jobless"!=this.job&&this.employerEnterpriseKey&&(null===(n=t.book.db.get.get(this.employerEnterpriseKey))||void 0===n?void 0:n.upgraded)&&i.push({reason:"Hates Building Density",mod:-.1}),this.cash<1?i.push({reason:"Penniless",mod:ft.Deficient}):this.cash>3*e.getCostOfLiving()?i.push({reason:"Upper Class",mod:.3}):this.cash>2*e.getCostOfLiving()&&i.push({reason:"Middle Class",mod:.15}),"jobless"===this.job&&i.push({reason:"Unemployed",mod:ft.Deficient}),i}},{key:"getSentimentModifiers",value:function(e,t,a,n){var i={party:[],law:[]};return this.community===n.community&&i.party.push({reason:"Same Community",mod:.15}),this.ideals===n.ideals?i.party.push({reason:"Same Ideals",mod:.15}):this.community!=n.community&&i.party.push({reason:"Incompatible Values",mod:-.15}),i}},{key:"calculateBeliefs",value:function(e,t,a,n){this.lastHappiness=jt(this.getHappinessModifiers(e,t,a));var i=this.getSentimentModifiers(e,t,a,n);if(this.lastSentiment=jt(i.law),this.lastPartySentiment=jt(i.party),"jobless"===this.job)this.fairGoodPrice=1;else{var r=St(this.job);this.fairGoodPrice=e.getFairGoodPrice(r)}}},{key:"getSentimentPolicies",value:function(e,t){var a=100;return t.forEach((function(t){t.fx.forEach((function(t){e[t.key]&&(a+=10*t.mag)}))})),a/100}},{key:"_getTraitMap",value:function(){var e,t=(e={},Object(d.a)(e,this.community,!0),Object(d.a)(e,this.ideals,!0),Object(d.a)(e,this.ethnicity,!0),e);return"noFaith"!=this.faith&&(t[this.faith]=!0),t}},{key:"getFace",value:function(){var e,t;if("buy"===this.state.data.act&&"shelter"===this.state.data.good)return"\ud83d\ude34";if("crime"===this.state.data.act)return"\ud83d\ude08";if("relax"===this.state.data.act)return"\ud83d\ude0e";if("chat"===this.state.data.act){var a;if("speaker"===(null===(a=this.state.data.chat)||void 0===a?void 0:a.participation))switch(null===(e=this.state.data)||void 0===e||null===(t=e.chat)||void 0===t?void 0:t.type){default:return"\ud83d\ude03";case"gift":return"\ud83d\ude07";case"praise":return"\ud83e\udd73";case"bully":return"\ud83d\ude08"}return"\ud83e\udd28"}return"starving"===this.food?"\ud83d\ude2b":"sick"===this.health?"\ud83e\udd22":"homeless"===this.stamina?"\ud83e\udd76":"jobless"===this.job?"\ud83d\ude27":this.lastHappiness<0?"\u2639\ufe0f":this.lastHappiness>=50?"\ud83d\ude42":"\ud83d\ude10"}},{key:"getIdea",value:function(e){return"hungry"===this.food?{bad:!0,idea:"\ud83c\udf57"}:"sickly"===this.health?{bad:!0,idea:"\ud83d\udc8a"}:"homeless"===this.stamina?{bad:!0,idea:"\ud83c\udfe0"}:this.canBaby(e)?{bad:!1,idea:"\ud83d\udc76"}:null}},{key:"getSpeech",value:function(){var e;if("chat"===this.state.data.act&&("speaker"===(null===(e=this.state.data.chat)||void 0===e?void 0:e.participation)&&this.state.data.chat.preachBelief))return"\ud83d\udcac"+Oe[this.state.data.chat.preachBelief].icon}},{key:"getCrimeDecision",value:function(e,t){var a=Math.random(),n=.05;return"ego"===this.community&&(n+=.1),("desperation"===t&&"sick"===this.health||"starving"===this.food)&&(n+=.15),n<=a}},{key:"tryFindRandomJob",value:function(e){var t,a,n=Ft(["builder","doc","farmer","entertainer"]);this.trySetJob(n)||(null===(t=this.city)||void 0===t||null===(a=t.eventBus)||void 0===a||a.nojobslots.publish({icon:"\ud83c\udfda\ufe0f",trigger:"nojobslots",message:"A subject cannot find a job; build or upgrade more buildings."}))}},{key:"trySetJob",value:function(e){var t;return!!(null===(t=this.city)||void 0===t?void 0:t.tryGetJob(this,e))&&(this.city.unsetJob(this),this.job=e,!0)}},{key:"canPurchase",value:function(e){return void 0===e.sanity||this.discrete_sanity>=e.sanity}},{key:"maybeParanoid",value:function(){this.ifBelievesInMaybeEmote("Paranoia","unhappiness",.05)}},{key:"maybeAntagonised",value:function(){this.emote("unhappiness","Antagonism")}},{key:"maybeEnthused",value:function(){this.emote("happiness","Enthusiasm")}},{key:"maybeChat",value:function(){if(this.lastChatMS+4e3>Date.now())return!1;if("chat"===this.state.data.act)return!1;var e=Math.random(),t="state"===this.community?.2:.1;return this.believesIn("Extroversion")&&(t+=.25),e<t}},{key:"getRandomChat",value:function(e){var t=this;if(this.beliefs.length){if(this.believesIn("Charity")&&this.cash>=2){var a=e.filter((function(e){return e.cash<=t.cash-1})).reduce((function(e,t){return null==e||t.cash<e.cash?t:e}),null);if(a)return this.cash-=.5,this.emote("happiness","Charity"),a.cash+=.5,a.emote("happiness","Charity"),{participation:"speaker",type:"gift",targetBeanKey:a.key}}else{if(this.believesIn("Enthusiasm")&&Math.random()<.45)return{participation:"speaker",type:"praise",preachBelief:"Enthusiasm"};if(this.believesIn("Antagonism")&&Math.random()<.45)return{participation:"speaker",type:"bully",preachBelief:"Antagonism"};if(this.believesIn("Gossip")&&Math.random()<.35)return{participation:"speaker",type:"bully",preachBelief:"Gossip"}}return{participation:"speaker",type:"preach",preachBelief:Ft(this.beliefs)}}return{participation:"speaker",type:"praise"}}},{key:"work",value:function(e,t){var a=this;if("jobless"===this.job);else{switch(this.job){case"farmer":this.discrete_food=Math.min(this.discrete_food+1,2*xt.food.sufficient),this.ifBelievesInMaybeEmote("Parochialism","happiness",.25);break;case"doc":this.discrete_health=Math.min(this.discrete_health+1,2*xt.medicine.sufficient),this.ifBelievesInMaybeEmote("Germophobia","unhappiness",.25);break;case"builder":this.stamina="awake",this.discrete_stamina=7;break;case"entertainer":this.ifBelievesInMaybeEmote("Cosmopolitanism","happiness",.25)}if(this.ifBelievesInMaybeEmote("Diligence","happiness",.25),this.ifBelievesInMaybeEmote("Hedonism","unhappiness",.15),this.ticksSinceLastSale++,this.ticksSinceLastSale>7)if(!!this.city&&this.city.beans.get.filter((function(e){return e.job===a.job})).length>1&&Math.random()>.5){var n=t.mostInDemandJob();n&&this.trySetJob(n)}var i=!1;if(this.city&&this.employerEnterpriseKey){var r=this.city.getEnterprise(this.employerEnterpriseKey);if(r)switch(t.employAndPrice(r,St(this.job),4,this.fairGoodPrice),i=!0,r.enterpriseType){case"company":this.ifBelievesInMaybeEmote("Communism","unhappiness",.1),r.ownerBeanKey===this.key&&this.ifBelievesInMaybeEmote("Capitalism","happiness",.1);break;case"cooperative":this.ifBelievesInMaybeEmote("Capitalism","unhappiness",.1),this.ifBelievesInMaybeEmote("Socialism","happiness",.1);break;case"commune":this.ifBelievesInMaybeEmote("Capitalism","unhappiness",.1)}}i||t.produceAndPrice(this,St(this.job),4,this.fairGoodPrice)}}},{key:"buyFood",value:function(e){var t=e.tryTransact(this,"food",.5,3);return t&&(this.discrete_food+=t.bought,"stuffed"===this.food&&(this.emote("happiness","Stuffed"),this.ifBelievesInMaybeEmote("Gluttony","happiness",1))),t}},{key:"steal",value:function(e,t){var a=t.steal(e,3);if(null!=a)switch(e){case"food":this.discrete_food+=a;break;case"medicine":this.discrete_health+=a}}},{key:"buyHousing",value:function(e){var t=e.tryTransact(this,"shelter");return t?(this.discrete_stamina=10,this.stamina="awake"):this.discrete_stamina<=0&&(this.stamina="homeless"),null!=t}},{key:"buyFun",value:function(e){var t=e.tryTransact(this,"fun");return t&&(this.discrete_fun=1,this.emote("happiness","Entertainment"),this.emote("happiness","Entertainment")),null!=t}},{key:"age",value:function(e,t){if(!this.alive)return null;var a="starving"!==this.food,n="sick"!==this.health;return this.discrete_food-=1/7,this.discrete_food<0&&(this.discrete_health-=.2),this.maybeDie("starvation",.6)?null:("starving"===this.food&&a&&(this.emote("unhappiness","Starving"),this.believesIn("Gluttony")&&(this.emote("unhappiness","Gluttony"),this.emote("unhappiness","Gluttony"))),"homeless"===this.stamina&&(this.discrete_health-=1/14),this.discrete_stamina--,this.maybeDie("exposure",.2)||(this.discrete_health-=.05,this.discrete_health=Math.min(this.discrete_health,3),this.maybeDie("sickness",.4)||("sick"===this.health&&n&&(this.emote("unhappiness","sick"),this.believesIn("Germophobia")&&this.emote("unhappiness","Germophobia")),this.discrete_fun-=.1,this.discrete_fun=Math.max(0,this.discrete_fun))),null)}},{key:"buyMeds",value:function(e){var t=e.tryTransact(this,"medicine",.5,3);return t&&(this.discrete_health+=t.bought,"fresh"===this.health&&this.emote("happiness","Robust")),t}},{key:"maybeBaby",value:function(e){if(this.canBaby(e.getCostOfLiving())&&(t=this.babyChance,function(){var e=new ArrayBuffer(8),t=new Int8Array(e);return window.crypto.getRandomValues(t),t[7]=63,t[6]|=240,new DataView(e).getFloat64(0,!0)-1}()<=t)){if(!this.city)throw"bean does not have city object";return this.city.breedBean(this),{icon:"\ud83c\udf89",trigger:"birth",message:"".concat(this.name," has a baby!")}}return null;var t}},{key:"canBaby",value:function(e){return this.alive&&this.cash>3*e&&!this.isInCrisis}},{key:"maybeCrime",value:function(e){if("shelter"===e)return!1;if("fun"===e)return!1;var t=Math.random(),a=.05;return"ego"===this.community&&(a+=.1),this.isInCrisis&&(a+=.1),this.believesIn("Greed")&&(a+=.25),this.believesIn("Anarchism")&&(a+=.33),this.believesIn("Authority")&&(a+=-.25),("food"===e&&"starving"===this.food||"medicine"===e&&"sick"===this.health)&&(a+=.25),a<=t}},{key:"ifBelievesInMaybeEmote",value:function(e,t,a){this.believesIn(e)&&Math.random()<a&&this.emote(t,e)}},{key:"emote",value:function(e,t){var a,n;(this.discrete_sanity=S(this.discrete_sanity+Mt[e],0,10),this.hedonHistory[0][t]=(this.hedonHistory[0][t]||0)+_t[e],null===(a=this.city)||void 0===a||a.addEmotePickup(this.point,e),this.believesIn("Hedonism")&&("happiness"===e||"love"===e)&&Math.random()<.1)&&(null===(n=this.city)||void 0===n||n.addEmotePickup(this.point,e))}},{key:"canBuy",value:function(e){var t,a;return(null===(t=this.city)||void 0===t||null===(a=t.economy)||void 0===a?void 0:a.canBuy(this,e))||"nosupply"}},{key:"maybeDie",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return this.discrete_health<0&&Math.random()<=t&&(this.die(e),!0)}},{key:"die",value:function(e){var t,a,n,i;this.alive=!1;for(var r=At(2,3),s=0;s<r;s++)this.emote("hate","death");null===(t=this.city)||void 0===t||t.beans.remove(this),null===(a=this.city)||void 0===a||a.historicalBeans.push(this),null===(n=this.city)||void 0===n||null===(i=n.eventBus)||void 0===i||i.death.publish({icon:"\u2620\ufe0f",trigger:"death",message:"".concat(this.name," died of ").concat(e,"!"),beanKey:this.key,cityKey:this.cityKey,point:this.point})}},{key:"maybeScarcity",value:function(e){var t=!1;("food"!==e||"starving"!==this.food&&"hungry"!==this.food)&&("shelter"!==e||"homeless"!==this.stamina&&"sleepy"!==this.stamina)&&("medicine"!==e||"sick"!==this.health&&"sickly"!==this.health)||(t=!0),t&&this.emote("unhappiness","Scarcity")}},{key:"abduct",value:function(e){var t;this.lifecycle="abducted",null===(t=this.city)||void 0===t||t.unsetJob(this),e.abductedBeans.push(this)}},{key:"sanity",get:function(){return this.discrete_sanity>=8?"sane":this.discrete_sanity>=5?"stressed":this.discrete_sanity>=3?"disturbed":"psychotic"}},{key:"alive",get:function(){return"alive"===this.lifecycle},set:function(e){this.lifecycle=!0===e?"alive":"dead"}},{key:"food",get:function(){return this.discrete_food>=xt.food.abundant?"stuffed":this.discrete_food>=xt.food.sufficient?"sated":this.discrete_food>=xt.food.warning?"hungry":"starving"}},{key:"health",get:function(){return this.discrete_health>=xt.medicine.abundant?"fresh":this.discrete_health>=xt.medicine.sufficient?"bruised":this.discrete_health>=xt.medicine.warning?"sickly":"sick"}},{key:"isInCrisis",get:function(){return"starving"===this.food||"homeless"===this.stamina||"sick"===this.health}},{key:"babyChance",get:function(){return this.believesIn("Natalism")?.048:.008}}]),e}(),Ae=["food","shelter","medicine","fun"],Fe=function(){function e(t){Object(l.a)(this,e),this.eventBus=t,this.market=new He,this.charity=new He,this.unfulfilledMonthlyDemand={food:0,shelter:0,medicine:0,fun:0},this.monthlyDemand={food:0,shelter:0,medicine:0,fun:0},this.monthlySupply={food:0,shelter:0,medicine:0,fun:0},this.law=void 0}return Object(c.a)(e,[{key:"resetMonthlyDemand",value:function(){this.unfulfilledMonthlyDemand={food:0,shelter:0,medicine:0,fun:0},this.monthlyDemand={food:0,shelter:0,medicine:0,fun:0},this.monthlySupply={food:0,shelter:0,medicine:0,fun:0}}},{key:"tryTransact",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.monthlyDemand[t]+=n;var i=this.market.getLowestPriceListing(t,a);if(null==i)return this.unfulfilledMonthlyDemand[t]+=n,null;var r,s,o=Math.min(i.quantity,n);if(i.price*(1+this.salesTaxPercentage)<=e.cash*o){var l=this.market.transact(i,t,o,e,this.salesTaxPercentage);return l.tax&&this.law&&this.law.treasury.set(this.law.treasury.get+l.tax),l}return e instanceof Ie&&(null===(r=this.law)||void 0===r?void 0:r.PurchaseQualifiesForWelfare(e,t))&&(null===(s=this.law)||void 0===s?void 0:s.CanPayWelfare(i.price))?this.market.governmentTransact(i,t,o,this.law.treasury):(this.unfulfilledMonthlyDemand[t]+=o,null)}},{key:"canBuy",value:function(e,t){var a,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=this.market.getLowestPriceListing(t,i);if(null==s)return"nosupply";var o=Math.min(s.quantity,r);return s.price<=e.cash*o||e instanceof Ie&&(null===(a=this.law)||void 0===a?void 0:a.PurchaseQualifiesForWelfare(e,t))&&(null===(n=this.law)||void 0===n?void 0:n.CanPayWelfare(s.price))?"yes":"pricedout"}},{key:"steal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=Ft(this.market.listings[e]);if(null==a)return null;var n=Math.min(a.quantity,t);return this.market.subtractFromListing(a,e,n),n}},{key:"produceAndPrice",value:function(e,t,a,n){this.monthlySupply[t]+=a;var i=this.market.getBeansListings(e.cityKey,e.key,t);i?(i.quantity+=a,i.price=n,i.quantity=Math.min(i.quantity,6)):this.market.addNewPersonalListing(t,a,n,e),this.market.sort(t)}},{key:"employAndPrice",value:function(e,t,a,n){this.monthlySupply[t]+=a;var i=this.market.getEnterpriseListings(e,t);i?(i.quantity+=a,i.price=n,i.quantity=Math.min(i.quantity,6)):this.market.addNewEnterpriseListing(t,a,n,e),this.market.sort(t)}},{key:"mostInDemandJob",value:function(){var e=this;return Ae.reduce((function(t,a){return e.unfulfilledMonthlyDemand[a]>t.max&&(t.max=e.unfulfilledMonthlyDemand[a],t.job=function(e){switch(e){case"shelter":return"builder";case"medicine":return"doc";case"fun":return"entertainer";default:case"food":return"farmer"}}(a)),t}),{max:0,job:null}).job}},{key:"onBeanDie",value:function(e){var t=this;Ae.forEach((function(a){var n=t.market.getBeansListings(e.cityKey,e.key,a);if(n){var i,r=null===(i=e.city)||void 0===i?void 0:i.getRandomCitizen();r&&(n.sellerCityKey=r.cityKey,n.sellerBeanKey=r.key,n.seller=r)}}))}},{key:"getFairGoodPrice",value:function(e){var t=this.monthlySupply[e]||1,a=this.monthlyDemand[e];return.25+.75*Math.min(a/t,1)}},{key:"getCostOfLiving",value:function(){return this.getFairGoodPrice("food")+this.getFairGoodPrice("shelter")+this.getFairGoodPrice("medicine")}},{key:"salesTaxPercentage",get:function(){var e;return(null===(e=this.law)||void 0===e?void 0:e.salesTaxPercentage)||0}}]),e}(),He=function(){function e(){Object(l.a)(this,e),this.listings={food:[],shelter:[],medicine:[],fun:[]}}return Object(c.a)(e,[{key:"getLowestPriceListing",value:function(e,t){var a=this.listings[e].filter((function(e){return e.quantity>=t}));if(a.length>0){for(var n=1,i=a[0].price,r=1;r<a.length;r++){if(a[r].price>i)break;n++}var s=Math.floor(Math.random()*n);if(s>=a.length)throw"invalid index";return a[s]}return null}},{key:"getStakeListings",value:function(e,t,a){return this.listings[a].find((function(a){return a.sellerBeanKey==e||a.sellerEnterpriseKey==t}))}},{key:"getBeansListings",value:function(e,t,a){return this.listings[a].find((function(a){return a.sellerBeanKey==t&&a.sellerCityKey==e}))}},{key:"getEnterpriseListings",value:function(e,t){return this.listings[t].find((function(t){return t.sellerEnterpriseKey==e.key}))}},{key:"transact",value:function(e,t,a,n,i){this.subtractFromListing(e,t,a);var r=e.price*a,s=r*i,o=r+s;return n.cash-=o,e.seller.cash+=r,e.seller.ticksSinceLastSale=0,{bought:a,price:r,tax:s}}},{key:"governmentTransact",value:function(e,t,a,n){this.subtractFromListing(e,t,a);var i=e.price*a,r=i;return n.set(n.get-r),e.seller.cash+=i,e.seller.ticksSinceLastSale=0,{bought:a,price:i,tax:0}}},{key:"subtractFromListing",value:function(e,t,a){e.quantity-=a,e.quantity<=0&&this.listings[t].splice(0,1)}},{key:"addNewPersonalListing",value:function(e,t,a,n){this.listings[e].push({sellerCityKey:n.cityKey,sellerBeanKey:n.key,price:a,seller:n,quantity:t})}},{key:"addNewEnterpriseListing",value:function(e,t,a,n){this.listings[e].push({sellerEnterpriseKey:n.key,price:a,seller:n,quantity:t})}},{key:"sort",value:function(e){this.listings[e].sort((function(e,t){return e.price-t.price}))}}]),e}(),Le=function e(){Object(l.a)(this,e),this.key=1,this.playerKey=1,this.organizations=[],this.name="Citizen's Party",this.slogan="Vote for us!",this.community="state",this.ideals="trad",this.availablePolicies=[],this.proposedPolicy=void 0,this.availableCampaigns=[],this.activeCampaigns=[],this.leadership=10,this.activeHQs=[],this.platform={}};function Re(e,t){return Array.isArray(e)?e.some((function(e){return qe(e,t)})):qe(e,t)}function qe(e,t){return t.has(e)}function ze(e){return Oe[e].icon+" "+Oe[e].noun}!function(e){e[e.Spring=0]="Spring",e[e.Summer=1]="Summer",e[e.Fall=2]="Fall",e[e.Winter=3]="Winter"}(Te||(Te={})),function(e){e[e.Midnight=0]="Midnight",e[e.Morning=1]="Morning",e[e.Noon=2]="Noon",e[e.Evening=3]="Evening"}(De||(De={}));var Ge={food_aid:{key:"food_aid",group:"Welfare",name:"Food Aid",axis:"wel_food",icon:"\ud83d\udc68\u200d\ud83c\udf3e",description:"The government buys Hungry Subjects food.",prereqs:[["Gluttony","Parochialism"],["Charity","Socialism"]]},medical_aid:{key:"medical_aid",group:"Welfare",name:"Med Aid",axis:"wel_health",icon:"\ud83d\udc69\u200d\u2695\ufe0f",description:"The government buys Sick Subjects medicine.",prereqs:["Charity","Cosmopolitanism"]},poll_tax:{key:"poll_tax",group:"Taxation",name:"Head Tax",axis:"tax_basic",prereqs:[],icon:"\ud83d\udc51",description:"Subjects must pay a flat tax."},sales_tax:{key:"sales_tax",group:"Taxation",name:"Sales Tax",axis:"tax_basic",prereqs:[],icon:"\ud83d\udcb8",description:"Subjects must pay a percentage tax for every transaction."},death_tax:{key:"death_tax",group:"Taxation",name:"Death Tax",axis:"tax_second",prereqs:[],icon:"\u2620\ufe0f",description:"Dead subjects pay a portion of their cash to the government."}},Ke=function(){function e(){Object(l.a)(this,e),this.lawTree={},this.treasury=new y(0)}return Object(c.a)(e,[{key:"getLawsByGroup",value:function(){return this.laws.reduce((function(e,t){return e[t.group].push(t),e}),{Taxation:[],Welfare:[],Economics:[],Crime:[],Culture:[]})}},{key:"isLaw",value:function(e){var t;return(null===(t=this.lawTree[Ge[e].axis])||void 0===t?void 0:t.key)===e}},{key:"enact",value:function(e){var t=Ge[e];this.lawTree[t.axis]=t}},{key:"revoke",value:function(e){var t=Ge[e];this.lawTree[t.axis]=void 0}},{key:"PurchaseQualifiesForWelfare",value:function(e,t){switch(t){case"food":return("starving"===e.food||"hungry"===e.food)&&this.isLaw("food_aid");case"medicine":return("sick"===e.health||"sickly"===e.health)&&this.isLaw("medical_aid")}return!1}},{key:"CanPayWelfare",value:function(e){return this.treasury.get>=e}},{key:"laws",get:function(){return Object.values(this.lawTree).flatMap((function(e){return e?[e]:[]}))},set:function(e){var t=this;e.forEach((function(e){t.lawTree[e.axis]=e}))}},{key:"salesTaxPercentage",get:function(){return this.isLaw("sales_tax")?.05:0}}]),e}();function We(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=[];return e.energy&&n.push(t+e.energy*a+" Energy"),e.bots&&n.push(t+e.bots*a+" Bots"),e.hedons&&n.push(t+e.hedons*a+" Hedons"),e.tortrons&&n.push(t+e.tortrons*a+" Antihedons"),n.join(" ")}var Ue={cost:{emptyHex:{build:{house:{energy:1,bots:3},farm:{energy:1,bots:3},theater:{energy:1,bots:4},hospital:{energy:1,bots:4},church:{energy:1,bots:4},courthouse:{energy:999,bots:999},park:{energy:1,bots:4},nature:{energy:1,bots:4}}},hex:{beam:{energy:3},upgrade:{energy:1,bots:4}},bean_brain:{brainwash_ideal:{sanity:4},brainimplant_secondary:{sanity:1},brainwash_secondary:{sanity:2}},bean:{scan:{energy:1},abduct:{bots:3},gift:{},empower:{},vaporize:{energy:2,bots:4},siphon:{}},market:{scrubHedons:{energy:5},resource:{bots:{hedons:6},energy:{hedons:5}},beliefs:{common:{},uncommon:{},rare:{}}}},bean_life:{vital_thresh:{food:{warning:.6,sufficient:1,abundant:3},shelter:{warning:.6,sufficient:1,abundant:7},medicine:{warning:.6,sufficient:1,abundant:3},fun:{warning:.1,sufficient:1,abundant:3}},degrade_per_tick:{food:1/12,health:.05,stamina:1/12,fun:1/6},penalty:{homeless_health:.05,starving_health:1/24},death_chance:{starvation:1/8,sickness:1/8,exposure:1/8,vaporization:1}},report_card_progression:[]},Ve={found_utopia:{key:"found_utopia",text:"Found your Utopia",check:function(e){return"Goodplace"!=e.party.name}},build_house_n_farm:{key:"build_house_n_farm",text:"Build a house and farm",check:function(e){return e.cities[0].book.getCountOfType("house")>0&&e.cities[0].book.getCountOfType("house")>0},reward:{energy:3,bots:3}},beam_3:{key:"beam_3",text:"Beam in 3 new beings",check:function(e){return e.beans.get.filter((function(e){return!e.bornInPetri})).length>=3+Rt}},scan:{key:"scan",text:"Scan a Subject",check:function(e){return Object.keys(e.alien.scanned_bean).length>0}},set_policy:{key:"set_policy",text:"Set a Gov Policy",check:function(e){return!1}},brainwash:{key:"brainwash",text:"Brainwash a Subject",check:function(e){return!1}},"c+_grade":{key:"c+_grade",text:"Receive a C+ Grade",check:function(e){return!1}}},Je={GradeWorld:function(e){return{Happiness:Qe(e.beans.get,(function(e){return e.lastHappiness>-.2})),Prosperity:Qe(e.beans.get,(function(e){return"hungry"!==e.food})),Stability:Qe(e.beans.get,(function(e){return"sane"===e.sanity})),Dogma:$e(e.alien.speechcrimes[e.date.year]||0,10,10)}},RubricDescription:{Happiness:"Subjects are at least 20% happy",Prosperity:"Subjects are not hungry",Stability:"Subjects are all sane",Dogma:"Up to 10 Speechcrimes"}};function $e(e,t,a){return Xe(1-Math.min(1,Math.max(0,e-t)/a))}function Qe(e,t){return e.length<1?"F":Xe(e.filter(t).length/e.length)}function Xe(e){return e<.58?"F":e<.68?"D":e<.78?"C":e<.88?"B":"A"}var Ye={A:5,B:4,C:3,D:2,F:1};var Ze={halve_sanity:{tech:"halve_sanity",name:"Surgical Psychops",techPoints:30,description:"Brainwashing causes -1 \ud83e\udde0 sanity damage"},fast_resources:{tech:"fast_resources",name:"0 Dimensional Supersiphons",techPoints:30,description:"Faster \u26a1\ufe0f and \ud83e\udd16 accumulation"},trauma_nanobots:{tech:"trauma_nanobots",name:"Trauma Nanobots",techPoints:30,description:"Spend \ud83e\udd16 to stop Subject from dying"},fast_leadership:{tech:"fast_leadership",name:"Advanced Marketing",techPoints:30,description:"Faster \ud83d\uddf3\ufe0f Leadership accumulation"},neural_duplicator:{tech:"neural_duplicator",name:"Level 2 Neural Duplication",techPoints:30,description:"Copy Traits 1 additional time"}},et=function(){function e(){Object(l.a)(this,e),this.scanned_bean={},this.seenBeliefs=new v(new Map),this.beliefInventory=new b([]),this.speechcrimes={},this.abductedBeans=[],this.energy={amount:16,income:2/30,change:new p},this.bots={amount:10,income:2/30,change:new p},this.hedons={amount:0,income:0,change:new p},this.tortrons={amount:0,income:0,change:new p},this.next_grade={year:1,season:3,day:1,hour:0},this.difficulty=Ue,this.goals=["found_utopia","build_house_n_farm","beam_3","scan","brainwash","set_policy","c+_grade"],this.goalProgress={},this.pastReportCards=[],this.workingReportCard={Happiness:"D",Prosperity:"D",Stability:"D",Dogma:"D"},this.techProgress={},this.currentlyResearchingTech=void 0}return Object(c.a)(e,[{key:"canAfford",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(void 0===e.bots||this.bots.amount>=e.bots*t)&&(void 0===e.energy||this.energy.amount>=e.energy*t)&&(void 0===e.hedons||this.hedons.amount>=e.hedons*t)}},{key:"hasResearched",value:function(e){return null!=this.techProgress[e]&&this.techProgress[e].researchPoints>=Ze[e].techPoints}},{key:"useCharge",value:function(e){var t=this.beliefInventory.get,a=t.find((function(t){return t.trait===e}));a&&(a.charges-=1,this.beliefInventory.set(Object(o.a)(t.filter((function(e){return e.charges>0})))))}},{key:"purchase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.bots&&(this.bots.amount-=e.bots*t,this.bots.change.publish({change:-e.bots*t})),e.energy&&(this.energy.amount-=e.energy*t,this.energy.change.publish({change:-e.energy*t})),e.hedons&&(this.hedons.amount-=e.hedons*t,this.hedons.change.publish({change:-e.hedons*t}))}},{key:"tryPurchase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return!!this.canAfford(e,t)&&(this.purchase(e,t),!0)}},{key:"reward",value:function(e){e.bots&&(this.bots.amount+=e.bots,this.bots.change.publish({change:e.bots})),e.energy&&(this.energy.amount+=e.energy,this.energy.change.publish({change:e.energy})),e.hedons&&(this.hedons.amount+=e.hedons,this.hedons.change.publish({change:e.hedons}))}},{key:"checkGoals",value:function(e){for(var t=0;t<this.goals.length;t++){var a=this.goals[t];if(null==this.goalProgress[a]&&(this.goalProgress[a]={done:!1,step:0}),!this.goalProgress[a].done){var n=Ve[a].check(e),i=Ve[a].reward;this.goalProgress[a].done=n,n&&null!=i&&this.reward(i)}}}},{key:"checkReportCard",value:function(e){this.workingReportCard=Je.GradeWorld(e)}}]),e}(),tt="drop.mp3",at="ding_soft.mp3",nt="ding_bad.wav",it="death_bell.wav",rt="scan.mp3",st="squish_pop.mp3",ot="squish_suck.mp3",lt="baby_squeak.wav",ct=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Object(l.a)(this,e),this.file=t,this.volume=a,this.buffer=[]}return Object(c.a)(e,[{key:"play",value:function(){if(this.buffer.length>0&&this.buffer[0].ended){var e=this.buffer.shift();null===e||void 0===e||e.play(),e&&this.buffer.push(e)}else{var t=new Audio("/socsim/"+this.file);t.volume=this.volume,t.play(),this.buffer.push(t)}}}]),e}(),ut=function(){function e(){Object(l.a)(this,e),this.lib={drop:new ct(tt,.2),love:new ct(at),happiness:new ct(at),unhappiness:new ct(nt),hate:new ct(nt),death:new ct(it),scan:new ct(rt,.3),wash_in:new ct(st),wash_out:new ct(ot),squeak:new ct(lt,.3)}}return Object(c.a)(e,[{key:"play",value:function(e){this.lib[e].play()}}]),e}(),ht={common:3,uncommon:5,rare:7},dt={common:3,uncommon:5,rare:7};function mt(){for(var e=[],t=0;t<3;t++){var a=Ft(Be);e.push(pt(a))}return e}function pt(e){var t=Oe[e].rarity;return{trait:e,cost:{hedons:ht[t]+At(0,dt[t])}}}var ft,yt={x:.94,y:.94},bt=60,vt=9,gt=10,Et={Brake:{x:.94,y:.94},AccelerateS:10,MaxSpeed:4,CollisionDistance:10},kt=function(){function e(){var t=this;Object(l.a)(this,e),this.bus=new f,this.economy=new Fe(this.bus),this.cities=[],this.law=new Ke,this.institutions=[],this.marketTraitsForSale=new b([]),this.party=new Le,this.date={year:1,season:Te.Spring,day:1,hour:1},this.alien=new et,this.sfx=new ut,this.onChat=function(e,a){t.party&&a.preachBelief&&_e(a.preachBelief,t.party.ideals,t.party.community)&&(t.publishEvent({icon:"\ud83d\udea8",trigger:"speechcrime",message:"Speechcrime! ".concat(e.name," is talking about ").concat(Oe[a.preachBelief].noun),beanKey:e.key}),null==t.alien.speechcrimes[t.date.year]?t.alien.speechcrimes[t.date.year]=1:t.alien.speechcrimes[t.date.year]++)},this.onBeanDie=function(e){var a=t.cities.find((function(t){return t.key===e.cityKey}));if(a){var n=a.historicalBeans.get.find((function(t){return t.key===e.beanKey}));n&&(a.onCitizenDie(n),t.economy.onBeanDie(n))}},this.onEmote=function(e,t){},this.bus.death.subscribe(this.onBeanDie),this.economy.law=this.law,this.marketTraitsForSale.set(mt())}return Object(c.a)(e,[{key:"beans",get:function(){return new b(this.cities.reduce((function(e,t){return e.concat(t.beans.get)}),[]))}},{key:"historicalBeans",get:function(){return new b(this.cities.reduce((function(e,t){return e.concat(t.historicalBeans.get)}),[]))}},{key:"organizations",get:function(){return this.institutions.reduce((function(e,t){return e.concat(t.organizations)}),[])}}]),Object(c.a)(e,[{key:"calculateComputedState",value:function(){var e=this;this.cities.forEach((function(t){t.calculate(e.economy,e.law),t.beans.get.forEach((function(a){return a.calculateBeliefs(e.economy,t,e.law,e.party)}))}))}},{key:"simulate_world",value:function(){var e=this;if(this.date.hour++,this.date.hour>De.Evening&&(this.date.hour=0,this.date.day++,this.simulate_every_day(),this.date.day%7===0&&this.simulate_every_week()),this.date.day>30&&(this.date.day=1,this.simulate_every_month(),this.date.season++),this.date.season>3&&(this.date.year++,this.simulate_every_year(),this.date.season=0),this.alien.bots.amount+=this.alien.bots.income,this.alien.energy.amount+=this.alien.energy.income,this.alien.hasResearched("fast_resources")&&(this.alien.bots.amount+=.5*this.alien.bots.income,this.alien.energy.amount+=.5*this.alien.energy.income),this.alien.currentlyResearchingTech){var t=this.alien.currentlyResearchingTech;null==this.alien.techProgress[t]&&(this.alien.techProgress[t]={researchPoints:0});var a=Ze[t].techPoints,n=this.alien.techProgress[t].researchPoints;n<a&&(this.alien.techProgress[t].researchPoints+=this.alien.abductedBeans.length),n>=a&&(this.alien.currentlyResearchingTech=void 0)}this.organizations.forEach((function(t){return t.work(e.law,e.economy)})),this.beans.get.forEach((function(t,a){t.age(e.economy,e.alien.difficulty);var n=t.maybeBaby(e.economy);n&&(e.publishEvent(n),e.sfx.play("squeak")),"jobless"===t.job&&t.tryFindRandomJob(e.law),t.happiness=Pe(t.hedonHistory)})),this.cities.forEach((function(t){return t.getTaxesAndDonations(e.party,e.economy)})),this.calculateComputedState(),this.alien.checkGoals(this),this.alien.checkReportCard(this)}},{key:"simulate_every_year",value:function(){this.inflate(),this.resetYearlyCounters()}},{key:"simulate_every_month",value:function(){this.economy.resetMonthlyDemand()}},{key:"simulate_every_week",value:function(){if(this.marketTraitsForSale.set(mt()),this.publishEvent({message:"New traits in the Emotion Market!",icon:"\ud83d\udecd\ufe0f",trigger:"marketrefresh"}),this.law.isLaw("poll_tax")){var e=0;this.cities.forEach((function(t){t.beans.get.forEach((function(t){t.cash>=.1&&(t.cash-=.1,e+=.1)}))})),this.law.treasury.set(this.law.treasury.get+e)}}},{key:"simulate_every_day",value:function(){this.beans.get.forEach((function(e){e.hedonHistory.length>=5&&e.hedonHistory.pop(),e.hedonHistory.unshift({})}))}},{key:"simulate_beans",value:function(e){var t=this;this.beans.get.forEach((function(a){!function(e,t,a,n){var i,r=e.state.act(e,t,a);e.onAct&&e.onAct.publish(t),r!=e.state&&(oe(e,r),"chat"===r.data.act&&"speaker"===(null===(i=r.data.chat)||void 0===i?void 0:i.participation)&&n.onChat(e,r.data.chat))}(a,e,t.alien.difficulty,t)}))}},{key:"simulate_pickups",value:function(e){for(var t=this.cities[0],a=t.pickups.get,n=a.length-1;n>=0;n--){var i=a[n],r=!1,s=t.pickupMagnetPoint.get;if(s?r=P(i,s,bt*e/1e3,vt,gt,yt):T(i,yt),r){var o=_t[i.type];this.alien.hedons.amount+=o,this.alien.hedons.change.publish({change:o}),t.pickups.remove(i),this.sfx.play(i.type)}else i.onMove.publish(i.point)}}},{key:"publishEvent",value:function(e){this.bus[e.trigger].publish(e)}},{key:"inflate",value:function(){var e=(this.beans.get.reduce((function(e,t){return e+t.cash}),0)+this.organizations.reduce((function(e,t){return e+t.cash}),0))/100,t=Math.round(1*e);if(t>0){var a=this.beans.get.reduce((function(e,t){return t.cash>e.max&&(e.winner=t,e.max=t.cash),e}),{max:0});a.winner&&(a.winner.cash+=t)}}},{key:"resetYearlyCounters",value:function(){this.cities.forEach((function(e){e.yearsPartyDonations=0}))}},{key:"addCharity",value:function(e,t,a){var n=new x;n.name=t,n.good=e,n.seasonalBudget=a,this.party.organizations.push(n)}}]),e}(),wt={state:"\ud83d\udd4a\ufe0f",ego:"\ud83e\udd85",prog:"\u2696\ufe0f",trad:"\ud83d\udc51",circle:"\ud83e\udd0e",square:"\ud83d\udc9b",triangle:"\ud83e\udde1",rocket:"\ud83d\ude80",music:"\ud83c\udfb5",dragon:"\ud83d\udc32",noFaith:"\u26ab\ufe0f",starving:"\ud83c\udf74",hungry:"\ud83c\udf7d\ufe0f",sated:"\ud83e\udd5c",stuffed:"\ud83e\udd69",homeless:"\ud83c\udf28\ufe0f",sleepy:"\ud83c\udf19",awake:"\u2600\ufe0f",rested:"\ud83c\udf1e",sick:"\ud83e\udd22",sickly:"\ud83d\ude37",bruised:"\ud83e\ude79",fresh:"\ud83d\udcaa",psychotic:"\ud83e\udd2a",disturbed:"\ud83e\udd24",stressed:"",sane:"\ud83e\udde0"};function jt(e){return 100*Math.min(1,Math.max(-1,e.reduce((function(e,t){return e+=t.mod}),0)))}!function(e){e[e.Deficient=-.25]="Deficient",e[e.Sufficient=0]="Sufficient",e[e.Abundant=.15]="Abundant"}(ft||(ft={}));var Ct={homeless:{reason:"Homeless",mod:ft.Deficient},sleepy:{reason:"Renting",mod:ft.Sufficient},awake:{reason:"Homeowner",mod:ft.Sufficient},rested:{reason:"Homeowner",mod:ft.Abundant},sick:{reason:"Sick",mod:ft.Deficient},sickly:{reason:"Sick",mod:ft.Sufficient},bruised:{reason:"Bruised",mod:ft.Sufficient},fresh:{reason:"Healthy",mod:ft.Abundant},starving:{reason:"Hungry",mod:ft.Deficient},hungry:{reason:"Hungry",mod:ft.Sufficient},sated:{reason:"Sated",mod:ft.Sufficient},stuffed:{reason:"Stuffed",mod:ft.Abundant}},xt={food:{warning:.5,sufficient:1,abundant:3},shelter:{warning:.5,sufficient:1,abundant:7},medicine:{warning:.5,sufficient:1,abundant:3},fun:{warning:.1,sufficient:1,abundant:3}};function St(e){switch(e){case"builder":return"shelter";case"doc":return"medicine";case"entertainer":return"fun";default:case"farmer":return"food"}}var Nt={food:"\ud83e\udd6a",shelter:"\ud83c\udfe0",medicine:"\ud83d\udc8a",fun:"\ud83d\udc4f"},Ot={love:"\ud83d\udc9b",happiness:"\ud83d\udc4d",unhappiness:"\ud83d\udca2",hate:"\ud83d\udc94"},_t={love:5,happiness:1,unhappiness:-1,hate:-5},Mt={love:1,happiness:.2,unhappiness:0,hate:-1},Bt=a(5);var Pt=function e(t,a,n){Object(l.a)(this,e),this.key=t,this.point=a,this.action=n},Tt=function e(t,a,n){Object(l.a)(this,e),this.key=t,this.point=a,this.type=n,this.velocity={x:0,y:0},this.onMove=new m},Dt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e,n){var i;return Object(l.a)(this,a),(i=t.call(this)).sfx=e,i.economy=n,i.name="",i.url="",i.type="",i.key=0,i.beans=new b([]),i.historicalBeans=new b([]),i.pickups=new b([]),i.ufos=[],i.pickupSeed=0,i.beanSeed=0,i.houses=[],i.partyHQ=void 0,i.yearsPartyDonations=0,i.majorityEthnicity="circle",i.costOfLiving=1,i.law=void 0,i.environment=void 0,i.eventBus=void 0,i.pickupMagnetPoint=new y(void 0),i}return Object(c.a)(a,[{key:"tryGetJob",value:function(e,t){if("jobless"===t)return!1;for(var a=this.book.getBuildings().filter((function(e){return e.type===Y[t]})),n=0;n<a.length;n++){var i=a[n],r=i.openSlots();if(r.length>0){var s=r.shift();return i.job_slots[s]=e.key,e.employerEnterpriseKey=i.key,C(i)&&null==i.ownerBeanKey&&(i.ownerBeanKey=e.key),!0}}return!1}},{key:"unsetJob",value:function(e){if("jobless"!==e.job)for(var t=this.book.getBuildings(),a=0;a<t.length;a++){if(t[a].tryFreeBean(e.key)){e.employerEnterpriseKey=void 0;break}}}},{key:"addEmotePickup",value:function(e,t){var a=Object(g.a)({},e);a.x+=At(-10,10),a.y+=At(-10,10);var n=++this.pickupSeed;this.pickups.push(new Tt(n,a,t))}},{key:"getRandomCitizen",value:function(){var e=function(e){for(var t=e.length;t>0;){var a=Math.floor(Math.random()*t),n=e[--t];e[t]=e[a],e[a]=n}return e}(this.beans.get);return e.length>0?e[0]:null}},{key:"onCitizenDie",value:function(e){if(e.cash>0)if(this.law&&this.law.isLaw("death_tax"))this.law.treasury.set(this.law.treasury.get+e.cash),e.cash=0;else{var t=this.getRandomCitizen();t&&(t.cash=t.cash+e.cash,e.cash=0)}this.unsetJob(e)}},{key:"breedBean",value:function(e){var t,a,n,i,r=zt(this,void 0,Math.random()<=.5?e.job:Ft(["doc","farmer","builder","jobless"]));r.ethnicity=e.ethnicity,r.name=r.name.split(" ")[0]+" "+e.name.split(" ")[1],r.cash=e.cash/2,e.cash/=2,r.bornInPetri=!0,this.environment&&(r.dob={year:null===(t=this.environment)||void 0===t?void 0:t.year,season:null===(a=this.environment)||void 0===a?void 0:a.season,day:null===(n=this.environment)||void 0===n?void 0:n.day,hour:null===(i=this.environment)||void 0===i?void 0:i.hour}),this.beans.push(r)}},{key:"getTaxesAndDonations",value:function(e,t){}},{key:"calculate",value:function(e,t){this.costOfLiving=e.getCostOfLiving();var a=this.beans.get.reduce((function(e,t){switch(t.ethnicity){case"circle":e.circle++;break;case"square":e.square++;break;case"triangle":e.triangle++}return e}),{circle:0,square:0,triangle:0});a.circle>a.square&&a.circle>a.triangle?this.majorityEthnicity="circle":a.square>a.circle&&a.square>a.triangle?this.majorityEthnicity="square":this.majorityEthnicity="triangle"}},{key:"getNearestNeighbors",value:function(e){return this.beans.get.filter((function(t){if(t.key==e.key)return!1;var a=t.point,n=e.point,i=Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2);return i<1600&&i>600}))}},{key:"getPopulationTraitsList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beans.get;return Array.from(t.reduce((function(t,a){return e[a.key]?a.beliefs.forEach((function(e){var a=t.get(e)||0;t.set(e,a+1)})):t.set("Unknown",(t.get("Unknown")||0)+1),t}),new Map).entries()).sort((function(e,t){var a=Object(Bt.a)(e,2),n=(a[0],a[1]),i=Object(Bt.a)(t,2);i[0];return i[1]-n})).map((function(e){var t=Object(Bt.a)(e,2),a=t[0],n=t[1];return"Unknown"===a?{icon:"\u2754",noun:"Unknown",count:n}:{icon:Oe[a].icon,noun:Oe[a].noun,count:n}}))}}]),a}(Z),It=function(){function e(){Object(l.a)(this,e),this.city=void 0,this.key=0,this.cityKey=0,this.address={q:0,r:0},this.type="farm",this.occupied_slots=[],this.empty_slots=[],this.upgraded=!1,this.job_slots={0:null,1:null,2:null,3:null,4:null,5:null},this.enterpriseType="company",this.ownerBeanKey=void 0,this.ticksSinceLastSale=0,this.bank=0}return Object(c.a)(e,[{key:"distributeCash",value:function(){var e=this,t=this.getWorkerBeans();switch(this.enterpriseType){case"company":if(t.length<1);else if(1===t.length)t[0].cash+=this.bank,this.bank=0;else{var a=this.bank/(t.length+.5);this.bank=0;var n=t.find((function(t){return t.key===e.ownerBeanKey}));null==n&&(n=t[0],this.ownerBeanKey=n.key),t.forEach((function(e){e.cash+=e===n?1.5*a:a}))}break;case"cooperative":var i=this.bank/t.length;this.bank=0,t.forEach((function(e){e.cash+=i}));break;case"commune":var r=this.bank/t.length;this.bank=0,t.forEach((function(e){e.cash+=r}))}}},{key:"getWorkerBeans",value:function(){var e=this,t=[],a=function(a){var n,i=null===(n=e.city)||void 0===n?void 0:n.beans.get.find((function(e){return e.key===+a}));i&&t.push(i)};for(var n in this.getBeanKeys())a(n);return t}},{key:"getBeanKeys",value:function(){var e=[],t=Object.keys(this.job_slots);for(var a in t){var n=+a,i=this.job_slots[n];null!=i&&e.push(i)}return e}},{key:"openSlots",value:function(){var e=this;return Object.keys(this.job_slots).filter((function(t,a){return null===e.job_slots[+t]&&(a<3||e.upgraded)})).map((function(e){return+e}))}},{key:"usedSlots",value:function(){var e=this;return Object.keys(this.job_slots).filter((function(t){return null!=e.job_slots[+t]})).map((function(e){return+e}))}},{key:"tryFreeBean",value:function(e){for(var t=this.usedSlots(),a=0;a<t.length;a++){var n=t[a];if(this.job_slots[n]===e)return this.job_slots[n]=null,!0}return!1}},{key:"cash",get:function(){return this.bank},set:function(e){this.bank+=e,this.distributeCash()}}]),e}();function At(e,t){var a=new Uint32Array(1);window.crypto.getRandomValues(a);var n=a[0]/4294967296;return e=Math.ceil(e),t=Math.floor(t),Math.floor(n*(t-e+1))+e}function Ft(e){return 1==e.length?e[0]:e[At(0,e.length-1)]}Math.PI;function Ht(e,t,a,n){var i=new It;i.type=t,i.key=e.book.getBuildings().length,i.address=a,e instanceof Dt&&(i.city=e),e.addBuilding(i);var r=Q[t];"fun"!=r&&n.employAndPrice(i,r,1,n.getFairGoodPrice(r))}function Lt(){var e=new kt;e.law.laws=[],e.party=new Le,e.institutions.push(e.party);for(var t=0;t<1;t++){e.cities.push(qt(e.cities.length,e.sfx,e.economy)),e.cities[t].eventBus=e.bus,e.cities[t].environment=e.date,e.cities[t].law=e.law;for(var a=0;a<e.cities[t].beans.get.length;a++){var n=e.cities[t].beans.get[a];n.work(e.law,e.economy),"farmer"==n.job&&n.work(e.law,e.economy)}}return e.economy.monthlyDemand.food=e.beans.get.length,e.economy.monthlyDemand.shelter=e.beans.get.length,e.economy.monthlyDemand.medicine=e.beans.get.length,e}var Rt=0;function qt(e,t,a){var n=new Dt(t,a);n.key=e,n.name=Ft(["New ","Old ","Fort ","St. ","Mount ","Grand ","","","","","","","","","",""]),n.name+=Ft(["Spring","Timber","Over","West","East","North","South","Rock","Sand","Clay","Iron","Ore","Coal","Liver","Hawk","Red","Yellow","Gold","Blue","Black","White","Sunny","Reed","Ox","Mill","Fern","Down","Bel","Bald","Ash"]),n.name+=Ft(["water "," Springs","ville","dale","lane","peak","coast","beach","port","market","ton","brook"," Creek","land","burgh","bridge","ford","bury","chester","son","vale"," Valley","hill","more","wood"," Oaks"," Cove","mouth","way","crest"]),Ht(n,"courthouse",n.hexes[0],n.economy),Ht(n,"nature",n.hexes[At(15,20)],n.economy),Ht(n,"nature",n.hexes[At(21,25)],n.economy),Ht(n,"nature",n.hexes[At(26,60)],n.economy);for(var i=Rt;n.beans.get.length<i;)n.beans.push(zt(n));return n}function zt(e,t,a){var n=new Ie;n.key=++e.beanSeed,n.cityKey=e.key,n.city=e,n.name=Ft(["Joe","Frank","Jill","Jose","Johnny","Isabelle","Carmen","Ace","Carl","Zander","Jean","Anne","Leslie","Ben","Ron","Ellen","Dallas","Kane","Ash","Jim","James","Leonard","Nyota","Christine","Scotty","Tasha","Geordi","Beverly","Deanna","Wesley","Majel","Malcolm","River","Luke","Han","Owen","Rey","Mace","Cody","Dana","Walter","Rick","Holden","Roy","Pris","Eldon","Rachael","Rose","Donna","Jack","Amy","Rory","Martha","Clara","Arnold","Dave","Holly","Kara","Gaius","William","Lee","Laura","Saul","Max","Edison","Theora","Bryce","Murray","Ned","Daniel","Samantha","Logan","Francis","Jessica","Thomas","Benny","James","John Henry","Sarah","Piper","Nick","Shaun","Preston"])+" ",n.name+=Ft(["Ripley","Bishop","Hicks","Vasquez","Hudson","Rico","Flores","Ibanez","Levy","Jenkins","Barlow","Zim","Rasczak","Kirk","McCoy","Sulu","Uhura","Chekov","Chapel","Rand","Riker","Crusher","Barret","O'Brien","Reynolds","Tam","Scully","Mulder","Skinner","Connor","Rex","Thrace","Baltar","Smith","Adama","Roslin","Tigh","Song","Oswald","Deckard","Bryant","Tyrell","Sebastian","Voight","Kampff","Tyler","Harkness","Jones","Noble","Pond","Williams","Rimmer","Lister","Head","Carter","Lynch","McKenzie","Grossberg","O'Neil","Jackson","Carter","Whitmore","House","Mitchell","Eden","Lyons","Valentine","Garvey"]),n.community=Ft(["state","ego"]),n.ideals=Ft(["prog","trad"]),n.faith=Ft(["rocket","music","dragon","noFaith"]);for(var i=Math.ceil(3*Math.random());n.beliefs.length<i;){var r=Ft(Be);n.beliefs.includes(r)||n.beliefs.push(r)}if(null==a)switch(e.beanSeed){case 1:a="farmer";break;case 2:a="builder";break;case 3:a="doc";break;default:a=Ft(["farmer","builder","doc","entertainer"])}return n.trySetJob(a),n.cash=function(e){var t=4+Math.floor(3*Math.random());switch(e){case"doc":return t+2;default:return t}}(n.job),n.discrete_food=3,n.point=z(e.hex_size,e.petriOrigin,t||function(e){var t=e.book.getRandomBuildingOfType("house");return t?t.address:{q:0,r:0}}(e)),n}var Gt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={show:!1},n}return Object(c.a)(a,[{key:"getButton",value:function(){var e=this;return this.props.hideCloseButton?null:i.a.createElement("button",{type:"button",className:"done",onClick:function(){return e.props.onClick()}},this.props.closeButtonText||"Done")}},{key:"render",value:function(){return this.props.show?i.a.createElement("div",{className:"modal"},this.props.children,this.getButton()):null}}]),a}(i.a.Component),Kt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={},n}return Object(c.a)(a,[{key:"header",value:function(){return this.props.children?i.a.createElement("b",null,this.props.children):null}},{key:"render",value:function(){var e=this,t=this.props.beans.filter((function(t){return e.props.need(t)==e.props.dire})).length,a={width:Math.floor(t/this.props.beans.length*100)+"%"},n=this.props.beans.filter((function(t){return e.props.need(t)==e.props.abundant})).length,r={width:Math.floor(n/this.props.beans.length*100)+"%"};return i.a.createElement("div",{className:this.props.className},this.header(),i.a.createElement("div",{className:"bar"},i.a.createElement("div",{className:"bar-inner dire",style:a},t>0?"".concat(t," ").concat(za[this.props.dire]):""),i.a.createElement("div",{className:"bar-inner abundant",style:r},n>0?n:"")))}}]),a}(i.a.Component),Wt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t="card button";return this.props.thin&&(t+=" thin"),this.props.singleLine&&(t+=" single"),i.a.createElement("button",{className:t,title:this.props.title,onClick:function(){e.props.onClick&&e.props.onClick()},type:"button",disabled:this.props.disabled},this.props.icon," ",this.props.name,null!=this.props.subtext?i.a.createElement("small",null,this.props.subtext):null)}}]),a}(i.a.Component);function Ut(e,t,a){switch(t){case"trad":case"prog":case"ego":case"state":return i.a.createElement(Wt,{icon:wt[t],title:Se[t].description,name:"",subtext:za[t],thin:!0,singleLine:!0,onClick:a});case"fresh":case"sick":case"hungry":case"starving":case"stuffed":case"homeless":case"rested":case"circle":case"square":case"triangle":case"sane":case"disturbed":case"stressed":return i.a.createElement(Wt,{icon:wt[t],title:za[t],name:"",subtext:za[t],thin:!0,singleLine:!0,onClick:a});case"noFaith":case"rocket":case"dragon":case"music":return i.a.createElement(Wt,{icon:wt[t],title:Ne[t].description,name:"",subtext:za[t],thin:!0,singleLine:!0,onClick:a});default:return null}}var Vt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={},n}return Object(c.a)(a,[{key:"render",value:function(){var e,t,a=this,n=i.a.createElement("div",null,"Human Emotion Farm",i.a.createElement("div",null,i.a.createElement("small",null,"Part of the \ud83c\udf0c Galactic Xenosensation Federation")));this.props.city&&(n=i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("b",null,this.props.city.name),i.a.createElement("button",{type:"button",className:"pull-r",onClick:function(){return a.props.clearCity()}},"\u274c"))));var r=this.props.beans.get.reduce((function(e,t){return e+t.lastHappiness}),0)/(this.props.beans.get.length||1),s=this.props.beans.get.reduce((function(e,t){return e+t.cash}),0)/(this.props.beans.get.length||1);return i.a.createElement("div",null,n,i.a.createElement("div",{className:"header"},i.a.createElement("b",null,"\ud83d\udc65 Subjects")),i.a.createElement("div",null,i.a.createElement("b",null,"Population"),"\xa0",i.a.createElement("span",null,this.props.beans.get.length)),i.a.createElement(Kt,{beans:this.props.beans.get,need:function(e){return e.food},dire:"starving",abundant:"stuffed"},"Food Security"),i.a.createElement(Kt,{beans:this.props.beans.get,need:function(e){return e.stamina},dire:"homeless",abundant:"rested"},"Housing"),i.a.createElement(Kt,{beans:this.props.beans.get,need:function(e){return e.health},dire:"sick",abundant:"fresh"},"Healthcare"),i.a.createElement("b",null,"Avg. Money")," $",s.toFixed(2)," \xa0",i.a.createElement("b",null,"Avg. Happiness")," ",Math.round(r),"%",this.props.city?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"header"},i.a.createElement("b",null,"\ud83e\udde0 Traits")),i.a.createElement("div",{className:"max-w-300"},this.props.city.getPopulationTraitsList(this.props.alien.scanned_bean).map((function(e){return i.a.createElement("span",{key:e.noun,className:"overview-belief"},e.icon,"\xa0",e.noun,"\xa0x",e.count)})))):null,(null===(e=this.props.city)||void 0===e||null===(t=e.beans.get)||void 0===t?void 0:t.length)?i.a.createElement("div",{className:"card-parent"},i.a.createElement(Wt,{icon:"\ud83d\udef0\ufe0f",name:"Scan All",disabled:!0,subtext:"-Energy +Info",onClick:function(){}})):null)}}]),a}(i.a.Component),Jt=(i.a.Component,function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={showBeam:!1},setTimeout((function(){n.setState({showBeam:!0}),setTimeout((function(){n.setState({showBeam:!1})}),1800)}),1800),n}return Object(c.a)(a,[{key:"render",value:function(){var e=Object(g.a)({},K(z(this.props.city.hex_size,this.props.city.petriOrigin,this.props.ufo.point)));return i.a.createElement("span",{style:e,className:"ufo"},"\ud83d\udef8",this.state.showBeam?i.a.createElement("span",{className:"beam"}):null)}}]),a}(i.a.Component)),$t=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).animations=[],n.finishedAnimationCount=0;for(var r=[],s=0;s<n.props.particleCount;s++)r.push(i.a.createRef());return n.state={active:!0,parts:r},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.animations=this.state.parts.map((function(t){if(t.current){var a=Math.floor(400*Math.random())-200,n=Math.floor(400*Math.random())-400;return t.current.animate([{transform:"translate(0px, 0px)",opacity:1},{transform:"translate(".concat(a,"px, ").concat(n,"px)"),opacity:0}],{duration:1500+1e3*Math.random(),easing:"ease-in-out",delay:e.props.delay+100*Math.random()})}return null})),this.animations.forEach((function(t){t&&(t.onfinish=function(){e.finishedAnimationCount++,e.finishedAnimationCount>=e.props.particleCount&&e.setState({active:!1,parts:[]})})}))}},{key:"render",value:function(){return i.a.createElement("div",{className:(this.props.className||"")+" particle-parent"},this.state.active?this.state.parts.map((function(e,t){return i.a.createElement("div",{key:t,className:"particle",ref:e})})):null)}}]),a}(i.a.Component),Qt=(i.a.Component,a(25),{"death-exposure":[{start:0,name:"death-exposure",faceOV:"\ud83e\udd76",beanClasses:"drop-tool turn-blue",particles:[]},{start:2e3,name:"death-exposure",faceOV:"\ud83d\udc80",beanClasses:"drop-tool turn-blue",particles:[]}],"death-vaporization":[{start:0,name:"death-vaporization",beanClasses:"",particles:[]},{start:1e3,name:"death-vaporization",beanClasses:"drop-tool",particles:[]},{start:2e3,name:"death-vaporization",beanClasses:"drop-tool",faceOV:" ",particles:[{className:"head",delay:0}]},{start:3e3,name:"death-vaporization",beanClasses:"drop-tool hide-body",faceOV:" ",particles:[{className:"head",delay:0},{className:"body",delay:0}]}],"death-sickness":[{start:0,name:"death-sickness",faceOV:"\ud83e\udd22",beanClasses:"",particles:[]},{start:1e3,name:"death-sickness",beanClasses:"drop-tool",faceOV:"\ud83e\udd2e",particles:[{className:"head",delay:0}]},{start:1400,name:"death-sickness",beanClasses:"drop-tool",faceOV:"\ud83e\udd2e",particles:[{className:"head",delay:0},{className:"head",delay:0}]},{start:2e3,name:"death-sickness",beanClasses:"drop-tool",faceOV:"\ud83d\udc80",particles:[{className:"head",delay:0}]}],"death-starvation":[{start:0,name:"death-starvation",faceOV:"\ud83e\udd7a",beanClasses:"",particles:[]},{start:500,name:"death-starvation",faceOV:"\ud83d\ude16",beanClasses:"body-shrink",particles:[]},{start:1e3,name:"death-starvation",faceOV:"\ud83d\ude2b",beanClasses:"body-shrink drop-tool",particles:[]},{start:3e3,name:"death-starvation",faceOV:"\ud83d\udc80",beanClasses:"body-shrink drop-tool",particles:[]}]}),Xt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).lastTickMS=0,n.currentTime=0,n.tickHandle=0,n.tick=function(e){var t=e-n.lastTickMS;if(n.lastTickMS=e,t>0){n.currentTime+=t;var a="".concat(n.props.event.trigger,"-").concat(n.getSubtype(n.props.event.message));n.setState(Qt[a].reduce((function(e,t){return n.currentTime>=t.start?t:e}),Qt[a][0]))}n.tickHandle=window.requestAnimationFrame(n.tick)};var i="".concat(n.props.event.trigger,"-").concat(n.getSubtype(n.props.event.message));return n.state=Qt[i][0],n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;window.requestAnimationFrame((function(t){e.lastTickMS=t,e.tickHandle=window.requestAnimationFrame(e.tick)}))}},{key:"componentWillUnmount",value:function(){window.cancelAnimationFrame(this.tickHandle)}},{key:"getSubtype",value:function(e){return e.includes("vaporiz")?"vaporization":e.includes("exposure")?"exposure":e.includes("sickness")?"sickness":"starvation"}},{key:"render",value:function(){var e,t,a=this;this.props.event.point&&(t=K(null===(e=this.props.event)||void 0===e?void 0:e.point));var n=[this.props.bean.job,this.props.bean.ethnicity,this.state.name,this.state.beanClasses].join(" ");return i.a.createElement("div",{className:"spotlight",style:t},i.a.createElement("div",{className:"bean-parent"},i.a.createElement("span",{className:n+" bean"},i.a.createElement("span",{className:"bean-face"},this.state.faceOV||this.props.bean.getFace())),this.state.particles.map((function(e,t){return i.a.createElement($t,{key:t,className:a.state.name+" "+e.className,delay:e.delay,particleCount:30})}))),i.a.createElement("div",{className:"label"},this.props.event.message.replace("A subject",this.props.bean.name)),"death"===this.props.event.trigger?i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{className:"card button",disabled:!0},"Prevent Death",i.a.createElement("br",null),"-4 \ud83e\udd16")):null)}}]),a}(i.a.Component);var Yt=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).animate=function(e){var t;n.setState({spin:"work"==n.props.bean.state.data.act,face:n.props.bean.getFace(),good:(t=n.props.bean,"buy"==t.state.data.act&&"shelter"!=t.state.data.good?Nt[n.props.bean.state.data.good||"food"]:void 0),speech:n.props.bean.getSpeech()})},n.delaySeedSec=void 0,n.delaySeedSec=60*Math.random()+n.props.bean.key,n.state={paused:!1,spin:!1,face:e.bean.getFace()},e.bean.onAct.subscribe(n.animate),n}return Object(c.a)(a,[{key:"getPurchase",value:function(){if(this.state.good)return i.a.createElement("span",{className:"purchase"},i.a.createElement("span",{className:"money"},"\ud83d\udcb8"),i.a.createElement("span",{className:"purchase-good"},this.state.good))}},{key:"getSpeech",value:function(){if(this.state.speech)return i.a.createElement("span",{className:"speech"},i.a.createElement("span",{className:""},this.state.speech))}},{key:"render",value:function(){var e=this,t=this.props.bean.job+" "+this.props.bean.ethnicity;t+=this.state.paused||!this.props.bean.alive?" paused":"",this.props.sitStill||(t+=" bean-walker",this.state.spin&&(t+=" spin"),this.props.selected&&(t+=" selected"),"travel"!=this.props.bean.state.data.act&&(t+=" paused"));var a={animationDelay:"-"+this.delaySeedSec+"s"};a.animationDelay="";return i.a.createElement("span",{className:t+" bean interactable",style:a,title:"",onClick:function(t){t.stopPropagation(),e.props.onClick()}},this.state.face," ",this.getPurchase()," ",this.getSpeech())}}]),a}(i.a.Component),Zt=function(e){var t=Object(n.useState)(!1),a=Object(Bt.a)(t,2),r=a[0],s=a[1],o=i.a.useContext(Ga);return Object(n.useEffect)((function(){!r&&o&&(o.play("drop"),s(!0))})),i.a.createElement("span",{className:"pickup bob"},Ot[e.pickup.type])},ea=function(e){var t=Object(n.useRef)(null),a=function(e){t.current&&e&&(t.current.style.transform="translate(".concat(e.x,"px, ").concat(e.y,"px)"))};return Object(n.useEffect)((function(){return e.onMove.subscribe(a),a(e.startPoint),function(){return e.onMove.unsubscribe(a)}}),[]),i.a.createElement("div",{ref:t},e.children)},ta=function(e){var t=Object(n.useState)(e.pickups.get),a=Object(Bt.a)(t,2),r=a[0],s=a[1],o=function(e){s(e)};return Object(n.useEffect)((function(){return e.pickups.onChange.subscribe(o),function(){return e.pickups.onChange.unsubscribe(o)}}),[]),i.a.createElement(i.a.Fragment,null,r.map((function(e){return i.a.createElement(ea,{onMove:e.onMove,key:e.key,startPoint:e.point},i.a.createElement(Zt,{pickup:e}))})))},aa=function(e){var t=Object(n.useState)(e.beans.get),a=Object(Bt.a)(t,2),r=a[0],s=a[1],o=function(e){s(e)};return Object(n.useEffect)((function(){return e.beans.onChange.subscribe(o),function(){return e.beans.onChange.unsubscribe(o)}}),[]),i.a.createElement(i.a.Fragment,null,r.map((function(t){return i.a.createElement(ea,{onMove:t.onMove,key:t.key,startPoint:t.point},i.a.createElement(Yt,{bean:t,selected:t.key===e.activeBeanID,onClick:function(){return e.onBeanClick(t)}}))})))},na=function(e){var t=Object(n.useState)(e.city.book.getBuildings()),a=Object(Bt.a)(t,2),r=a[0],s=a[1],o=function(){s(e.city.book.getBuildings())};return Object(n.useEffect)((function(){return e.city.book.db.onChange.subscribe(o),function(){return e.city.book.db.onChange.unsubscribe(o)}})),i.a.createElement(i.a.Fragment,null,r.map((function(t){return i.a.createElement(ne,{city:e.city,key:t.key,building:t})})))},ia=function(e){var t=Object(n.useRef)(null),a=Object(n.useState)(e.pickupMagnetPoint.get),r=Object(Bt.a)(a,2),s=r[0],o=r[1],l=function(e){o(e),t.current&&e&&(t.current.style.transform="translate(".concat(e.x,"px, ").concat(e.y,"px)"))};return Object(n.useEffect)((function(){return e.pickupMagnetPoint.onChange.subscribe(l),l(e.pickupMagnetPoint.get),function(){return e.pickupMagnetPoint.onChange.unsubscribe(l)}})),s?i.a.createElement("div",{className:"magnet",ref:t},"\ud83e\uddf2"):null},ra=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).mtn_transforms=[],n.state={};for(var i=0;i<72;i++){var r=G({r:530,az:5*i*Math.PI/180});r.x+=550,r.y+=550,n.mtn_transforms.push(K(r))}return n}return Object(c.a)(a,[{key:"renderSpotlight",value:function(){var e=this;if(this.props.spotlightEvent){var t=this.props.city.historicalBeans.get.find((function(t){var a;return t.key===(null===(a=e.props.spotlightEvent)||void 0===a?void 0:a.beanKey)}));if(this.props.spotlightEvent.point&&t)return i.a.createElement(Xt,{event:this.props.spotlightEvent,bean:t})}return null}},{key:"renderHexes",value:function(){var e=this;return this.props.city.hexes.map((function(t,a){var n=z(e.props.city.hex_size,e.props.city.petriOrigin,t);return i.a.createElement("div",{className:"hex",key:a,style:K(n),onMouseEnter:function(t){e.props.city.pickupMagnetPoint.set(n)},onClick:function(a){return e.props.onHexClick(t),a.stopPropagation(),!1}})}))}},{key:"render",value:function(){var e=this,t=(this.props.city.historicalBeans.get.filter((function(e){return!e.alive})).map((function(e,t){return i.a.createElement("span",{key:t,className:"dead",style:{left:10*t+"px"}},"\u26b0\ufe0f")})),this.props.city.ufos.map((function(t,a){return i.a.createElement(Jt,{ufo:t,key:t.key,city:e.props.city})}))),a=this.mtn_transforms.map((function(e,t){return i.a.createElement("span",{key:t,style:e,className:"mtn"},"\u26f0\ufe0f")}));return i.a.createElement("div",{className:"tile",onClick:function(){return e.props.onClick()},onMouseLeave:function(){e.props.city.pickupMagnetPoint.set(void 0)}},i.a.createElement("svg",{style:{width:"100%",height:"100%"},className:"petri-base"},i.a.createElement("circle",{cx:"50%",cy:"50%",r:"50%",stroke:"grey",fill:"rgba(255, 255, 255, 1)"})),this.renderHexes(),a,i.a.createElement(na,{city:this.props.city}),i.a.createElement(ta,{pickups:this.props.city.pickups}),i.a.createElement(aa,{beans:this.props.city.beans,activeBeanID:this.props.activeBeanID,onBeanClick:function(t){return e.props.onBeanClick(t)}}),t,i.a.createElement(ia,{pickupMagnetPoint:this.props.city.pickupMagnetPoint}),i.a.createElement("svg",{style:{width:"100%",height:"100%"},className:"petri-lid"},i.a.createElement("circle",{cx:"50%",cy:"50%",r:"50%",stroke:"grey",fill:"rgba(255, 255, 255, 0.2)"})),this.renderSpotlight())}}]),a}(i.a.Component);function sa(e){if(0===e.length)return 0;e.sort((function(e,t){return e-t}));var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2}var oa=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={paused:!1},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this.props.world.beans.get,t=sa(e.map((function(e){return e.discrete_food}))),a=sa(e.map((function(e){return e.discrete_health}))).toFixed(1),n=sa(e.map((function(e){return e.discrete_stamina}))).toFixed(1),r=e.reduce((function(e,t){return e+t.cash}),0),s=r/(e.length||1),o=sa(e.map((function(e){return e.cash}))),l=e.filter((function(e){return e.cash<1})).length,c=Math.max(s,o),u=e.filter((function(e){return e.cash>c})),h=u.length/(e.length||1)*100,d=u.reduce((function(e,t){return e+t.cash}),0)/r*100,m=e.reduce((function(e,t){return e[t.job]=(e[t.job]||0)+1,e}),{}),p=((m.jobless||0)/e.length*100).toFixed(1);function f(e,t){return e.supply+=t.quantity,e.price+=t.price,e.count++,e.avg=e.price/e.count,e}var y=this.props.world.economy.market.listings.food.reduce(f,{supply:0,price:0,avg:0,count:0}),b=this.props.world.economy.market.listings.medicine.reduce(f,{supply:0,price:0,avg:0,count:0}),v=this.props.world.economy.market.listings.shelter.reduce(f,{supply:0,price:0,avg:0,count:0});return i.a.createElement("div",null,i.a.createElement("div",{className:"pad-4p"},i.a.createElement("h2",null,"State of the Utopia")),i.a.createElement("div",{className:"col-2"},i.a.createElement("div",null,i.a.createElement("strong",null,"\ud83c\udf5e Food Security"),i.a.createElement(Kt,{beans:this.props.world.beans.get,need:function(e){return e.food},dire:"hungry",abundant:"stuffed",className:"big"}),i.a.createElement("table",{className:"width-100p"},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,"Median ",t.toFixed(1)," \ud83c\udf5e"),i.a.createElement("td",{className:"text-center"},"Supply: ",y.supply," \ud83c\udf5e @ $",y.avg.toFixed(2)),i.a.createElement("td",{className:"text-right"},"Deficit: ",this.props.world.economy.unfulfilledMonthlyDemand.food," \ud83c\udf5e"))))),i.a.createElement("div",null,i.a.createElement("strong",null,"\ud83e\ude7a Healthcare"),i.a.createElement(Kt,{beans:this.props.world.beans.get,need:function(e){return e.health},dire:"sick",abundant:"fresh",className:"big"}),i.a.createElement("table",{className:"width-100p"},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,"Median ",a," \ud83e\ude7a"),i.a.createElement("td",{className:"text-center"},"Supply: ",b.supply," \ud83e\ude7a @ $",b.avg.toFixed(2)),i.a.createElement("td",{className:"text-right"},"Deficit: ",this.props.world.economy.unfulfilledMonthlyDemand.medicine," \ud83e\ude7a")))))),i.a.createElement("div",{className:"col-2"},i.a.createElement("div",null,i.a.createElement("strong",null,"\ud83c\udfe1 Housing")," ",i.a.createElement("br",null),i.a.createElement(Kt,{beans:this.props.world.beans.get,need:function(e){return e.stamina},dire:"homeless",abundant:"rested",className:"big"}),i.a.createElement("table",{className:"width-100p"},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,"Median ",n," \ud83c\udfe1"),i.a.createElement("td",{className:"text-center"},"Supply: ",v.supply," \ud83c\udfe1 @ $",v.avg.toFixed(2)),i.a.createElement("td",{className:"text-right"},"Deficit: ",this.props.world.economy.unfulfilledMonthlyDemand.shelter," \ud83c\udfe1")))))),i.a.createElement("div",{className:"col-2"},i.a.createElement("div",null,i.a.createElement("strong",null,"\ud83d\udcb0 Wealth")," ",i.a.createElement("br",null),l," penniless citizens \xa0 \xa0 Cost of Living: $",this.props.world.economy.getCostOfLiving().toFixed(2)," ",i.a.createElement("br",null),i.a.createElement("table",{className:"width-100p"},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,"Total $",r.toFixed(2)),i.a.createElement("td",{className:"text-center"},"Median: $",o.toFixed(2)),i.a.createElement("td",{className:"text-right"},"Avg: $",s.toFixed(2))))),"Top ",h.toFixed(1),"% of subjects own ",d.toFixed(1),"% of the wealth"),i.a.createElement("span",null,i.a.createElement("strong",null,"Unemployment")," ",p,"% (",m.jobless,")",i.a.createElement("br",null),i.a.createElement("ul",{className:"boxes"},i.a.createElement("li",null,m.farmer||0," farmers"),i.a.createElement("li",null,m.builder||0," builders"),i.a.createElement("li",null,m.doc||0," doctors"),i.a.createElement("li",null,m.entertainer||0," entertainers")))))}}]),a}(i.a.Component);var la=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props.events.map((function(t,a){var n="\ud83d\udea8"===t.icon,r="nojobslots"===t.trigger;return i.a.createElement("div",{key:a,className:n||r?"tall":""},i.a.createElement("span",{className:n?"police-siren":""},t.icon),"\xa0",function(e){return null!=e.beanKey&&("speechcrime"===e.trigger||"birth"===e.trigger)}(t)?i.a.createElement("a",{onClick:function(){return e.props.selectBean(t.beanKey)},href:"javascript:void(0)"},t.message):i.a.createElement("span",null,t.message))}));return 0===this.props.events.length&&(t=[i.a.createElement("div",{key:0},i.a.createElement("small",null,"No events yet"))]),i.a.createElement("div",{className:"events-panel"},i.a.createElement("div",null,i.a.createElement("b",null,"Events")),t)}}]),a}(i.a.Component),ca=(a(26),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return i.a.createElement("small",null,We(this.props.cost,"-",this.props.qty)," ",this.props.rider)}}]),a}(i.a.Component)),ua=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).scan=function(){n.props.scan(n.props.bean)&&(n.setState({faceOverride:"\ud83e\udd28"}),n._resetFace())},n.vaporize=function(){n.props.vaporize(n.props.bean),n.setState({faceOverride:"\ud83d\udc80"}),n._resetFace()},n.support=function(){n.setState({faceOverride:"\ud83e\udd29"}),n._resetFace()},n.abduct=function(){n.props.abduct(n.props.bean),n.setState({faceOverride:"\ud83d\ude28"}),n._resetFace()},n.state={innerView:"beliefs"},n}return Object(c.a)(a,[{key:"_resetFace",value:function(){var e=this;setTimeout((function(){e.setState({faceOverride:void 0})}),5e3)}},{key:"happyTable",value:function(e){return e.filter((function(e){return 0!=e.mod})).map((function(e,t){return i.a.createElement("tr",{key:t},i.a.createElement("td",{className:"small text-right"},e.reason),i.a.createElement("td",{className:"small"},Math.round(100*e.mod),"%"))}))}},{key:"hedonTable",value:function(){var e=this;return Object.keys(this.props.bean.happiness.all).map((function(t,a){return i.a.createElement("tr",{key:a},i.a.createElement("td",{className:"small text-right"},e.props.bean.happiness.all[t]," ",e.props.bean.happiness.all[t]>=0?Ot.happiness:Ot.unhappiness," from "),i.a.createElement("td",{className:"small"},t))}))}},{key:"renderInner",value:function(){var e=this;if(!this.scanned)return i.a.createElement("div",{className:"width-100p text-center"},i.a.createElement("small",null,"Subject needs a Scan to reveal their thoughts"));switch(this.state.innerView){case"beliefs":return this.scanned?this.beliefTable(this.props.bean.beliefs):null;case"feelings":return i.a.createElement("table",{className:"width-100p"},i.a.createElement("tbody",null,this.scanned?this.hedonTable():null));case"priorities":return i.a.createElement("table",{className:"width-100p"},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",null,"Currently ",this.props.bean.state.display)),we(this.props.bean,this.props.alien.difficulty).values.map((function(e){return i.a.createElement("tr",{key:"p-".concat(e.value.act,"-").concat(e.value.good)},i.a.createElement("td",null,e.priority.toFixed(1)," ",function(e){switch(e.act){case"work":return e.good?"\ud83d\udcaa "+Nt[e.good]:"\ud83d\udcaa";case"buy":return"shelter"==e.good?"\ud83d\ude34":e.good?"\ud83d\udcb8 "+Nt[e.good]:"\ud83d\udcb8"}return""}(e.value)))})),this.actDurations().filter((function(t){return e.props.bean.activity_duration[t]>0})).map((function(t){var a=t;return i.a.createElement("tr",{key:a},i.a.createElement("td",null,t),i.a.createElement("td",null,(e.props.bean.activity_duration[a]/1e3).toFixed(1),"s"))}))))}}},{key:"actDurations",value:function(){var e=this,t=Object.keys(this.props.bean.activity_duration).map((function(e){return e}));return t.sort((function(t,a){return e.props.bean.activity_duration[a]-e.props.bean.activity_duration[t]})),t}},{key:"beliefTable",value:function(e){return e.map((function(e,t){var a,n="belief-name shadow text-left "+Oe[e].rarity;return i.a.createElement("table",{className:"width-100p",key:e+t},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("th",{className:n},Oe[e].icon," ",Oe[e].adj),i.a.createElement("td",{className:"text-right"},(Oe[e].idealPro||[]).map((function(e){return i.a.createElement("span",{key:e},"+",wt[e])})),(Oe[e].idealCon||[]).map((function(e){return i.a.createElement("span",{key:e},"-",wt[e])})))),i.a.createElement("tr",null,i.a.createElement("td",{className:"small text-center",colSpan:2},Oe[e].description?null===(a=Oe[e].description)||void 0===a?void 0:a.split(";").map((function(e,t){return i.a.createElement("div",{key:t},e)})):null))))}))}},{key:"renderTraits",value:function(){if(this.scanned){var e=this.props.brainwash.bind(this);return i.a.createElement("div",null,i.a.createElement("div",{className:"card-parent"},Ut(this.props.bean,this.props.bean.ethnicity,void 0),Ut(this.props.bean,this.props.bean.faith,e)),i.a.createElement("div",{className:"card-parent"},Ut(this.props.bean,this.props.bean.ideals,e),Ut(this.props.bean,this.props.bean.community,e)),i.a.createElement("div",{className:"card-parent"},Ut(this.props.bean,this.props.bean.food,void 0),Ut(this.props.bean,this.props.bean.stamina,void 0),Ut(this.props.bean,this.props.bean.health,void 0)))}return i.a.createElement("div",{className:"card-parent"},i.a.createElement(Wt,{icon:"\ud83d\udef0\ufe0f",name:"Scan",subtext:"-Energy +Info",onClick:this.scan,disabled:!this.props.alien.canAfford(this.props.alien.difficulty.cost.bean.scan)}))}},{key:"render",value:function(){var e=this,t=this.props.bean.job+" "+this.props.bean.ethnicity;return i.a.createElement("div",{className:"vertical bean-panel"},i.a.createElement("div",{className:"bean-panel-header"},i.a.createElement("div",null,i.a.createElement("b",null,this.props.bean.name,"\xa0",i.a.createElement("small",null,"of ",this.props.city.name)),i.a.createElement("button",{type:"button",className:"pull-r",onClick:function(){return e.props.clearCity()}},"\u274c")),i.a.createElement("div",{className:"bean-view"},i.a.createElement("span",{className:t+" bean"},void 0===this.state.faceOverride?this.props.bean.getFace():this.state.faceOverride)),i.a.createElement("div",{className:"horizontal"},i.a.createElement("span",{className:"text-center"},"\ud83d\udcb0 $",this.props.bean.cash.toFixed(2)),i.a.createElement("span",{className:"text-center"},"\ud83d\ude42 ",Math.round(this.props.bean.lastHappiness),"%"),i.a.createElement("span",{className:"text-center"},Math.round(this.props.bean.happiness.flatAverage)," ",Ot.happiness," /day")),this.renderTraits()),i.a.createElement("div",{className:"grow-1 pad-4"},i.a.createElement("div",{className:"cylinder blue-orange horizontal"},i.a.createElement("button",{type:"button",className:"beliefs"==this.state.innerView?"active":"",onClick:function(){return e.setState({innerView:"beliefs"})}},"\ud83d\ude07 Traits"),i.a.createElement("button",{type:"button",className:"feelings"==this.state.innerView?"active":"",onClick:function(){return e.setState({innerView:"feelings"})}},"\ud83d\ude10 Feelings"),i.a.createElement("button",{type:"button",className:"priorities"==this.state.innerView?"active":"",onClick:function(){return e.setState({innerView:"priorities"})}},"\ud83d\udcaa Priorities")),this.renderInner()),i.a.createElement("div",{className:"bean-action-card-parent"},i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{type:"button",className:"button card",onClick:function(){return e.props.brainwash()},title:"Rewrite one of this being's traits"},"\ud83d\ude35 Brainwash",i.a.createElement("small",null,"-Sanity +-Trait"))),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{type:"button",className:"button card",onClick:function(){return e.props.brainwash()},disabled:!0,title:"Give this being food or meds or cash"},"\ud83c\udf81 Gift",i.a.createElement("small",null,"-Energy +Things"))),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{type:"button",className:"button card",onClick:this.scan,disabled:!0,title:"Steal a bit of this being's mind"},"\ud83e\udd2a Braindrain",i.a.createElement("small",null,"-Energy -Sanity")),i.a.createElement("button",{type:"button",className:"button card",onClick:this.vaporize,disabled:!this.props.alien.canAfford(this.props.alien.difficulty.cost.bean.vaporize),title:"Delete this being from the experiment"},"\u2620\ufe0f Vaporize",i.a.createElement(ca,{cost:this.props.alien.difficulty.cost.bean.vaporize}))),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{type:"button",className:"button card",disabled:!this.props.alien.canAfford(this.props.alien.difficulty.cost.bean.abduct),onClick:function(){return e.abduct()},title:"Remove this being for study"},"\ud83d\udc7e Abduct for Research",i.a.createElement(ca,{cost:this.props.alien.difficulty.cost.bean.abduct,rider:"+Tech"})))))}},{key:"scanned",get:function(){return this.props.alien.scanned_bean[this.props.bean.key]}}]),a}(i.a.Component),ha=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).onName=function(e){n.setState({name:e.target.value})},n.onSlogan=function(e){n.setState({slogan:e.target.value})},n.onCity=function(e){n.setState({cityKey:+e})},n.state={community:null,ideal:null,name:"Goodplace",slogan:"Perfection is achievable.",members:"Citizens",goal:"Legislation",cityKey:0},n}return Object(c.a)(a,[{key:"onCommunity",value:function(e){var t=this;this.setState({community:e},(function(){t.onBigFourChange()}))}},{key:"onIdeal",value:function(e){var t=this;this.setState({ideal:e},(function(){t.onBigFourChange()}))}},{key:"onBigFourChange",value:function(){"ego"===this.state.community&&"trad"===this.state.ideal?this.setState({name:"Arcadia",slogan:"A man belongs on the farm.",members:"Farmers",goal:"Tariffs"}):"ego"===this.state.community&&"prog"===this.state.ideal?this.setState({name:"Libertaria",slogan:"Freedom for every being!",members:"Builders",goal:"Right to Strike"}):"state"===this.state.community&&"trad"===this.state.ideal?this.setState({name:"Ultimate Kingdom",slogan:"Honor to King and family.",members:"Homeowners",goal:"Repeal Property Tax"}):"state"===this.state.community&&"prog"===this.state.ideal&&this.setState({name:"Equus",slogan:"True equality is peace.",members:"Penniless",goal:"Food Welfare"})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",{className:"pad-4p"},i.a.createElement("h2",null,"Found your Utopia")),i.a.createElement("div",{className:"col-2"},i.a.createElement("div",null,"Perfect societies rely on the",i.a.createElement("div",null,i.a.createElement("label",null,i.a.createElement("input",{type:"radio",name:"community",value:"state",checked:"state"===this.state.community,onChange:function(t){return e.onCommunity(t.currentTarget.value)}})," ",i.a.createElement("b",null,"Collective")," \ud83d\udd4a\ufe0f "),"\xa0\xa0or\xa0\xa0",i.a.createElement("label",null,i.a.createElement("input",{type:"radio",name:"community",value:"ego",checked:"ego"===this.state.community,onChange:function(t){return e.onCommunity(t.currentTarget.value)}})," ",i.a.createElement("b",null,"Independent")," \ud83e\udd85 ")),"\xa0 to guarantee well-being."),i.a.createElement("div",null,"Perfect beings devote themselves to",i.a.createElement("div",null,i.a.createElement("label",null,i.a.createElement("input",{type:"radio",name:"ideal",value:"trad",checked:"trad"===this.state.ideal,onChange:function(t){return e.onIdeal(t.currentTarget.value)}})," ",i.a.createElement("b",null,"Elitist")," "," \ud83d\udc51"),"\xa0\xa0or\xa0\xa0",i.a.createElement("label",null,i.a.createElement("input",{type:"radio",name:"ideal",value:"prog",checked:"prog"===this.state.ideal,onChange:function(t){return e.onIdeal(t.currentTarget.value)}})," ",i.a.createElement("b",null,"Progressive")," "," \u2696\ufe0f")),"\xa0 social values.")),i.a.createElement("hr",null),i.a.createElement("div",{className:"col-2"},i.a.createElement("div",null,"My Utopia is named ",i.a.createElement("input",{type:"text",value:this.state.name,onChange:this.onName})),i.a.createElement("div",null,"My Utopia's mantra is ",i.a.createElement("input",{type:"text",value:this.state.slogan,onChange:this.onSlogan}))),i.a.createElement("hr",null),i.a.createElement("button",{type:"button",disabled:null==this.state.community||null==this.state.ideal,className:"important btn-found-party",onClick:function(){return e.props.onFound(e.state)}},"Found the ",this.state.name," Utopia"))}}]),a}(i.a.Component);var da=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).bubbleSeed=0,n.onChange=function(e){var t=++n.bubbleSeed,a=e.change>0;n.setState({bubbles:n.state.bubbles.concat([{string:(a?"+":"")+e.change,id:t,className:a?"pos":"neg"}])}),setTimeout((function(){n.setState({bubbles:n.state.bubbles.filter((function(e){return e.id!=t}))})}),1500)},n.state={bubbles:[]},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.props.changeEvent&&this.props.changeEvent.subscribe(this.onChange)}},{key:"componentWillUnmount",value:function(){this.props.changeEvent&&this.props.changeEvent.unsubscribe(this.onChange)}},{key:"render",value:function(){var e=this,t=this.state.bubbles.map((function(t){return i.a.createElement("span",{key:t.id,className:[t.className,e.props.bubbleClass,"bubbler"].join(" ")},e.props.icon," ",t.string)}));return i.a.createElement("span",{className:"bubble-parent"},this.props.children,t)}}]),a}(i.a.Component),ma=function(e){var t=function(e,t){var a=Object(n.useState)([]),i=Object(Bt.a)(a,2),r=i[0],s=i[1],o=0,l=function(e){var a=++o;s(r.concat([Object(g.a)({id:a},t(e))])),setTimeout((function(){s(r.filter((function(e){return e.id!=a})))}),1500)};return Object(n.useEffect)((function(){return e.subscribe(l),function(){return e.unsubscribe(l)}})),r}(e.changeEvent,(function(e){return{string:"Discovered ".concat(e.k,"!"),className:"seen-belief"}}));return i.a.createElement("span",{className:"bubble-parent"},e.children,t.map((function(t){return i.a.createElement("span",{key:t.id,className:[t.className,e.bubbleClass,"bubbler"].join(" ")},e.icon," ",t.string)})))},pa=(a(27),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={},n}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"social-graph"},this.props.beans.get.map((function(t){return i.a.createElement("div",{key:t.key,className:"bean-node",onClick:function(){return e.props.onClick(t)}},i.a.createElement(Yt,{bean:t,static:!0,sitStill:!0,onClick:function(){e.props.onClick(t)}}))})))}}]),a}(i.a.Component)),fa=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={},n}return Object(c.a)(a,[{key:"render",value:function(){var e="capsule-label "+this.props.label||!1;return i.a.createElement("span",{className:e},i.a.createElement("span",{className:"capsule-icon"},this.props.icon),i.a.createElement("span",{className:"capsule-text"},this.props.label,":"),i.a.createElement("span",{className:"capsule-value"},this.props.children))}}]),a}(i.a.Component),ya=a(13),ba=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"renderReward",value:function(e){return i.a.createElement("div",null,i.a.createElement("small",null,"\ud83c\udf81 ",We(e.reward||{},"+")))}},{key:"renderGoal",value:function(e){var t=null!=this.props.progress.goalProgress[e.key]&&this.props.progress.goalProgress[e.key].done;return i.a.createElement("li",null,t?"\u2611\ufe0f":"\u2b55\ufe0f",e.text,null!=e.tooltip?i.a.createElement("small",{title:e.tooltip},"\u2754"):null,t||null==e.reward?null:this.renderReward(e))}},{key:"render",value:function(){var e,t=this;return i.a.createElement("div",{className:"goals"},i.a.createElement("div",null,i.a.createElement("b",null,"Goals")),i.a.createElement("ul",null,this.props.progress.goals.map((function(e){return t.renderGoal(Ve[e])}))),i.a.createElement("div",null,i.a.createElement("b",null,"Report Card")),i.a.createElement("p",{className:"horizontal"},i.a.createElement("span",null,"Last Grade: ",i.a.createElement("b",null,"D")),i.a.createElement("span",null,"Next Grade in: ",i.a.createElement("b",null,"2 mo."))),i.a.createElement("p",null),i.a.createElement("table",{style:{margin:"auto"}},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("th",null,"\ud83c\udfaf Happiness"),i.a.createElement("td",null,this.props.player.workingReportCard.Happiness),i.a.createElement("td",null,i.a.createElement("small",{title:"Are your subjects happy?"},"\u2754"))),i.a.createElement("tr",null,i.a.createElement("td",{className:"text-left",colSpan:3},i.a.createElement("small",null,Je.RubricDescription.Happiness))),i.a.createElement("tr",null,i.a.createElement("th",null,"\ud83c\udfaf Prosperity"),i.a.createElement("td",null,this.props.player.workingReportCard.Prosperity),i.a.createElement("td",null,i.a.createElement("small",{title:"Are your subjects fed and healthy?"},"\u2754"))),i.a.createElement("tr",null,i.a.createElement("td",{className:"text-left",colSpan:3},i.a.createElement("small",null,Je.RubricDescription.Prosperity))),i.a.createElement("tr",null,i.a.createElement("th",null,"\ud83c\udfaf Stability"),i.a.createElement("td",null,this.props.player.workingReportCard.Stability),i.a.createElement("td",null,i.a.createElement("small",{title:"Are your subjects sane and civil?"},"\u2754"))),i.a.createElement("tr",null,i.a.createElement("td",{className:"text-left",colSpan:3},i.a.createElement("small",null,Je.RubricDescription.Stability))),i.a.createElement("tr",null,i.a.createElement("th",null,"\ud83c\udfaf Dogma"),i.a.createElement("td",null,this.props.player.workingReportCard.Dogma),i.a.createElement("td",null,i.a.createElement("small",{title:"Do your society's rules match your utopian ideals?"},"\u2754"))),i.a.createElement("tr",null,i.a.createElement("td",{className:"text-left",colSpan:3},i.a.createElement("small",null,Je.RubricDescription.Dogma))),i.a.createElement("tr",null,i.a.createElement("td",{colSpan:3},i.a.createElement("hr",null))),i.a.createElement("tr",null,i.a.createElement("th",null,"Avg. Grade"),i.a.createElement("td",null,(e=this.props.player.workingReportCard,Xe((Ye[e.Happiness]+Ye[e.Prosperity]+Ye[e.Stability]+Ye[e.Dogma])/20))),i.a.createElement("td",null)))))}}]),a}(i.a.Component),va=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return i.a.createElement("div",{className:"pad-4p"},i.a.createElement("div",{className:"subheader"},i.a.createElement("h3",null,"Propaganda"),i.a.createElement("button",{type:"button",className:"callout",onClick:function(){}},"\ud83c\udf99\ufe0f Buy Propaganda")),i.a.createElement("span",null,"Propaganda changes beans' feelings on a wide variety of topics."),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{type:"button",className:"card button"},i.a.createElement("span",{className:"h"},"\ud83d\udcfa Broadcast Campaign"),i.a.createElement("small",null,"Approval+ Cash-"),i.a.createElement("span",{className:"p"},"Small chance to increase Approval among all beans")),i.a.createElement("button",{type:"button",className:"card button"},i.a.createElement("span",{className:"h"},"\ud83d\udc4b Canvassing"),i.a.createElement("small",null,"Approval+ Labor-"),i.a.createElement("span",{className:"p"},"Chance to increase Approval on a few random beans")),i.a.createElement("button",{type:"button",className:"card button"},i.a.createElement("span",{className:"h"},"\ud83d\uddde\ufe0f Print Campaign"),i.a.createElement("small",null,"Approval+ Cash-"),i.a.createElement("span",{className:"p"},"Chance to increase Approval on wealthy beans"))),i.a.createElement("div",{className:"subheader"},i.a.createElement("h3",null,"Appearances"),i.a.createElement("button",{type:"button",className:"callout",onClick:function(){}},"\ud83d\udcac Schedule Appearance")),i.a.createElement("span",null,"Appearances have limited reach, but have powerful effects."),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{type:"button",className:"card button"},i.a.createElement("span",{className:"h"},"\ud83e\udd14 Debating"),i.a.createElement("small",null,"Labor-"),i.a.createElement("span",{className:"p"},"Chance to gain or lose Influence")),i.a.createElement("button",{type:"button",className:"card button"},i.a.createElement("span",{className:"h"},"\ud83d\udcf8 Photo Op"),i.a.createElement("small",null,"Labor-"),i.a.createElement("span",{className:"p"},"Increases Approval within one Social Group")),i.a.createElement("button",{type:"button",className:"card button"},i.a.createElement("span",{className:"h"},"\ud83c\udfa4 Speechmaking"),i.a.createElement("small",null,"Labor-"),i.a.createElement("span",{className:"p"},"Increases chance of Donations in a single City")),i.a.createElement("button",{type:"button",className:"card button"},i.a.createElement("span",{className:"h"},"\ud83d\ude4b Town Hall"),i.a.createElement("small",null,"Labor-"),i.a.createElement("span",{className:"p"},"Suppresses negative Approval in a single city"))))}}]),a}(i.a.Component),ga=function(e){var t=Object(n.useState)(e.treasury.get),a=Object(Bt.a)(t,2),r=a[0],s=a[1],o=function(){s(e.treasury.get)};return Object(n.useEffect)((function(){return e.treasury.onChange.subscribe(o),e.treasury.onChange.unsubscribe(o)})),i.a.createElement("div",{className:"pad-4p"},i.a.createElement("div",null,i.a.createElement("strong",null,"\ud83d\udcb0 Treasury: ",r.toFixed(2))))},Ea=function(e){var t=Object(n.useState)("Welfare"),a=Object(Bt.a)(t,2),r=a[0],s=a[1];return i.a.createElement("div",null,i.a.createElement("div",{className:"col-2"},i.a.createElement("h2",{className:"marg-b-0"},"Utopia Government"),i.a.createElement("div",null,i.a.createElement("div",{className:"horizontal blue-orange cylinder f-size-125em marg-t-20"},i.a.createElement("button",{type:"button",onClick:function(){return s("Welfare")},className:"Welfare"===r?"active":""},"\ud83e\udd32 Welfare"),i.a.createElement("button",{type:"button",onClick:function(){return s("Crime")},className:"Crime"===r?"active":""},"\ud83d\udea8 Crime"),i.a.createElement("button",{type:"button",onClick:function(){return s("Taxation")},className:"Taxation"===r?"active":""},"\ud83d\udcb0 Taxes"),i.a.createElement("button",{type:"button",onClick:function(){return s("funds")},className:"funds"===r?"active":""},"\ud83d\udcb8 Funds")))),"funds"===r?i.a.createElement("div",null,i.a.createElement(ga,{treasury:e.world.law.treasury})):i.a.createElement(ka,{group:r,seenBeliefs:e.world.alien.seenBeliefs.get,beliefs:e.world.alien.beliefInventory.get,isLaw:function(t){return e.world.law.isLaw(t)},enactLaw:function(t){return e.enactLaw(t)},revokeLaw:function(t){return e.revokeLaw(t)}}))},ka=function(e){var t=Object.values(Ge).filter((function(t){return t.group===e.group}));return i.a.createElement("div",{className:"pad-4p"},i.a.createElement("strong",null,e.group," Laws"),i.a.createElement("div",{className:"horizontal scroll"},t.map((function(t){return i.a.createElement(wa,{seenBeliefs:e.seenBeliefs,id:t.key,beliefs:e.beliefs,key:t.key,enacted:e.isLaw(t.key),enactLaw:function(t){return e.enactLaw(t)},revokeLaw:function(t){return e.revokeLaw(t)}})}))))},wa=function(e){var t,a,n=Ge[e.id],r=(t=n.prereqs,a=e.seenBeliefs,0===t.length||t.some((function(e){return Re(e,a)}))),s=function(e,t){return 0===e.length||e.every((function(e){return Re(e,t)}))}(n.prereqs,e.seenBeliefs);return i.a.createElement("div",{className:"vertical law-formula"},i.a.createElement("div",{className:"horizontal"},i.a.createElement("div",{className:"circular"},r?n.icon:"\u2754"),i.a.createElement("div",null,i.a.createElement("strong",null,r?n.name:"Unknown"),i.a.createElement("div",null,r?i.a.createElement("small",null," ",n.description," "):null))),i.a.createElement("div",{className:"vertical"},n.prereqs.map((function(t){var a,n=Re(t,e.seenBeliefs),r=(a=t,Array.isArray(a)?a.join("/"):a);return n?i.a.createElement("span",{className:"law-formula-ingredient",key:r},function(e){return Array.isArray(e)?e.map((function(e){return ze(e)})).join(" / "):ze(e)}(t)):i.a.createElement("span",{className:"law-formula-ingredient unknown",key:r},"\u2754 Unknown")}))),e.enacted?i.a.createElement("button",{className:"callout",onClick:function(){return e.revokeLaw(e.id)}},"\ud83d\uddd1\ufe0f\xa0Revoke Active Law"):i.a.createElement("button",{className:"callout",disabled:!s,onClick:function(){return e.enactLaw(e.id)}},s?"\u2712\ufe0f":i.a.createElement("span",{className:"grey"},"\ud83d\udd12"),"\xa0Enact"),e.children)},ja=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={confirming:!1},n}return Object(c.a)(a,[{key:"click",value:function(){this.state.confirming?(this.props.onConfirm(),this.setState({confirming:!1})):this.setState({confirming:!0})}},{key:"render",value:function(){var e=this;return i.a.createElement("button",{className:this.props.className,onClick:function(){return e.click()},disabled:this.props.disabled},this.state.confirming?this.props.confirmText:this.props.children)}}]),a}(i.a.Component),Ca=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return i.a.createElement("svg",{width:"100",height:"300",xmlns:"http://www.w3.org/2000/svg",style:{},className:this.props.classN+" robot-arm"},i.a.createElement("g",null,i.a.createElement("title",null,"robotarm"),i.a.createElement("rect",{fill:"transparent",id:"canvas_background",height:"302",width:"102",y:"-1",x:"-1"}),i.a.createElement("g",{display:"none",overflow:"visible",y:"0",x:"0",height:"100%",width:"100%",id:"canvasGrid"},i.a.createElement("rect",{fill:"url(#gridpattern)",strokeWidth:"0",y:"0",x:"0",height:"100%",width:"100%"}))),i.a.createElement("g",null,i.a.createElement("title",null,"Layer 1"),i.a.createElement("rect",{id:"svg_2",height:"200",width:"48",y:"91.63545",x:"25",strokeWidth:"1.5",stroke:"#000",fill:"#BBBBBB"}),i.a.createElement("ellipse",{ry:"48",rx:"48",id:"svg_1",cy:"50",cx:"50",strokeWidth:"1.5",stroke:"#000",fill:"#999999"}),i.a.createElement("ellipse",{ry:"20",rx:"20",id:"svg_3",cy:"50",cx:"50",strokeWidth:"1.5",stroke:"#000",fill:"#444444"}),i.a.createElement("ellipse",{ry:"48",rx:"48",id:"svg_4",cy:"250",cx:"50",strokeWidth:"1.5",stroke:"#000",fill:"#999999"}),i.a.createElement("ellipse",{ry:"20",rx:"20",id:"svg_5",cy:"250",cx:"50",strokeWidth:"1.5",stroke:"#000",fill:"#444444"},this.props.tool)),i.a.createElement("text",{y:"250",x:"-20",fontSize:"4em"},this.props.tool))}}]),a}(i.a.Component),xa=(a(28),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).tools=["\ud83d\udce1","\ud83d\udddc\ufe0f","\ud83d\udd2c","\ud83d\udc89","\ud83d\udd0e","\ud83e\uddfc","\ud83e\uddf2","\ud83c\udfa5","\ud83d\udd27"],n.interval=void 0,n.state={toolI:0,toolI2:2,toolI3:4,toolI4:1},n}return Object(c.a)(a,[{key:"loop",value:function(e){var t=e+1;return t===this.tools.length&&(t=0),t}},{key:"componentDidMount",value:function(){var e=this;this.interval=window.setInterval((function(){e.setState({toolI:e.loop(e.state.toolI),toolI2:e.loop(e.state.toolI2),toolI3:e.loop(e.state.toolI3),toolI4:e.loop(e.state.toolI4)})}),1e3)}},{key:"componentWillUnmount",value:function(){null!=this.interval&&window.clearInterval(this.interval)}},{key:"setResearch",value:function(e){this.props.setResearch(e)}},{key:"renderTech",value:function(e){var t=this,a=null==this.props.player.techProgress[e.tech]?0:this.props.player.techProgress[e.tech].researchPoints,n=e.techPoints,r={width:Math.min(a/n*100,100)+"%"},s=a>=n,o=this.props.player.currentlyResearchingTech===e.tech,l=s?"\u2705":o?"\ud83d\udd2c":"\u2b55\ufe0f",c=o?"active":"inactive";return i.a.createElement("div",{className:"card-parent "+c,key:e.tech},i.a.createElement("button",{className:"card button",onClick:function(){return t.setResearch(e.tech)}},i.a.createElement("strong",null,e.name),i.a.createElement("strong",{className:"pull-r f-size-125em"},l),i.a.createElement("div",null,e.description),i.a.createElement("div",{className:"bar f-size-12 h-12"},i.a.createElement("div",{className:"bar-inner text-center",style:r}),a,"/",n," tech")))}},{key:"render",value:function(){var e=this,t=Object.values(Ze);return i.a.createElement("div",null,i.a.createElement("div",{className:"col-2"},i.a.createElement("div",null,i.a.createElement("h2",null,"Research \ud83e\uddea Lab"),i.a.createElement("div",{className:"vertical"},t.map((function(t){return e.renderTech(t)})))),i.a.createElement("div",{className:"vertical"},i.a.createElement("div",null,i.a.createElement("div",{className:"robot"},"\ud83e\udd16",i.a.createElement(Ca,{classN:"far-left",tool:this.tools[this.state.toolI]}),i.a.createElement(Ca,{classN:"left",tool:this.tools[this.state.toolI2]}),i.a.createElement(Ca,{classN:"near-right",tool:this.tools[this.state.toolI3]}),i.a.createElement(Ca,{classN:"far-right",tool:this.tools[this.state.toolI4]}))),i.a.createElement("div",{className:"h-42em"},this.props.player.abductedBeans.map((function(e){return i.a.createElement("span",{key:e.key,className:"victim bean triangle shake"},"\ud83d\ude28")}))),i.a.createElement("div",{className:"text-center"},"Currently probing ",this.props.player.abductedBeans.length," beings for ",this.props.player.abductedBeans.length," tech a day",i.a.createElement("p",null,i.a.createElement("small",null,"1 tech per research subject per day"))),this.props.player.abductedBeans.length>0?i.a.createElement("div",{className:"text-right"},i.a.createElement(ja,{className:"callout",onConfirm:function(){e.props.release()},confirmText:"-1 Research Subject?"},"\ud83c\udf88 Release Research Subject")):null)),i.a.createElement("div",null))}}]),a}(i.a.Component)),Sa=(a(29),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"s-p-f button-group cylinder blue-orange"},"\u231b\ufe0f",i.a.createElement("button",{type:"button",className:0==this.props.timeScale?"active":"",onClick:function(){return e.props.setTimeScale(0)}},"\u23f9"),i.a.createElement("button",{type:"button",className:1==this.props.timeScale?"active":"",onClick:function(){return e.props.setTimeScale(1)}},"\u25b6\ufe0f"),i.a.createElement("button",{type:"button",className:2==this.props.timeScale?"active":"",onClick:function(){return e.props.setTimeScale(2)}},"\u23e9"))}}]),a}(i.a.Component)),Na=function(e){return i.a.createElement("div",{className:"s-p-f button-group cylinder blue-orange"},"\ud83d\udc41\ufe0f",i.a.createElement("button",{type:"button",className:"geo"==e.activeMain?"active":"",onClick:function(){return e.setActiveMain("geo")}},"\ud83c\udf0e"),i.a.createElement("button",{type:"button",className:"network"==e.activeMain?"active":"",onClick:function(){return e.setActiveMain("network")}},"\ud83c\udf10"))},Oa=function(e){return i.a.createElement("div",{className:"horizontal blue-orange cylinder f-size-125em marg-t-20"+(e.additionalClasses||"")},e.options.map((function(t){return i.a.createElement("button",{type:"button",key:t.value,onClick:function(){return t.onClick()},className:e.active===t.value?"active":""},t.icon," ",t.text)})))},_a=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"emptyPanel",value:function(){var e=this,t=this.props.difficulty.cost.emptyHex;return i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement("strong",null,"Empty Lot")," in ",i.a.createElement("strong",null,this.props.city.name),i.a.createElement("button",{type:"button",className:"pull-r",onClick:function(){return e.props.clearHex()}},"\u274c")),i.a.createElement("h3",null,"Build:"),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{className:"card button",type:"button",onClick:function(){return e.props.build(e.props.hex,"house")}},V.house," House",i.a.createElement(ca,{cost:t.build.house}))),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{className:"card button",type:"button",onClick:function(){return e.props.build(e.props.hex,"farm")}},V.farm," Farm",i.a.createElement(ca,{cost:t.build.farm})),i.a.createElement("button",{className:"card button",type:"button",onClick:function(){return e.props.build(e.props.hex,"hospital")}},V.hospital," Hospital",i.a.createElement(ca,{cost:t.build.hospital}))),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{className:"card button",type:"button",onClick:function(){return e.props.build(e.props.hex,"theater")}},V.theater," Theater",i.a.createElement(ca,{cost:t.build.theater})),i.a.createElement("button",{className:"card button",type:"button",onClick:function(){return e.props.build(e.props.hex,"park")}},V.park," Park",i.a.createElement(ca,{cost:t.build.park}))),i.a.createElement("h3",null,"Beings:"),this.renderBeamButton())}},{key:"renderBeamButton",value:function(){var e=this;return i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{className:"card button",type:"button",onClick:function(){return e.props.beam(e.props.hex)}},"\ud83d\udef8 Beam In New Subject",i.a.createElement(ca,{cost:this.props.difficulty.cost.hex.beam,rider:"+Subject"})))}},{key:"buildingPanel",value:function(e){var t=this,a=e.usedSlots(),n=e.openSlots(),r="park"!=e.type&&"nature"!=e.type;return i.a.createElement("div",null,i.a.createElement("strong",null,e.upgraded&&r?"Dense ":"Small ",za[e.type])," in ",i.a.createElement("strong",null,this.props.city.name),i.a.createElement("button",{type:"button",className:"pull-r",onClick:function(){return t.props.clearHex()}},"\u274c"),e.upgraded&&r?i.a.createElement("div",null,this.renderDensityWarning(e.type)):null,i.a.createElement(Ma,{building:e,changeEnterprise:this.props.changeEnterprise}),0===a.length?null:i.a.createElement("div",null,i.a.createElement("strong",null,"Workers:"),a.map((function(a){return{key:a,bean:t.props.city.beans.get.find((function(t){return t.key===e.job_slots[a]}))}})).map((function(t){var a,n;return i.a.createElement("div",{key:t.key},$[e.type]," ",null===(a=t.bean)||void 0===a?void 0:a.name," ",C(e)&&"company"===e.enterpriseType&&(null===(n=t.bean)||void 0===n?void 0:n.key)===e.ownerBeanKey?"\ud83c\udfa9":"")}))),r?i.a.createElement("div",null,"This ",za[e.type]," can support ",n.length," more jobs.",e.upgraded?null:i.a.createElement("span",null,i.a.createElement("br",null),"Upgrade it to add 3 more job slots.")):null,e.upgraded||!r?null:i.a.createElement("div",null,i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{className:"card button",type:"button",onClick:function(){return t.props.upgrade(e)}},"\ud83d\udee0\ufe0f Upgrade",i.a.createElement(ca,{cost:this.props.difficulty.cost.hex.upgrade}))),this.renderDensityWarning(e.type)),this.renderBeamButton())}},{key:"renderDensityWarning",value:function(e){return"house"===e?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"text-center"},i.a.createElement("small",null,"\ud83d\udc2e Parochial subjects may emit \ud83d\udc4e",i.a.createElement("br",null),"when living in dense buildings")),i.a.createElement("div",{className:"text-center"},i.a.createElement("small",null,"\ud83c\udf78 Cosmopolitan subjects may emit \ud83d\udc4e",i.a.createElement("br",null),"when living in small buildings"))):i.a.createElement("div",null)}},{key:"renderJobs",value:function(){}},{key:"render",value:function(){var e=this.props.city.book.findBuildingByCoordinate(this.props.hex);return e?this.buildingPanel(e):this.emptyPanel()}}]),a}(i.a.Component),Ma=function(e){var t=e.building;if(C(t)){var a=w.map((function(a){return{icon:j[a],text:a[0].toUpperCase()+a.substring(1),value:a,onClick:function(){t.enterpriseType=a,e.changeEnterprise(t)}}}));return i.a.createElement(Oa,{active:t.enterpriseType,options:a})}return null},Ba=(a(30),function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).onChange=function(e){n.props.onChange(e.target.value),n.setState({key:e.target.value})},n.state={key:e.value||null},n}return Object(c.a)(a,[{key:"hint",value:function(){if(this.props.hint)return i.a.createElement("option",{value:"",disabled:!0,selected:!0,hidden:!0},this.props.hint)}},{key:"getTextForOption",value:function(e){return this.props.titleCase&&(e=e[0].toUpperCase()+e.slice(1)),e}},{key:"options",value:function(){var e=this;return this.props.options.map((function(t){return i.a.createElement("option",{value:t,key:t,title:e.getTitleForOption(t)},e.getTextForOption(t))}))}},{key:"render",value:function(){return i.a.createElement("select",{onChange:this.onChange,value:this.state.key,required:null!=this.props.hint},this.hint(),this.options())}},{key:"getTitleForOption",value:function(e){}}]),a}(i.a.Component)),Pa=(a(31),function(e){return i.a.createElement("div",{className:"belief"},i.a.createElement("div",{className:"horizontal badger"},i.a.createElement("div",{className:"vertical"},i.a.createElement("div",{className:"circular"},e.data.icon),e.leftButton),i.a.createElement("div",{className:"vertical"},i.a.createElement("div",{className:"text-center"},e.titleView,e.cost?i.a.createElement("span",{className:"pull-r"},e.cost,"\ud83e\udde0"):null),e.data.description?e.data.description.split(";").map((function(e,t){return i.a.createElement("small",{className:"marg-b-6",key:t}," ",e)})):null,i.a.createElement("div",{className:"grow-1 text-center"},e.bottomView))))}),Ta=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return i.a.createElement("div",{className:"belief"},i.a.createElement("div",{className:"horizontal badger"},i.a.createElement("div",{className:"vertical"},i.a.createElement("div",{className:"circular"},this.props.data.icon),this.props.frozen?null:i.a.createElement(ja,{className:"callout pad-4 marg-0",confirmText:"-"+this.props.cost.toString()+"\ud83e\udde0?",disabled:this.props.available<this.props.cost,onConfirm:this.props.wash},"\ud83d\udebf ",i.a.createElement("small",null,"Wash"))),i.a.createElement("div",{className:"vertical"},i.a.createElement("div",{className:"text-center"},i.a.createElement("strong",{title:this.props.data.description,className:this.props.divergent?"divergent marg-r-6":"marg-r-6"},this.props.data.noun),i.a.createElement("span",{className:"pull-r"},this.props.cost,"\ud83e\udde0")),i.a.createElement("small",{className:"marg-b-6"},this.props.data.description),i.a.createElement("div",{className:"grow-1 text-center"}))))}}]),a}(i.a.Component),Da=Me.slice().sort((function(e,t){return e.localeCompare(t)})),Ia=(i.a.Component,function(e){var t=Object(n.useState)(e.live.get),a=Object(Bt.a)(t,2),r=a[0],s=a[1],o=function(e){s(e)};return Object(n.useEffect)((function(){return e.live.onChange.subscribe(o),function(){return e.live.onChange.unsubscribe(o)}})),i.a.createElement(i.a.Fragment,null,r.map((function(t){return i.a.createElement(Pa,{key:t.trait,data:Oe[t.trait],titleView:i.a.createElement("strong",null,Oe[t.trait].noun),leftButton:i.a.createElement(ja,{onConfirm:function(){return e.implant(t.trait)},className:"callout marg-0",confirmText:"-1 \ud83e\udde0?",disabled:t.charges<1||e.dogmatic},"Implant"),bottomView:i.a.createElement("span",null,t.charges," \ud83e\udde0")})})))}),Aa=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){return Object(l.a)(this,a),t.call(this,e)}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props.world.beans.get.find((function(t){return t.key==e.props.beanID})),a=this.props.beanID&&this.props.world.alien.scanned_bean[this.props.beanID];if(null==t)return i.a.createElement("div",null);var n=t.believesIn("Dogmatism");return i.a.createElement("div",null,i.a.createElement("div",{className:"horizontal fancy-header"},i.a.createElement("div",null,"BRAIN"),i.a.createElement("div",{className:"emoji-3"},"\ud83e\udde0\ud83d\udebf"),i.a.createElement("div",null,"WASH")),i.a.createElement("div",null,i.a.createElement("p",{className:"pad-4p"},i.a.createElement("strong",null,t.name)," has ",t.discrete_sanity.toFixed(0)," sanity \ud83e\udde0.","stressed"===t.sanity||"disturbed"===t.sanity?i.a.createElement("small",{className:"pull-r"},"(Low sanity \ud83e\udde0 causes ",Ot.unhappiness,"; Negative sanity \ud83e\udde0 causes extremely negative traits)"):null),n?i.a.createElement("div",{className:"text-center"},"\ud83d\udc36 Dogmatic subjects cannot change their minds"):null,a?i.a.createElement("div",{className:"horizontal scroll"},i.a.createElement(Ta,{available:t.discrete_sanity,frozen:n,wash:function(){return e.props.washCommunity(t,t.community)},cost:this.props.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity||0,data:Se[t.community]}),i.a.createElement(Ta,{available:t.discrete_sanity,frozen:n,wash:function(){return e.props.washMotive(t,t.ideals)},cost:this.props.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity||0,data:Se[t.ideals]}),i.a.createElement(Ta,{available:t.discrete_sanity,frozen:n,wash:function(){return e.props.washNarrative(t,t.faith)},cost:this.props.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity||0,data:Ne[t.faith]}),t.beliefs.map((function(a){return i.a.createElement(Ta,{key:a,available:t.discrete_sanity,frozen:n&&"Dogmatism"!=a,divergent:_e(a,e.props.world.party.ideals,e.props.world.party.community),wash:function(){return e.props.washBelief(t,a)},cost:e.props.world.alien.difficulty.cost.bean_brain.brainwash_secondary.sanity||0,data:Oe[a]})}))):i.a.createElement("div",{className:"text-center"},"\ud83d\udef0\ufe0f Scan this subject to reveal its Traits! "),i.a.createElement("h3",{className:"pad-4p"},"\ud83e\udde0 Trait Inventory"),i.a.createElement("div",{className:"horizontal scroll"},i.a.createElement(Ia,{live:this.props.world.alien.beliefInventory,dogmatic:n,implant:function(a){return e.props.implantBelief(t,a)}}))))}}]),a}(i.a.Component),Fa=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).onEvent=function(e){n.setState({eventCount:n.state.eventCount+1}),window.setTimeout((function(){n.setState({eventCount:n.state.eventCount-1})}),3e3)},n.props.event.subscribe(n.onEvent),n.state={eventCount:0},n}return Object(c.a)(a,[{key:"render",value:function(){return i.a.createElement("span",null,this.state.eventCount<1?this.props.children:i.a.createElement("span",{className:this.props.eventClass},this.props.eventIcon))}}]),a}(i.a.Component),Ha=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",{className:"text-center"},i.a.createElement("strong",null,"\ud83c\udf0c Galactic \ud83d\ude28 Emotion \ud83d\udcb0 Market")),i.a.createElement("p",null,i.a.createElement("small",null,"The premier exchange for \u26a1\ufe0f, \ud83e\udd16,  and ",Ot.happiness,"!")),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{className:"card button",onClick:function(){return e.props.buyEnergy(1)},disabled:!this.props.player.canAfford(this.props.player.difficulty.cost.market.resource.energy)},"+1 \u26a1\ufe0f Energy",i.a.createElement(ca,{cost:this.props.player.difficulty.cost.market.resource.energy,qty:1})),i.a.createElement("button",{className:"card button",onClick:function(){return e.props.buyEnergy(5)},disabled:!this.props.player.canAfford(this.props.player.difficulty.cost.market.resource.energy,5)},"+5 \u26a1\ufe0f Energy",i.a.createElement(ca,{cost:this.props.player.difficulty.cost.market.resource.energy,qty:5}))),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{className:"card button",onClick:function(){return e.props.buyBots(1)},disabled:!this.props.player.canAfford(this.props.player.difficulty.cost.market.resource.bots)},"+1 \ud83e\udd16 Bot",i.a.createElement(ca,{cost:this.props.player.difficulty.cost.market.resource.bots,qty:1})),i.a.createElement("button",{className:"card button",onClick:function(){return e.props.buyBots(5)},disabled:!this.props.player.canAfford(this.props.player.difficulty.cost.market.resource.bots,5)},"+5 \ud83e\udd16 Bots",i.a.createElement(ca,{cost:this.props.player.difficulty.cost.market.resource.bots,qty:5}))),i.a.createElement("div",{className:"card-parent"},i.a.createElement("button",{className:"card button",onClick:function(){return e.props.scrubHedons()},disabled:this.props.player.hedons.amount>=0||!this.props.player.canAfford(this.props.player.difficulty.cost.market.scrubHedons)},"Remove \ud83d\udca2 Negative Hedons",i.a.createElement(ca,{cost:this.props.player.difficulty.cost.market.scrubHedons,qty:1}))),i.a.createElement("div",null,i.a.createElement("small",null,i.a.createElement("i",null,"Current \ud83e\udde0 Traits for sale:"))),i.a.createElement("div",{className:"short-scroll"},i.a.createElement(La,{hedons:this.props.player.hedons.amount,live:this.props.market,buy:this.props.buyTrait})))}}]),a}(i.a.Component),La=function(e){var t=Object(n.useState)(e.live.get),a=Object(Bt.a)(t,2),r=a[0],s=a[1],o=function(e){s(e)};return Object(n.useEffect)((function(){return e.live.onChange.subscribe(o),function(){return e.live.onChange.unsubscribe(o)}})),i.a.createElement(i.a.Fragment,null,r.map((function(t,a){var n=Oe[t.trait],r="belief-name "+n.rarity;return i.a.createElement("div",{className:"card-parent",key:a},i.a.createElement("button",{className:"card button",onClick:function(){return e.buy(t)},disabled:e.hedons<(t.cost.hedons||0)},i.a.createElement("span",{className:r},n.icon," ",n.noun),i.a.createElement(ca,{cost:t.cost})))})))},Ra=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={},n}return Object(c.a)(a,[{key:"render",value:function(){var e=[];return this.props.seenBeliefs.get.forEach((function(t,a){null!=Oe[a]&&e.push(Oe[a])})),e.sort((function(e,t){return e.noun.localeCompare(t.noun)})),i.a.createElement("div",{className:"vertical"},i.a.createElement("div",{className:"pad-4p"},i.a.createElement("h2",null,"Subject \ud83e\udde0 Traits")),i.a.createElement("div",{className:"col-2-30-60"},i.a.createElement("div",null,i.a.createElement("div",{className:"scroll"},i.a.createElement("div",{className:"scoll-sticky-h"},i.a.createElement("strong",null,"Trait Inventory")),this.props.beliefInventory.get.length<1?i.a.createElement("div",null,"No Traits! ",i.a.createElement("br",null),"\ud83d\ude35 Brainwash your subjects  ",i.a.createElement("br",null),"or buy from the \ud83d\udecd\ufe0f Market"):this.props.beliefInventory.get.map((function(e){return i.a.createElement("div",{key:e.trait},i.a.createElement("div",null,i.a.createElement("strong",null,Oe[e.trait].icon," ",Oe[e.trait].noun)),i.a.createElement("div",null,"This can be implanted ",e.charges," more times"))})))),i.a.createElement("div",null,i.a.createElement("div",{className:"modal-scroll-v"},i.a.createElement("div",{className:"sticky-t-0"},i.a.createElement("strong",null,"Discovered Traits")),e.length<1?i.a.createElement("div",null,"No Traits! ",i.a.createElement("br",null),"\ud83d\udef0\ufe0f Scan some of your subjects."):e.map((function(e){return i.a.createElement(Pa,{key:e.noun,data:e,cost:0,titleView:i.a.createElement("strong",null,e.noun),bottomView:i.a.createElement("span",null)})}))))))}}]),a}(i.a.Component),qa=function(e){return i.a.createElement("div",null,i.a.createElement("div",{className:"col-2"},i.a.createElement("div",null,i.a.createElement("h3",null,"Welcome to the"),i.a.createElement("h2",null,"\ud83d\udc7d Alien \ud83c\udf0d Utopia \ud83d\udd2c Laboratory"),i.a.createElement("div",null,"Thank you for joining the ",i.a.createElement("select",null,i.a.createElement("option",null,"Human"))," Cultivation Division of the ",i.a.createElement("strong",null,"\ud83c\udf0c Galactic Xenosensation Federation!")," Your interdimensional petri dish is ready for farming."),i.a.createElement("p",null,"As a ",i.a.createElement("select",null,i.a.createElement("option",null,"Human Emotion Farmer")),", you are required to execute the following duties:"),i.a.createElement("ul",null,i.a.createElement("li",null,"Construct ",i.a.createElement("strong",null,"\ud83c\udfe0 Buildings")," for your ",i.a.createElement("select",null,i.a.createElement("option",null,"Human"))," subjects."),i.a.createElement("li",null,i.a.createElement("strong",null,"\ud83d\udef8 Beam In")," ",i.a.createElement("select",null,i.a.createElement("option",null,"Human"))," subjects for cultivation."),i.a.createElement("li",null,"Harvest your subject's positive ",i.a.createElement("strong",null,Ot.happiness," Hedons"),"."),i.a.createElement("li",null,"Sell the Hedons on the ",i.a.createElement("br",null),i.a.createElement("strong",null,"\ud83c\udf0c Galactic \ud83d\ude28 Emotion \ud83d\udcb0 Market"),".")),i.a.createElement("div",null)),i.a.createElement("div",null,i.a.createElement("p",null,"The GXF's records indicate ",i.a.createElement("select",null,i.a.createElement("option",null,"Humans"))," are a",i.a.createElement("br",null),i.a.createElement("u",null,"mentally malleable")," and ",i.a.createElement("u",null,"physically fragile")," species. Try the following cultivation methods:"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("strong",null,"\ud83d\udef0\ufe0f Scan")," your subject's primitive minds for information on what pleases them."),i.a.createElement("li",null,i.a.createElement("strong",null,"\ud83d\udebf Brainwash")," subjects to change their ",i.a.createElement("strong",null,"\ud83e\udde0\xa0Traits"),". Try to add Traits that emit more ",i.a.createElement("strong",null,Ot.happiness,"\xa0Hedons"),"."),i.a.createElement("li",null,"Avoid letting your subjects die or endure pain; this makes ",i.a.createElement("strong",null,Ot.unhappiness,"\xa0Antihedons")," which are less profitable."),i.a.createElement("li",null,"Use your knowledge of Traits to modify the farm's ",i.a.createElement("strong",null,"\ud83d\uddf3\ufe0f\xa0Government")," to maximize Hedon generation."),i.a.createElement("li",null,"Use the GXF's ",i.a.createElement("strong",null,"\ud83e\uddea Research Lab")," to upgrade your farm, when stocked with ",i.a.createElement("strong",null,"\ud83d\udc7e Abducted")," subjects.")),i.a.createElement("h3",null,"\ud83c\udf0c Galactic Xenosensation Federation ",i.a.createElement("br",null),i.a.createElement("div",{className:"text-right"},i.a.createElement("small",null,i.a.createElement("i",null,"1 trillion sensations. 100% organic. 100% gourmet.")))))))},za={state:"Collectivist",ego:"Independent",trad:"Elitist",prog:"Progressive",circle:"Brunette",square:"Blonde",triangle:"Redhead",rocket:"Futuristic",dragon:"Mythical",music:"Dramatic",noFaith:"Nihilistic",starving:"Starving",hungry:"Hungry",sated:"Sated",stuffed:"Stuffed",homeless:"Homeless",sleepy:"Sleepy",awake:"Awake",rested:"Rested",sick:"Sick",sickly:"Sickly",bruised:"Bruised",fresh:"Robust",sane:"Sane",stressed:"Confused",disturbed:"Disturbed",psychotic:"Psychotic",house:"House",hospital:"Hospital",farm:"Farm",theater:"Theater",church:"Church",courthouse:"Courthouse",park:"Park",nature:"Elysian Scenery"},Ga=i.a.createContext(void 0),Ka=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).previousTimeMS=0,n.logicTickAccumulatorMS=0,n.tick=function(e){var t=(e-n.previousTimeMS)*n.state.timeScale;n.previousTimeMS=e,t>0&&(n.logicTickAccumulatorMS+=t,n.state.world.simulate_beans(t),n.state.world.simulate_pickups(t),n.logicTickAccumulatorMS>2e3&&(n.state.world.simulate_world(),n.setState({world:n.state.world}),n.logicTickAccumulatorMS=0)),window.requestAnimationFrame(n.tick)},n.cheatMode=!1,n.keyupHandler=function(e){" "===e.key?n.state.timeScale>0?n.setState({timeScale:0}):n.setState({timeScale:1}):"Escape"===e.key?n.setState({activeModal:null}):n.cheatMode&&"B"===e.key?(n.state.world.alien.energy.amount+=n.state.world.alien.difficulty.cost.hex.beam.energy||0,n.beam(n.state.world.cities[0],{q:0,r:0})):n.cheatMode&&"Q"===e.key?(n.state.world.cities[0].book.getBuildings().filter((function(e){return"farm"===e.type})).length<1&&(n.state.world.alien.energy.amount+=n.state.world.alien.difficulty.cost.emptyHex.build.farm.energy||0,n.state.world.alien.bots.amount+=n.state.world.alien.difficulty.cost.emptyHex.build.farm.bots||0,n.build(n.state.world.cities[0],{q:1,r:1},"farm"),n.state.world.alien.energy.amount+=n.state.world.alien.difficulty.cost.emptyHex.build.house.energy||0,n.state.world.alien.bots.amount+=n.state.world.alien.difficulty.cost.emptyHex.build.house.bots||0,n.build(n.state.world.cities[0],{q:1,r:0},"house"),n.state.world.alien.energy.amount+=n.state.world.alien.difficulty.cost.emptyHex.build.hospital.energy||0,n.state.world.alien.bots.amount+=n.state.world.alien.difficulty.cost.emptyHex.build.hospital.bots||0,n.build(n.state.world.cities[0],{q:0,r:1},"hospital")),n.state.world.alien.energy.amount+=4*(n.state.world.alien.difficulty.cost.hex.beam.energy||0),n.beam(n.state.world.cities[0],{q:0,r:0}),n.beam(n.state.world.cities[0],{q:1,r:0}),n.beam(n.state.world.cities[0],{q:0,r:1}),n.beam(n.state.world.cities[0],{q:1,r:1})):n.cheatMode&&"S"===e.key&&n.state.world.beans.get.forEach((function(e){n.state.world.alien.difficulty.cost.bean.scan.energy&&n.state.world.alien.energy.amount<n.state.world.alien.difficulty.cost.bean.scan.energy&&(n.state.world.alien.energy.amount+=n.state.world.alien.difficulty.cost.bean.scan.energy),n.scan(e)})),n.cheatMode=e.shiftKey&&"C"===e.key},n.foundParty=function(e){n.state.world.party.name=e.name,n.state.world.party.slogan=e.slogan,n.state.world.cities[0].name=e.name,e.community&&(n.state.world.party.community=e.community),e.ideal&&(n.state.world.party.ideals=e.ideal);var t=n.state.world.cities.find((function(t){return t.key==e.cityKey}));t&&n.state.world.party,n.state.world.calculateComputedState(),n.setState({world:n.state.world,activeModal:null})},n.build=function(e,t,a){var i=n.difficulty.cost.emptyHex.build[a];n.state.world.alien.canAfford(i)&&(n.state.world.alien.purchase(i),Ht(e,a,t,e.economy)),n.setState({world:n.state.world})},n.changeEnterprise=function(e,t){n.setState({world:n.state.world})},n.upgrade=function(e,t){var a=n.difficulty.cost.hex.upgrade;n.state.world.alien.tryPurchase(a)&&(t.upgraded=!0),n.setState({world:n.state.world})},n.beam=function(e,t){var a=n.difficulty.cost.hex.beam;if(n.state.world.alien.canAfford(a)){n.state.world.alien.purchase(a);var i=new Pt(e.ufos.length,t,"beam-in");e.ufos.push(i),window.setTimeout((function(){e.beans.push(zt(e,t)),n.setState({world:n.state.world})}),3e3),n.setState({world:n.state.world},(function(){n.removeUFO(e,i.key)}))}},n.buyBots=function(e){var t=n.difficulty.cost.market.resource.bots;n.state.world.alien.tryPurchase(t,e)&&(n.state.world.alien.bots.amount+=e,n.state.world.alien.bots.change.publish({change:e})),n.setState({world:n.state.world})},n.buyEnergy=function(e){var t=n.difficulty.cost.market.resource.bots;n.state.world.alien.tryPurchase(t,e)&&(n.state.world.alien.energy.amount+=e,n.state.world.alien.energy.change.publish({change:e})),n.setState({world:n.state.world})},n.scrubHedons=function(){var e=n.difficulty.cost.market.scrubHedons;if(n.state.world.alien.tryPurchase(e)){var t=n.state.world.alien.hedons.amount;n.state.world.alien.hedons.amount=0,n.state.world.alien.hedons.change.publish({change:-t})}n.setState({world:n.state.world})},n.buyTrait=function(e){if(n.state.world.alien.tryPurchase(e.cost)){var t=n.state.world.alien.beliefInventory.get.find((function(t){return t.trait===e.trait}));t?(t.charges+=3,n.state.world.alien.beliefInventory.set(Object(o.a)(n.state.world.alien.beliefInventory.get))):n.state.world.alien.beliefInventory.push({trait:e.trait,charges:3})}n.setState({world:n.state.world})},n.foundCharity=function(e,t,a){n.state.world.addCharity(e,t,a),n.setState({world:n.state.world})},n.vaporize=function(e){n.state.world.alien.tryPurchase(n.state.world.alien.difficulty.cost.bean.vaporize)&&(e.city&&e.die("vaporization"),n.setState({world:n.state.world}))},n.abduct=function(e){var t;n.state.world.alien.tryPurchase(n.state.world.alien.difficulty.cost.bean.abduct)&&(e.abduct(n.state.world.alien),null===(t=e.city)||void 0===t||t.beans.remove(e),n.setState({world:n.state.world}))},n.enactLaw=function(e){n.state.world.law.enact(e),n.setState({world:n.state.world})},n.revokeLaw=function(e){n.state.world.law.enact(e),n.setState({world:n.state.world})},n.releaseBean=function(){if(n.state.world.alien.abductedBeans.length>0){var e,t=n.state.world.alien.abductedBeans.shift();if(t instanceof Ie)t.lifecycle="alive",null===(e=t.city)||void 0===e||e.beans.push(t);else window.alert("releasing data beans is unimplemented")}},n.setResearch=function(e){n.state.world.alien.currentlyResearchingTech=e,n.setState({world:n.state.world})},n.scan=function(e){return!!n.state.world.alien.tryPurchase(n.state.world.alien.difficulty.cost.bean.scan)&&(n.state.world.alien.scanned_bean[e.key]=!0,e.beliefs.forEach((function(e){n.state.world.alien.seenBeliefs.get.has(e)||n.state.world.alien.seenBeliefs.add(e,!0)})),n.state.world.sfx.play("scan"),n.setState({world:n.state.world}),!0)},n.washCommunity=function(e,t){if(e.canPurchase(n.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal))return e.loseSanity(n.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity||0),"ego"===e.community?e.community="state":e.community="ego",n.setState({world:n.state.world}),!0},n.washMotive=function(e,t){if(e.canPurchase(n.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal))return e.loseSanity(n.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity||0),"prog"===e.ideals?e.ideals="trad":e.ideals="prog",n.setState({world:n.state.world}),!0},n.washNarrative=function(e,t){if(e.canPurchase(n.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal)){e.loseSanity(n.state.world.alien.difficulty.cost.bean_brain.brainwash_ideal.sanity||0);for(var a=e.faith;e.faith===a;)e.faith=Ft(["rocket","dragon","music","noFaith"]);return n.setState({world:n.state.world}),!0}},n.washBelief=function(e,t){if(e.canPurchase(n.state.world.alien.difficulty.cost.bean_brain.brainwash_secondary)){e.beliefs.splice(e.beliefs.indexOf(t),1),e.loseSanity(n.state.world.alien.difficulty.cost.bean_brain.brainwash_secondary.sanity||0);var a=n.state.world.alien.beliefInventory.get.find((function(e){return e.trait===t}));return a?(a.charges+=3,n.state.world.alien.beliefInventory.set(Object(o.a)(n.state.world.alien.beliefInventory.get))):n.state.world.alien.beliefInventory.push({trait:t,charges:3}),n.state.world.sfx.play("wash_out"),n.setState({world:n.state.world}),!0}},n.implantBelief=function(e,t){if(e.canPurchase(n.state.world.alien.difficulty.cost.bean_brain.brainimplant_secondary)&&n.state.world.alien.beliefInventory.get.filter((function(e){return e.trait==t&&e.charges>0})))return e.beliefs.push(t),n.state.world.alien.useCharge(t),n.state.world.sfx.play("wash_in"),e.loseSanity(n.state.world.alien.difficulty.cost.bean_brain.brainimplant_secondary.sanity||0),n.setState({world:n.state.world}),!0},n.setPolicy=function(e,t){n.state.world.party.platform[e]=t,n.state.world.calculateComputedState(),n.setState({world:n.state.world})},n.onDeath=function(e){n.state.world.sfx.play("death"),n.startSpotlight(e)},n.timescaleBeforeSpotlight=1,n.state={world:Lt(),activeCityID:null,activeBeanID:null,activeHex:null,activeMain:"geo",activeModal:"greeting",activeRightPanel:"overview",timeScale:0,spotlightEvent:void 0},n.state.world.calculateComputedState(),n.state.world.bus.death.subscribe(n.onDeath),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;document.addEventListener("keyup",this.keyupHandler,!1),window.requestAnimationFrame((function(t){e.previousTimeMS=t,window.requestAnimationFrame(e.tick)}))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keyup",this.keyupHandler)}},{key:"removeUFO",value:function(e,t){window.setTimeout((function(){var a=e.ufos.findIndex((function(e){return e.key===t}));a>-1&&e.ufos.splice(a,1)}),7e3)}},{key:"startSpotlight",value:function(e){var t=this;this.timescaleBeforeSpotlight=this.state.timeScale,this.setState({spotlightEvent:e,timeScale:0},(function(){setTimeout((function(){return t.endSpotlight()}),5e3)}))}},{key:"endSpotlight",value:function(){this.setState({timeScale:this.timescaleBeforeSpotlight,spotlightEvent:void 0})}},{key:"getPanel",value:function(){var e=this;switch(this.state.activeRightPanel){case"overview":if(null==this.state.activeCityID)return i.a.createElement(Vt,{beans:this.state.world.beans,utopia:this.state.world.party,clearCity:function(){return e.setState({activeCityID:null})},alien:this.state.world.alien});var t=this.state.world.cities.find((function(t){return t.key==e.state.activeCityID}));if(t){if(null!=this.state.activeHex)return i.a.createElement(_a,{city:t,hex:this.state.activeHex,difficulty:this.state.world.alien.difficulty,clearHex:function(){return e.setState({activeHex:null})},beam:function(a){return e.beam(t,a)},upgrade:function(a){return e.upgrade(t,a)},build:function(a,n){e.build(t,a,n)},changeEnterprise:function(a){return e.changeEnterprise(t,a)}});if(null!=this.state.activeBeanID){var a=t.beans.get.find((function(t){return t.key==e.state.activeBeanID}));if(a)return i.a.createElement(ua,{bean:a,city:t,alien:this.state.world.alien,economy:this.state.world.economy,party:this.state.world.party,bus:this.state.world.bus,law:this.state.world.law,scan:this.scan,vaporize:this.vaporize,brainwash:function(){return e.setState({activeModal:"brainwash"})},abduct:this.abduct,gift:function(){return e.setState({activeModal:"brainwash"})},clearCity:function(){return e.setState({activeCityID:null,activeBeanID:null})}})}return i.a.createElement(Vt,{beans:null===t||void 0===t?void 0:t.beans,utopia:this.state.world.party,city:t,clearCity:function(){return e.setState({activeCityID:null})},alien:this.state.world.alien})}return i.a.createElement("div",null);case"goals":return i.a.createElement(ba,{player:this.state.world.alien,progress:this.state.world.alien});case"events":return i.a.createElement(la,{events:this.state.world.bus.buffer,selectBean:function(t){t&&e.setState({activeCityID:e.state.world.cities[0].key,activeBeanID:t,activeHex:null,activeRightPanel:"overview"})}});case"market":return i.a.createElement(Ha,{buyEnergy:this.buyEnergy,buyBots:this.buyBots,scrubHedons:this.scrubHedons,buyTrait:this.buyTrait,player:this.state.world.alien,market:this.state.world.marketTraitsForSale})}}},{key:"renderGeo",value:function(){var e=this,t=this.state.world.economy.getCostOfLiving();return this.state.world.cities.map((function(a){return i.a.createElement(ra,{tile:a,city:a,costOfLiving:t,key:a.key,spotlightEvent:e.state.spotlightEvent,activeBeanID:e.state.activeBeanID,onClick:function(){return e.setState({activeCityID:a.key,activeRightPanel:"overview",activeHex:null,activeBeanID:null})},onBeanClick:function(t){return e.setState({activeCityID:a.key,activeRightPanel:"overview",activeHex:null,activeBeanID:t.key})},onHexClick:function(t){e.setState({activeCityID:a.key,activeHex:t,activeBeanID:null,activeRightPanel:"overview"})}})}))}},{key:"render",value:function(){var e=this,t=Te[this.state.world.date.season];return i.a.createElement("div",{className:"canvas"},i.a.createElement(Ga.Provider,{value:this.state.world.sfx},"network"===this.state.activeMain?i.a.createElement("div",{className:"canvas"},i.a.createElement(pa,{costOfLiving:this.state.world.economy.getCostOfLiving(),beans:this.state.world.beans,onClick:function(t){return e.setState({activeCityID:t.cityKey,activeRightPanel:"overview",activeBeanID:t.key,activeHex:null})}})):i.a.createElement(ya.b,{defaultScale:1,wheel:{step:48}},i.a.createElement(ya.a,null,i.a.createElement("div",{className:"world"},this.renderGeo()))),i.a.createElement("div",{className:"overlay"},i.a.createElement(Gt,{show:"greeting"==this.state.activeModal,onClick:function(){return e.setState({activeModal:null})}},i.a.createElement(qa,null)),i.a.createElement(Gt,{show:"party_creation"==this.state.activeModal,onClick:function(){return e.setState({activeModal:null})},hideCloseButton:!0},i.a.createElement(ha,{cities:this.state.world.cities,onFound:this.foundParty})),i.a.createElement(Gt,{show:"gov"==this.state.activeModal,onClick:function(){return e.setState({activeModal:null})}},i.a.createElement(Ea,{world:this.state.world,enactLaw:this.enactLaw,revokeLaw:this.revokeLaw})),i.a.createElement(Gt,{show:"polisci"==this.state.activeModal,onClick:function(){return e.setState({activeModal:null})}},i.a.createElement(xa,{release:this.releaseBean,setResearch:this.setResearch,player:this.state.world.alien})),i.a.createElement(Gt,{show:"campaign"==this.state.activeModal,onClick:function(){return e.setState({activeModal:null})}},i.a.createElement(va,null)),i.a.createElement(Gt,{show:"economy"==this.state.activeModal,onClick:function(){return e.setState({activeModal:null})}},"economy"==this.state.activeModal?i.a.createElement(oa,{world:this.state.world}):""),i.a.createElement(Gt,{show:"traits"==this.state.activeModal,onClick:function(){return e.setState({activeModal:null})}},i.a.createElement(Ra,{seenBeliefs:this.state.world.alien.seenBeliefs,beliefInventory:this.state.world.alien.beliefInventory})),i.a.createElement(Gt,{show:"brainwash"==this.state.activeModal,onClick:function(){return e.setState({activeModal:null})}},"brainwash"==this.state.activeModal?i.a.createElement(Aa,{world:this.state.world,beanID:this.state.activeBeanID,washCommunity:this.washCommunity,washMotive:this.washMotive,washNarrative:this.washNarrative,washBelief:this.washBelief,implantBelief:this.implantBelief}):""),i.a.createElement("div",{className:"left"},i.a.createElement("div",{className:"top"},i.a.createElement("span",null,"\ud83d\udc7d Alien \ud83c\udf0d Utopia \ud83d\udd2c Lab"),i.a.createElement("span",null,"\xa0Year ",this.state.world.date.year,",\xa0",t," ",this.state.world.date.day," ",this.renderHour()),i.a.createElement(Sa,{timeScale:this.state.timeScale,setTimeScale:function(t){e.setState({timeScale:t})}}),i.a.createElement(Na,{setActiveMain:function(t){return e.setState({activeMain:t})},activeMain:this.state.activeMain}),i.a.createElement("span",null)),i.a.createElement("div",{className:"bottom"},i.a.createElement(da,{changeEvent:this.state.world.alien.energy.change,icon:"\u26a1\ufe0f"},i.a.createElement(fa,{icon:"\u26a1\ufe0f",label:"Energy"},this.state.world.alien.energy.amount.toFixed(1))),i.a.createElement(da,{changeEvent:this.state.world.alien.bots.change,icon:"\ud83e\udd16"},i.a.createElement(fa,{icon:"\ud83e\udd16",label:"Bots"},this.state.world.alien.bots.amount.toFixed(1))),i.a.createElement(da,{changeEvent:this.state.world.alien.hedons.change,icon:"\ud83d\udc4d"},i.a.createElement(fa,{icon:"\ud83d\udc4d",label:"Hedons"},this.state.world.alien.hedons.amount.toFixed(0))),i.a.createElement("span",null,i.a.createElement("button",{type:"button",className:"callout",onClick:function(){return e.setState({activeModal:"economy"})}},"\ud83d\udcca State of the Utopia"),i.a.createElement("button",{type:"button",className:"callout",onClick:function(){return e.setState({activeModal:"gov"})}},"\ud83d\uddf3\ufe0f Gov"),i.a.createElement("button",{type:"button",className:"callout",onClick:function(){return e.setState({activeModal:"polisci"})}},"\ud83e\uddea Research"),i.a.createElement(ma,{changeEvent:this.state.world.alien.seenBeliefs.onAdd,icon:"\ud83e\udde0"},i.a.createElement("button",{type:"button",className:"callout",onClick:function(){return e.setState({activeModal:"traits"})}},"\ud83e\udde0 Traits"))))),i.a.createElement("div",{className:"right"},i.a.createElement("div",{className:"full-width-tabs"},i.a.createElement("button",{onClick:function(){return e.setState({activeRightPanel:"overview"})}},"\ud83d\udcc8 Info"),i.a.createElement("button",{onClick:function(){return e.setState({activeRightPanel:"market"})}},"\ud83d\udecd\ufe0f Market"),i.a.createElement("button",{onClick:function(){return e.setState({activeRightPanel:"events"})}},i.a.createElement(Fa,{event:this.state.world.bus.speechcrime,eventIcon:"\ud83d\udea8",eventClass:"police-siren"},"\ud83d\udce3")," Events"),i.a.createElement("button",{onClick:function(){return e.setState({activeRightPanel:"goals"})}},"\ud83c\udfc6 Goals")),i.a.createElement("div",{className:"right-panel"},this.getPanel())))))}},{key:"renderHour",value:function(){switch(this.state.world.date.hour){default:return"\u2600\ufe0f";case De.Evening:return"\ud83c\udf07";case De.Morning:return"\ud83c\udf04";case De.Midnight:return"\ud83c\udf19"}}},{key:"difficulty",get:function(){return this.state.world.alien.difficulty}}]),a}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(Ka,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[16,1,2]]]);
//# sourceMappingURL=main.8f260fc1.chunk.js.map